#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ПриЗаписи(Отказ, Замещение)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	Если Не ДополнительныеСвойства.Свойство("ПропуститьОбновлениеДанныхМероприятия")
		Или Не ДополнительныеСвойства.ПропуститьОбновлениеДанныхМероприятия Тогда
		РегистрыСведений.ДанныеМероприятий.ОбновитьДанныеМероприятия(Отбор.Мероприятие.Значение);
	КонецЕсли;
	
	Если Количество() > 0 И Отбор.Найти("Мероприятие") <> Неопределено Тогда
		
		Мероприятие = Отбор.Мероприятие.Значение;
		
		// Рабочая группа мероприятия.
		Если Не ДополнительныеСвойства.Свойство("ПропуститьРасширениеРабочейГруппыМероприятия")
			Или Не ДополнительныеСвойства.ПропуститьРасширениеРабочейГруппыМероприятия Тогда
			ТипКонтейнеровПользователей = Метаданные.ОпределяемыеТипы.КонтейнерыСотрудников.Тип;
			ТаблицаНабора = РаботаСРабочимиГруппами.ПолучитьРабочуюГруппуДокумента(Мероприятие);
			КолСтрокДоДобавления = ТаблицаНабора.Количество();
			Для Каждого Запись Из ЭтотОбъект Цикл
				Если ТипКонтейнеровПользователей.СодержитТип(ТипЗнч(Запись.Исполнитель)) Тогда
					РаботаСРабочимиГруппами.ДобавитьУчастникаВТаблицуНабора(
						ТаблицаНабора, Запись.Исполнитель, Ложь);
				КонецЕсли;
			КонецЦикла;
			Если ТаблицаНабора.Количество() > КолСтрокДоДобавления Тогда
				РаботаСРабочимиГруппами.ПерезаписатьРабочуюГруппуОбъекта(
					Мероприятие, ТаблицаНабора, Истина);
			КонецЕсли;
		КонецЕсли;
		
		// Рабочая группа документа-предмета.
		Если ДополнительныеСвойства.Свойство("ДополнительныеПараметры")
			И ДополнительныеСвойства.ДополнительныеПараметры.Свойство("ОсновныеРеквизитыМероприятия") Тогда
			РеквизитыМероприятия = ДополнительныеСвойства.ДополнительныеПараметры.ОсновныеРеквизитыМероприятия;
		Иначе
			РеквизитыМероприятия = УправлениеМероприятиями.ОсновныеРеквизитыМероприятия(Мероприятие);
		КонецЕсли;
		Предмет = РеквизитыМероприятия.Предмет;
		Если РаботаСРабочимиГруппами.ПоОбъектуВедетсяАвтоматическоеЗаполнениеРабочейГруппы(Предмет) Тогда
			ТипКонтейнеровПользователей = Метаданные.ОпределяемыеТипы.КонтейнерыСотрудников.Тип;
			ТаблицаНабора = РаботаСРабочимиГруппами.ПолучитьРабочуюГруппуДокумента(Предмет);
			КолСтрокДоДобавления = ТаблицаНабора.Количество();
			Для Каждого Запись Из ЭтотОбъект Цикл
				Если ТипКонтейнеровПользователей.СодержитТип(ТипЗнч(Запись.Исполнитель)) Тогда
					РаботаСРабочимиГруппами.ДобавитьУчастникаВТаблицуНабора(
						ТаблицаНабора, Запись.Исполнитель, Ложь);
				КонецЕсли;
			КонецЦикла;
			Если ТаблицаНабора.Количество() > КолСтрокДоДобавления Тогда
				РаботаСРабочимиГруппами.ПерезаписатьРабочуюГруппуОбъекта(Предмет, ТаблицаНабора, Истина);
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Иначе
ВызватьИсключение НСтр("ru = 'Недопустимый вызов объекта на клиенте.'");
#КонецЕсли