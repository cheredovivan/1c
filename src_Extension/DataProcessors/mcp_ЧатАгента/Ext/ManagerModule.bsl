#Область ПрограммныйИнтерфейс

// Обрабатывает запрос пользователя и возвращает ответ агента
//
// Параметры:
//  ТекстЗапроса - Строка - текст запроса пользователя
//  Сессия - Строка - идентификатор сессии диалога
//
// Возвращаемое значение:
//  Структура - результат обработки:
//   * Успешно - Булево
//   * ТекстОтвета - Строка - текст ответа агента
//   * Ошибка - Строка - текст ошибки (если Успешно = Ложь)
//
Функция ОбработатьЗапрос(ТекстЗапроса, Сессия) Экспорт
	
	Пользователь = ПараметрыСеанса.ТекущийПользователь;
	
	Результат = mcp_АгентОбработчик.ОбработатьЗапросПользователя(ТекстЗапроса, Пользователь, Сессия);
	
	Возврат Результат;
	
КонецФункции

// Получает историю диалога для отображения
//
// Параметры:
//  Сессия - Строка - идентификатор сессии
//
// Возвращаемое значение:
//  ТаблицаЗначений - история диалога с колонками:
//   * Роль - Строка
//   * ТекстСообщения - Строка
//   * ВремяСообщения - Дата
//
Функция ПолучитьИсторию(Сессия) Экспорт
	
	Пользователь = ПараметрыСеанса.ТекущийПользователь;
	
	Возврат mcp_АгентОбработчик.ПолучитьИсториюДиалога(Пользователь, Сессия);
	
КонецФункции

// Очищает историю диалога
//
// Параметры:
//  Сессия - Строка - идентификатор сессии
//
Процедура ОчиститьИсторию(Сессия) Экспорт
	
	Пользователь = ПараметрыСеанса.ТекущийПользователь;
	
	mcp_АгентОбработчик.ОчиститьИсториюДиалога(Пользователь, Сессия);
	
КонецПроцедуры

// Обрабатывает запрос пользователя в фоновом режиме
// Используется для запуска через ФоновыеЗадания.Выполнить()
//
// Параметры:
//  ТекстЗапроса - Строка - текст запроса пользователя
//  Сессия - Строка - идентификатор сессии диалога
//  Пользователь - СправочникСсылка.Пользователи - пользователь (передаётся явно, т.к. в фоне параметры сеанса другие)
//  АдресРезультата - Строка - адрес во временном хранилище для записи результата
//
Процедура ОбработатьЗапросФоновое(ТекстЗапроса, Сессия, Пользователь, АдресРезультата) Экспорт
	
	Результат = mcp_АгентОбработчик.ОбработатьЗапросПользователя(ТекстЗапроса, Пользователь, Сессия);
	
	ПоместитьВоВременноеХранилище(Результат, АдресРезультата);
	
КонецПроцедуры

#КонецОбласти
