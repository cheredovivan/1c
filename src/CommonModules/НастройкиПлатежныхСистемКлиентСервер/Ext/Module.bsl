///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2025, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////
//
////////////////////////////////////////////////////////////////////////////////
// Подсистема "ИнтернетПоддержкаПользователей.НастройкиПлатежныхСистем".
// ОбщийМодуль.НастройкиПлатежныхСистемКлиентСервере.
// 
// Клиент серверные методы работы с платежными системами:
//  - статусы операций;
//  - обработка нечитаемых и запрещенных символов;
//  - имена подсистем для алгоритмов.
//  
////////////////////////////////////////////////////////////////////////////////
#Область ПрограммныйИнтерфейс

#Область СтатусыОпераций

// Возвращает статус операции "Выполнена".
//
// Возвращаемое значение:
//  Строка - код состояния.
//
Функция СтатусОперацииВыполнена() Экспорт
	
	Возврат "Выполнена";
	
КонецФункции

// Возвращает статус операции "Выполняется".
//
// Возвращаемое значение:
//  Строка - код состояния.
//
Функция СтатусОперацииВыполняется() Экспорт
	
	Возврат "Выполняется";
	
КонецФункции

// Возвращает статус операции "Отменена".
//
// Возвращаемое значение:
//  Строка - код состояния.
//
Функция СтатусОперацииОтменена() Экспорт
	
	Возврат "Отменена";
	
КонецФункции

// Возвращает статус операции "Ошибка".
//
// Возвращаемое значение:
//  Строка - код состояния.
//
Функция СтатусОперацииОшибка() Экспорт
	
	Возврат "Ошибка";
	
КонецФункции

// Возвращает статус операции "ТребуетсяПодтверждение".
//
// Возвращаемое значение:
//  Строка - код состояния.
//
Функция СтатусОперацииТребуетсяПодтверждение() Экспорт
	
	Возврат "ТребуетсяПодтверждение";
	
КонецФункции

// Возвращает статус операции "Отклонена".
//
// Возвращаемое значение:
//  Строка - код состояния.
//
Функция СтатусОперацииОтклонена() Экспорт
	
	Возврат "Отклонена";
	
КонецФункции

#КонецОбласти

#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

// Удаляет нечитаемые символы из строки.
//
// Параметры:
//  ИсходнаяСтрока - Строка - данные аутентификации, которые необходимо обработать.
//
// Возвращаемое значение:
//  Строка - результат обработки.
//
Функция УдалитьНечитаемыеСимволы(Знач ИсходнаяСтрока) Экспорт
	
	НечитаемыеСимволы = Новый Массив();
	НечитаемыеСимволы.Добавить(Символы.ВК);
	НечитаемыеСимволы.Добавить(Символы.ВТаб);
	НечитаемыеСимволы.Добавить(Символы.НПП);
	НечитаемыеСимволы.Добавить(Символы.ПС);
	НечитаемыеСимволы.Добавить(Символы.ПФ);
	НечитаемыеСимволы.Добавить(Символы.Таб);
	НечитаемыеСимволы.Добавить(Символ(182)); // символ параграфа
	НечитаемыеСимволы.Добавить(Символ(176)); // символ градуса
	НечитаемыеСимволы.Добавить(" ");
	
	Для Каждого НечитаемыйСимвол Из НечитаемыеСимволы Цикл
		ИсходнаяСтрока = СтрЗаменить(ИсходнаяСтрока, НечитаемыйСимвол, "");
	КонецЦикла;
	
	Возврат ИсходнаяСтрока;
	
КонецФункции

// Выполняет проверку наличия запрещенных символов в строке назначения платежа.
//
// Параметры:
//  НазначенияПлатежа - Строка - строка для проверки.
//
// Возвращаемое значение:
//  Массив из Строка - запрещенные символы найденные в строке.
//
Функция ЗапрещенныеСимволыНазначенияПлатежа(НазначенияПлатежа) Экспорт
	
	ЗапрещенныеСимволы = Новый Массив;
	Счетчик = 0;
	Если Не ЗначениеЗаполнено(НазначенияПлатежа) Тогда
		Возврат ЗапрещенныеСимволы;
	КонецЕсли;
	
	Пока Счетчик <= СтрДлина(НазначенияПлатежа) Цикл
		
		ТекущийСимвол = Сред(НазначенияПлатежа, Счетчик, 1);
		КодТекущегоСимвола = КодСимвола(ТекущийСимвол);
		СимволРазрешен = ((КодТекущегоСимвола >= 65 И КодТекущегоСимвола <= 90)
			Или (КодТекущегоСимвола >= 97 И КодТекущегоСимвола <= 122)
			Или (КодТекущегоСимвола >= 1040 И КодТекущегоСимвола <= 1103)
			Или (КодТекущегоСимвола >= 48 И КодТекущегоСимвола <= 57)
			Или (КодТекущегоСимвола >= 32 И КодТекущегоСимвола <= 47)
			Или (КодТекущегоСимвола >= 58 И КодТекущегоСимвола <= 64)
			Или (КодТекущегоСимвола >= 91 И КодТекущегоСимвола <= 96)
			Или КодТекущегоСимвола = 8470);
		Если Не СимволРазрешен Тогда
			ЗапрещенныеСимволы.Добавить(ТекущийСимвол);
		КонецЕсли;
		
		Счетчик = Счетчик + 1;
		
	КонецЦикла;
	
	Возврат ОбщегоНазначенияКлиентСервер.СвернутьМассив(
		ЗапрещенныеСимволы);
	
КонецФункции

// Возвращает строковое значение, определяющее, что текущая строка дерева является корневым элементом для подсистемы.
//
// Возвращаемое значение:
//  Строка - тип элемента.
//
Функция ИмяКорень() Экспорт
	
	Возврат "Корень"

КонецФункции

// Возвращает имя подсистемы "СистемаБыстрыхПлатежей"
//
// Возвращаемое значение:
//  Строка - тип элемента.
//
Функция ИмяПодсистемыСБП() Экспорт
	
	Возврат "СистемаБыстрыхПлатежей";
	
КонецФункции

// Возвращает имя подсистемы "ИнтернетЭквайринг"
//
// Возвращаемое значение:
//  Строка - тип элемента.
//
Функция ИмяПодсистемыЭквайринг() Экспорт
	
	Возврат "ИнтернетЭквайринг";
	
КонецФункции

// Формирует URL страницы подключения к Системе быстрых платежей.
//
// Параметры:
//  Идентификатор - Строка - идентификатор участника.
//  ИдентификаторНастройки - Строка - Идентификатор варианта настройки СБП.
//
// Возвращаемое значение:
//  Строка - адрес страницы подключения к СБП.
//
Функция АдресСтраницыПодключенияКСБП(
		Идентификатор,
		ИдентификаторНастройки) Экспорт
	
	Возврат СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
		"https://its.1c.ru/sbp?memberId=%1&useCase=%2",
		Идентификатор,
		ИдентификаторНастройки);
	
КонецФункции

#КонецОбласти
