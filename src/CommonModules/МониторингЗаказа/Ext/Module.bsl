
#Область СлужебныйПрограммныйИнтерфейс

// Настроить шкалу времени.
// 
// Параметры:
//  ДиаграммаГанта - ДиаграммаГанта - Диаграмма ганта
//  НачалоПериода - Дата - Начало периода
//  КонецПериода - Дата - Конец периода
Процедура НастроитьШкалуВремени(ДиаграммаГанта, НачалоПериода, КонецПериода) Экспорт
	
	// Шкала времени
	ШкалаВремениЭлементы = ДиаграммаГанта.ОбластьПостроения.ШкалаВремени.Элементы;
	
	БылоЭлементов = ШкалаВремениЭлементы.Количество();
	
	Если (КонецПериода - НачалоПериода > 50 * 86400) Тогда
		ШкалаВремениЭлементы.Добавить().Единица = ТипЕдиницыШкалыВремени.Месяц;
		ШкалаВремениЭлементы.Добавить().Единица = ТипЕдиницыШкалыВремени.День;
	Иначе
		ШкалаВремениЭлементы.Добавить().Единица = ТипЕдиницыШкалыВремени.Неделя;
		ШкалаВремениЭлементы.Добавить().Единица = ТипЕдиницыШкалыВремени.День;
	КонецЕсли;
	
	Если БылоЭлементов > 0 Тогда
		Для Сч = 0 По БылоЭлементов - 1 Цикл
			ШкалаВремениЭлементы.Удалить(ШкалаВремениЭлементы[0]);
		КонецЦикла;
	КонецЕсли;
	
	Если ДиаграммаГанта.ОбластьПостроения.ШкалаВремени.Элементы[0].Единица = ТипЕдиницыШкалыВремени.Месяц Тогда
		НачалоПериода = НачалоМесяца(НачалоПериода);
		КонецПериода  = КонецМесяца(КонецПериода);
	Иначе
		НачалоПериода = НачалоНедели(НачалоПериода);
		КонецПериода  = КонецНедели(КонецПериода);
	КонецЕсли;
	
	// Выделение выходных
	ДиаграммаГанта.ИнтервалыФона.Очистить();
	
	Графики = Новый Массив();
	Графики.Добавить(Константы.ОсновнойКалендарьПредприятия.Получить());
	
	РасписанияРаботы = ПланированиеПроизводства.РасписаниеРаботыПоГрафику(Графики, НачалоПериода, КонецПериода);
	РасписанияРаботы.Свернуть("ДатаГрафика");
	РасписанияРаботы.Индексы.Добавить("ДатаГрафика");
	
	ПериодыНедоступности = Новый ТаблицаЗначений();
	ПериодыНедоступности.Колонки.Добавить("Начало",    Новый ОписаниеТипов("Дата",,, Новый КвалификаторыДаты(ЧастиДаты.ДатаВремя)));
	ПериодыНедоступности.Колонки.Добавить("Окончание", Новый ОписаниеТипов("Дата",,, Новый КвалификаторыДаты(ЧастиДаты.ДатаВремя)));
	
	ТекущийПериод = НачалоПериода;
	Пока ТекущийПериод <= КонецПериода Цикл
		
		Если РасписанияРаботы.Найти(ТекущийПериод, "ДатаГрафика") = Неопределено Тогда
			НовыйПериод = ПериодыНедоступности.Добавить();
			НовыйПериод.Начало = ТекущийПериод;
			НовыйПериод.Окончание = КонецДня(НовыйПериод.Начало);
		КонецЕсли;
		
		ТекущийПериод = ТекущийПериод + 86400;
	КонецЦикла;
	
	Для каждого ДанныеНедоступности Из ПериодыНедоступности Цикл
		
		ДиаграммаГанта.ИнтервалыФона.Добавить(ДанныеНедоступности.Начало, ДанныеНедоступности.Окончание);
		
	КонецЦикла;
	
КонецПроцедуры
	
#КонецОбласти