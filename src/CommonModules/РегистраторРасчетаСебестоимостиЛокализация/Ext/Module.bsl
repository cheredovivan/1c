////////////////////////////////////////////////////////////////////////////////
// Процедуры, используемые для локализации документа "Регистратор расчета себестоимости".
// 
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

#Область Проведение

// Описывает учетные механизмы используемые в документе для регистрации в механизме проведения.
//
// Параметры:
//  МеханизмыДокумента - Массив Из Строка - список имен учетных механизмов, для которых будет выполнена
//              регистрация в механизме проведения.
//
Процедура ЗарегистрироватьУчетныеМеханизмы(МеханизмыДокумента) Экспорт
	
	//++ Локализация

	//++ НЕ УТ
	МеханизмыДокумента.Добавить("РегламентированныйУчет");
	//-- НЕ УТ

	//-- Локализация
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытий

// Вызывается из соответствующего обработчика документа
//
// Параметры:
//  Объект - ДокументОбъект - Обрабатываемый документ.
//  Отказ - Булево - Признак проведения документа.
//                   Если в теле процедуры-обработчика установить данному параметру значение Истина,
//                   то проведение документа выполнено не будет.
//  РежимПроведения - РежимПроведенияДокумента - В данный параметр передается текущий режим проведения.
//
Процедура ОбработкаПроведения(Объект, Отказ, РежимПроведения) Экспорт
	
КонецПроцедуры

#КонецОбласти

//++ НЕ УТ

#Область ПроводкиРегУчета

// Регистрирует документ к отражению в регламентированном учете.
//
// Параметры:
//	Документ - ДокументСсылка.РегистраторРасчетаСебестоимости - документ к отражению.
//
Процедура ЗарегистрироватьОтражениеДокумента(Документ) Экспорт
	
КонецПроцедуры

// Функция возвращает текст запроса для отражения документа в регламентированном учете.
//
// Возвращаемое значение:
//	Строка - Текст запроса
//
Функция ТекстОтраженияВРеглУчете() Экспорт
	
	ТекстЗапроса = "";
	
	//++ Локализация
	
	ТекстыОтражения = Новый Массив;
	ТекстыОтражения.Добавить(ТекстВыпускСобственнойПродукцииФактическаяСтоимостьМатериальныеЗатраты());
	ТекстыОтражения.Добавить(ТекстВыпускСобственнойПродукцииФактическаяСтоимостьПостатейныеРасходы());
	ТекстыОтражения.Добавить(ТекстВыпускСобственнойПродукцииФактическаяСтоимостьТрудозатраты());
	ТекстыОтражения.Добавить(ТекстВыпускСобственнойПродукцииОтклонениеНаСебестоимостьПродаж());
	ТекстыОтражения.Добавить(ТекстВыпускСобственнойПродукцииНаСкладОтклонение());
	ТекстыОтражения.Добавить(ТекстВыпускПродукцииСоСписаниемНаРасходыОтклонение());
	ТекстыОтражения.Добавить(ТекстВыпускПродукцииСоСписаниемНаАктивыПассивыОтклонение());
	ТекстыОтражения.Добавить(ТекстОтклоненияВСтоимостиФактуровкаПоставки());
	ТекстыОтражения.Добавить(ТекстОтклоненияВСтоимостиТовараНаСебестоимостьПродаж());
	ТекстыОтражения.Добавить(ТекстОтклоненияВСтоимостиТовараНаПрочиеРасходы());
	ТекстыОтражения.Добавить(ТекстОтклоненияВСтоимостиТовараНаПрочиеДоходы());
	ТекстыОтражения.Добавить(ТекстОтклоненияВСтоимостиТовараНаАктивыПассивы());
	ТекстыОтражения.Добавить(ТекстПеремещениеОтклоненийМеждуАналитиками());
	ТекстыОтражения.Добавить(ТекстПеремещениеОтклоненийСОбособленногоПодразделения());
	ТекстыОтражения.Добавить(ТекстПеремещениеОтклоненийНаОбособленноеПодразделение());
	ТекстыОтражения.Добавить(ТекстСписаниеПостатейныхРасходовНаВыпускПродукцииОтклонение());
	ТекстыОтражения.Добавить(ТекстВыпускПродукцииДавальцаРасход()); // Списание материалов давальца (Дт :: Кт 002, 003, 004)

	ТекстЗапроса = СтрСоединить(ТекстыОтражения, ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении());
	
	//-- Локализация
	
	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст запроса дополнительных временных таблиц,
// необходимых для отражения в регламентированном учете.
//
// Возвращаемое значение:
//   Строка - сформированный текст запроса.
//
Функция ТекстЗапросаВТОтраженияВРеглУчете() Экспорт
	
	ТекстыЗапроса = Новый Массив;
	
	//++ Локализация
	
	ТекстыЗапроса.Добавить(ТекстЗапросаВыручкаИСебестоимостьПродаж());
	ТекстыЗапроса.Добавить(ТекстЗапросаОтклоненияВСтоимостиТоваров());
	
	// Добавим пустой запрос, для того чтобы последний запрос тоже заканчивался на разделитель пакета запросов:
	ТекстыЗапроса.Добавить("");
	
	//-- Локализация
	
	ТекстЗапроса = СтрСоединить(ТекстыЗапроса, ОбщегоНазначения.РазделительПакетаЗапросов());
	Возврат ТекстЗапроса;
	
КонецФункции

//++ Локализация

// Функция возвращает текст фрагмента отражения фактической стоимости выпуска продукции при использовании плановой стоимости.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстВыпускСобственнойПродукцииФактическаяСтоимостьМатериальныеЗатраты() Экспорт

	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Выпуск собственной продукции (фактическая стоимость) (Дт 40 :: Кт 20)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	СтрокиДт.ИдентификаторСтроки КАК ИдентификаторСтроки,
	|
	|	СтрокиКт.Сумма КАК Сумма,
	|	СтрокиКт.СуммаУУ КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеДт,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыпускПродукции) КАК СчетДт,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСтоимости.Фактическая) КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиКт.СуммаНУ КАК СуммаНУДт,
	|	СтрокиКт.СуммаПР КАК СуммаПРДт,
	|	СтрокиКт.СуммаВР КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Производство) КАК ВидСчетаКт,
	|	СтрокиКт.ГруппаПродукции КАК АналитикаУчетаКт,
	|	СтрокиКт.ПодразделениеАналитики КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.ПодразделениеАналитики КАК ПодразделениеКт,
	|	СтрокиКт.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	СтрокиКт.ГруппаПродукции КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СуммаНУ КАК СуммаНУКт,
	|	СтрокиКт.СуммаПР КАК СуммаПРКт,
	|	СтрокиКт.СуммаВР КАК СуммаВРКт,
	|
	|	""Выпуск собственной продукции (фактическая стоимость)"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ВтСтоимости КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|		И СтрокиДт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И СтрокиДт.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ВыпускПродукции)
	|		И НЕ СтрокиДт.КорРазделУчета В (&ЗабалансовыеРазделыУчета)
	|		И (СтрокиДт.Сумма <> 0 ИЛИ СтрокиДт.СуммаУУ <> 0)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ВтСтоимости КАК СтрокиКт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиКт.Ссылка
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И СтрокиКт.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	|		И СтрокиКт.Период = СтрокиДт.Период
	|		И СтрокиКт.НастройкаХозяйственнойОперации = СтрокиДт.НастройкаХозяйственнойОперации
	|		И СтрокиКт.ИдентификаторФинЗаписи = СтрокиДт.ИдентификаторФинЗаписи";
	
	Возврат ТекстЗапроса;
	
КонецФункции
	
// Функция возвращает текст фрагмента отражения фактической стоимости выпуска продукции при использовании плановой стоимости.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстВыпускСобственнойПродукцииФактическаяСтоимостьПостатейныеРасходы() Экспорт

	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Выпуск собственной продукции (фактическая стоимость) (Дт 40 :: Кт 20)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	СтрокиДт.ИдентификаторСтроки КАК ИдентификаторСтроки,
	|
	|	СтрокиКт.СтоимостьРегл КАК Сумма,
	|	СтрокиКт.СтоимостьУпр КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеДт,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыпускПродукции) КАК СчетДт,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСтоимости.Фактическая) КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиКт.СтоимостьРегл - СтрокиКт.ПостояннаяРазница - СтрокиКт.ВременнаяРазница КАК СуммаНУДт,
	|	СтрокиКт.ПостояннаяРазница КАК СуммаПРДт,
	|	СтрокиКт.ВременнаяРазница КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Производство) КАК ВидСчетаКт,
	|	СтрокиКт.ГруппаПродукции КАК АналитикаУчетаКт,
	|	СтрокиКт.Подразделение КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.Подразделение КАК ПодразделениеКт,
	|	СтрокиКт.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	СтрокиКт.ГруппаПродукции КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СтоимостьРегл - СтрокиКт.ПостояннаяРазница - СтрокиКт.ВременнаяРазница КАК СуммаНУДКт,
	|	СтрокиКт.ПостояннаяРазница КАК СуммаПРКт,
	|	СтрокиКт.ВременнаяРазница КАК СуммаВРКт,
	|
	|	""Выпуск собственной продукции (фактическая стоимость)"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ВтСтоимости КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|		И СтрокиДт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И СтрокиДт.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ВыпускПродукции)
	|		И НЕ СтрокиДт.КорРазделУчета В (&ЗабалансовыеРазделыУчета)
	|		И (СтрокиДт.Сумма <> 0 ИЛИ СтрокиДт.СуммаУУ <> 0)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ПрочиеРасходыНезавершенногоПроизводства КАК СтрокиКт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиКт.Регистратор
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И СтрокиКт.Период = СтрокиДт.Период
	|		И СтрокиКт.НастройкаХозяйственнойОперации = СтрокиДт.НастройкаХозяйственнойОперации
	|		И СтрокиКт.ИдентификаторФинЗаписи = СтрокиДт.ИдентификаторФинЗаписи
	|		И СтрокиКт.Активность И НЕ СтрокиКт.Сторно";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст фрагмента отражения фактической стоимости выпуска продукции при использовании плановой стоимости.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстВыпускСобственнойПродукцииФактическаяСтоимостьТрудозатраты() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Выпуск собственной продукции (фактическая стоимость) (Дт 40 :: Кт 20)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	СтрокиДт.ИдентификаторСтроки КАК ИдентификаторСтроки,
	|
	|	СтрокиКт.СтоимостьРегл КАК Сумма,
	|	СтрокиКт.Стоимость КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеДт,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыпускПродукции) КАК СчетДт,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСтоимости.Фактическая) КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиКт.СтоимостьРегл - СтрокиКт.ПостояннаяРазница - СтрокиКт.ВременнаяРазница КАК СуммаНУДт,
	|	СтрокиКт.ПостояннаяРазница КАК СуммаПРДт,
	|	СтрокиКт.ВременнаяРазница КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Производство) КАК ВидСчетаКт,
	|	СтрокиКт.ГруппаПродукции КАК АналитикаУчетаКт,
	|	СтрокиКт.Подразделение КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.Подразделение КАК ПодразделениеКт,
	|	СтрокиКт.ПартияПроизводства.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	СтрокиКт.ГруппаПродукции КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СтоимостьРегл - СтрокиКт.ПостояннаяРазница - СтрокиКт.ВременнаяРазница КАК СуммаНУДКт,
	|	СтрокиКт.ПостояннаяРазница КАК СуммаПРКт,
	|	СтрокиКт.ВременнаяРазница КАК СуммаВРКт,
	|
	|	""Выпуск собственной продукции (фактическая стоимость)"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ВтСтоимости КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|		И СтрокиДт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И СтрокиДт.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ВыпускПродукции)
	|		И НЕ СтрокиДт.КорРазделУчета В (&ЗабалансовыеРазделыУчета)
	|		И (СтрокиДт.Сумма <> 0 ИЛИ СтрокиДт.СуммаУУ <> 0)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ТрудозатратыНезавершенногоПроизводства КАК СтрокиКт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиКт.Регистратор
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И СтрокиКт.Период = СтрокиДт.Период
	|		И СтрокиКт.НастройкаХозяйственнойОперации = СтрокиДт.НастройкаХозяйственнойОперации
	|		И СтрокиКт.ИдентификаторФинЗаписи = СтрокиДт.ИдентификаторФинЗаписи
	|		И СтрокиКт.Активность И НЕ СтрокиКт.Сторно";
	
	Возврат ТекстЗапроса;
	
КонецФункции
	
// Функция возвращает текст фрагмента отражения отклонения стоимости выпуска продукции на себестоимость продаж
// при использовании плановой стоимости.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстВыпускСобственнойПродукцииОтклонениеНаСебестоимостьПродаж() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Выпуск продукции (отклонение на себестоимость продаж) (Дт 90.02 :: Кт 40)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	СтрокиКт.ИдентификаторСтроки КАК ИдентификаторСтроки,
	|
	|	СтрокиДт.Сумма КАК Сумма,
	|	СтрокиДт.СуммаУУ КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	СтрокиДт.ВидСчета КАК ВидСчетаДт,
	|	СтрокиДт.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	СтрокиДт.Склад КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	СтрокиДт.ГруппаФинансовогоУчета КАК СубконтоДт1,
	|	СтрокиДт.Номенклатура КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиДт.СуммаНУ КАК СуммаНУДт,
	|	СтрокиДт.СуммаПР КАК СуммаПРДт,
	|	СтрокиДт.СуммаВР КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеКт,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыпускПродукции) КАК СчетКт,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСтоимости.Отклонение) КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиДт.СуммаНУ КАК СуммаНУКт,
	|	СтрокиДт.СуммаПР КАК СуммаПРКт,
	|	СтрокиДт.СуммаВР КАК СуммаВРКт,
	|
	|	""Выпуск продукции (отклонение на себестоимость продаж)"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ВыручкаИСебестоимостьПродаж КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ВтСтоимости КАК СтрокиКт
	|	ПО
	|		СтрокиДт.Ссылка = СтрокиКт.Ссылка
	|		И СтрокиДт.НастройкаХозяйственнойОперации = СтрокиКт.НастройкаХозяйственнойОперации
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И СтрокиКт.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ВыпускПродукции)
	|		И СтрокиКт.Период = СтрокиДт.Период
	|		И СтрокиКт.ИдентификаторФинЗаписи = СтрокиДт.ИдентификаторФинЗаписи";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст отклонения выпуска продукции на склад.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстВыпускСобственнойПродукцииНаСкладОтклонение() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Выпуск продукции на склад (отклонение) (Дт 43.ОС :: Кт 40)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	СтрокиДт.ИдентификаторФинЗаписи КАК ИдентификаторСтроки,
	|
	|	СтрокиДт.Сумма КАК Сумма,
	|	СтрокиДт.СуммаУУ КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ОтклоненияВСтоимости) КАК ВидСчетаДт,
	|	СтрокиДт.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	СтрокиДт.МестоУчета КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	СтрокиДт.Номенклатура КАК СубконтоДт1,
	|	СтрокиДт.МестоХранения КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиДт.СуммаНУ КАК СуммаНУДт,
	|	СтрокиДт.СуммаПР КАК СуммаПРДт,
	|	СтрокиДт.СуммаВР КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеКт,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыпускПродукции) КАК СчетКт,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСтоимости.Отклонение) КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиДт.СуммаНУ КАК СуммаНУКт,
	|	СтрокиДт.СуммаПР КАК СуммаПРКт,
	|	СтрокиДт.СуммаВР КАК СуммаВРКт,
	|
	|	""Выпуск продукции на склад (отклонение)"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|		И СтрокиДт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ВтСтоимости КАК СтрокиКт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиКт.Ссылка
	|		И СтрокиКт.Период = СтрокиДт.Период
	|		И СтрокиДт.НастройкаХозяйственнойОперации = СтрокиКт.НастройкаХозяйственнойОперации
	|		И СтрокиДт.ИдентификаторФинЗаписи = СтрокиКт.ИдентификаторФинЗаписи
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И СтрокиКт.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ВыпускПродукции)
	|		И (СтрокиКт.Сумма <> 0 ИЛИ СтрокиКт.СуммаУУ <> 0 ИЛИ СтрокиКт.СуммаНУ <> 0 ИЛИ СтрокиКт.СуммаПР <> 0 ИЛИ СтрокиКт.СуммаВР <> 0)
	|";

	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст фрагмента отражения отклонения стоимости выпуска продукции на статью расходов 
// при использовании плановой стоимости.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстВыпускПродукцииСоСписаниемНаРасходыОтклонение() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Выпуск продукции со списанием на расходы (отклонение) (Дт 25 :: Кт 40)
	|ВЫБРАТЬ
	|	СтрокиДт.Регистратор КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	СтрокиДт.СуммаРегл КАК Сумма,
	|	СтрокиДт.СуммаУпр КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаДт,
	|	СтрокиДт.СтатьяРасходов КАК АналитикаУчетаДт,
	|	СтрокиДт.Подразделение КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	СтрокиДт.СтатьяРасходов КАК СубконтоДт1,
	|	СтрокиДт.АналитикаРасходов КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиДт.СуммаРегл - СтрокиДт.ПостояннаяРазница - СтрокиДт.ВременнаяРазница КАК СуммаНУДт,
	|	СтрокиДт.ПостояннаяРазница КАК СуммаПРДт,
	|	СтрокиДт.ВременнаяРазница КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеКт,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыпускПродукции) КАК СчетКт,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСтоимости.Отклонение) КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СтоимостьРегл + СтрокиКт.ДопРасходыРегл + СтрокиКт.ТрудозатратыРегл
	|		+ СтрокиКт.ПостатейныеПостоянныеРегл + СтрокиКт.ПостатейныеПеременныеРегл
	|		- СтрокиКт.ПостояннаяРазница - СтрокиКт.ВременнаяРазница КАК СуммаНУКт,
	|	СтрокиКт.ПостояннаяРазница КАК СуммаПРКт,
	|	СтрокиКт.ВременнаяРазница КАК СуммаВРКт,
	|
	|	""Выпуск продукции со списанием на расходы (отклонение)"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ПрочиеРасходы КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Регистратор
	|		И СтрокиДт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И СтрокиДт.Активность И НЕ СтрокиДт.Сторно
	|		И СтрокиДт.РасчетСебестоимости
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.СебестоимостьТоваров КАК СтрокиКт
	|	ПО
	|		СтрокиДт.Регистратор = СтрокиКт.Регистратор
	|		И СтрокиКт.Период = СтрокиДт.Период
	|		И СтрокиДт.ИдентификаторФинЗаписи = СтрокиКт.ИдентификаторФинЗаписи
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И СтрокиКт.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ВыпускПродукции)
	|		И СтрокиКт.НастройкаХозяйственнойОперации = СтрокиДт.НастройкаХозяйственнойОперации
	|		И СтрокиКт.Активность И НЕ СтрокиКт.Сторно
	|		И СтрокиКт.РасчетСебестоимости";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст фрагмента отражения отклонения стоимости выпуска продукции на статью А/П 
// при использовании плановой стоимости.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстВыпускПродукцииСоСписаниемНаАктивыПассивыОтклонение() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Выпуск продукции со списанием на активы/пассивы (отклонение) (Дт 94 :: Кт 40)
	|ВЫБРАТЬ
	|	СтрокиДт.Регистратор КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	ВЫБОР
	|		КОГДА СтрокиДт.ДебетКредит = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет)
	|			ТОГДА СтрокиДт.СуммаРегл
	|		ИНАЧЕ -СтрокиДт.СуммаРегл 
	|	КОНЕЦ КАК Сумма,
	|	ВЫБОР
	|		КОГДА СтрокиДт.ДебетКредит = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет)
	|			ТОГДА СтрокиДт.СуммаУпр
	|		ИНАЧЕ -СтрокиДт.СуммаУпр 
	|	КОНЕЦ КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ПрочиеАктивыПассивы) КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	СтрокиДт.НастройкаСчетовУчета.СчетУчета КАК СчетДт,
	|	СтрокиДт.НастройкаСчетовУчета.Субконто1 КАК СубконтоДт1,
	|	СтрокиДт.НастройкаСчетовУчета.Субконто2 КАК СубконтоДт2,
	|	СтрокиДт.НастройкаСчетовУчета.Субконто3 КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	ВЫБОР
	|		КОГДА СтрокиДт.ДебетКредит = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет)
	|			ТОГДА СтрокиДт.СуммаРегл - СтрокиДт.ПостояннаяРазница - СтрокиДт.ВременнаяРазница
	|		ИНАЧЕ -(СтрокиДт.СуммаРегл - СтрокиДт.ПостояннаяРазница - СтрокиДт.ВременнаяРазница) 
	|	КОНЕЦ КАК СуммаНУДт,
	|	ВЫБОР
	|		КОГДА СтрокиДт.ДебетКредит = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет)
	|			ТОГДА СтрокиДт.ПостояннаяРазница
	|		ИНАЧЕ -СтрокиДт.ПостояннаяРазница
	|	КОНЕЦ КАК СуммаПРДт,
	|	ВЫБОР
	|		КОГДА СтрокиДт.ДебетКредит = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет)
	|			ТОГДА СтрокиДт.ВременнаяРазница
	|		ИНАЧЕ -СтрокиДт.ВременнаяРазница
	|	КОНЕЦ КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеКт,
	|	НЕОПРЕДЕЛЕНО КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ВыпускПродукции) КАК СчетКт,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСтоимости.Отклонение) КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СтоимостьРегл + СтрокиКт.ДопРасходыРегл + СтрокиКт.ТрудозатратыРегл
	|		+ СтрокиКт.ПостатейныеПостоянныеРегл + СтрокиКт.ПостатейныеПеременныеРегл
	|		- СтрокиКт.ПостояннаяРазница - СтрокиКт.ВременнаяРазница КАК СуммаНУКт,
	|	СтрокиКт.ПостояннаяРазница КАК СуммаПРКт,
	|	СтрокиКт.ВременнаяРазница КАК СуммаВРКт,
	|
	|	""Выпуск продукции со списанием на активы/пассивы (отклонение)"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ДвиженияПоПрочимАктивамПассивам КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Регистратор
	|		И СтрокиДт.Активность И НЕ СтрокиДт.Сторно
	|		И СтрокиДт.РасчетСебестоимости
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.СебестоимостьТоваров КАК СтрокиКт
	|	ПО
	|		СтрокиДт.Регистратор = СтрокиКт.Регистратор
	|		И СтрокиКт.Период = СтрокиДт.Период
	|		И СтрокиДт.ИдентификаторФинЗаписи = СтрокиКт.ИдентификаторФинЗаписи
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И СтрокиКт.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ВыпускПродукции)
	|		И СтрокиКт.НастройкаХозяйственнойОперации = СтрокиДт.НастройкаХозяйственнойОперации
	|		И СтрокиКт.Активность И НЕ СтрокиКт.Сторно
	|		И СтрокиКт.РасчетСебестоимости";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст отражения отклонений при фактуровке поставки.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстОтклоненияВСтоимостиФактуровкаПоставки() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Отражение доп. расходов (отклонение) (Дт 10.ТЗР :: Кт 60.НП)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	СтрокиДт.ИдентификаторФинЗаписи КАК ИдентификаторСтроки,
	|
	|	СтрокиДт.Сумма КАК Сумма,
	|	СтрокиДт.СуммаУУ КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ОтклоненияВСтоимости) КАК ВидСчетаДт,
	|	СтрокиДт.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	СтрокиДт.МестоУчета КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	СтрокиДт.Номенклатура КАК СубконтоДт1,
	|	СтрокиДт.МестоХранения КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиДт.СуммаНУ КАК СуммаНУДт,
	|	СтрокиДт.СуммаПР КАК СуммаПРДт,
	|	СтрокиДт.СуммаВР КАК СуммаВРДт,
	|
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.НеотфактурованныеПоставки) КАК ВидСчетаКт,
	|	СтрокиКт.АналитикаУчетаНоменклатуры.Договор.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.АналитикаУчетаНоменклатуры.Договор.Подразделение КАК ПодразделениеКт,
	|	СтрокиКт.АналитикаУчетаНоменклатуры.Договор.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	СтрокиКт.АналитикаУчетаНоменклатуры.Номенклатура КАК СубконтоКт1,
	|	СтрокиКт.АналитикаУчетаНоменклатуры.Контрагент КАК СубконтоКт2,
	|	СтрокиКт.АналитикаУчетаНоменклатуры.Договор КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СтоимостьРегл + СтрокиКт.ДопРасходыРегл + СтрокиКт.ТрудозатратыРегл
	|		+ СтрокиКт.ПостатейныеПостоянныеРегл + СтрокиКт.ПостатейныеПеременныеРегл
	|		- СтрокиКт.ПостояннаяРазница - СтрокиКт.ВременнаяРазница КАК СуммаНУКт,
	|	СтрокиКт.ПостояннаяРазница КАК СуммаПРКт,
	|	СтрокиКт.ВременнаяРазница КАК СуммаВРКт,
	|
	|	""Отклонения в стоимости товаров и работ"" КАК Содержание
	|
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|		И СтрокиДт.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
	|		РегистрНакопления.СебестоимостьТоваров КАК СтрокиКт
	|	ПО 
	|		СтрокиКт.Регистратор = СтрокиДт.Ссылка
	|		И СтрокиКт.Период = СтрокиДт.Период
	|		И СтрокиДт.НастройкаХозяйственнойОперации = СтрокиКт.НастройкаХозяйственнойОперации
	|		И СтрокиДт.ИдентификаторФинЗаписи = СтрокиКт.ИдентификаторФинЗаписи
	|		И СтрокиКт.Активность И НЕ СтрокиКт.Сторно
	|";

	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст фрагмента отражения отклонения в стоимости товара на себестоимость продаж.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстОтклоненияВСтоимостиТовараНаСебестоимостьПродаж() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Отклонения в стоимости товара на себестоимость продаж (Дт 90.02 :: Кт 10.ТЗР)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	СтрокиДт.ИдентификаторФинЗаписи КАК ИдентификаторСтроки,
	|
	|	СтрокиДт.Сумма КАК Сумма,
	|	СтрокиДт.СуммаУУ КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	СтрокиДт.ВидСчета КАК ВидСчетаДт,
	|	СтрокиДт.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	СтрокиДт.Склад КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	СтрокиДт.ГруппаФинансовогоУчета КАК СубконтоДт1,
	|	СтрокиДт.Номенклатура КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиДт.СуммаНУ КАК СуммаНУДт,
	|	СтрокиДт.СуммаПР КАК СуммаПРДт,
	|	СтрокиДт.СуммаВР КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ОтклоненияВСтоимости) КАК ВидСчетаКт,
	|	СтрокиКт.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	СтрокиКт.МестоУчета КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.Подразделение КАК ПодразделениеКт,
	|	СтрокиКт.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	СтрокиКт.Номенклатура КАК СубконтоКт1,
	|	СтрокиКт.МестоХранения КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СуммаНУ КАК СуммаНУКт,
	|	СтрокиКт.СуммаПР КАК СуммаПРКт,
	|	СтрокиКт.СуммаВР КАК СуммаВРКт,
	|
	|	""Отклонения в стоимости товара на себестоимость продаж"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ВыручкаИСебестоимостьПродаж КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиКт
	|	ПО
	|		СтрокиДт.Ссылка = СтрокиКт.Ссылка
	|		И СтрокиДт.Период = СтрокиКт.Период
	|		И СтрокиДт.НастройкаХозяйственнойОперации = СтрокиКт.НастройкаХозяйственнойОперации
	|		И СтрокиДт.ИдентификаторФинЗаписи = СтрокиКт.ИдентификаторФинЗаписи
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)";

	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст фрагмента отражения отклонения в стоимости товара на прочие расходы.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстОтклоненияВСтоимостиТовараНаПрочиеРасходы() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Отклонения в стоимости товара на прочие расходы (Дт 26 :: Кт 10.ТЗР)
	|ВЫБРАТЬ
	|	СтрокиДт.Регистратор КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	СтрокиДт.СуммаРегл КАК Сумма,
	|	СтрокиДт.СуммаУпр КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаДт,
	|	СтрокиДт.СтатьяРасходов КАК АналитикаУчетаДт,
	|	СтрокиДт.Подразделение КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	СтрокиДт.СтатьяРасходов КАК СубконтоДт1,
	|	СтрокиДт.АналитикаРасходов КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиДт.СуммаРегл - СтрокиДт.ПостояннаяРазница - СтрокиДт.ВременнаяРазница КАК СуммаНУДт,
	|	СтрокиДт.ПостояннаяРазница КАК СуммаПРДт,
	|	СтрокиДт.ВременнаяРазница КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ОтклоненияВСтоимости) КАК ВидСчетаКт,
	|	СтрокиКт.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	СтрокиКт.МестоУчета КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.Подразделение КАК ПодразделениеКт,
	|	СтрокиКт.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	СтрокиКт.Номенклатура КАК СубконтоКт1,
	|	СтрокиКт.МестоХранения КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СуммаНУ КАК СуммаНУКт,
	|	СтрокиКт.СуммаПР КАК СуммаПРКт,
	|	СтрокиКт.СуммаВР КАК СуммаВРКт,
	|
	|	""Отклонения в стоимости товара на прочие расходы"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ПрочиеРасходы КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Регистратор
	|		И СтрокиДт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И СтрокиДт.НастройкаХозяйственнойОперации <> ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ПеремещениеТоваровМеждуФилиалами)
	|		И СтрокиДт.Активность И НЕ СтрокиДт.Сторно
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиКт
	|	ПО
	|		СтрокиДт.Регистратор = СтрокиКт.Ссылка
	|		И СтрокиДт.Период = СтрокиКт.Период
	|		И СтрокиДт.НастройкаХозяйственнойОперации = СтрокиКт.НастройкаХозяйственнойОперации
	|		И СтрокиДт.ИдентификаторФинЗаписи = СтрокиКт.ИдентификаторФинЗаписи
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)";

	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст фрагмента отражения отклонения в стоимости товара на прочие доходы.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстОтклоненияВСтоимостиТовараНаПрочиеДоходы() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Отклонения в стоимости товара на прочие доходы (Дт 10.ТЗР :: Кт 91.01)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	-СтрокиДт.Сумма КАК Сумма,
	|	-СтрокиДт.СуммаУУ КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ОтклоненияВСтоимости) КАК ВидСчетаДт,
	|	СтрокиДт.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	СтрокиДт.МестоУчета КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	СтрокиДт.Номенклатура КАК СубконтоДт1,
	|	СтрокиДт.МестоХранения КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	-СтрокиДт.СуммаНУ КАК СуммаНУДт,
	|	-СтрокиДт.СуммаПР КАК СуммаПРДт,
	|	-СтрокиДт.СуммаВР КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Доходы) КАК ВидСчетаКт,
	|	СтрокиКт.СтатьяДоходов КАК АналитикаУчетаКт,
	|	СтрокиКт.Подразделение КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.Подразделение КАК ПодразделениеКт,
	|	СтрокиКт.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	СтрокиКт.СтатьяДоходов КАК СубконтоКт1,
	|	СтрокиКт.АналитикаДоходов КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	-СтрокиДт.СуммаНУ КАК СуммаНУКт,
	|	-СтрокиДт.СуммаПР КАК СуммаПРКт,
	|	-СтрокиДт.СуммаВР КАК СуммаВРКт,
	|
	|	""Отклонения в стоимости товара на прочие доходы"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|		И СтрокиДт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И СтрокиДт.НастройкаХозяйственнойОперации <> ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ПеремещениеТоваровМеждуФилиалами)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ПрочиеДоходы КАК СтрокиКт
	|	ПО
	|		СтрокиДт.Ссылка = СтрокиКт.Регистратор
	|		И СтрокиДт.Период = СтрокиКт.Период
	|		И СтрокиДт.НастройкаХозяйственнойОперации = СтрокиКт.НастройкаХозяйственнойОперации
	|		И СтрокиДт.ИдентификаторФинЗаписи = СтрокиКт.ИдентификаторФинЗаписи
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И СтрокиКт.Активность И НЕ СтрокиКт.Сторно
	|";

	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст фрагмента отражения отклонения в стоимости товара на прочие активы/пассивы.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстОтклоненияВСтоимостиТовараНаАктивыПассивы() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Отклонения в стоимости товара на прочие активы/пассивы (Дт 94 :: Кт 10.ТЗР)
	|ВЫБРАТЬ
	|	СтрокиДт.Регистратор КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	ВЫБОР
	|		КОГДА СтрокиДт.ДебетКредит = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет)
	|			ТОГДА СтрокиДт.СуммаРегл
	|		ИНАЧЕ -СтрокиДт.СуммаРегл 
	|	КОНЕЦ КАК Сумма,
	|	ВЫБОР
	|		КОГДА СтрокиДт.ДебетКредит = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет)
	|			ТОГДА СтрокиДт.СуммаУпр
	|		ИНАЧЕ -СтрокиДт.СуммаУпр 
	|	КОНЕЦ КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ПрочиеАктивыПассивы) КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	СтрокиДт.НастройкаСчетовУчета.СчетУчета КАК СчетДт,
	|	СтрокиДт.НастройкаСчетовУчета.Субконто1 КАК СубконтоДт1,
	|	СтрокиДт.НастройкаСчетовУчета.Субконто2 КАК СубконтоДт2,
	|	СтрокиДт.НастройкаСчетовУчета.Субконто3 КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	ВЫБОР
	|		КОГДА СтрокиДт.ДебетКредит = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет)
	|			ТОГДА СтрокиДт.СуммаРегл - СтрокиДт.ПостояннаяРазница - СтрокиДт.ВременнаяРазница
	|		ИНАЧЕ -(СтрокиДт.СуммаРегл - СтрокиДт.ПостояннаяРазница - СтрокиДт.ВременнаяРазница) 
	|	КОНЕЦ КАК СуммаНУДт,
	|	ВЫБОР
	|		КОГДА СтрокиДт.ДебетКредит = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет)
	|			ТОГДА СтрокиДт.ПостояннаяРазница
	|		ИНАЧЕ -СтрокиДт.ПостояннаяРазница
	|	КОНЕЦ КАК СуммаПРДт,
	|	ВЫБОР
	|		КОГДА СтрокиДт.ДебетКредит = ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет)
	|			ТОГДА СтрокиДт.ВременнаяРазница
	|		ИНАЧЕ -СтрокиДт.ВременнаяРазница
	|	КОНЕЦ КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ОтклоненияВСтоимости) КАК ВидСчетаКт,
	|	СтрокиКт.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	СтрокиКт.МестоУчета КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.Подразделение КАК ПодразделениеКт,
	|	СтрокиКт.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	СтрокиКт.Номенклатура КАК СубконтоКт1,
	|	СтрокиКт.МестоХранения КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СуммаНУ КАК СуммаНУКт,
	|	СтрокиКт.СуммаПР КАК СуммаПРКт,
	|	СтрокиКт.СуммаВР КАК СуммаВРКт,
	|
	|	""Отклонения в стоимости товара на прочие активы/пассивы"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ДвиженияПоПрочимАктивамПассивам КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Регистратор
	|		И СтрокиДт.НастройкаХозяйственнойОперации <> ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ПеремещениеТоваровМеждуФилиалами)
	|		И СтрокиДт.Активность И НЕ СтрокиДт.Сторно
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиКт
	|	ПО
	|		СтрокиДт.Регистратор = СтрокиКт.Ссылка
	|		И СтрокиДт.Период = СтрокиКт.Период
	|		И СтрокиДт.НастройкаХозяйственнойОперации = СтрокиКт.НастройкаХозяйственнойОперации
	|		И СтрокиДт.ИдентификаторФинЗаписи = СтрокиКт.ИдентификаторФинЗаписи
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)";

	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст фрагмента отражения перемещений отклонений между аналитиками.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстПеремещениеОтклоненийМеждуАналитиками() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Перемещение отклонений между аналитиками (Дт 10.ТЗР :: Кт 10.ТЗР)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	СтрокиДт.ИдентификаторФинЗаписи КАК ИдентификаторСтроки,
	|
	|	СтрокиДт.Сумма КАК Сумма,
	|	СтрокиДт.СуммаУУ КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ОтклоненияВСтоимости) КАК ВидСчетаДт,
	|	СтрокиДт.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	СтрокиДт.МестоУчета КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	СтрокиДт.Номенклатура КАК СубконтоДт1,
	|	СтрокиДт.МестоХранения КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиДт.СуммаНУ КАК СуммаНУДт,
	|	СтрокиДт.СуммаПР КАК СуммаПРДт,
	|	СтрокиДт.СуммаВР КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ОтклоненияВСтоимости) КАК ВидСчетаКт,
	|	СтрокиКт.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	СтрокиКт.МестоУчета КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.Подразделение КАК ПодразделениеКт,
	|	СтрокиКт.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	СтрокиКт.Номенклатура КАК СубконтоКт1,
	|	СтрокиКт.МестоХранения КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СуммаНУ КАК СуммаНУКт,
	|	СтрокиКт.СуммаПР КАК СуммаПРКт,
	|	СтрокиКт.СуммаВР КАК СуммаВРКт,
	|
	|	""Перемещение отклонений между аналитиками"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|		И СтрокиДт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И СтрокиДт.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеТоваровМеждуФилиалами)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиКт
	|	ПО
	|		СтрокиДт.Ссылка = СтрокиКт.Ссылка
	|		И СтрокиДт.Период = СтрокиКт.Период
	|		И СтрокиДт.НастройкаХозяйственнойОперации = СтрокиКт.НастройкаХозяйственнойОперации
	|		И СтрокиДт.ИдентификаторФинЗаписи = СтрокиКт.ИдентификаторФинЗаписи
	|		И СтрокиДт.Номенклатура = СтрокиКт.КорНоменклатура
	|		И СтрокиДт.КорНоменклатура = СтрокиКт.Номенклатура
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)";

	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст фрагмента отражения перемещений отклонений с обособленного подразделения.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстПеремещениеОтклоненийСОбособленногоПодразделения() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Перемещение отклонений с обособленного подразделения (Дт 79.01 :: Кт 10.ТЗР)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиКт.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	СтрокиДт.Сумма КАК Сумма,
	|	СтрокиДт.СуммаУУ КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеДт,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоВыделенномуИмуществу) КАК СчетДт,
	|	СтрокиДт.Организация КАК СубконтоДт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиДт.СуммаНУ КАК СуммаНУДт,
	|	СтрокиДт.СуммаПР КАК СуммаПРДт,
	|	СтрокиДт.СуммаВР КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ОтклоненияВСтоимости) КАК ВидСчетаКт,
	|	СтрокиКт.ГруппаФинансовогоУчета КАК АналитикаУчетаКт,
	|	СтрокиКт.МестоУчета КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.Подразделение КАК ПодразделениеКт,
	|	СтрокиКт.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	СтрокиКт.Номенклатура КАК СубконтоКт1,
	|	СтрокиКт.МестоХранения КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СуммаНУ КАК СуммаНУКт,
	|	СтрокиКт.СуммаПР КАК СуммаПРКт,
	|	СтрокиКт.СуммаВР КАК СуммаВРКт,
	|
	|	""Перемещение отклонений с обособленного подразделения"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|		И СтрокиДт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И СтрокиДт.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеТоваровМеждуФилиалами)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиКт
	|	ПО
	|		СтрокиДт.Ссылка = СтрокиКт.Ссылка
	|		И СтрокиДт.Период = СтрокиКт.Период
	|		И СтрокиДт.НастройкаХозяйственнойОперации = СтрокиКт.НастройкаХозяйственнойОперации
	|		И СтрокиДт.ИдентификаторФинЗаписи = СтрокиКт.ИдентификаторФинЗаписи
	|		И СтрокиДт.Номенклатура = СтрокиКт.КорНоменклатура
	|		И СтрокиДт.КорНоменклатура = СтрокиКт.Номенклатура
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)";

	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст фрагмента отражения перемещений отклонений на обособленное подразделение.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстПеремещениеОтклоненийНаОбособленноеПодразделение() Экспорт
	
	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Перемещение отклонений на обособленное подразделение (Дт 10.ТЗР :: Кт 79.01)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторСтроки,
	|
	|	СтрокиДт.Сумма КАК Сумма,
	|	СтрокиДт.СуммаУУ КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ОтклоненияВСтоимости) КАК ВидСчетаДт,
	|	СтрокиДт.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	СтрокиДт.МестоУчета КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	СтрокиДт.Номенклатура КАК СубконтоДт1,
	|	СтрокиДт.МестоХранения КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиДт.СуммаНУ КАК СуммаНУДт,
	|	СтрокиДт.СуммаПР КАК СуммаПРДт,
	|	СтрокиДт.СуммаВР КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.Подразделение КАК ПодразделениеКт,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.РасчетыПоВыделенномуИмуществу) КАК СчетКт,
	|	СтрокиКт.Организация КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СуммаНУ КАК СуммаНУКт,
	|	СтрокиКт.СуммаПР КАК СуммаПРКт,
	|	СтрокиКт.СуммаВР КАК СуммаВРКт,
	|
	|	""Перемещение отклонений на обособленное подразделение"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|		И СтрокиДт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И СтрокиДт.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеТоваровМеждуФилиалами)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиКт
	|	ПО
	|		СтрокиДт.Ссылка = СтрокиКт.Ссылка
	|		И СтрокиДт.Период = СтрокиКт.Период
	|		И СтрокиДт.НастройкаХозяйственнойОперации = СтрокиКт.НастройкаХозяйственнойОперации
	|		И СтрокиДт.ИдентификаторФинЗаписи = СтрокиКт.ИдентификаторФинЗаписи
	|		И СтрокиДт.Номенклатура = СтрокиКт.КорНоменклатура
	|		И СтрокиДт.КорНоменклатура = СтрокиКт.Номенклатура
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)";

	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст фрагмента отражения списаний постатейных расходов на выпуск продукции (отклонения).
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстСписаниеПостатейныхРасходовНаВыпускПродукцииОтклонение() Экспорт

	ТекстЗапроса = "
	|////////////////////////////////////////////////////////////////////////////////////////////////////
	|// Списание постатейных расходов на выпуск продукции (отклонение) (Дт 43.ОС :: Кт 20)
	|ВЫБРАТЬ
	|	СтрокиДт.Ссылка КАК Ссылка,
	|	СтрокиДт.Период КАК Период,
	|	СтрокиДт.Организация КАК Организация,
	|	СтрокиДт.ИдентификаторФинЗаписи КАК ИдентификаторСтроки,
	|
	|	СтрокиКт.СтоимостьРегл КАК Сумма,
	|	СтрокиКт.СтоимостьУпр КАК СуммаУУ,
	|
	|	// Дт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ОтклоненияВСтоимости) КАК ВидСчетаДт,
	|	СтрокиДт.ГруппаФинансовогоУчета КАК АналитикаУчетаДт,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(СтрокиДт.МестоХранения) = ТИП(Справочник.ДоговорыКонтрагентов)
	|		ТОГДА ВЫРАЗИТЬ(СтрокиДт.МестоХранения КАК Справочник.ДоговорыКонтрагентов).Партнер
	|		ИНАЧЕ СтрокиДт.МестоХранения
	|	КОНЕЦ КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	СтрокиДт.Подразделение КАК ПодразделениеДт,
	|	СтрокиДт.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	СтрокиДт.Номенклатура КАК СубконтоДт1,
	|	СтрокиДт.МестоХранения КАК СубконтоДт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|
	|	СтрокиКт.СтоимостьРегл - СтрокиКт.ПостояннаяРазница - СтрокиКт.ВременнаяРазница КАК СуммаНУДт,
	|	СтрокиКт.ПостояннаяРазница КАК СуммаПРДт,
	|	СтрокиКт.ВременнаяРазница КАК СуммаВРДт,
	|
	|	// Кт ///////////////////////////////////////////////////////////////////////////////////////////
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Производство) КАК ВидСчетаКт,
	|	СтрокиКт.ГруппаПродукции КАК АналитикаУчетаКт,
	|	СтрокиКт.Подразделение КАК МестоУчетаКт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаКт,
	|	СтрокиКт.Подразделение КАК ПодразделениеКт,
	|	СтрокиКт.НаправлениеДеятельности КАК НаправлениеДеятельностиКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетКт,
	|	СтрокиКт.ГруппаПродукции КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	0 КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|
	|	СтрокиКт.СтоимостьРегл - СтрокиКт.ПостояннаяРазница - СтрокиКт.ВременнаяРазница КАК СуммаНУКт,
	|	СтрокиКт.ПостояннаяРазница КАК СуммаПРКт,
	|	СтрокиКт.ВременнаяРазница КАК СуммаВРКт,
	|
	|	""Списание постатейных расходов на выпуск продукции (отклонение)"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		ОтклоненияВСтоимостиТоваров КАК СтрокиДт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиДт.Ссылка
	|		И СтрокиДт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		И СтрокиДт.НастройкаХозяйственнойОперации <> ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ПустаяСсылка)
	|		И СтрокиДт.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеТоваровМеждуФилиалами)
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ПрочиеРасходыНезавершенногоПроизводства КАК СтрокиКт
	|	ПО
	|		ДокументыКОтражению.Ссылка = СтрокиКт.Регистратор
	|		И СтрокиКт.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		И СтрокиКт.Период = СтрокиДт.Период
	|		И СтрокиКт.НастройкаХозяйственнойОперации = СтрокиДт.НастройкаХозяйственнойОперации
	|		И СтрокиКт.ИдентификаторФинЗаписи = СтрокиДт.ИдентификаторФинЗаписи
	|		И СтрокиКт.Активность И НЕ СтрокиКт.Сторно
	|";

	Возврат ТекстЗапроса;

КонецФункции

// Функция возвращает текст запроса для получения виртуальной таблицы ОтклоненияВСтоимостиТоваров.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстЗапросаОтклоненияВСтоимостиТоваров() Экспорт
	
	ТекстЗапроса = "ВЫБРАТЬ
	|	Строки.Регистратор КАК Ссылка,
	|	Строки.Период КАК Период,
	|	Строки.ВидДвижения КАК ВидДвижения,
	|	Строки.Организация КАК Организация,
	|	Строки.ИдентификаторФинЗаписи КАК ИдентификаторФинЗаписи,
	|	Строки.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	|	Строки.НастройкаХозяйственнойОперации КАК НастройкаХозяйственнойОперации,
	|	Строки.Подразделение КАК Подразделение,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	Строки.МестоХранения КАК МестоХранения,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(Строки.МестоХранения) = ТИП(Справочник.ДоговорыКонтрагентов)
	|			ТОГДА ВЫРАЗИТЬ(Строки.МестоХранения КАК Справочник.ДоговорыКонтрагентов).Партнер
	|		ИНАЧЕ Строки.МестоХранения
	|	КОНЕЦ КАК МестоУчета,
	|	Строки.Номенклатура КАК Номенклатура,
	|	Строки.КорНоменклатура КАК КорНоменклатура,
	|	ВЫБОР
	|		КОГДА &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета
	|			И Строки.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				ТОГДА ЕСТЬNULL(Строки.ВидЗапасов.ГруппаФинансовогоУчета, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка))
	|		ИНАЧЕ Строки.Номенклатура.ГруппаФинансовогоУчета
	|	КОНЕЦ КАК ГруппаФинансовогоУчета,
	|	СУММА(Строки.ОтклоненияВСтоимостиРегл + Строки.ДопРасходыРегл + Строки.НДСРегл) КАК Сумма,
	|	СУММА(Строки.ОтклоненияВСтоимостиУпр + Строки.ДопРасходыУпр + Строки.НДСУпр) КАК СуммаУУ,
	|	СУММА(Строки.ОтклоненияВСтоимостиРегл + Строки.ДопРасходыРегл + Строки.НДСРегл - Строки.ПостояннаяРазница - Строки.ВременнаяРазница) КАК СуммаНУ,
	|	СУММА(Строки.ПостояннаяРазница) КАК СуммаПР,
	|	СУММА(Строки.ВременнаяРазница) КАК СуммаВР
	|ПОМЕСТИТЬ ОтклоненияВСтоимостиТоваров
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ОтклоненияВСтоимостиТоваров КАК Строки
	|		ПО (Строки.Регистратор = ДокументыКОтражению.Ссылка)
	|			И (Строки.Активность)
	|			И (НЕ Строки.Сторно)
	|			И (Строки.ИдентификаторФинЗаписи <> """")
	|			И (Строки.НастройкаХозяйственнойОперации <> ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ПустаяСсылка))
	|
	|СГРУППИРОВАТЬ ПО
	|	Строки.НаправлениеДеятельности,
	|	Строки.Подразделение,
	|	Строки.КорНоменклатура,
	|	Строки.Номенклатура,
	|	Строки.МестоХранения,
	|	Строки.НастройкаХозяйственнойОперации,
	|	Строки.Организация,
	|	Строки.ВидДвижения,
	|	Строки.ИдентификаторФинЗаписи,
	|	Строки.ХозяйственнаяОперация,
	|	Строки.Регистратор,
	|	Строки.Период,
	|	ВЫБОР
	|		КОГДА &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета
	|			И Строки.Номенклатура.ТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				ТОГДА ЕСТЬNULL(Строки.ВидЗапасов.ГруппаФинансовогоУчета, ЗНАЧЕНИЕ(Справочник.ГруппыФинансовогоУчетаНоменклатуры.ПустаяСсылка))
	|		ИНАЧЕ Строки.Номенклатура.ГруппаФинансовогоУчета
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(Строки.МестоХранения) = ТИП(Справочник.ДоговорыКонтрагентов)
	|			ТОГДА ВЫРАЗИТЬ(Строки.МестоХранения КАК Справочник.ДоговорыКонтрагентов).Партнер
	|		ИНАЧЕ Строки.МестоХранения
	|	КОНЕЦ
	|
	|ИМЕЮЩИЕ
	|	СУММА(Строки.ОтклоненияВСтоимостиРегл + Строки.ДопРасходыРегл + Строки.НДСРегл) <> 0
	|	ИЛИ СУММА(Строки.ОтклоненияВСтоимостиУпр + Строки.ДопРасходыУпр + Строки.НДСУпр) <> 0
	|	ИЛИ СУММА(Строки.ОтклоненияВСтоимостиРегл + Строки.ДопРасходыРегл + Строки.НДСРегл - Строки.ПостояннаяРазница - Строки.ВременнаяРазница) <> 0
	|	ИЛИ СУММА(Строки.ПостояннаяРазница) <> 0
	|	ИЛИ СУММА(Строки.ВременнаяРазница) <> 0
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка,
	|	ИдентификаторФинЗаписи,
	|	НастройкаХозяйственнойОперации,
	|	Номенклатура";
	
	Возврат ТекстЗапроса;
	
КонецФункции

// Функция возвращает текст запроса для получения виртуальной таблицы ВыручкаИСебестоимостьПродаж.
//
// Возвращаемое значение:
//	Строка - сформированный текст запроса.
//
Функция ТекстЗапросаВыручкаИСебестоимостьПродаж() Экспорт
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	Строки.Регистратор КАК Ссылка,
	|	Строки.Период КАК Период,
	|	Строки.АналитикаУчетаПоПартнерам.Организация КАК Организация,
	|	Строки.НастройкаХозяйственнойОперации КАК НастройкаХозяйственнойОперации,
	|	Строки.ИдентификаторФинЗаписи КАК ИдентификаторФинЗаписи,
	|	ВЫБОР
	|		КОГДА Строки.НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.СебестоимостьПродажЕНВД)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.СебестоимостьПродаж)
	|	КОНЕЦ КАК ВидСчета,
	|	ЕСТЬNULL(ВидыЗапасов.ГруппаФинансовогоУчета, СпрНоменклатуры.ГруппаФинансовогоУчета) КАК ГруппаФинансовогоУчета,
	|	Аналитика.СкладскаяТерритория КАК Склад,
	|	СпрНоменклатуры.Ссылка КАК Номенклатура,
	|	Строки.Подразделение КАК Подразделение,
	|	Строки.НаправлениеДеятельностиНоменклатуры КАК НаправлениеДеятельности,
	|	СУММА(Строки.Количество) КАК Количество,
	|	СУММА(Строки.СтоимостьРегл + Строки.ПостатейныеПостоянныеРегл + Строки.ПостатейныеПеременныеРегл + Строки.ТрудозатратыРегл + Строки.ДопРасходыРегл) КАК Сумма,
	|	СУММА(Строки.СтоимостьУпр + Строки.ПостатейныеПостоянныеУпр + Строки.ПостатейныеПеременныеУпр + Строки.ТрудозатратыУпр + Строки.ДопРасходыУпр) КАК СуммаУУ,
	|	СУММА(Строки.ПостояннаяРазница) КАК СуммаПР,
	|	СУММА(Строки.ВременнаяРазница) КАК СуммаВР,
	|	СУММА(Строки.СтоимостьРегл + Строки.ПостатейныеПостоянныеРегл + Строки.ПостатейныеПеременныеРегл + Строки.ТрудозатратыРегл + Строки.ДопРасходыРегл - Строки.ПостояннаяРазница - Строки.ВременнаяРазница) КАК СуммаНУ
	|ПОМЕСТИТЬ ВыручкаИСебестоимостьПродаж
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ВыручкаИСебестоимостьПродаж КАК Строки
	|		ПО (Строки.Регистратор = ДокументыКОтражению.Ссылка)
	|			И (Строки.Активность)
	|			И (НЕ Строки.Сторно)
	|			И (Строки.ИдентификаторФинЗаписи <> """")
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО (Строки.АналитикаУчетаНоменклатуры = Аналитика.Ссылка)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК ВидыЗапасов
	|		ПО (Строки.ВидЗапасов = ВидыЗапасов.Ссылка)
	|			И (&ФормироватьВидыЗапасовПоГруппамФинансовогоУчета)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатуры
	|		ПО (СпрНоменклатуры.Ссылка = Аналитика.Номенклатура)
	|
	|СГРУППИРОВАТЬ ПО
	|	Строки.Регистратор,
	|	Строки.Период,
	|	Строки.АналитикаУчетаПоПартнерам.Организация,
	|	Строки.НастройкаХозяйственнойОперации,
	|	Строки.ИдентификаторФинЗаписи,
	|	ВЫБОР
	|		КОГДА Строки.НалогообложениеНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяЕНВД)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.СебестоимостьПродажЕНВД)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.СебестоимостьПродаж)
	|	КОНЕЦ,
	|	ЕСТЬNULL(ВидыЗапасов.ГруппаФинансовогоУчета, СпрНоменклатуры.ГруппаФинансовогоУчета),
	|	Аналитика.СкладскаяТерритория,
	|	СпрНоменклатуры.Ссылка,
	|	Строки.Подразделение,
	|	Строки.НаправлениеДеятельностиНоменклатуры
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка,
	|	ИдентификаторФинЗаписи,
	|	НастройкаХозяйственнойОперации";
	
	Возврат ТекстЗапроса;
	
КонецФункции

//-- Локализация

#КонецОбласти

//-- НЕ УТ

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область Проведение

// Процедура дополняет тексты запросов проведения документа.
//
// Параметры:
//  Запрос - Запрос - Общий запрос проведения документа.
//  ТекстыЗапроса - СписокЗначений - Список текстов запроса проведения.
//  Регистры - Строка, Структура - Список регистров проведения документа через запятую или в ключах структуры.
//
Процедура ДополнитьТекстыЗапросовПроведения(Запрос, ТекстыЗапроса, Регистры) Экспорт

КонецПроцедуры

#КонецОбласти

//++ Локализация

//++ НЕ УТ

#Область ФрагментыПроводокРеглУчета

Функция ТекстВыпускПродукцииДавальцаРасход()
	
	ТекстЗапроса = ПроизводствоБезЗаказаЛокализация.ТекстСписаниеТоваровЗаБалансом(Истина);
	Возврат ТекстЗапроса;
	
КонецФункции

#КонецОбласти

//-- НЕ УТ

//-- Локализация

#КонецОбласти