
#Область СлужебныеПроцедурыИФункции

#Область КлючиПриглашений

Функция КлючПриглашения() Экспорт
	
	Результат = Новый Структура;
	Результат.Вставить("ИдентификаторОрганизации", "");
	Результат.Вставить("ИдентификаторКонтрагента", "");
	Результат.Вставить("ИНН", "");
	Результат.Вставить("КПП", "");
	
	Возврат Результат;
	
КонецФункции

Функция КлючПриглашенияНаИдентификатор() Экспорт
	
	Результат = Новый Структура;
	Результат.Вставить("Тип", ПредопределенноеЗначение("Перечисление.ТипыПриглашений.НаИдентификатор"));
	Результат.Вставить("ИдентификаторОрганизации", "");
	Результат.Вставить("ИдентификаторКонтрагента", "");
	
	Возврат Результат;
	
КонецФункции

Функция КлючШироковещательногоПриглашения() Экспорт
	
	Результат = Новый Структура;
	Результат.Вставить("Тип", ПредопределенноеЗначение("Перечисление.ТипыПриглашений.Широковещательное"));
	Результат.Вставить("ИдентификаторОрганизации", "");
	Результат.Вставить("ИНН", "");
	Результат.Вставить("КПП", "");
	
	Возврат Результат;
	
КонецФункции

Функция КлючЗаявкиНаРоуминг() Экспорт
	
	Результат = Новый Структура;
	Результат.Вставить("Тип", ПредопределенноеЗначение("Перечисление.ТипыПриглашений.ЗаявкаНаРоуминг"));
	Результат.Вставить("ИдентификаторОрганизации", "");
	Результат.Вставить("ИдентификаторОператора", "");
	Результат.Вставить("ИНН", "");
	Результат.Вставить("КПП", "");
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти

Функция ПодсказкаЭлектроннаяПочтаДляУведомленияОСтатусеЗаявкиНаРоуминг() Экспорт
	
	Возврат НСтр("ru = 'На данный адрес электронной почты будут отправляться оповещения о статусе выполнения заявки по настройке роуминга';
				|en = 'Notifications will be sent to this email address about the status of the application for roaming settings'");
	
КонецФункции

Функция ВидПриглашенияИсходящее() Экспорт
	
	Возврат "Исходящее";
	
КонецФункции

Функция ЭтоВходящееПриглашение(Приглашение) Экспорт
	
	Возврат Приглашение.Вид = ВидПриглашенияВходящее();
	
КонецФункции

Функция ВидПриглашенияВходящее() Экспорт
	
	Возврат "Входящее";
	
КонецФункции

Функция ТипыПриглашений() Экспорт

	Результат = Новый Структура;
	Результат.Вставить("НаИдентификатор", ПредопределенноеЗначение("Перечисление.ТипыПриглашений.НаИдентификатор"));	
	Результат.Вставить("Широковещательное", ПредопределенноеЗначение("Перечисление.ТипыПриглашений.Широковещательное"));	
	Результат.Вставить("ЗаявкаНаРоуминг", ПредопределенноеЗначение("Перечисление.ТипыПриглашений.ЗаявкаНаРоуминг"));	

	Возврат Новый ФиксированнаяСтруктура(Результат);
		
КонецФункции

#Область ОбработкаНеисправностей

// Возвращает вид ошибки, описывающий ситуацию, когда операция не может быть выполнена из-за того, что
// не настроена связь с контрагентом.
// 
// Параметры:
// 	СтатусПриглашения - ПеречислениеСсылка.СтатусыПриглашений
// 	ВидОперации - Строка - вид операции, при выполнении которой произошла ошибка, может 
// 	принимать значения "Распаковка", "Отправка".
// Возвращаемое значение:
//  См. ОбработкаНеисправностейБЭДКлиентСервер.НовоеОписаниеВидаОшибки
Функция ВидОшибкиНеНастроенаСвязьСКонтрагентом(СтатусПриглашения, ВидОперации) Экспорт
	
	Если СтатусПриглашения = ПредопределенноеЗначение("Перечисление.СтатусыПриглашений.ТребуетсяСогласие") Тогда
		Идентификатор = "НеПринятоПриглашение" + ВидОперации;
		ОписаниеПроблемы = НСтр("ru = 'Не принято приглашение к обмену электронными документами';
								|en = 'Invitation to exchange electronic documents is not accepted'");
		Если ВидОперации = "Распаковка" Тогда
			ШаблонОписаниеРешения = НСтр("ru = 'Необходимо <a href = ""%1"">принять</a> приглашение.
				|После того как оно будет принято, транспортный контейнер можно будет распаковать.';
				|en = 'You must <a href = ""%1"">accept</a>the invitation.
				|Then you can unpack the transport container.'");
			ОписаниеРешения = СтрШаблон(ШаблонОписаниеРешения, "принять");
		Иначе
			ШаблонОписаниеРешения = НСтр("ru = 'Необходимо <a href = ""%1"">принять</a> приглашение.
				|После того как оно будет принято, документ можно будет отправить.';
				|en = 'Please <a href = ""%1"">accept</a> the invitation.
				|After the invitation is accepted the document can be sent.'");
			ОписаниеРешения = СтрШаблон(ШаблонОписаниеРешения, "принять");
		КонецЕсли;
	ИначеЕсли СтатусПриглашения = ПредопределенноеЗначение("Перечисление.СтатусыПриглашений.ОжидаемСогласия") Тогда 
		Идентификатор = "ОжидаетсяСогласиеНаПриглашение" + ВидОперации;
		ОписаниеПроблемы = НСтр("ru = 'Приглашение к обмену электронными документами находится в статусе ""Ожидаем согласие""';
								|en = 'Invitation to exchange electronic documents is in the ""Approval pending"" status'");
		ШаблонОписаниеРешения = НСтр("ru = 'Уточните у контрагента, принял ли он <a href = ""%1"">приглашение</a>.
					   |Если приглашение принято - <a href = ""%2"">обратитесь</a> в тех. поддержку';
					   |en = 'Ask the counterparty if they accepted <a href = ""%1"">the invitation</a>.
					   |If the invitation is accepted, <a href = ""%2"">contact</a> technical support'");
		ОписаниеРешения = СтрШаблон(ШаблонОписаниеРешения, "приглашение", "обратитесь");
	ИначеЕсли СтатусПриглашения = ПредопределенноеЗначение("Перечисление.СтатусыПриглашений.Отклонено")
		Или СтатусПриглашения = ПредопределенноеЗначение("Перечисление.СтатусыПриглашений.ТребуетсяОтправить") Тогда 
		Идентификатор = "ТребуетсяОтправкаПриглашения" + ВидОперации;
		ОписаниеПроблемы = НСтр("ru = 'Приглашение к обмену электронными документами еще не было отправлено';
								|en = 'Invitation to exchange electronic documents has not yet been sent'");
		Если ВидОперации = "Распаковка" Тогда
			ШаблонОписаниеРешения = НСтр("ru = 'Чтобы продолжить обмен электронными документами с контрагентом, отправьте <a href = ""%1"">приглашение</a>.
					   |После того как оно будет принято, транспортный контейнер можно будет распаковать.';
					   |en = 'To continue electronic document exchange with the counterparty, send <a href = ""%1"">an invitation</a>.
					   |You can unpack the transport container once the invitation is accepted.'");
			ОписаниеРешения = СтрШаблон(ШаблонОписаниеРешения, "приглашение");
		Иначе
			ШаблонОписаниеРешения = НСтр("ru = 'Чтобы продолжить обмен электронными документами с контрагентом, отправьте <a href = ""%1"">приглашение</a>.
					   |После того как оно будет принято, документ можно будет отправить.';
					   |en = 'o continue exchanging electronic documents with the counterparty, please send <a href = ""%1"">приглашение</a>.
					   |Once it is accepted, the document can be sent.'");
			ОписаниеРешения = СтрШаблон(ШаблонОписаниеРешения, "приглашение");
		КонецЕсли;
	ИначеЕсли СтатусПриглашения = ПредопределенноеЗначение("Перечисление.СтатусыПриглашений.Ошибка") Тогда 
		Идентификатор = "ОшибкаПриглашения" + ВидОперации;
		ОписаниеПроблемы = НСтр("ru = 'Приглашение к обмену электронными документами находится в статусе ""Ошибка""';
								|en = 'Invitation to exchange electronic documents is in the ""Error"" status'");
		ОписаниеРешения = СтрШаблон(НСтр("ru = '<a href = ""%1"">Обратитесь</a> в тех. поддержку';
										|en = '<a href = ""%1"">Contact</a> technical support'"), "Обратитесь");
	ИначеЕсли СтатусПриглашения = Неопределено Тогда 
		Идентификатор = "НетПриглашения" + ВидОперации;
		ОписаниеПроблемы = НСтр("ru = 'Не настроена связь с контрагентом';
								|en = 'Counterparty connection is not configured'");
		ОписаниеРешения = НСтр("ru = 'Не настроена связь с контрагентом';
								|en = 'Counterparty connection is not configured'")
	Иначе
		Возврат ОбработкаНеисправностейБЭДКлиентСервер.ВидОшибкиНеизвестнаяОшибка();
	КонецЕсли;
	
	Если ВидОперации = "Распаковка" Тогда
		ЗаголовокПроблемы = НСтр("ru = 'Не удалось распаковать транспортный контейнер ЭДО';
								|en = 'Cannot unpack the EDI transport container'");
	Иначе
		ЗаголовокПроблемы = НСтр("ru = 'Не удалось отправить электронный документ';
								|en = 'It was not possible to send an electronic document'");
	КонецЕсли;
	
	ОбработчикОткрытияПриглашения = "ПриглашенияЭДОКлиент.ОткрытьПриглашения";
	ОбработчикОткрытияФормыОбращенияВТехподдержку = 
		ОбработкаНеисправностейБЭДКлиентСервер.ОбработчикОткрытияФормыОбращенияВТехподдержку();
	ВидОшибки = ОбработкаНеисправностейБЭДКлиентСервер.НовоеОписаниеВидаОшибки();
	ВидОшибки.Идентификатор = Идентификатор;
	ВидОшибки.ЗаголовокПроблемы = ЗаголовокПроблемы;
	ВидОшибки.ОписаниеПроблемы = ОписаниеПроблемы;
	ВидОшибки.ОписаниеРешения = ОписаниеРешения;
	ВидОшибки.ОбработчикиНажатия.Вставить("принять", ОбработчикОткрытияПриглашения);
	ВидОшибки.ОбработчикиНажатия.Вставить("приглашение", ОбработчикОткрытияПриглашения);
	ВидОшибки.ОбработчикиНажатия.Вставить("Обратитесь",	ОбработчикОткрытияФормыОбращенияВТехподдержку);
	ВидОшибки.ОбработчикиНажатия.Вставить("обратитесь", ОбработчикОткрытияФормыОбращенияВТехподдержку);
	ВидОшибки.ПараметрыОбработчиков.Вставить("принять", Новый Структура("Группировать", Истина));
	ВидОшибки.ПараметрыОбработчиков.Вставить("приглашение", Новый Структура("Группировать", Истина));
	
	Возврат ВидОшибки;
	
КонецФункции

Функция ВидОшибкиНеУдалосьНайтиКонтрагентаПоПриглашению() Экспорт
	
	ВидОшибки = ОбработкаНеисправностейБЭДКлиентСервер.НовоеОписаниеВидаОшибки();
	ВидОшибки.Идентификатор = "НеУдалосьНайтиКонтрагентаПоРеквизитамИзПриглашения";
	ВидОшибки.ЗаголовокПроблемы = НСтр("ru = 'Не удалось найти контрагента по реквизитам из приглашения';
										|en = 'Cannot find a counterparty by information from the invitation'");
	ОписаниеРешения = 
		НСтр("ru = '<a href = ""%1"">Укажите</a> контрагентов в приглашениях.
			 |Для того, чтобы контрагенты создавались автоматически, <a href = ""%2"">включите опцию</a>.';
			 |en = '<a href = ""%1"">Specify</a>counterparties in invitations.
			 |To generate counterparties automatically, <a href = ""%2"">enable the option</a>.'");
	ВидОшибки.ОписаниеРешения = СтрШаблон(ОписаниеРешения, "Укажите", "ВключитеОпцию");
	ВидОшибки.ОбработчикиНажатия.Вставить("Укажите", "ПриглашенияЭДОКлиент.ОткрытьПриглашения");
	ВидОшибки.ОбработчикиНажатия.Вставить("ВключитеОпцию", "ПриглашенияЭДОКлиент.ВключитьОпциюАвтоматическогоСозданияКонтрагентов");
	ВидОшибки.Статус = ОбработкаНеисправностейБЭДКлиентСервер.СтатусыОшибок().Обычная;
	ВидОшибки.ВыводитьСсылкуНаСписокОшибок = Ложь;
	
	Возврат ВидОшибки;
	
КонецФункции

#КонецОбласти

#КонецОбласти