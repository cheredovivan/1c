///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2025, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Подсистема "ИнтернетПоддержкаПользователей.ИнтернетЭквайринг".
// ОбщийМодуль.ИнтернетЭквайрингПереопределяемый.
// 
// Серверные процедуры работы с интернет-эквайрингом:
//  - определение места хранения прикладных настроек подключения и сохранение этих настроек;
//  - настройка элементов формы подключения к интернет эквайрингу;
//  - обработка данных при формировании заказа на возврат;
//  - обработка получения статуса возврата.
//
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

#Область НастройкиПодключения

// Определяет прикладные настройки работы с Интернет-эквайрингом.
//
// Параметры:
//  Настройки - Структура - настройки работы с Интернет-эквайрингом:
//    * ОбъектМетаданных - ОбъектМетаданныхРегистрСведений - объект метаданных регистр сведений, в котором хранятся
//        настройки выполнения оплат. Регистр определяет связь мерчанта и аналитики ведения учета в программах 1С. На
//        основании данных регистра должен выполняется поиск настройки подключения при выполнении оплат и возвратов.
//    * ИсключаемыеПоля - Массив из Строка - наименования измерений, ресурсов или реквизитов, которые необходимо скрыть
//        на форме настройки подключения.
//    * ШаблоныНазначения - ТаблицаЗначений - настройки заполнения шаблонов платежей:
//      ** ОбъектМетаданных - Строка - имя объекта метаданных операции.
//      ** Идентификатор - Строка - идентификатор шаблона.
//      ** Наименование - Строка - наименование шаблона для пользователя.
//      ** Параметры - Структура - параметры заполнения шаблона:
//        *** Наименование - Строка - наименование параметра для пользователя.
//        *** Идентификатор - Строка - идентификатор параметра для заполнения.
//
Процедура ПриОпределенииНастроекПодключения(Настройки) Экспорт
	
	
КонецПроцедуры

// Позволяет настроить элементы настройки приема оплат на формах подключения к Интернет-эквайрингу
//
// Параметры:
//  НастройкиФормы - Структура - содержит элементы формы и текущие значения реквизитов:
//    * ОбщиеЭлементы - Структура - общие настройки формы подключения к Интернет-эквайрингу:
//      ** Наименование - ПолеФормы - элемент формы, в котором заполняется наименование.
//      ** ЗначениеНаименования - Строка - текущее значение наименования.
//      ** ДекорацияДополнительнаяИнформация - ДекорацияФормы - декорация формы, в которую можно вывести дополнительную
//         информацию.
//    * НастройкаПодключения - СправочникСсылка.НастройкиПодключенияКИнтернетЭквайрингу, Неопределено - ссылка на
//         настройку подключения; в случае создания новой настройки передается Неопределено.
//    * ИдентификаторУчастника - Строка - идентификатор участника Интернет-эквайринга для которого выполняется настройка.
//  НастройкиЭлементов - Структура - данные элементов формы:
//    * ЭлементыНастроекОплаты - Структура Из КлючИЗначение - элементы формы для вывода прикладных настроек:
//        ** Ключ - Строка - имя настройки.
//        ** Значение - Произвольный - элемент формы.
//    * ЗначенияНастроекОплаты - Структура Из КлючИЗначение - текущие значения прикладных настроек. Изменение значения
//        в данной процедуре, приведет к изменению значения на форме:
//        ** Ключ - Строка - имя настройки.
//        ** Значение - Произвольный - значение настройки.
//  ДополнительныеПараметры - Структура, Неопределено - дополнительные параметры настройки подключения к
//    Интернет-эквайрингу, которые передаются в методе НастройкиПлатежныхСистемКлиент.ПодключитьПлатежнуюСистему.
//
Процедура ПриНастройкеЭлементовФормыПодключения(
		НастройкиФормы,
		НастройкиЭлементов,
		ДополнительныеПараметры) Экспорт
	
	
КонецПроцедуры

// Определяет алгоритм записи настроек оплат в регистр сведений указанный в методе
// ИнтернетЭквайрингПереопределяемый.ПриОпределенииНастроекПодключения.
//
// Параметры:
//  ПрикладныеНастройки - Соответствие Из КлючИЗначение - значения прикладных настроек:
//   * Ключ - Строка - идентификатор реквизита (соответствует имени измерения, ресурса или реквизита прикладного
//       регистра, определяемого в методе ИнтернетЭквайрингПереопределяемый.ПриОпределенииНастроекПодключения).
//   * Значение - Произвольный - значение реквизита.
//  Отказ - Булево - следует устанавливать значение Истина, если в процессе записи возникли ошибки;
//  СообщениеОбОшибке - Строка - сообщение для пользователя. Отображается в случае, если в параметр
//    Отказ установлено значение Истина.
//
Процедура ПриЗаписиНастроекПодключения(
		ПрикладныеНастройки,
		Отказ,
		СообщениеОбОшибке) Экспорт
	
	
КонецПроцедуры

#КонецОбласти

#Область ПрикладныеОперации

// Определяются данные для формирования запроса на возврат в платежную систему.
// Все поля переменной ЗаказНаВозврат обязательны для заполнения.
//
// Параметры:
//  ДокументВозврата - ОпределяемыйТип.ДокументОперацииИнтернетЭквайринга - документ, который отражает возврат в
//    информационной базе.
//  ЗаказНаВозврат - Структура - содержит описание заказа на возврат:
//    * СуммаВозврата - Число - Сумма, которую необходимо вернуть покупателю.
//    * ДатаВозврата - Дата - дата выполнения операции.
//  НастройкаПодключения - СправочникСсылка.НастройкиПодключенияКИнтернетЭквайрингу - настройка через которую будет
//    выполнена операции.
//  ДополнительныеПараметры - Структура, Неопределено - дополнительные настройки формирования заказа на возврат,
//    переданные при вызове функции ИнтернетЭквайринг.ВозвратОплаты.
//
Процедура ПриФормированииЗаказаНаВозврат(
		ДокументВозврата,
		ЗаказНаВозврат,
		НастройкаПодключения,
		ДополнительныеПараметры) Экспорт
	
	
КонецПроцедуры

// Определяет алгоритм обработки операции, статус которых был получен регламентным заданием.
//
// Параметры:
//  ДокументОперации - ОпределяемыйТип.ДокументОперацииИнтернетЭквайринга - документ, который отражает операцию в
//    информационной базе;
//  НастройкаПодключения - СправочникСсылка.НастройкиПодключенияКИнтернетЭквайрингу - настройка выполнения операций;
//  РезультатОбработки - Структура - результат загрузки статуса операции:
//    * СтатусОперации - Строка - текущее состояние операции операции. Для проверки статуса
//      операции, необходимо использовать функции программного интерфейса общего модуля
//      НастройкиПлатежныхСистемКлиентСервер. Возможные значения:
//        - "Отменена" - по ранее сформированная операция отменена;
//        - "Выполнена" - выполнение операции подтверждено банком;
//        - "Ошибка" - не удалось выполнить проверку статуса операции из-за ошибки или банк вернул ошибку;
//    * ПараметрыОперации - Структура - дополнительные данные по оплате:
//        ** ДатаОперации - Дата - фактическая дата оплаты в UTC;
//        ** СуммаОперации - Число - фактическая суммы операции по документу;
//        ** ИдентификаторОперации - Строка - идентификатор текущей операции;
//        ** ИдентификаторОплаты- Строка - идентификатор оплаты;
//    * СообщениеОбОшибке - Строка - сообщение пользователю. Заполняется в случае ошибки.
//  Обработан - Булево - признак обработки операции. Необходимо установить Истина, после завершения обработки.
//
Процедура ПриЗагрузкеСтатусаОперации(
		ДокументОперации,
		НастройкаПодключения,
		РезультатОбработки,
		Обработан) Экспорт
	
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти
