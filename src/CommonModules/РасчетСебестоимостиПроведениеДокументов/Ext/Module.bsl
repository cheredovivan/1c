/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Механизм партионного учета версии 2.2
//
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

// Структура основных процедур и функций модуля:
// - ОтразитьВМеханизмеУчетаЗатратИСебестоимости() - основная процедура интерфейса формирования движений. 
//		Вызывается из процедуры ДанныеДокументаДляПроведения() модуля менеджера документов.
// - ОтразитьОперацииВУчетеСебестоимости() - процедура формирования всех текстов запросов в соответствии с описанием операцией документа.
//	имеет описания в областях:
//		#Область Описание_ОтразитьОперацииВУчетеСебестоимости - описание алгоритма формирования текстов запросов
//		#Область Описание_ТекстыОперацийСебестоимость - описание правил заполнения полей в движениях

#Область ПрограммныйИнтерфейс

Процедура ОтразитьВМеханизмеУчетаЗатратИСебестоимости(Документ, Запрос, ТекстыЗапроса, Регистры, Объект = Неопределено) Экспорт
	
	ИспользуетсяСреднескользящаяОценка = РасчетСебестоимостиПовтИсп.ИспользуетсяСреднескользящаяОценка();
	
	Если ИспользуетсяСреднескользящаяОценка Тогда
		
		МассивРегистры = РасчетСебестоимостиПовтИсп.СвязанныеРегистрыПриПроведенииСреднескользящая();
		ЕстьРегистрыСебестоимости = Ложь;
		
		Для Каждого МетаРегистр Из МассивРегистры Цикл
			Если ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(МетаРегистр.Имя, Регистры) Тогда
				ЕстьРегистрыСебестоимости = Истина;
				Прервать;
			КонецЕсли;
		КонецЦикла;
		
		Если НЕ ЕстьРегистрыСебестоимости Тогда
			Возврат;
		КонецЕсли;
		
	Иначе
		
		Если НЕ ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя, Регистры)
		 И НЕ ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(Метаданные.РегистрыНакопления.ВыручкаИСебестоимостьПродаж.Имя, Регистры) Тогда
			Возврат;
		КонецЕсли;
		
	КонецЕсли;
	
	МетаДокумент = Метаданные.НайтиПоТипу(ТипЗнч(Документ));
	
	Если МетаДокумент = Неопределено ИЛИ НЕ Метаданные.Документы.Содержит(МетаДокумент) Тогда
		ВызватьИсключение НСтр("ru = 'Не удалось определить тип документа';
								|en = 'Cannot determine a document type'");
	КонецЕсли;
	
	ЭтоДокументСторно = (МетаДокумент = Метаданные.Документы.Сторно);
	
	ПараметрыОтражения = Новый Структура;
	ПараметрыОтражения.Вставить("ЕстьСторнирование", Ложь);
	
	// Для исправительных документов таблица ВТДанныеСторнированияСебестоимость должна быть сформирована раньше, чем вызов механизма проведения по себестоимости.
	Если ЭтоДокументСторно ИЛИ МетаДокумент.Реквизиты.Найти("Исправление") <> Неопределено Тогда
		
		ПроверятьТаблицуСторно = Ложь;
		
		Если ЭтоДокументСторно Тогда

			ПроверятьТаблицуСторно = Истина;
			
		ИначеЕсли Запрос.Параметры.Свойство("Исправление") И Запрос.Параметры.Исправление Тогда
			
			ПроверятьТаблицуСторно = Истина;
			
		ИначеЕсли НЕ Запрос.Параметры.Свойство("Исправление") И Запрос.Параметры.Свойство("Ссылка") Тогда
			
			ТекстЗапросаИсправления =
			"ВЫБРАТЬ ПЕРВЫЕ 1
			|	Документы.Ссылка КАК Ссылка
			|ИЗ
			|	&ИмяДокумента КАК Документы
			|ГДЕ
			|	Документы.Ссылка В (&Ссылка)
			|	И Документы.Исправление
			|";
			
			ТекстЗапросаИсправления = СтрЗаменить(ТекстЗапросаИсправления, "&ИмяДокумента", "Документ." + МетаДокумент.Имя);
			
			ЗапросИсправления = Новый Запрос;
			ЗапросИсправления.Текст = ТекстЗапросаИсправления;
			ЗапросИсправления.УстановитьПараметр("Ссылка", Документ);
			
			ПроверятьТаблицуСторно = НЕ ЗапросИсправления.Выполнить().Пустой();
			
		КонецЕсли;
		
		Если ПроверятьТаблицуСторно Тогда
			
			ЕстьДвиженияСебестоимость = Ложь;
			ИмяРегистраСебестоимость = Метаданные.РегистрыНакопления.СебестоимостьТоваров.Имя;
			
			Для Каждого ЭлементСписка Из ТекстыЗапроса Цикл
				
				Если ЭлементСписка.Представление = ИмяРегистраСебестоимость Тогда
					ЕстьДвиженияСебестоимость = Истина;
				КонецЕсли;
				
				Если СтрНайти(ЭлементСписка.Значение, "ВТДанныеСторнированияСебестоимость") > 0 Тогда
					ПараметрыОтражения.Вставить("ЕстьСторнирование", Истина);
					Прервать;
				КонецЕсли;
				
			КонецЦикла;
			
			Если НЕ ПараметрыОтражения.ЕстьСторнирование И ЕстьДвиженияСебестоимость Тогда
				ВызватьИсключение НСтр("ru = 'Ошибка формирования запроса проведения документа:
					|запросы сторнирования движений должны выполняться до запросов проведения по регистру ""Себестоимость товаров""';
					|en = 'An error occurred when generating the document posting query:
					|Record reversal queries must be performed before posting queries for the ""Inventory cost"" register'");
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
	
	// Описание документа.
	ПараметрыОтражения.Вставить("Документ", 			Документ);
	ПараметрыОтражения.Вставить("МетаданныеДокумента", 	МетаДокумент);
	ПараметрыОтражения.Вставить("МенеджерДокумента", 	МенеджерОбъектаПоСсылке(Документ));
	// Параметры проведения документа.
	ПараметрыОтражения.Вставить("Запрос", 				Запрос);
	ПараметрыОтражения.Вставить("ТекстыЗапроса", 		ТекстыЗапроса);
	ПараметрыОтражения.Вставить("Регистры", 			Регистры);
	// Регистры для отражения.
	ПараметрыОтражения.Вставить("РегистрыДляОтражения", Новый Структура);
	
	ПараметрыОтражения.Вставить("ИспользуетсяСреднескользящая", ИспользуетсяСреднескользящаяОценка);
	ПараметрыОтражения.Вставить("ВозможныРазныеПериодыВДвижениях",
		Запрос.МенеджерВременныхТаблиц <> Неопределено
		И Запрос.МенеджерВременныхТаблиц.Таблицы.Найти("ВТПараметрыПартионногоУчетаДляПроведения") <> Неопределено);
	
	ОписаниеДополнительныхПараметров = Неопределено;
	ОписаниеДополнительныхТаблиц = Неопределено;
	
	// Себестоимость
	МетаданныеРегистра = Метаданные.РегистрыНакопления.СебестоимостьТоваров;
	ИмяРегистра 	   = МетаданныеРегистра.Имя;
	
	Если (ИспользуетсяСреднескользящаяОценка ИЛИ ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, ПараметрыОтражения.Регистры))
	 И ПараметрыОтражения.МенеджерДокумента.ОписаниеРегистровУчетаЗатратИСебестоимости(ПараметрыОтражения.Документ).Найти(МетаданныеРегистра) <> Неопределено Тогда 
		
		ПараметрыОтражения.Вставить("ИмяРегистра", ИмяРегистра);
		
		ОписаниеРегистра = Новый Структура;
	
		// Получим данные для отражения документа.
		ОписаниеДополнительныхПараметров = ПараметрыОтражения.МенеджерДокумента.УстановитьДополнительныеПараметрыОперацийУчетаЗатратИСебестоимости(
			ПараметрыОтражения.Документ,
			ПараметрыОтражения.Запрос);
		
		Если НЕ Объект = Неопределено Тогда
			ОписаниеДополнительныхТаблиц = ПараметрыОтражения.МенеджерДокумента.СформироватьДополнительныеТаблицыОперацийУчетаЗатратИСебестоимости(
				Объект,
				ПараметрыОтражения.Запрос,
				ПараметрыОтражения.ТекстыЗапроса);
			
			ОписаниеОперацийДокумента = ПараметрыОтражения.МенеджерДокумента.ОписаниеОперацийУчетаСебестоимости(
				Объект);
		Иначе
			ОписаниеДополнительныхТаблиц = ПараметрыОтражения.МенеджерДокумента.СформироватьДополнительныеТаблицыОперацийУчетаЗатратИСебестоимости(
				ПараметрыОтражения.Документ,
				ПараметрыОтражения.Запрос,
				ПараметрыОтражения.ТекстыЗапроса);
			
			ОписаниеОперацийДокумента = ПараметрыОтражения.МенеджерДокумента.ОписаниеОперацийУчетаСебестоимости(
				ПараметрыОтражения.Документ);
		КонецЕсли;
		
		ОписаниеРегистра.Вставить("МетаданныеРегистра", 			  МетаданныеРегистра);
		ОписаниеРегистра.Вставить("ПоляРегистра", 			  		  ВсеПоляРегистра(МетаданныеРегистра));
		ОписаниеРегистра.Вставить("ОписаниеДополнительныхПараметров", ОписаниеДополнительныхПараметров);
		ОписаниеРегистра.Вставить("ОписаниеДополнительныхТаблиц", 	  ОписаниеДополнительныхТаблиц);
		ОписаниеРегистра.Вставить("ОписаниеОперацийДокумента", 		  ОписаниеОперацийДокумента);
		
		ПараметрыОтражения.РегистрыДляОтражения.Вставить(ИмяРегистра, ОписаниеРегистра);
		
		// Сформируем тексты запросов для отражения в учете себестоимости.
		ОтразитьОперацииВУчетеСебестоимости(ПараметрыОтражения);
		
	КонецЕсли;
	
	// Выручка
	МетаданныеРегистра = Метаданные.РегистрыНакопления.ВыручкаИСебестоимостьПродаж;
	ИмяРегистра 	   = МетаданныеРегистра.Имя;
	
	Если ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, ПараметрыОтражения.Регистры)
	 И ПараметрыОтражения.МенеджерДокумента.ОписаниеРегистровУчетаЗатратИСебестоимости(ПараметрыОтражения.Документ).Найти(МетаданныеРегистра) <> Неопределено Тогда
	
		ПараметрыОтражения.Вставить("ИмяРегистра", ИмяРегистра);
		
		ОписаниеРегистра = Новый Структура;
		
		Если НЕ ЗначениеЗаполнено(ОписаниеДополнительныхПараметров) Тогда
			ОписаниеДополнительныхПараметров = ПараметрыОтражения.МенеджерДокумента.УстановитьДополнительныеПараметрыОперацийУчетаЗатратИСебестоимости(
				ПараметрыОтражения.Документ,
				ПараметрыОтражения.Запрос);
		КонецЕсли;
		
		Если НЕ ЗначениеЗаполнено(ОписаниеДополнительныхТаблиц) Тогда
			ОписаниеДополнительныхТаблиц = ПараметрыОтражения.МенеджерДокумента.СформироватьДополнительныеТаблицыОперацийУчетаЗатратИСебестоимости(
				ПараметрыОтражения.Документ,
				ПараметрыОтражения.Запрос,
				ПараметрыОтражения.ТекстыЗапроса);
		КонецЕсли;
		
		ОписаниеОперацийДокумента = ПараметрыОтражения.МенеджерДокумента.ОписаниеОперацийУчетаВыручки(
			ПараметрыОтражения.Документ);
		
		ОписаниеРегистра.Вставить("МетаданныеРегистра", 			  МетаданныеРегистра);
		ОписаниеРегистра.Вставить("ОписаниеДополнительныхПараметров", ОписаниеДополнительныхПараметров);
		ОписаниеРегистра.Вставить("ОписаниеДополнительныхТаблиц", 	  ОписаниеДополнительныхТаблиц);
		ОписаниеРегистра.Вставить("ОписаниеОперацийДокумента", 		  ОписаниеОперацийДокумента);
		
		ПараметрыОтражения.РегистрыДляОтражения.Вставить(ИмяРегистра, ОписаниеРегистра);
		
	КонецЕсли;
	
КонецПроцедуры

// Добавляет описание операции для отражения.
//
// Параметры:
//	ОписаниеОпераций - Массив -
//	ВидОперации  - ПеречислениеСсылка.ОперацииУчетаСебестоимости -
//	ТекстЗапроса - Строка -
//	ОписаниеОперации - Строка -
//	
Процедура ДобавитьОписаниеОперацииДляОтраженияВУчетеСебестоимости(ОписаниеОпераций, ВидОперации, ТекстЗапроса, ОписаниеОперации = "") Экспорт
	
	ТекущаяОперация = Новый Структура;
	
	ТекущаяОперация.Вставить("ВидОперации",  	 ВидОперации);
	ТекущаяОперация.Вставить("ТекстЗапроса", 	 ТекстЗапроса);
	ТекущаяОперация.Вставить("НомерОперации", 	 0);
	ТекущаяОперация.Вставить("ОписаниеОперации", ОписаниеОперации);
	
	ОписаниеОпераций.Добавить(ТекущаяОперация);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область ОписаниеОпераций

Функция СформироватьОписаниеОперации(МетаданныеРегистра) Экспорт
	
	Описание = Новый Структура;
	Поля 	 = Новый Массив;
	
	// Общие и служебные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, Поля, "Период");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, Поля, "Ссылка");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, Поля, "КорректируемыйДокумент",, Истина);
	
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, Поля, "ХозяйственнаяОперация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, Поля, "ИдентификаторФинЗаписи");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, Поля, "НастройкаХозяйственнойОперации");
	
	Описание.Вставить("Поля", Поля);
	Описание.Вставить("ВидОперации", Неопределено);
	
	Возврат Описание;
	
КонецФункции

Процедура ДобавитьОписаниеПоляОперации(МетаданныеРегистра, Поля, ИмяПоля, ТипПоляПоУмолчанию = Неопределено, Дополнительное = Ложь)
	
	ОписаниеПоля = Новый Структура;
	ОписаниеПоля.Вставить("Имя", ИмяПоля);
	
	ТипПоля = Неопределено;
	
	Если ТипПоляПоУмолчанию <> Неопределено Тогда
		
		ТипПоля = ТипПоляПоУмолчанию;
		
	ИначеЕсли НРег(ИмяПоля) = НРег("Период") Тогда
		
		ТипПоля = МетаданныеРегистра.СтандартныеРеквизиты["Период"].Тип;
		
	ИначеЕсли НРег(ИмяПоля) = НРег("Ссылка") Тогда
		
		ТипПоля = МетаданныеРегистра.СтандартныеРеквизиты["Регистратор"].Тип;
		
	Иначе
		
		МетаданныеПоля = МетаданныеРегистра.Измерения.Найти(ИмяПоля);
		
		Если МетаданныеПоля <> Неопределено Тогда
			ТипПоля = МетаданныеПоля.Тип;
		Иначе
			
			МетаданныеПоля = МетаданныеРегистра.Ресурсы.Найти(ИмяПоля);
			
			Если МетаданныеПоля <> Неопределено Тогда
				ТипПоля = МетаданныеПоля.Тип;
			Иначе
				
				МетаданныеПоля = МетаданныеРегистра.Реквизиты.Найти(ИмяПоля);
				
				Если МетаданныеПоля <> Неопределено Тогда
					ТипПоля = МетаданныеПоля.Тип;
				КонецЕсли;
				
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
	
	ОписаниеПоля.Вставить("Тип", ТипПоля);
	ОписаниеПоля.Вставить("Дополнительное", Дополнительное);
	
	Поля.Добавить(ОписаниеПоля);
	
КонецПроцедуры

Процедура ДобавитьОписаниеПолейАналитикиФинансовогоУчета(МетаданныеРегистра, ОписаниеОперации, ГруппаПродукцииОбязательна = Истина)
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		"Сделка",
		Новый ОписаниеТипов("СправочникСсылка.СделкиСКлиентами"));
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		"Подразделение",
		Новый ОписаниеТипов("СправочникСсылка.СтруктураПредприятия"));
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		"Менеджер",
		Новый ОписаниеТипов("СправочникСсылка.Пользователи"));
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		"ГруппаПродукции",
		Новый ОписаниеТипов("СправочникСсылка.ГруппыАналитическогоУчетаНоменклатуры"),
		НЕ ГруппаПродукцииОбязательна);
	
КонецПроцедуры

Процедура ДобавитьОписаниеСуммовыхПолейСебестоимости(МетаданныеРегистра, ОписаниеОперации)
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.Стоимость.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.СтоимостьБезНДС.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.СтоимостьРегл.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Реквизиты.НДСРегл.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.СтоимостьУпр.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Реквизиты.НДСУпр.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.СтоимостьЗабалансовая.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.СтоимостьЗабалансоваяРегл.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.ДопРасходы.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.ДопРасходыБезНДС.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.ДопРасходыРегл.Имя);
		
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.ДопРасходыУпр.Имя);
		
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.ПостояннаяРазница.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.ВременнаяРазница.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Реквизиты.КорСтоимость.Имя);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.СтоимостьНДД.Имя);
	
КонецПроцедуры

Процедура ДобавитьОписаниеСуммовыхПолейСебестоимостиСокращенная(МетаданныеРегистра, ОписаниеОперации, Дополнительное = Ложь)
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.Стоимость.Имя,,
		Дополнительное);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.СтоимостьБезНДС.Имя,,
		Дополнительное);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.СтоимостьРегл.Имя,,
		Дополнительное);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.СтоимостьУпр.Имя,,
		Дополнительное);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Реквизиты.КорСтоимость.Имя,,
		Дополнительное);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.СтоимостьЗабалансовая.Имя,
		,
		Истина);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.СтоимостьЗабалансоваяРегл.Имя,
		,
		Истина);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.ПостояннаяРазница.Имя,
		,
		Истина);
	
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы.ВременнаяРазница.Имя,
		,
		Истина);
	
КонецПроцедуры

Функция ЕстьПолеТаблицыДанные(ПараметрыОтражения, ИмяПоля)
	
	ИмяРегистра = ПараметрыОтражения.ИмяРегистра;
	КолонкиТаблицыДанные = ПараметрыОтражения.РегистрыДляОтражения[ИмяРегистра].КолонкиТаблицыДанные;
	
	Возврат КолонкиТаблицыДанные.Свойство(ИмяПоля);
	
КонецФункции


Функция ОписаниеОперацииСебестоимостиВнешнееПоступление(ПараметрыОтражения) Экспорт
	
	МетаданныеРегистра = ПараметрыОтражения.РегистрыДляОтражения[ПараметрыОтражения.ИмяРегистра].МетаданныеРегистра;
	ОписаниеОперации   = СформироватьОписаниеОперации(МетаданныеРегистра);
	
	// Служебные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ДокументИсточник");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ПериодДокументаИсточника", Новый ОписаниеТипов("Дата"));
	
	// Поля аналитики учета партий.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПартий");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаПартий");
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		"Поставщик",
		Метаданные.Справочники.КлючиАналитикиУчетаПартий.Реквизиты.Поставщик.Тип);
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		"Контрагент",
		Метаданные.Справочники.КлючиАналитикиУчетаПартий.Реквизиты.Контрагент.Тип);
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		"СтавкаНДС",
		Метаданные.Справочники.КлючиАналитикиУчетаПартий.Реквизиты.СтавкаНДС.Тип);
	
	// Поля учета номенклатуры.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Организация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидЗапасов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Партия");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДС");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДСДокумента");
	
	// Корреспондирующие поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорВидЗапасов");
	
	// Количественные и суммовые показатели.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Количество");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ИдентификаторСтроки");
	
	ДобавитьОписаниеСуммовыхПолейСебестоимости(МетаданныеРегистра, ОписаниеОперации);
	
	// Поля аналитики финансового учета.
	ДобавитьОписаниеПолейАналитикиФинансовогоУчета(МетаданныеРегистра, ОписаниеОперации, Ложь);
	
	// Необязательные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "РазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорРазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПоПартнерам",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ТипЗаписи",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорПартия",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьНДД",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорОрганизация",, Истина);
	
	// Для неотфактурованной поставки работ и услуг
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтатьяРасходовСписания",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаРасходов",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорНаправлениеДеятельности",, Истина);
	
	// Используются только в документе "Ввод остатков товаров".
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "РезервПодОбесценениеРегл",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "РезервПодОбесценениеУпр",, Истина);
	
	Возврат ОписаниеОперации;
	
КонецФункции

Функция ОписаниеОперацииСебестоимостиВнутреннееПоступление(ПараметрыОтражения) Экспорт
	
	МетаданныеРегистра = ПараметрыОтражения.РегистрыДляОтражения[ПараметрыОтражения.ИмяРегистра].МетаданныеРегистра;
	ОписаниеОперации   = СформироватьОписаниеОперации(МетаданныеРегистра);
	
	// Служебные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ДокументИсточник");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ПериодДокументаИсточника", Новый ОписаниеТипов("Дата"));
	
	// Поля аналитики учета партий.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПартий");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаПартий");
	ДобавитьОписаниеПоляОперации(
		МетаданныеРегистра,
		ОписаниеОперации.Поля,
		"КодСтроки",
		Метаданные.Справочники.КлючиАналитикиУчетаПартий.Реквизиты.КодСтроки.Тип);
	
	// Поля учета номенклатуры.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Организация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидЗапасов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Партия");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДС");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДСДокумента");
	
	// Корреспондирующие поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорВидЗапасов");
	ДобавитьОписаниеПоляОперации(
			МетаданныеРегистра,
			ОписаниеОперации.Поля,
			"КорГруппаПродукции",
			Новый ОписаниеТипов("СправочникСсылка.ГруппыАналитическогоУчетаНоменклатуры"));
	
	// Количественные и суммовые показатели.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Количество");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ИдентификаторСтроки");
	
	ДобавитьОписаниеСуммовыхПолейСебестоимости(МетаданныеРегистра, ОписаниеОперации);
	
	// Поля аналитики финансового учета.
	ДобавитьОписаниеПолейАналитикиФинансовогоУчета(МетаданныеРегистра, ОписаниеОперации);
	
	// Необязательные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "РазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорРазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорПартия",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорВидДеятельностиНДС",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ТипЗаписи",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ДокументДвижения",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПоПартнерам",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьНДД",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорОрганизация",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СпособОпределенияСебестоимости",, Истина);

	// Используются только в документе "Ввод остатков товаров".
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "РезервПодОбесценениеРегл",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "РезервПодОбесценениеУпр",, Истина);
	
	Возврат ОписаниеОперации;
	
КонецФункции

Функция ОписаниеОперацииСебестоимостиВыбытиеПоФиксированнойСтоимости(ПараметрыОтражения) Экспорт
	
	МетаданныеРегистра = ПараметрыОтражения.РегистрыДляОтражения[ПараметрыОтражения.ИмяРегистра].МетаданныеРегистра;
	ОписаниеОперации   = СформироватьОписаниеОперации(МетаданныеРегистра);
	
	// Служебные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ДокументИсточник");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ПериодДокументаИсточника", Новый ОписаниеТипов("Дата"));
	
	// Поля учета номенклатуры.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Организация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидЗапасов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДС");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДСДокумента");
	
	// Корреспондирующие поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорВидЗапасов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтатьяРасходовАктивов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаРасходовАктивов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтатьяДоходов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаДоходов");
	
	// Количественные и суммовые показатели.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Количество");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ИдентификаторСтроки");
	
	ДобавитьОписаниеСуммовыхПолейСебестоимостиСокращенная(МетаданныеРегистра, ОписаниеОперации);
	
	// Поля аналитики финансового учета.
	ДобавитьОписаниеПолейАналитикиФинансовогоУчета(МетаданныеРегистра, ОписаниеОперации);
	
	// Необязательные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "РазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорРазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ТипЗаписи",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПоПартнерам",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Партия",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорПартия",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "НастройкаСчетовУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорОрганизация",, Истина);
	
	Возврат ОписаниеОперации;
	
КонецФункции

Функция ОписаниеОперацииСебестоимостиПеремещение(ПараметрыОтражения) Экспорт
	
	МетаданныеРегистра = ПараметрыОтражения.РегистрыДляОтражения[ПараметрыОтражения.ИмяРегистра].МетаданныеРегистра;
	ОписаниеОперации   = СформироватьОписаниеОперации(МетаданныеРегистра);
	
	// Поля учета номенклатуры.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Организация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидЗапасов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДС");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДСДокумента");
	
	// Корреспондирующие поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорОрганизация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорПартия");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорВидЗапасов");
	
	// Количественные и суммовые показатели.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Количество");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ИдентификаторСтроки");
	
	ДобавитьОписаниеСуммовыхПолейСебестоимостиСокращенная(МетаданныеРегистра, ОписаниеОперации, Истина);
	
	// Поля аналитики финансового учета.
	ДобавитьОписаниеПолейАналитикиФинансовогоУчета(МетаданныеРегистра, ОписаниеОперации);
	
	// Необязательные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "РазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорРазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПартий",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ЗаказКлиента",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Партия",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПоПартнерам",, Истина);
	
	Возврат ОписаниеОперации;
	
КонецФункции

Функция ОписаниеОперацииСебестоимостиРеализация(ПараметрыОтражения) Экспорт
	
	МетаданныеРегистра = ПараметрыОтражения.РегистрыДляОтражения[ПараметрыОтражения.ИмяРегистра].МетаданныеРегистра;
	ОписаниеОперации   = СформироватьОписаниеОперации(МетаданныеРегистра);
	
	// Служебные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ДокументИсточник");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ПериодДокументаИсточника", Новый ОписаниеТипов("Дата"));
	
	// Поля учета номенклатуры.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Организация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидЗапасов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДС");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДСДокумента");
	
	// Корреспондирующие поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорОрганизация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорВидЗапасов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорПартия");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаПартий");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПоПартнерам");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ЗаказКлиента");
	
	// Количественные и суммовые показатели.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Количество");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ИдентификаторСтроки");
	
	// Поля аналитики финансового учета.
	ДобавитьОписаниеПолейАналитикиФинансовогоУчета(МетаданныеРегистра, ОписаниеОперации);
	
	// Необязательные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "РазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорРазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Стоимость",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьБезНДС",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьРегл",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьУпр",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьЗабалансовая",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьЗабалансоваяРегл",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ТипЗаписи",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорВидДеятельностиНДС",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Партия",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПартий",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СпособОпределенияСебестоимости",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ДокументДвижения",, Истина);
	
	Возврат ОписаниеОперации;
	
КонецФункции

Функция ОписаниеОперацииСебестоимостиСписаниеНаДругиеПартии(ПараметрыОтражения) Экспорт
	
	МетаданныеРегистра = ПараметрыОтражения.РегистрыДляОтражения[ПараметрыОтражения.ИмяРегистра].МетаданныеРегистра;
	ОписаниеОперации   = СформироватьОписаниеОперации(МетаданныеРегистра);
	
	// Поля учета номенклатуры.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Организация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидЗапасов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДС");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДСДокумента");
	
	// Корреспондирующие поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорОрганизация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорПартия");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорВидЗапасов");
	
	// Количественные и суммовые показатели.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Количество");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ИдентификаторСтроки");
	
	// Поля аналитики финансового учета.
	ДобавитьОписаниеПолейАналитикиФинансовогоУчета(МетаданныеРегистра, ОписаниеОперации);
	
	// Необязательные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "РазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорРазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаПартий",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Партия",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПартий",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Стоимость",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьБезНДС",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьРегл",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьУпр",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьЗабалансовая",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьЗабалансоваяРегл",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "НДСРегл",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "НДСУпр",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ТипЗаписи",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаФинансовогоУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаФинансовогоУчетаДокумента",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ДокументДвижения",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СпособОпределенияСебестоимости",, Истина);
	
	Возврат ОписаниеОперации;
	
КонецФункции

Функция ОписаниеОперацииСебестоимостиСписаниеНаРасходыАктивы(ПараметрыОтражения) Экспорт
	
	МетаданныеРегистра = ПараметрыОтражения.РегистрыДляОтражения[ПараметрыОтражения.ИмяРегистра].МетаданныеРегистра;
	ОписаниеОперации   = СформироватьОписаниеОперации(МетаданныеРегистра);
	
	// Служебные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ДокументИсточник");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ПериодДокументаИсточника", Новый ОписаниеТипов("Дата"));
	
	// Поля учета номенклатуры.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Организация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидЗапасов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДС");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ВидДеятельностиНДСДокумента");
	
	// Корреспондирующие поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорОрганизация");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаНоменклатуры");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорВидЗапасов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтатьяРасходовАктивов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаРасходовАктивов");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорНаправлениеДеятельности");
	
	// Количественные и суммовые показатели.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Количество");
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ИдентификаторСтроки");
	
	// Поля аналитики финансового учета.
	ДобавитьОписаниеПолейАналитикиФинансовогоУчета(МетаданныеРегистра, ОписаниеОперации);
	
	// Необязательные поля.
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "РазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорРазделУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Партия",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПартий",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорПартия",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "КорАналитикаУчетаПартий",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "Стоимость",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьБезНДС",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьРегл",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "СтоимостьУпр",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ТипЗаписи",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "НастройкаСчетовУчета",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "АналитикаУчетаПоПартнерам",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ЗаказКлиента",, Истина);
	ДобавитьОписаниеПоляОперации(МетаданныеРегистра, ОписаниеОперации.Поля, "ДокументДвижения",, Истина);
	
	Возврат ОписаниеОперации;
	
КонецФункции

Функция ПолучитьОписаниеОперации(ПараметрыОтражения, ВидОперации) Экспорт
	
	Если ВидОперации = Перечисления.ОперацииУчетаСебестоимости.ВнешнееПоступление Тогда
		ОписаниеОперации = ОписаниеОперацииСебестоимостиВнешнееПоступление(ПараметрыОтражения);
	ИначеЕсли ВидОперации = Перечисления.ОперацииУчетаСебестоимости.ВнутреннееПоступление Тогда
		ОписаниеОперации = ОписаниеОперацииСебестоимостиВнутреннееПоступление(ПараметрыОтражения);
	ИначеЕсли ВидОперации = Перечисления.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости Тогда
		ОписаниеОперации = ОписаниеОперацииСебестоимостиВыбытиеПоФиксированнойСтоимости(ПараметрыОтражения);
	ИначеЕсли ВидОперации = Перечисления.ОперацииУчетаСебестоимости.Перемещение Тогда
		ОписаниеОперации = ОписаниеОперацииСебестоимостиПеремещение(ПараметрыОтражения);
	ИначеЕсли ВидОперации = Перечисления.ОперацииУчетаСебестоимости.Реализация Тогда
		ОписаниеОперации = ОписаниеОперацииСебестоимостиРеализация(ПараметрыОтражения);
	ИначеЕсли ВидОперации = Перечисления.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии Тогда
		ОписаниеОперации = ОписаниеОперацииСебестоимостиСписаниеНаДругиеПартии(ПараметрыОтражения);
	ИначеЕсли ВидОперации = Перечисления.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы Тогда
		ОписаниеОперации = ОписаниеОперацииСебестоимостиСписаниеНаРасходыАктивы(ПараметрыОтражения);
	Иначе
		ОписаниеОперации = Неопределено;
	КонецЕсли;
	
	Если ОписаниеОперации <> Неопределено Тогда
		ОписаниеОперации.ВидОперации = ВидОперации;
	КонецЕсли;
	
	Возврат ОписаниеОперации;
	
КонецФункции

#КонецОбласти

#Область ТекстыОперацийСебестоимость

#Область Описание_ОтразитьОперацииВУчетеСебестоимости

// В процедуре ОтразитьОперацииВУчетеСебестоимости() выполняется формирование полного текста запроса для проведения
// документа по регистрам учета себестоимости.
// Структура процедуры:
// 1) Формируются временные таблицы в соответствии с операциями документа:
// Запросы формирования временных таблиц описаны в процедурах, соответствующих имени модульной операции:
//	ВнешнееПоступление - ОтразитьОперациюСебестоимостиВнешнееПоступление() - временная таблица ВТОперация_ВнешнееПоступление
//	ВнутреннееПоступление - ОтразитьОперациюСебестоимостиВнутреннееПоступление() - временная таблица ВТОперация_ВнутреннееПоступление
//	ВыбытиеПоФиксированнойСтоимости- ОтразитьОперациюСебестоимостиВыбытиеПоФиксированнойСтоимости() - временная таблица ВТОперация_ВыбытиеПоФиксированнойСтоимости
//	Перемещение - ОтразитьОперациюСебестоимостиПеремещение() - временная таблица ВТОперация_Перемещение
//	Реализация - ОтразитьОперациюСебестоимостиРеализация() - временная таблица ВТОперация_Реализация
//	СписаниеНаДругиеПартии - ОтразитьОперациюСебестоимостиСписаниеНаДругиеПартии() - временная таблица ВТОперация_СписаниеНаДругиеПартии
//	СписаниеНаРасходыАктивы - ОтразитьОперациюСебестоимостиСписаниеНаРасходыАктивы() - временная таблица ВТОперация_СписаниеНаРасходыАктивы

// 2) Формируется сводный запрос по данным временных таблиц операций документа.
// Выполняется в процедуре ДобавитьТекстЗапросаФормированияДвижений().
// Исходные данные: временные таблицы
//	- ВТОперация_ВнешнееПоступление
//	- ВТОперация_ВнутреннееПоступление
//	- ВТОперация_ВыбытиеПоФиксированнойСтоимости
//	- ВТОперация_Перемещение
//	- ВТОперация_Реализация
//	- ВТОперация_СписаниеНаДругиеПартии
//	- ВТОперация_СписаниеНаРасходыАктивы
// Выходные данные:
//	При использовании метода оценки стоимости "Среднескользящая" формируется временная таблица ВТОперацииДокумента.
//	При использовании других методов оценки формируется выборка из исходных временных таблиц.

// Следующме пункты 3 - 9 выполняются только при использовании метода оценки стоимости "Среднескользящая".

#Область Описание_ОтразитьОперацииВУчетеСебестоимости_СреднескользящаяРасчетСтоимости

// 3) Формируются запросы получения и расчета среднескользящей стоимости.
// Выполняется в процедуре ДобавитьТекстЗапросаРасчетСреднескользящаяСтоимость().

// 3.1) Формируется запрос получения среднескользящей стоимости.
// Выполняется в области #Область ДобавитьТекстЗапросаСреднескользящаяСтоимость
// Исходные данные:
// 	 - временная таблица ВТОперацииДокумента
// 	 - движения текущего документа по регистру накопления "Себестоимость товаров"
// Условия выборки данных из таблицы ВТОперацииДокумента:
//	- МетодОценкиСтоимостиТоваров = «Среднескользящая»
//	- ВидДвижения = «Расход»
// Выполняемые действия:
//	- Получается остаток без указания даты из виртуальной таблицы Остатки регистра накопления "Себестоимость товаров"
//	по 4-м первым измерениям (АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, Организация).
//	- Получаются суммы из ранее сформированных движений документа (для сохранения ранее рассчитанной стоимости). 
// Выходные данные: временные таблицы
//	- ВТСебестоимостьОстаток - рассчитаный остаток себестоимости 
//	- ВТИдентификаторыСебестоимости - таблица идентификаторов фин записи, для которых уже была рассчитана себестоимость

// 3.2) Формируется запрос определения стоимости по методу "Среднескользящая".
// Выполняется в области #Область ДобавитьТекстЗапросаРасчетаСтоимостиПоСреднескользящей
// Исходные данные: временные таблицы
// 	- ВТОперацииДокумента
//	- ВТСебестоимостьОстаток 
//	- ВТИдентификаторыСебестоимости
// Выполняемые действия:
//	Для движений по новым строкам документа стоимость определяется по остаткам себестоимости.
//	Для движений по строкам, которые уже были у данного документа, стоимость определяется по его старым движениям.
// Выходные данные: временная таблица ВТДвиженияРасчетПоСреднескользящей
// 
// ОГРАНИЧЕНИЕ: при наличии двух и более одинаковых строк может возникнуть суммовой остаток на погрешность округления,
// если в результате все количество списывается в 0. Такой остаток будет списан при закрытии месяца или будет учтен после
// следующего приобретения товаров.

// 3.3) Формируется запрос определения стоимости по документу - источнику.
// Выполняется в области #Область ДобавитьТекстЗапросаСтоимостьПоДвижениямДокументаИсточника.
// Исходные данные:
// 	 - временная таблица ВТОперацииДокумента
// 	 - движения документа-источника по регистру накопления "Себестоимость товаров"
// Условия выборки данных из таблицы ВТОперацииДокумента:
//	МетодОценкиСтоимостиТоваров = "Среднескользящая"
//	ДокументИсточник <> Неопределено
// Выполняемые действия:
//	Получаются движения документа-источника по регистру "Себестоимость товаров".
// Выходные данные: временная таблица ВТСебестоимостьДокументаИсточника

// 3.4) Формируется запрос расчета стоимости по документу - источнику.
// Выполняется в области #Область ДобавитьТекстЗапросаРасчетаСтоимостиПоДокументуИсточнику
// Исходные данные: временные таблицы
//	- ВТОперацииДокумента
//	- ВТСебестоимостьДокументаИсточника
// Условия выборки данных из таблицы ВТОперацииДокумента:
//	МетодОценкиСтоимостиТоваров = «Среднескользящая»
//	И
//	(СпособОпределенияСебестоимости = «ПоДвижениямДокументаИсточника» 
//	ИЛИ 
//	ОперацияУчетаСебестоимости = "ВыбытиеПоФиксированнойСтоимости" и метод оценки Среднескользящая)
// Выполняемые действия:
//	Выполняется расчет стоимости по данным документа-источника.
// Выходные данные: временная таблица ВТДвиженияРасчетПоДокументуИсточнику

// 3.5) Формируется запрос расчета отклонений в стоимости.
// Выполняется в области #Область ДобавитьТекстЗапросаРасчетаОтклоненийВСтоимости
// Исходные данные: временные таблицы
//	- ВТДвиженияРасчетПоСреднескользящей
//	- ВТДвиженияРасчетПоДокументуИсточнику
// Условия выборки данных:
//	ОперацияУчетаСебестоимости = "ВыбытиеПоФиксированнойСтоимости"
// Выполняемые действия:
//	- Рассчитываются отклонения рассчитанной стоимости от исходной стоимости документа.
//	- Отклонения будут отнесены на прочие доходы, если отклонения меньше 0 (рассчитанная стоимость меньше стоимости в документе)
//	- Отклонения будут отнесены на прочие расходы, если отклонения больше 0 (рассчитанная стоимость больше стоимости в документе)
// Выходные данные: временная таблица ВТДвиженияОтклоненияВСтоимости

// 3.6) Формируется результирующий запрос для формирования движений по регистру "Себестоимость товаров".
// Выполняется в области #Область ДобавитьТекстЗапросаДвиженияСоСтоимостью 
// Исходные данные: временные таблицы
//	- ВТОперацииДокумента
//	- ВТДвиженияРасчетПоСреднескользящей
//	- ВТДвиженияРасчетПоДокументуИсточнику
//	- ВТДвиженияОтклоненияВСтоимости
// Выполняемые действия: формируются результирующие движения
//	- со способом определения себестоимости "ИзДокумента"
//	- со способом определения себестоимости "ПоСреднескользящей"
//	- со способом определения себестоимости "ПоКорДвжению"
//	- со способом определения себестоимости "ПоДвижениямДокументаИсточника"
//	- Формируются движения по отклонениям в стоимости.
// Выходные данные:
//	- Временная таблица ВТИтоговыеДвиженияСебестоимостьТоваров
//	- Выборка из итоговой таблицы. Структура полей выборки полностью соответствует исходной таблице ВТОперацииДокумента

#КонецОбласти

#Область Описание_ОтразитьОперацииВУчетеСебестоимости_СреднескользящаяФормированиеДвижений

// В процедурах формируются корреспондирующие движения по разным регистрам исходными данными для которых являются
// движения по регистру "Себестоимость товаров".

// 4) Формируются движения по регистру "Выручка и себестоимость продаж".
// Выполняется в процедуре ДобавитьТекстЗапросаДвиженияВыручкаИСебестоимостьПродаж().
// Исходные данные: временные таблицы
//	- ВТИтоговыеДвиженияСебестоимостьТоваров
//	- ДвиженияВыручкиИСебестоимости - запрос формирования движений мз модуля менеджера документа
// Выполняемые действия: в таблице формирования движений заполняется рассчитанная себестоимость
// Выходные данные: выборка для формирования движений по регистру

// 5) Формируются корреспондирующие движения по регистру "Прочие расходы".
// Выполняется в процедуре ДобавитьТекстЗапросаКорДвиженияПрочиеРасходы().
// Исходные данные: временные таблицы
//	- ВТДвиженияРасчетПоСреднескользящей
//	- ВТДвиженияРасчетПоДокументуИсточнику
//	- ВТДвиженияОтклоненияВСтоимости
// Условие выборки данных: 
//	(ОперацияУчетаСебестоимости  = "СписаниеНаРасходыАктивы"
//	ИЛИ ОперацияУчетаСебестоимости  = "ВыбытиеПоФиксированнойСтоимости")
//	И заполнено поле СтатьяРасходовСписания
// Выполняемые действия: формируется таблица для записи движений по регистру
// Выходные данные: выборка для формирования движений по регистру

// 6) Формируются корреспондирующие движения по регистру "Прочие доходы".
// Выполняется в процедуре ДобавитьТекстЗапросаКорДвиженияПрочиеДоходы().
// Исходные данные:
//	- временная таблица ВТДвиженияОтклоненияВСтоимости
// Условие выборки данных: заполнено поле СтатьяДоходов
// Выполняемые действия: формируется таблица для записи движений по регистру
// Выходные данные: выборка для формирования движений по регистру

// 7) Формируются корреспондирующие движения по регистру "Активы и пассивы".
// Выполняется в процедуре ДобавитьТекстЗапросаКорДвиженияПрочиеАктивыПассивы().
// Исходные данные:
//	- временная таблица ВТДвиженияРасчетПоСреднескользящей
// Условие выборки данных:
//	ОперацияУчетаСебестоимости  = "СписаниеНаРасходыАктивы"
//	И заполнено поле СтатьяАктивовПассивов
// Выполняемые действия: формируется таблица для записи движений по регистру
// Выходные данные: выборка для формирования движений по регистру

// 8) Формируются корреспондирующие движения по регистру "Движения Прочие активы и пассивы".
// Выполняется в процедуре ДобавитьТекстЗапросаКорДвиженияПоПрочимАктивамПассивам().
// Исходные данные:
//	- временная таблица ВТДвиженияРасчетПоСреднескользящей
// Условие выборки данных:
//	ОперацияУчетаСебестоимости  = "СписаниеНаРасходыАктивы"
//	И заполнено поле СтатьяАктивовПассивов
// Выполняемые действия: формируется таблица для записи движений по регистру
// Выходные данные: выборка для формирования движений по регистру

// 9) Формируются корреспондирующие движения по регистру "Движения Номенклатура - Доходы/Расходы".
// Выполняется в процедуре ДобавитьТекстЗапросаКорДвиженияНоменклатураДоходыРасходы().
// Исходные данные: временные таблицы
//	- ВТДвиженияРасчетПоСреднескользящей
//	- ВТДвиженияРасчетПоДокументуИсточнику
//	- ВТДвиженияОтклоненияВСтоимости
// Условие выборки данных из таблиц ВТДвиженияРасчетПоСреднескользящей и ВТДвиженияРасчетПоДокументуИсточнику
//	ОперацияУчетаСебестоимости  = "СписаниеНаРасходыАктивы"
// Выполняемые действия: формируется таблица для записи движений по регистру
// Выходные данные: выборка для формирования движений по регистру

#КонецОбласти

#КонецОбласти

// Формирует запрос для проведения документа по регистру СебестоимостьТоваров.
//
// Параметры:
//	ОписаниеОпераций - Массив - массив операций
//
Процедура ОтразитьОперацииВУчетеСебестоимости(ПараметрыОтражения)
	
	ИмяРегистра 	   			= ПараметрыОтражения.ИмяРегистра;
	ОписаниеОперацийДокумента   = ПараметрыОтражения.РегистрыДляОтражения[ИмяРегистра].ОписаниеОперацийДокумента;
	
	Если ОписаниеОперацийДокумента.Количество() = 0 Тогда
		 Возврат;
	КонецЕсли;
	
	НомерОперации = 0;
	
	ВидыОперацийДокумента  = Новый Соответствие;
	СхемыЗапросовДокумента = Новый Массив;
	
	ТаблицаПолей = Новый ТаблицаЗначений;
	ТаблицаПолей.Колонки.Добавить("Имя");
	ТаблицаПолей.Колонки.Добавить("Тип");
	ТаблицаПолей.Колонки.Добавить("ПрисутствуетВОперациях");
	ТаблицаПолей.Колонки.Добавить("Дополнительное");
	
	КолонкиТаблицыДанные = Новый Структура;
	
	Для Каждого ТекущаяОперацияДокумента Из ОписаниеОперацийДокумента Цикл
		
		ТекущаяОперацияДокумента.НомерОперации = НомерОперации;
		НомерОперации = НомерОперации + 1;
		
		// Разберем схему запроса текущей операции.
		РазборСхемыЗапроса = Новый Структура;
		
		Попытка
			
			РазборСхемыЗапроса.Вставить("СхемаЗапроса", Новый СхемаЗапроса);
			
			РазборСхемыЗапроса.СхемаЗапроса.УстановитьТекстЗапроса(ТекущаяОперацияДокумента.ТекстЗапроса);
			
			РазборСхемыЗапроса.Вставить("ОписаниеЗапроса", РазборСхемыЗапроса.СхемаЗапроса.ПакетЗапросов[РазборСхемыЗапроса.СхемаЗапроса.ПакетЗапросов.Количество() - 1]);
			РазборСхемыЗапроса.Вставить("КолонкиЗапроса", Новый Структура);
			
			Для Каждого ТекущаяКолонка Из РазборСхемыЗапроса.ОписаниеЗапроса.Колонки Цикл
				РазборСхемыЗапроса.КолонкиЗапроса.Вставить(ТекущаяКолонка.Псевдоним);
			КонецЦикла;
			
			РазборСхемыЗапроса.Вставить("ВидОперации", ТекущаяОперацияДокумента.ВидОперации);
			
		Исключение

			ТекстОшибки = НСтр("ru = 'Невозможно выполнить разбор схемы запроса №%1 движений документа %2 по регистру %3';
								|en = 'Unable to parse query schema %1 of document register records %2 by register %3'") + ":
				|" + КраткоеПредставлениеОшибки(ИнформацияОбОшибке());
			
			ТекстОшибки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				ТекстОшибки,
				НомерОперации,
				ПараметрыОтражения.МетаданныеДокумента.Имя,
				ПараметрыОтражения.ИмяРегистра);
				
			ВызватьИсключение ТекстОшибки;
			
		КонецПопытки;
		
		СхемыЗапросовДокумента.Добавить(РазборСхемыЗапроса);
		
		// Заполним описание полей для всех типов используемых операций
		ОписаниеОперации = ВидыОперацийДокумента.Получить(ТекущаяОперацияДокумента.ВидОперации);
		ЕстьОписаниеОперации = (ОписаниеОперации <> Неопределено);
		
		Если НЕ ЕстьОписаниеОперации Тогда
			ОписаниеОперации = ПолучитьОписаниеОперации(ПараметрыОтражения, ТекущаяОперацияДокумента.ВидОперации);
		КонецЕсли;
		
		ПроверитьПоляЗапросаВыборкиДанных(ПараметрыОтражения, ОписаниеОперации, РазборСхемыЗапроса);
		
		Если ЕстьОписаниеОперации Тогда
			Продолжить;
		КонецЕсли;
		
		Если ОписаниеОперации = Неопределено Тогда
			
			ТекстОшибки = НСтр("ru = 'Некорректная операция учета себестоимости для документа ""%1""';
								|en = 'Incorrect cost accounting transaction for document ""%1""'");
			
			Если ЗначениеЗаполнено(ПараметрыОтражения.Документ) Тогда
				ТекстОшибки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
					ТекстОшибки,
					СокрЛП(ПараметрыОтражения.Документ));
			Иначе
				
				ТекстОшибки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
					ТекстОшибки,
					ПараметрыОтражения.МетаданныеДокумента);
				
			КонецЕсли;
			
			ВызватьИсключение ТекстОшибки; // некорректная операция учета себестоимости
			
		КонецЕсли;
		
		Для Каждого ОписаниеПоля Из ОписаниеОперации.Поля Цикл
			
			Если КолонкиТаблицыДанные.Свойство(ОписаниеПоля.Имя) Тогда
				СтрокаПоля = ТаблицаПолей[КолонкиТаблицыДанные[ОписаниеПоля.Имя]];
			Иначе
				СтрокаПоля = Неопределено;
			КонецЕсли;
			
			Если СтрокаПоля = Неопределено Тогда
				
				СтрокаПоля = ТаблицаПолей.Добавить();
				СтрокаПоля.Имя = ОписаниеПоля.Имя;
				СтрокаПоля.Тип = ?(ОписаниеПоля.Тип = Неопределено, Новый ОписаниеТипов, ОписаниеПоля.Тип);
				СтрокаПоля.ПрисутствуетВОперациях = Новый Соответствие;
				СтрокаПоля.Дополнительное = Новый Соответствие;
				
				КолонкиТаблицыДанные.Вставить(ОписаниеПоля.Имя, ТаблицаПолей.Количество() - 1);
				
			Иначе
				
				Если ОписаниеПоля.Тип <> Неопределено Тогда
					СтрокаПоля.Тип = Новый ОписаниеТипов(СтрокаПоля.Тип, ОписаниеПоля.Тип.Типы());
				КонецЕсли;
				
			КонецЕсли;
			
			СтрокаПоля.ПрисутствуетВОперациях.Вставить(ТекущаяОперацияДокумента.ВидОперации, Истина);
			
			Если ОписаниеПоля.Дополнительное Тогда
				СтрокаПоля.Дополнительное.Вставить(ТекущаяОперацияДокумента.ВидОперации, Истина);
			КонецЕсли;
			
		КонецЦикла;
		
		ВидыОперацийДокумента.Вставить(ТекущаяОперацияДокумента.ВидОперации, ОписаниеОперации);
		
	КонецЦикла;
	
	ПараметрыОтражения.РегистрыДляОтражения[ИмяРегистра].Вставить("ТаблицаПолей",  			ТаблицаПолей);
	ПараметрыОтражения.РегистрыДляОтражения[ИмяРегистра].Вставить("КолонкиТаблицыДанные",  	КолонкиТаблицыДанные);
	ПараметрыОтражения.РегистрыДляОтражения[ИмяРегистра].Вставить("СхемыЗапросовДокумента",	СхемыЗапросовДокумента);
	ПараметрыОтражения.РегистрыДляОтражения[ИмяРегистра].Вставить("ВидыОперацийДокумента", 	ВидыОперацийДокумента);
	
	ПараметрыОтражения.Вставить("ТекстыШаблоновОтражения",  	 Новый Структура);
	ПараметрыОтражения.Вставить("ТекстыШаблоновВТ", 			 Новый Структура);
	ПараметрыОтражения.Вставить("ТекстыЗапросовДанныхДокумента", Новый Структура);
	
	ДобавитьТекстЗапросаТаблицыДанные(ПараметрыОтражения);
	
	Для Каждого ТекущаяОперацияДокумента Из ВидыОперацийДокумента Цикл
		
		// Сформируем текст запроса формирвоания временной таблицы отражения операции документа.
		Если ТекущаяОперацияДокумента.Ключ = Перечисления.ОперацииУчетаСебестоимости.ВнешнееПоступление Тогда
			ОтразитьОперациюСебестоимостиВнешнееПоступление(ПараметрыОтражения);
		ИначеЕсли ТекущаяОперацияДокумента.Ключ = Перечисления.ОперацииУчетаСебестоимости.ВнутреннееПоступление Тогда
			ОтразитьОперациюСебестоимостиВнутреннееПоступление(ПараметрыОтражения);
		ИначеЕсли ТекущаяОперацияДокумента.Ключ = Перечисления.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости Тогда
			ОтразитьОперациюСебестоимостиВыбытиеПоФиксированнойСтоимости(ПараметрыОтражения);
		ИначеЕсли ТекущаяОперацияДокумента.Ключ = Перечисления.ОперацииУчетаСебестоимости.Перемещение Тогда
			ОтразитьОперациюСебестоимостиПеремещение(ПараметрыОтражения);
		ИначеЕсли ТекущаяОперацияДокумента.Ключ = Перечисления.ОперацииУчетаСебестоимости.Реализация Тогда
			ОтразитьОперациюСебестоимостиРеализация(ПараметрыОтражения);
		ИначеЕсли ТекущаяОперацияДокумента.Ключ = Перечисления.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии Тогда
			ОтразитьОперациюСебестоимостиСписаниеНаДругиеПартии(ПараметрыОтражения);
		ИначеЕсли ТекущаяОперацияДокумента.Ключ = Перечисления.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы Тогда
			ОтразитьОперациюСебестоимостиСписаниеНаРасходыАктивы(ПараметрыОтражения);
		КонецЕсли;
		
	КонецЦикла;
	
	// Добавим текст запроса выборки данных документа (или формирования ВТОперацииДокумента при использовании среднескользящей)
	ДобавитьТекстЗапросаФормированияДвижений(ПараметрыОтражения);
	
	Если ПараметрыОтражения.ИспользуетсяСреднескользящая Тогда
		
		// Рассчитываются дополнительные суммовые движения и формируется текст запроса выборки данных документа
		ДобавитьТекстЗапросаРасчетСреднескользящаяСтоимость(ПараметрыОтражения);
		ДобавитьТекстЗапросаДвиженияВыручкаИСебестоимостьПродаж(ПараметрыОтражения);
		ДобавитьТекстЗапросаКорДвиженияПрочиеРасходы(ПараметрыОтражения);
		ДобавитьТекстЗапросаКорДвиженияПрочиеДоходы(ПараметрыОтражения);
		ДобавитьТекстЗапросаКорДвиженияПрочиеАктивыПассивы(ПараметрыОтражения);
		ДобавитьТекстЗапросаКорДвиженияПоПрочимАктивамПассивам(ПараметрыОтражения);
		ДобавитьТекстЗапросаКорДвиженияНоменклатураДоходыРасходы(ПараметрыОтражения);
		ДобавитьТекстЗапросаКорДвиженияНоменклатураНоменклатура(ПараметрыОтражения);
		ДобавитьТекстЗапросаОтклоненияВСтоимостиТоваров(ПараметрыОтражения);
		
	КонецЕсли;
	
	УстановитьДополнительныеПараметрыЗапроса(ПараметрыОтражения);
	
	// Дополним тексты запросов для проведения документа.
	ПроведениеДокументов.ДополнитьЗапросОтраженияДокумента(
		ПараметрыОтражения.Запрос,
		ПараметрыОтражения.ТекстыЗапроса,
		ПараметрыОтражения.ТекстыШаблоновОтражения,
		ПараметрыОтражения.ТекстыЗапросовДанныхДокумента,
		ПараметрыОтражения.ТекстыШаблоновВТ);
	
КонецПроцедуры

#Область Описание_ТекстыОперацийСебестоимость

// Описываются общие правила заполнения полей в движениях по регистру "Себестоимость товаров".
// 
// Правила заполнения поля "РазделУчета":
// - "МатериалыПринятыеВПереработку" - тип запасов "МатериалДавальца" и тип места хранения "Склад" или "Подразделение";
// - "МатериалыПринятыеВПереработкуКОформлениюСписания" - тип запасов "МатериалДавальца" и только для следующих хоз. операций:
// 		СписаниеТоваровДавальцаЗаСчетДавальца,
// 		СписаниеТоваровДавальцаНаРасходы;
// - "МатериалыПринятыеВПереработкуПереданныеПартнерам" - тип запасов "МатериалДавальца" и тип места хранения "Договор"
// 	с типом договора "СПереработчиком2_5" или "СПереработчиком2_5_ЕАЭС";
// - "НезавершенноеПроизводство" - если в поле "Партия" указана ссылка на справочник "ПартииПроизводства", партии
// 	производства могут быть отражены только в этом разделе учета;
// - "НеотфактурованныеПоставки" - тип запасов "СобственныйТоварПоНеотфактурованнойПоставке", но для услуг нельзя
// 	определить поэтому для них определяется по хоз. операциям:
// 		ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка,
// 		ЗакупкаУПоставщикаНеотфактурованнаяПоставка,
// 		ЗакупкаУПоставщикаФактуровкаПоставки,
// 		ЗакупкаВСтранахЕАЭСФактуровкаПоставки;
// - "ПроизводственныеЗатраты" - тип номенклатуры "Работа" или "Услуга", или тип места хранения "Склад" с реквизитом
// 	"ЦеховаяКладовая" = Истина, или тип места хранения "Подразделение";
// - "СобственныеТоварыВПути" - тип запасов "СобственныйТоварВПути";
// - "СобственныеТоварыПереданныеПартнерам" - тип места хранения "Договор" с типом договора "СХранителем";
// - "ТоварыВПути" - определеяется только по хоз. операции "РеализацияБезПереходаПраваСобственности";
// - "ТоварыНаСкладах" - тип запасов "Товар" и тип места хранения "Склад", как правило, устанавливается тогда, когда
// 	остальные варианты не подошли;
// - "ТоварыНаХраненииСПравомПродажи" - тип запасов "ТоварНаХраненииСПравомПродажи" и тип места хранения не "Договор";
// - "ТоварыНаХраненииСПравомПродажиКОформлениюСписания" - тип запасов "ТоварНаХраненииСПравомПродажи" и только для следующих хоз. операций:
// 		ОприходованиеИзлишковТоваровВПользуПоклажедателя,
// 		СписаниеПринятыхТоваровЗаСчетПоклажедателя,
// 		СписаниеПринятыхТоваровНаРасходы,
// 		СписаниеТоваров,
// 		СписаниеНедостачЗаСчетПоклажедателя,
// 		СписаниеТоваровУПереработчика,
// 		ПересортицаТоваров,
// 		ПересортицаТоваровСПереоценкой,
// 		ПорчаТоваров,
// 		ПорчаТоваровСПереоценкой;
// - "ТоварыНаХраненииСПравомПродажиПереданныеПартнерам" - тип запасов "ТоварНаХраненииСПравомПродажи" и тип места
// 	хранения "Договор" с типом договора не "СПереработчиком2_5" и не "СПереработчиком2_5_ЕАЭС";
// - "ТоварыПереданныеНаКомиссию" - тип запасов "Товар" и тип места хранения "Договор" с типом "СКомиссионером".
// 	Такое определение справедливо только для новой комиссии, для старой комиссии возможно определение только по хоз. операциям:
// 		ВводОстатковТоваровПереданныхНаКомиссию,
// 		ОприходованиеИзлишковТоваровВПользуКомитента,
// 		СписаниеНедостачЗаСчетКомитента,
// 		СписаниеТоваровУКомиссионера,
// 		РеализацияЧерезКомиссионера,
// 		РеализацияЧерезКомиссионераБезПереходаПраваСобственности,
// 		ВозвратТоваровЧерезКомиссионера,
// 		ВозвратОтКомиссионера,
// 		ПередачаНаКомиссию,
// 		ПередачаНаКомиссиюВДругуюОрганизацию,
// 		ОтчетКомиссионера,
// 		ОтчетКомиссионераОСписании;
// - "ТоварыПереданныеНаКомиссиюВПути" - определяется только по хоз. операции "РеализацияЧерезКомиссионераБезПереходаПраваСобственности";
// - "ТоварыПереданныеПереработчику" - тип места хранения "Договор" с типом договора "СПереработчиком2_5" и "СПереработчиком2_5_ЕАЭС",
// 	при этом тип номенклатуры не работа и не услуга.
// 	Такое определение справедливо только для новой переработки, для старой переработки возможно определение только по хоз. операциям:
// 		ВводОстатковМатериаловПереданныхПереработчикам,
// 		ПересортицаТоваровУПереработчика,
// 		СписаниеТоваровУПереработчика,
// 		ВозвратОтПереработчика,
// 		ПоступлениеОтПереработчика,
// 		ПорчаТоваровУПереработчика,
// 		ПередачаПереработчику,
// 		ВыкупТоваровПереработчиком;
// - "ТоварыПринятыеНаКомиссию" - тип запасов "КомиссионныйТовар";
// - "ТоварыПринятыеНаКомиссиюВПути" - тип запасов "КомиссионныйТовар" и только для следующих хоз. операций:
// 		РеализацияБезПереходаПраваСобственности,
// 		РеализацияЧерезКомиссионераБезПереходаПраваСобственности;
// - "ТоварыПринятыеНаОтветхранение" - тип запасов "ПолуфабрикатДавальца" или "ПродукцияДавальца" и тип места хранения "Склад" или "Подразделение";
// - "ТоварыПринятыеНаОтветхранениеКОформлениюСписания" - тип запасов "ПолуфабрикатДавальца" или "ПродукцияДавальца" и только для следующих хоз. операций:
// 		СписаниеТоваровДавальцаЗаСчетДавальца,
// 		СписаниеТоваровДавальцаНаРасходы;
// - "ТоварыПринятыеНаОтветхранениеПереданныеПартнерам" - тип запасов "ПолуфабрикатДавальца" или "ПродукцияДавальца"
// 	и тип места хранения "Договор" с типом договора "СПереработчиком2_5" или "СПереработчиком2_5_ЕАЭС".

#КонецОбласти

Процедура ОтразитьОперациюСебестоимостиВнешнееПоступление(ПараметрыОтражения)
	
	// Сформируем шаблон текста запроса для отражения операции.
	ТекстЗапросаОтражения =
	"ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка))
	|		  И ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета
	|		  И ДанныеДокумента.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|			ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровПоставщику))
	|		  И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ПриобретениеТоваровУслуг))
	|			ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|			ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	КОНЕЦ									КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|	ДанныеДокумента.ПериодДокументаИсточника КАК ПериодДокументаИсточника,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 															КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|		  ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			  И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ									КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета И ДанныеДокумента.РазделУчета <> НЕОПРЕДЕЛЕНО
	|		 И ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.РазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_РазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_РазделУчета
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковТоваровПринятыхНаОтветственноеХранение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковТоваровПереданныхНаКомиссию)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		 И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковТоваровПолученныхНаКомиссию) 
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковМатериаловПереданныхВПроизводство)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковМатериаловПереданныхПереработчикам)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	//-- Устарело_Переработка24
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемНаХранениеСПравомПродажи),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемкаПодПринципала))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	//++ НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаОтчетаПереработчика)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	//-- НЕ УТ
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.АналитикаУчетаНоменклатурыИсходнаяНазначениеТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемНаКомиссию))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	//++ НЕ УТКА

	//++ Устарело_Переработка24
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтДавальца)
	|			И ДанныеДокумента.СпрНоменклатураТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	//-- Устарело_Переработка24

	//-- НЕ УТКА
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|		 И (ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5)
	|			ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5_ЕАЭС))
	|		 И ДанныеДокумента.СпрНоменклатураТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|			ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																					КАК РазделУчета,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|		ТОГДА ДанныеДокумента.КорРазделУчета
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|	КОНЕЦ 																					КАК КорРазделУчета,
	|
	// Корреспондирующие поля
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|		  ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			  И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.КорВидЗапасов
	|	КОНЕЦ 																					КАК КорВидЗапасов,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация 													КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.Подразделение 															КАК Подразделение,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПоПартнерам
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПоПартнерам
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаУчетаПоПартнерам,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество 						КАК Количество,
	|	(ВЫБОР
	// При передаче между организациями стоимость заполняется, если организация-получатель применяет среднескольящую.
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорОрганизация
	|			ТОГДА (ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|					ТОГДА ДанныеДокумента.Стоимость ИНАЧЕ 0 КОНЕЦ)
	|		ИНАЧЕ ДанныеДокумента.Стоимость КОНЕЦ)		КАК Стоимость,
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорОрганизация
	|			ТОГДА (ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|					ТОГДА ДанныеДокумента.СтоимостьБезНДС ИНАЧЕ 0 КОНЕЦ)
	|		ИНАЧЕ ДанныеДокумента.СтоимостьБезНДС КОНЕЦ) КАК СтоимостьБезНДС,
	|	ДанныеДокумента.СтоимостьРегл
	|	+ ВЫБОР КОГДА НЕ ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|	  И (НЕ &ФормироватьНДСПредъявленныйПриВключенииВСтоимость
	// При неотфактурованной поставке НДС отдельным движением не выделяется. 
	|		ИЛИ ДанныеДокумента.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка)))
	|	  И ДанныеДокумента.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
	|	  И (ДанныеДокумента.Количество <> 0
	|	  ИЛИ НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	// При партионном учете 2.1 включение НДС в стоимость отражается в ресурсе СтоимостьРегл не зависимо от периода документа-основания.
	|	  ИЛИ НЕ &Константа_ПартионныйУчетВерсии22
	|	  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ))
	|			ТОГДА ДанныеДокумента.НДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК СтоимостьРегл,
	// При неотфактурованной поставке НДС не заполняется.
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка))
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.НДСРегл КОНЕЦ)		КАК НДСРегл,
	|	ВЫБОР КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|	  И &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.СтоимостьУпр
	|			+ ВЫБОР КОГДА НЕ ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|			    И НЕ &ФормироватьНДСПредъявленныйПриВключенииВСтоимость
	|			    И (НЕ &ФормироватьНДСПредъявленныйПриВключенииВСтоимость
	// При неотфактурованной поставке НДС отдельным движением не выделяется. 
	|					ИЛИ ДанныеДокумента.ХозяйственнаяОперация В (
	|						ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка),
	|						ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка)))
	|		  	    И ДанныеДокумента.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
	|	  			И (ДанныеДокумента.Количество <> 0
	|				ИЛИ НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|				ИЛИ НЕ &Константа_ПартионныйУчетВерсии22
	|				ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ))
	|					ТОГДА ДанныеДокумента.НДСУпр
	|					ИНАЧЕ 0
	|			  КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК СтоимостьУпр,
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка))
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.НДСУпр КОНЕЦ)			КАК НДСУпр,
	|	ДанныеДокумента.СтоимостьЗабалансовая			КАК СтоимостьЗабалансовая,
	|	ДанныеДокумента.СтоимостьЗабалансоваяРегл		КАК СтоимостьЗабалансоваяРегл,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|	 И ДанныеДокумента.ВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.ДопРасходы
	|	КОНЕЦ 											КАК ДопРасходы,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|	 И ДанныеДокумента.ВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.ДопРасходыБезНДС
	|	КОНЕЦ 											КАК ДопРасходыБезНДС,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|	 И ДанныеДокумента.ВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.ДопРасходыРегл
	|			+ ВЫБОР КОГДА НЕ &ФормироватьНДСПредъявленныйПриВключенииВСтоимость
	|		  	    И ДанныеДокумента.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
	|	  			И ДанныеДокумента.Количество = 0
	|				И НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|				И &Константа_ПартионныйУчетВерсии22
	|				И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|					ТОГДА ДанныеДокумента.НДСРегл
	|					ИНАЧЕ 0
	|			  КОНЕЦ
	|	КОНЕЦ 											КАК ДопРасходыРегл,
	|	ВЫБОР КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|	  И &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	  И (НЕ ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		ИЛИ ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке))
	|		ТОГДА ДанныеДокумента.ДопРасходыУпр
	|			+ ВЫБОР КОГДА НЕ &ФормироватьНДСПредъявленныйПриВключенииВСтоимость
	|		  	    И ДанныеДокумента.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
	|	  			И ДанныеДокумента.Количество = 0
	|				И НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|				И &Константа_ПартионныйУчетВерсии22
	|				И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|					ТОГДА ДанныеДокумента.НДСУпр
	|					ИНАЧЕ 0
	|			  КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК ДопРасходыУпр,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|	 И ДанныеДокумента.ВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.ПостояннаяРазница
	|	КОНЕЦ 											КАК ПостояннаяРазница,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|	 И ДанныеДокумента.ВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.ВременнаяРазница
	|	КОНЕЦ 											КАК ВременнаяРазница,
	// Стоимость НДД формируется по правилам стоимости НУ См. РасчетСебестоимостиНДД.ПодставитьСтоимостьНДДВЗапрос
	|	&СтоимостьНДД 									КАК СтоимостьНДД,
	|	ДанныеДокумента.РезервПодОбесценениеРегл		КАК РезервПодОбесценениеРегл,
	|	ВЫБОР КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|	  И &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.РезервПодОбесценениеУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК РезервПодОбесценениеУпр,
	|	ДанныеДокумента.КорСтоимость					КАК КорСтоимость,
	|
	// Поля партионного учета версии 2.2
	// Поля "Партия" и "Аналитика учета партий" заполняются всегда в разделах "Неотфактурованные поставки" и "Собственные товары в пути (от поставщиков)".
	// Для товаров раздел учета определяется по типу запасов, для работ и услуг - по разделу учета, определяемому в документе. 
	|	ВЫБОР
	|		КОГДА &Константа_ПартионныйУчетВерсии22
	|	  	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	  	  И ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|	 	  ИЛИ ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути)
	|	 	  ИЛИ ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		  ИЛИ ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета
	|			И ДанныеДокумента.РазделУчета В (
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки),
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути))
	|			ТОГДА ДанныеДокумента.Партия
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			ТОГДА ДанныеДокумента.Партия
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК Партия,
	|	ВЫБОР
	|		КОГДА &Константа_ПартионныйУчетВерсии22
	|		  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		  И ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|	 	  ИЛИ ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути)
	|	 	  ИЛИ ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		  ИЛИ ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета
	|			И ДанныеДокумента.РазделУчета В (
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки),
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути))
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	// Причина НЕ перед ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка:
	// При учете по средней стоимости, КорАналитикаУчетаПартий заполняется, она используется для целей учета НДС
	|	  И НЕ ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|			ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	|	  КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭС),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыСПартией),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыБезПартии),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуМеждуОрганизациями))
	|			ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|	  КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК КорАналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		КОГДА &Константа_ПартионныйУчетВерсии22 И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковСобственныхТоваров) 
	|		ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|	ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|	  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ ДанныеДокумента.ВидДеятельностиНДС
	|	КОНЕЦ 																				КАК ВидДеятельностиНДС,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК ВидДеятельностиНДСДокумента,
	|	ВЫБОР
	|	  КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровПоставщику),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыСПартией),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыБезПартии),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки))
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		  И НЕ (ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	|		  	И ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) = НЕОПРЕДЕЛЕНО
	|		  	И ДанныеДокумента.Количество > 0)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	|	  КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка))
	|			ТОГДА ВЫБОР КОГДА &Константа_ИспользоватьУчетНДС
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяНДС)
	|				ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|			КОНЕЦ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК КорВидДеятельностиНДС,
	|
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ТипЗаписи
	|			ТОГДА ДанныеДокумента.ТипЗаписи
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ЗаявлениеОВвозеТоваров)
	|			ТОГДА ВЫБОР
	|				КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
	|				КОГДА НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости)
	|				КОНЕЦ
	// Заполнение типа записей для неотфактурованной поставки
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	// При коррективки стоимости тип записи должен быть "Доп расходы (указана партия)", т.к. при такой корректировке заполнение
	// партионных измерений в себестоимости товаров нужно выполнить по движениям документа - источника (документа 
	// приобретения товаров и услуг на фактуровку поставки).
	|		КОГДА (ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		 ИЛИ ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки))) // для работ и услуг
	|		 И ДанныеДокумента.Количество = 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
	// При фактуровке поставки тип записи должен быть "Потребление", т.к. для фактуровки подбирается партия, образованная
	// документами "Поступление товаров на склад" и "Поступление услуг в подразделение". 
	|		КОГДА (ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке) 
	|		 ИЛИ ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки))) // для работ и услуг
	|		 И ДанныеДокумента.Количество > 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	// При уменьшении количества фактуровки поставки тип записи должен быть "Стороно потребления", т.к. для такой корректировки подбираются
	// партии, списанные документом - основанием "Приобретение товаров и услуг".
	|		КОГДА (ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке) 
	|		 ИЛИ ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки))) // для работ и услуг
	|		 И ДанныеДокумента.Количество < 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СторноПотребления)
	|
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	//++ Устарело_Переработка24
	|		  ТИП(Документ.ОтчетПереработчика),
	//-- Устарело_Переработка24
	|		  ТИП(Документ.ОтчетПереработчика2_5))
	|			ТОГДА
	|				ВЫБОР 
	|				КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость))
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	|				КОГДА ДанныеДокумента.Период = ДанныеДокумента.ПериодДокументаИсточника
	|				  И ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	|				КОГДА ДанныеДокумента.Период = ДанныеДокумента.ПериодДокументаИсточника
	|				  И ДанныеДокумента.ДокументИсточник = НЕОПРЕДЕЛЕНО
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|				КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
	|				  ИЛИ ДанныеДокумента.Количество < 0
	|					ТОГДА ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  				  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПустаяСсылка)
	|					КОНЕЦ
	|				КОНЕЦ
	//-- НЕ УТ
	|
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыБезПартии)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыСПартией)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровПоставщику))
	|		  И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|				ТИП(Документ.ПриобретениеТоваровУслуг))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретения)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
	|		  И ДанныеДокумента.Количество = 0
	|		  И ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
	|		  И ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		  И &Константа_ПартионныйУчетВерсии22
	|	  	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПриобретенияПрошлогоПериода)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеПоВозврату),
	//++ Устарело_Переработка24
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтДавальца),
	//-- Устарело_Переработка24
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтДавальца2_5))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|		КОГДА &Константа_ПартионныйУчетВерсии22
	|	  	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		  ИЛИ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|			ТИП(Документ.ВводОстатков),
	|			ТИП(Документ.КорректировкаПриобретения))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПустаяСсылка)
	|	КОНЕЦ																				КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВнешнееПоступление) 				КАК ОперацияУчетаСебестоимости,
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	|			ТОГДА ВЫБОР КОГДА ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|		  	  И ДанныеДокумента.Период <> ДанныеДокумента.ПериодДокументаИсточника
	|				ТОГДА ДанныеДокумента.ДокументИсточник
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|		ИНАЧЕ ДанныеДокумента.ДокументИсточник
	|	КОНЕЦ																				КАК ДокументИсточник,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеПоВозврату))
	|			ТОГДА ДанныеДокумента.Ссылка
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ДанныеДокумента.ДокументИсточник
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК ДокументДвижения,
	|	ДанныеДокумента.ИдентификаторСтроки 						  						КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  						КАК ИдентификаторФинЗаписи,
	|	ДанныеДокумента.НастройкаХозяйственнойОперации 				  						КАК НастройкаХозяйственнойОперации,
	// Необязательные поля
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовСписания) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.СтатьяРасходовСписания
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК СтатьяРасходовСписания,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовСписания) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.АналитикаРасходов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаРасходов,
	|	ДанныеДокумента.КорНаправлениеДеятельности			    								КАК КорНаправлениеДеятельности,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров								КАК МетодОценкиСтоимостиТоваров,
	|	ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента) 				КАК СпособОпределенияСебестоимости
	|ПОМЕСТИТЬ ВТОперация_ВнешнееПоступление
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВнешнееПоступление)
	|
	// Включение НДС в стоимость
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка))
	|		  И ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета
	|		  И ДанныеДокумента.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|			ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровПоставщику))
	|		  И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ПриобретениеТоваровУслуг))
	|			ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|			ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|	КОНЕЦ									КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|	ДанныеДокумента.ПериодДокументаИсточника КАК ПериодДокументаИсточника,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 															КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|		  ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			  И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ									КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета И ДанныеДокумента.РазделУчета <> НЕОПРЕДЕЛЕНО
	|		 И ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.РазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_РазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_РазделУчета
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковТоваровПринятыхНаОтветственноеХранение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковТоваровПереданныхНаКомиссию)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		 И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковТоваровПолученныхНаКомиссию) 
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковМатериаловПереданныхВПроизводство)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковМатериаловПереданныхПереработчикам)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	//-- Устарело_Переработка24
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемНаХранениеСПравомПродажи),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемкаПодПринципала))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	//++ НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаОтчетаПереработчика)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	//-- НЕ УТ
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.АналитикаУчетаНоменклатурыИсходнаяНазначениеТипНазначения, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.ПоставкаПодПринципала)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемНаКомиссию))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	//++ НЕ УТКА

	//++ Устарело_Переработка24
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтДавальца)
	|			И ДанныеДокумента.СпрНоменклатураТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.МногооборотнаяТара)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	//-- Устарело_Переработка24

	//-- НЕ УТКА
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|		 И (ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5)
	|			ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5_ЕАЭС))
	|		 И ДанныеДокумента.СпрНоменклатураТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|			ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																					КАК РазделУчета,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|		ТОГДА ДанныеДокумента.КорРазделУчета
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|	КОНЕЦ 																					КАК КорРазделУчета,
	|
	// Корреспондирующие поля
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|		  ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			  И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.КорВидЗапасов
	|	КОНЕЦ 																					КАК КорВидЗапасов,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация 													КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.Подразделение 															КАК Подразделение,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПоПартнерам
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПоПартнерам
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаУчетаПоПартнерам,
	|
	// Количественные и суммовые показатели
	|	0												КАК Количество,
	|	0												КАК Стоимость,
	|	0 												КАК СтоимостьБезНДС,
	|	ВЫБОР КОГДА ДанныеДокумента.Количество <> 0
	|	 ИЛИ НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.НДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК СтоимостьРегл,
	|	0												КАК НДСРегл,
	|	ВЫБОР КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|	  И &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	  И (ДанныеДокумента.Количество <> 0
	|	 		ИЛИ НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) = НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ))
	|		ТОГДА ДанныеДокумента.НДСУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК СтоимостьУпр,
	|	0												КАК НДСУпр,
	|	0												КАК СтоимостьЗабалансовая,
	|	0												КАК СтоимостьЗабалансоваяРегл,
	|	0 												КАК ДопРасходы,
	|	0 												КАК ДопРасходыБезНДС,
	|	ВЫБОР КОГДА ДанныеДокумента.Количество = 0
	|	 И НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.НДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК ДопРасходыРегл,
	|	ВЫБОР КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|	  И &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	  И ДанныеДокумента.Количество = 0
	|	  И НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.НДСУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК ДопРасходыУпр,
	|	0												КАК ПостояннаяРазница,
	|	0												КАК ВременнаяРазница,
	|	0 												КАК СтоимостьНДД,
	|	0												КАК РезервПодОбесценениеРегл,
	|	0 												КАК РезервПодОбесценениеУпр,
	|	0												КАК КорСтоимость,
	|
	// Поля партионного учета версии 2.2
	// Поля "Партия" и "Аналитика учета партий" заполняются всегда в разделах "Неотфактурованные поставки" и "Собственные товары в пути (от поставщиков)".
	// Для товаров раздел учета определяется по типу запасов, для работ и услуг - по разделу учета, определяемому в документе. 
	|	ВЫБОР
	|		КОГДА &Константа_ПартионныйУчетВерсии22
	|	  	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	  	  И ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|	 	  ИЛИ ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути)
	|	 	  ИЛИ ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		  ИЛИ ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета
	|			И ДанныеДокумента.РазделУчета В (
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки),
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути))
	|			ТОГДА ДанныеДокумента.Партия
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			ТОГДА ДанныеДокумента.Партия
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК Партия,
	|	ВЫБОР
	|		КОГДА &Константа_ПартионныйУчетВерсии22
	|		  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		  И ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|	 	  ИЛИ ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути)
	|	 	  ИЛИ ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		  ИЛИ ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета
	|			И ДанныеДокумента.РазделУчета В (
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки),
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути))
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	// Причина НЕ перед ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка:
	// При учете по средней стоимости, КорАналитикаУчетаПартий заполняется, она используется для целей учета НДС
	|	  И НЕ ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|			ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	|	  КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭС),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыСПартией),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыБезПартии),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуМеждуОрганизациями))
	|			ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|	  КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК КорАналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		КОГДА &Константа_ПартионныйУчетВерсии22 И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковСобственныхТоваров) 
	|		ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|	ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|	  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ ДанныеДокумента.ВидДеятельностиНДС
	|	КОНЕЦ 																				КАК ВидДеятельностиНДС,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК ВидДеятельностиНДСДокумента,
	|	ВЫБОР
	|	  КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровПоставщику),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыСПартией),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыБезПартии),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки))
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		  И НЕ (ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	|		  	И ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) = НЕОПРЕДЕЛЕНО
	|		  	И ДанныеДокумента.Количество > 0)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	|	  КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка))
	|			ТОГДА ВЫБОР КОГДА &Константа_ИспользоватьУчетНДС
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаОблагаетсяНДС)
	|				ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПродажаНеОблагаетсяНДС)
	|			КОНЕЦ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК КорВидДеятельностиНДС,
	|
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ТипЗаписи
	|			ТОГДА ДанныеДокумента.ТипЗаписи
	// Для таможенной декларции на импорт при включении НДС в стоимость применяется отдельный тип записи,
	// т.к. у документа есть еще движения с типами записи "Доп расходы с партией" или "Доп расходы без партии". 
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ТаможеннаяДекларацияИмпорт)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВключениеНДСВСтоимость)
	//++ Локализация
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ЗаявлениеОВвозеТоваров)
	|			ТОГДА ВЫБОР
	|				КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
	|				КОГДА НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости)
	|				КОНЕЦ
	//-- Локализация
	
	// При коррективки стоимости тип записи должен быть "Доп расходы (указана партия)", т.к. при такой корректировке заполнение
	// партионных измерений в себестоимости товаров нужно выполнить по движениям документа - источника (документа 
	// приобретения товаров и услуг на фактуровку поставки).
	|		КОГДА (ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		 ИЛИ ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки))) // для работ и услуг
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыБезПартии)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыБезПартии)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ДополнительныеРасходыСПартией)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ДопРасходыСПартией)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровПоставщику)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
	|		  И ДанныеДокумента.Количество = 0
	|		  И ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КорректировкаПриобретенияПрошлогоПериода)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаПриобретенияПрошлогоПериода)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|	КОНЕЦ																				КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВнешнееПоступление) 				КАК ОперацияУчетаСебестоимости,
	|	ВЫБОР
	// Для неотфактурованной поставки в движении по включению НДС в стоимость указывается тип записи ДопРасходыСПартией.
	// Для типа записи ДопРасходыСПартией поле ДокументИсточник должно быть заполнено.
	|		КОГДА (ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|		 ИЛИ ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСФактуровкаПоставки),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаФактуровкаПоставки))) // для работ и услуг
	|			ТОГДА ДанныеДокумента.Ссылка
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	|			ТОГДА ВЫБОР КОГДА ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|		  	  И ДанныеДокумента.Период <> ДанныеДокумента.ПериодДокументаИсточника
	|				ТОГДА ДанныеДокумента.ДокументИсточник
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|		ИНАЧЕ ДанныеДокумента.ДокументИсточник
	|	КОНЕЦ																				КАК ДокументИсточник,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеПоВозврату))
	|			ТОГДА ДанныеДокумента.Ссылка
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ДанныеДокумента.ДокументИсточник
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК ДокументДвижения,
	|	ДанныеДокумента.ИдентификаторСтроки 						  						КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторСтроки 						  						КАК ИдентификаторФинЗаписи,
	|	ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ВключениеНДСВСтоимость)			КАК НастройкаХозяйственнойОперации,
	// Необязательные поля
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовСписания) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.СтатьяРасходовСписания
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК СтатьяРасходовСписания,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовСписания) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.АналитикаРасходов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаРасходов,
	|	ДанныеДокумента.КорНаправлениеДеятельности			    								КАК КорНаправлениеДеятельности,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров								КАК МетодОценкиСтоимостиТоваров,
	|	ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента) 				КАК СпособОпределенияСебестоимости
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВнешнееПоступление)
	|	И НЕ ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|	И &ФормироватьНДСПредъявленныйПриВключенииВСтоимость
	|	И ДанныеДокумента.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
	|	И (ДанныеДокумента.НДСРегл <> 0 ИЛИ ДанныеДокумента.НДСУпр <> 0)
	// При неотфактурованной поставке НДС отдельным движением не выделяется. 
	|	И НЕ ДанныеДокумента.ХозяйственнаяОперация В (
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСНеотфактурованнаяПоставка),
	|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаНеотфактурованнаяПоставка))
	// При неотфактурованной поставке работ и услуг НДС отдельным движениям не выделяется.
	|	И НЕ (ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета
	|		И ДанныеДокумента.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|		И ДанныеДокумента.ВидЗапасов = ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка))
	|";
	
	РасчетСебестоимостиЛокализация.ПодставитьСтоимостьНДДВЗапрос(ТекстЗапросаОтражения, "ВТОперация_ВнешнееПоступление");
	
	ТекстЗапросаОтражения = СтрЗаменить(ТекстЗапросаОтражения, "&СтоимостьНДД", "0");
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТОперация_ВнешнееПоступление", ТекстЗапросаОтражения);
	
КонецПроцедуры

Процедура ОтразитьОперациюСебестоимостиВнутреннееПоступление(ПараметрыОтражения)
	
	// Сформируем шаблон текста запроса для отражения операции.
	ТекстЗапросаОтражения =
	"ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)	КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 															КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ																					КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета И ДанныеДокумента.РазделУчета <> НЕОПРЕДЕЛЕНО
	|		 И ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.РазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_РазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_РазделУчета
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковТоваровПринятыхНаОтветственноеХранение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковТоваровПереданныхНаКомиссию)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		 И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковТоваровПолученныхНаКомиссию) 
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковМатериаловПереданныхВПроизводство)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВводОстатковТоваров), ТИП(Документ.ВводОстатков))
	|		  И ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|				(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковМатериаловПереданныхПереработчикам),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковМатериаловПереданныхПереработчикам2_5))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровУХранителя))
	|			ТОГДА
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеИзлишковТоваровВПользуКомитента))
	|			ТОГДА
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУХранителя),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУПереработчика))
	|			ТОГДА
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|					КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУХранителя))
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|		 И (ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5)
	|			ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5_ЕАЭС))
	|		 И ДанныеДокумента.СпрНоменклатураТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		 ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|		 ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|		 ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																					КАК РазделУчета,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|			ТОГДА ДанныеДокумента.КорРазделУчета
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|	КОНЕЦ 																					КАК КорРазделУчета,
	|
	// Корреспондирующие поля
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.КорВидЗапасов
	|	КОНЕЦ																					КАК КорВидЗапасов,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорПартия
	|		ТОГДА ДанныеДокумента.КорПартия
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК КорПартия,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация 													КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.Подразделение 															КАК Подразделение,
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ВЫБОР КОГДА ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|		  		ИЛИ ДанныеДокумента.Период = ДанныеДокумента.ПериодДокументаИсточника
	|					ТОГДА НЕОПРЕДЕЛЕНО
	|					ИНАЧЕ ДанныеДокумента.ГруппаПродукции
	|				КОНЕЦ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ПоступлениеОтПереработчика))
	|			ТОГДА ДанныеДокумента.ГруппаПродукции
	//-- Устарело_Переработка24
	
	//++ Локализация
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВыпускПродукции))
	|			ТОГДА ДанныеДокумента.ГруппаПродукции
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	//-- Локализация

	//-- НЕ УТ
	|	КОНЕЦ                                            										КАК ГруппаПродукции,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПоПартнерам
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПоПартнерам
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаУчетаПоПартнерам,
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА 0
	//++ НЕ УТ

	//++ Локализация
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВыпускПродукции))
	|			ТОГДА ДанныеДокумента.КодСтроки
	//-- Локализация

	//-- НЕ УТ
	|			ИНАЧЕ 0
	|	КОНЕЦ																					КАК КодСтроки,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество 						КАК Количество,
	|	(ВЫБОР
	// Плановая стоимость выпущенной продукции отражается отдельным движениям.
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	//++ НЕ УТ

	//++ Локализация
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВыпускПродукции)
	//-- Локализация
	
	//++ Устарело_Переработка24
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.Стоимость КОНЕЦ)		КАК Стоимость,
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	//++ НЕ УТ

	//++ Локализация
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВыпускПродукции)
	//-- Локализация
	
	//++ Устарело_Переработка24
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.СтоимостьБезНДС КОНЕЦ) КАК СтоимостьБезНДС,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	//++ НЕ УТ

	//++ Локализация
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВыпускПродукции)
	//-- Локализация
	
	//++ Устарело_Переработка24
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.СтоимостьРегл
	|		  + ВЫБОР КОГДА НЕ ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		      И ДанныеДокумента.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
	|				ТОГДА ДанныеДокумента.НДСРегл
	|				ИНАЧЕ 0
	|			КОНЕЦ
	|	КОНЕЦ											КАК СтоимостьРегл,
	|	ДанныеДокумента.НДСРегл							КАК НДСРегл,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	//++ НЕ УТ
	
	//++ Локализация
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВыпускПродукции)
	//-- Локализация
	
	//++ Устарело_Переработка24
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ТОГДА 0 
	|		КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|		 И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|		 И &Константа_ПартионныйУчетВерсии22
	|		 И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА ДанныеДокумента.СтоимостьУпр
	|		  	  + ВЫБОР КОГДА НЕ ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		      	  И ДанныеДокумента.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
	|					ТОГДА ДанныеДокумента.НДСУпр
	|					ИНАЧЕ 0
	|				КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ											КАК СтоимостьУпр,
	|	ДанныеДокумента.НДСУпр							КАК НДСУпр,
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	//++ НЕ УТ

	//++ Локализация
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВыпускПродукции)
	//-- Локализация
	
	//++ Устарело_Переработка24
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.СтоимостьЗабалансовая КОНЕЦ) КАК СтоимостьЗабалансовая,
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	//++ НЕ УТ
	
	//++ Локализация
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВыпускПродукции)
	//-- Локализация
	
	//++ Устарело_Переработка24
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.СтоимостьЗабалансоваяРегл КОНЕЦ) КАК СтоимостьЗабалансоваяРегл,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.ДопРасходы
	|	КОНЕЦ 											КАК ДопРасходы,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.ДопРасходыБезНДС
	|	КОНЕЦ 											КАК ДопРасходыБезНДС,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.ДопРасходыРегл
	|	КОНЕЦ 											КАК ДопРасходыРегл,
	|	ВЫБОР КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|	  И &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	  И НЕ ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		ТОГДА ДанныеДокумента.ДопРасходыУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК ДопРасходыУпр,
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	//++ НЕ УТ
	
	//++ Локализация
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВыпускПродукции)
	//-- Локализация
	
	//++ Устарело_Переработка24
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ТОГДА 0
	|		КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.ПостояннаяРазница КОНЕЦ) КАК ПостояннаяРазница,
	
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	//++ НЕ УТ

	//++ Локализация
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВыпускПродукции)
	//-- Локализация
	
	//++ Устарело_Переработка24
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ТОГДА 0
	|		КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|			ТОГДА 0
	|		ИНАЧЕ ДанныеДокумента.ВременнаяРазница КОНЕЦ) КАК ВременнаяРазница,
	// Стоимость НДД формируется по правилам стоимости НУ См. РасчетСебестоимостиНДД.ПодставитьСтоимостьНДДВЗапрос
	|	&СтоимостьНДД 									КАК СтоимостьНДД,
	|	ДанныеДокумента.РезервПодОбесценениеРегл		КАК РезервПодОбесценениеРегл,
	|	ВЫБОР КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|	  И &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.РезервПодОбесценениеУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК РезервПодОбесценениеУпр,
	|	ДанныеДокумента.КорСтоимость					КАК КорСтоимость,
	|
	// Поля партионного учета версии 2.2
	|	ВЫБОР
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			ТОГДА ДанныеДокумента.Партия
	//-- НЕ УТ
	|		КОГДА &Константа_ПартионныйУчетВерсии22
	|				И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|				И ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|			ТОГДА ДанныеДокумента.Партия
	|
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК Партия,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	  И ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|	  	КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК КорАналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	 И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ) ТОГДА
	|		(ВЫБОР
	//++ НЕ УТ
	|			КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|				И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|				И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|			ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|			КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|					ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|					ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|				И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|			ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|			КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|					ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|					ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|				И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|			ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ)
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																				КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|			 		И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			 		И &Константа_АналитическийУчетПоГруппамПродукции
	|				ТОГДА ДанныеДокумента.КорГруппаПродукции
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.КорПартия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.КорПартия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.КорПартия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.КорПартия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) = НЕОПРЕДЕЛЕНО ТОГДА
	|					НЕОПРЕДЕЛЕНО
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.КорГруппаПродукции) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|					И ДанныеДокумента.КорГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ДанныеДокумента.КорГруппаПродукции
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.КорГруппаПродукции) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.КорГруппаПродукции
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК КорАналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	  И ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК ВидДеятельностиНДС,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК ВидДеятельностиНДСДокумента,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорВидДеятельностиНДС
	|			ТОГДА ДанныеДокумента.КорВидДеятельностиНДС
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|		  ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции))
	//++ НЕ УТ

	//++ Локализация
	|		  И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВыпускПродукции)
	//-- Локализация
	
	//++ Устарело_Переработка24
	|		  И НЕ (ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	|		  	И ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) = НЕОПРЕДЕЛЕНО
	|		  	И ДанныеДокумента.Количество > 0)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК КорВидДеятельностиНДС,
	|
	|	ВЫБОР
	// Тип записи определяется в процедуре ОписаниеОперацийУчетаСебестоимости у следующих документов:
	//	- ОтчетПереработчика
	//	- ОтчетПереработчика2_5 
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ТипЗаписи
	|			ТОГДА ДанныеДокумента.ТипЗаписи
	//++ НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|		  И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	//++ Устарело_Переработка24
	|		  ТИП(Документ.ОтчетПереработчика),
	//-- Устарело_Переработка24
	|		  ТИП(Документ.ОтчетПереработчика2_5))
	|			ТОГДА
	|				ВЫБОР 
	|				КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНаРасходыФиксированнаяСтоимость)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	|				КОГДА ДанныеДокумента.Период = ДанныеДокумента.ПериодДокументаИсточника
	|				  И ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	|				КОГДА ДанныеДокумента.Период = ДанныеДокумента.ПериодДокументаИсточника
	|				  И ДанныеДокумента.ДокументИсточник = НЕОПРЕДЕЛЕНО
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|				КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
	|				  ИЛИ ДанныеДокумента.Количество < 0
	|					ТОГДА ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  				  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПустаяСсылка)
	|					КОНЕЦ
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|				КОНЕЦ
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
	|		  И ДанныеДокумента.Количество = 0
	|		  И ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.КорректировкаСтоимости)		
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)
	|	КОНЕЦ																				КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВнутреннееПоступление) 			КАК ОперацияУчетаСебестоимости,
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	|			ТОГДА ВЫБОР КОГДА ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|		  	  И ДанныеДокумента.Период <> ДанныеДокумента.ПериодДокументаИсточника
	|				ТОГДА ДанныеДокумента.ДокументИсточник
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|		ИНАЧЕ ДанныеДокумента.ДокументИсточник
	|	КОНЕЦ																				КАК ДокументИсточник,
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.ПроизводствоБезЗаказа),
	//++ НЕ УТКА
	|		  ТИП(Документ.НачальныеОстаткиНЗППоПартиямПроизводства),
	//-- НЕ УТКА
	|		  ТИП(Документ.РаспределениеВозвратныхОтходов))
	|			ТОГДА ДанныеДокумента.Ссылка
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ПоступлениеОтПереработчика)
	|		  И ДанныеДокумента.Количество > 0
	|			ТОГДА ДанныеДокумента.Ссылка
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ДанныеДокумента.ДокументИсточник
	//-- Устарело_Переработка24
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ДокументДвижения 
	|			ТОГДА ДанныеДокумента.ДокументДвижения
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																				КАК ДокументДвижения,
	|	ДанныеДокумента.ИдентификаторСтроки 												КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи												КАК ИдентификаторФинЗаписи,
	|	ДанныеДокумента.НастройкаХозяйственнойОперации 										КАК НастройкаХозяйственнойОперации,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров							КАК МетодОценкиСтоимостиТоваров,
	// Поле "Способ определения себестоимости" заполняется в документах:
	//	- СборкаТоваров - значение "ПоКорДвижению", т.к. стоимость комплекта нужно рассчитать по себестоимости комплектующих.
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СпособОпределенияСебестоимости
	|			ТОГДА ДанныеДокумента.СпособОпределенияСебестоимости
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента) КОНЕЦ) КАК СпособОпределенияСебестоимости
	|
	|ПОМЕСТИТЬ ВТОперация_ВнутреннееПоступление
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|	ЛЕВОЕ СОЕДИНЕНИЕ НастройкиПризнанияРасходовНДД КАК НастройкиПризнанияРасходовНДДПоПодразделению
	|		ПО ДанныеДокумента.Организация = НастройкиПризнанияРасходовНДДПоПодразделению.Организация
	|		И ДанныеДокумента.Подразделение = НастройкиПризнанияРасходовНДДПоПодразделению.ОбъектРаздельногоУчетаНДД
	|		И НастройкиПризнанияРасходовНДДПоПодразделению.РасходыВключаютсяВСтоимость
	|	ЛЕВОЕ СОЕДИНЕНИЕ НастройкиПризнанияРасходовНДД КАК НастройкиПризнанияРасходовНДДПоНаправлениюДеятельности
	|		ПО ДанныеДокумента.Организация = НастройкиПризнанияРасходовНДДПоНаправлениюДеятельности.Организация
	|		И ДанныеДокумента.АналитикаУчетаНоменклатурыНазначениеНаправлениеДеятельности = НастройкиПризнанияРасходовНДДПоНаправлениюДеятельности.ОбъектРаздельногоУчетаНДД
	|		И НастройкиПризнанияРасходовНДДПоНаправлениюДеятельности.РасходыВключаютсяВСтоимость
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВнутреннееПоступление)
	|
	// Плановую стоимость выпуска выделяем отдельным движением, т.к. для этой записи нет корреспондирующего движения и
	// плановая стоимость сторнируется после расчета. 
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)	КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 															КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ 																					КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета И ДанныеДокумента.РазделУчета <> НЕОПРЕДЕЛЕНО
	|		 И ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.РазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_РазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_РазделУчета
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		 ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|		 ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|		 ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																					КАК РазделУчета,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)					КАК КорРазделУчета,
	|
	// Корреспондирующие поля
	|	НЕОПРЕДЕЛЕНО 																			КАК КорАналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО 																			КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	НЕОПРЕДЕЛЕНО 																			КАК КорВидЗапасов,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорПартия
	|		ТОГДА ДанныеДокумента.КорПартия
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК КорПартия,
	|
	// Прочие поля
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтражениеПлановойСтоимостиВыпуска)			КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.Подразделение 															КАК Подразделение,
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ВЫБОР КОГДА ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|		  		ИЛИ ДанныеДокумента.Период = ДанныеДокумента.ПериодДокументаИсточника
	|					ТОГДА НЕОПРЕДЕЛЕНО
	|					ИНАЧЕ ДанныеДокумента.ГруппаПродукции
	|				КОНЕЦ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ПоступлениеОтПереработчика))
	|			ТОГДА ДанныеДокумента.ГруппаПродукции
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ                                            										КАК ГруппаПродукции,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПоПартнерам
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПоПартнерам
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаУчетаПоПартнерам,
	|	0																						КАК КодСтроки,
	|
	// Количественные и суммовые показатели
	|	0												КАК Количество,
	|	ДанныеДокумента.Стоимость						КАК Стоимость,
	|	ДанныеДокумента.СтоимостьБезНДС					КАК СтоимостьБезНДС,
	|	ДанныеДокумента.СтоимостьРегл
	|		+ ВЫБОР КОГДА НЕ ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		  И ДанныеДокумента.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
	|			ТОГДА ДанныеДокумента.НДСРегл
	|			ИНАЧЕ 0
	|		КОНЕЦ										КАК СтоимостьРегл,
	|	0												КАК НДСРегл,
	|	ВЫБОР КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|	  И &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.СтоимостьУпр
	|	  	  + ВЫБОР КОГДА НЕ ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|	      	  И ДанныеДокумента.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
	|				ТОГДА ДанныеДокумента.НДСУпр
	|				ИНАЧЕ 0
	|			КОНЕЦ
	|		ИНАЧЕ 0
	|	КОНЕЦ											КАК СтоимостьУпр,
	|	0												КАК НДСУпр,
	|	ДанныеДокумента.СтоимостьЗабалансовая			КАК СтоимостьЗабалансовая,
	|	ДанныеДокумента.СтоимостьЗабалансоваяРегл		КАК СтоимостьЗабалансоваяРегл,
	|	0												КАК ДопРасходы,
	|	0												КАК ДопРасходыБезНДС,
	|	0												КАК ДопРасходыРегл,
	|	0	 											КАК ДопРасходыУпр,
	|	ДанныеДокумента.ПостояннаяРазница				КАК ПостояннаяРазница,
	|	ДанныеДокумента.ВременнаяРазница				КАК ВременнаяРазница,
	|	0												КАК РезервПодОбесценениеРегл,
	|	0	 											КАК РезервПодОбесценениеУпр,
	|	0 												КАК СтоимостьНДД,
	|	ДанныеДокумента.КорСтоимость					КАК КорСтоимость,
	|
	// Поля партионного учета версии 2.2
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	 И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	 И ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|		ТОГДА ДанныеДокумента.Партия
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК Партия,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	  И ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|	  	КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК КорАналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ) 
	|		ТОГДА
	|			(ВЫБОР
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ)
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА
	|			(ВЫБОР
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ)
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаФинансовогоУчетаДокумента,
	|	НЕОПРЕДЕЛЕНО																		КАК КорАналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК ВидДеятельностиНДС,
	|	НЕОПРЕДЕЛЕНО																		КАК ВидДеятельностиНДСДокумента,
	|	НЕОПРЕДЕЛЕНО																		КАК КорВидДеятельностиНДС,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Партия)										КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВнутреннееПоступление) 			КАК ОперацияУчетаСебестоимости,
	|	НЕОПРЕДЕЛЕНО																		КАК ДокументИсточник,
	|	ДанныеДокумента.Ссылка																КАК ДокументДвижения,
	|	ДанныеДокумента.ИдентификаторСтроки 						  						КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  						КАК ИдентификаторФинЗаписи,
	|	ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ОтражениеПлановойСтоимостиВыпуска) КАК НастройкаХозяйственнойОперации,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров							КАК МетодОценкиСтоимостиТоваров,
	|	ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента) 			КАК СпособОпределенияСебестоимости
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|	ЛЕВОЕ СОЕДИНЕНИЕ НастройкиПризнанияРасходовНДД КАК НастройкиПризнанияРасходовНДДПоПодразделению
	|		ПО ДанныеДокумента.Организация = НастройкиПризнанияРасходовНДДПоПодразделению.Организация
	|		И ДанныеДокумента.Подразделение = НастройкиПризнанияРасходовНДДПоПодразделению.ОбъектРаздельногоУчетаНДД
	|		И НастройкиПризнанияРасходовНДДПоПодразделению.РасходыВключаютсяВСтоимость
	|	ЛЕВОЕ СОЕДИНЕНИЕ НастройкиПризнанияРасходовНДД КАК НастройкиПризнанияРасходовНДДПоНаправлениюДеятельности
	|		ПО ДанныеДокумента.Организация = НастройкиПризнанияРасходовНДДПоНаправлениюДеятельности.Организация
	|		И ДанныеДокумента.АналитикаУчетаНоменклатурыНазначениеНаправлениеДеятельности = НастройкиПризнанияРасходовНДДПоНаправлениюДеятельности.ОбъектРаздельногоУчетаНДД
	|		И НастройкиПризнанияРасходовНДДПоНаправлениюДеятельности.РасходыВключаютсяВСтоимость
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВнутреннееПоступление)
	|	И ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции)
	|	И (ДанныеДокумента.Стоимость <> 0 ИЛИ ДанныеДокумента.СтоимостьРегл <> 0)
	// В разделе учета "Выпуск продукции" движений Приход по плановой стоимости не должно быть. 
	// Плановая стоимость отражается движением Расход из раздела учета "Выпуск продукции".
	|	И (ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета И ДанныеДокумента.РазделУчета <> НЕОПРЕДЕЛЕНО
	|		 И ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ВыпускПродукции)
	|		ИНАЧЕ ИСТИНА КОНЕЦ)
	// 
	|
	//++ НЕ УТ

	//++ Локализация
	|	И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВыпускПродукции)
	//-- Локализация
	
	//++ Устарело_Переработка24
	|	И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетПереработчика)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|";
	
	РасчетСебестоимостиЛокализация.ПодставитьСтоимостьНДДВЗапрос(ТекстЗапросаОтражения, "ВТОперация_ВнутреннееПоступление", Истина);
	
	ТекстЗапросаОтражения = СтрЗаменить(ТекстЗапросаОтражения, "&СтоимостьНДД", "0");
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТОперация_ВнутреннееПоступление", ТекстЗапросаОтражения);
	
КонецПроцедуры

Процедура ОтразитьОперациюСебестоимостиВыбытиеПоФиксированнойСтоимости(ПараметрыОтражения)
	
	// Сформируем шаблон текста запроса для отражения операции.
	ТекстЗапросаОтражения =
	"ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТарыОтКлиентаПрошлыхПериодов),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноПереданнойТарыВозвратНаДругойСклад))
	|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	КОНЕЦ КАК ВидДвижения,
	|	ДанныеДокумента.Период КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 															КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	// При списании комиссионного товара на расходы в движениях не заполняется вид запасов, т.к. в отчете комитенту о списании 
	// нельзя определить вид запасов, по которому было выполнено списание. У таких движений в типе места хранения указан партнер.
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		 И ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|		  ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			  И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|			ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ 																				КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета И ДанныеДокумента.РазделУчета <> НЕОПРЕДЕЛЕНО
	|		 И ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.РазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_РазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_РазделУчета
	// Заполнение раздела учета для работ и услуг
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПустаяСсылка),
	|														ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Работа))
	|			И ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасхожденийПоступлениеПриобретение)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		  ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУХранителя),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУПереработчика),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровУХранителя),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровУПереработчика),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровУПереработчика))
	|			ТОГДА
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|					КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|					 (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУХранителя),
	|					  ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровУХранителя))
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНедостачЗаСчетКомитента))
	|			ТОГДА 
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияПереданнойВозвратнойТары),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноПереданнойТары),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноПереданнойТарыВозвратНаДругойСклад))
	|		 И ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионера),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровЧерезКомиссионера))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ПоступлениеОтПереработчика)
	|		  И ДанныеДокумента.Количество < 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|			ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																					КАК РазделУчета,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|			ТОГДА ДанныеДокумента.КорРазделУчета
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|	КОНЕЦ 																					КАК КорРазделУчета,
	|
	// Корреспондирующие поля
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|		  ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			  И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.КорВидЗапасов
	|	КОНЕЦ 															КАК КорВидЗапасов,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация 													КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.Подразделение 															КАК Подразделение,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.СтатьяРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК СтатьяРасходовСписания,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.АналитикаРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаРасходов,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ДанныеДокумента.СтатьяРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК СтатьяАктивовПассивов,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ДанныеДокумента.АналитикаРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаАктивовПассивов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_НастройкаСчетовУчета
	|		 И ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ДанныеДокумента.НастройкаСчетовУчета
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК НастройкаСчетовУчета,
	|	ДанныеДокумента.СтатьяДоходов 															КАК СтатьяДоходов,
	|	ДанныеДокумента.АналитикаДоходов 														КАК АналитикаДоходов,
	|	ДанныеДокумента.ПериодДокументаИсточника												КАК ПериодПродажи,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПоПартнерам
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПоПартнерам
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаУчетаПоПартнерам,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество 						КАК Количество,
	|	ДанныеДокумента.Стоимость 						КАК Стоимость,
	|	ДанныеДокумента.СтоимостьБезНДС 				КАК СтоимостьБезНДС,
	|	ДанныеДокумента.СтоимостьРегл 					КАК СтоимостьРегл,
	|	ВЫБОР КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|	  И &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.СтоимостьУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК СтоимостьУпр,
	|	ДанныеДокумента.КорСтоимость 					КАК КорСтоимость,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьЗабалансовая
	|		ТОГДА ДанныеДокумента.СтоимостьЗабалансовая
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК СтоимостьЗабалансовая,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьЗабалансоваяРегл
	|		ТОГДА ДанныеДокумента.СтоимостьЗабалансоваяРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ 											КАК СтоимостьЗабалансоваяРегл,
	|
	// Поля партионного учета версии 2.2
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаФинансовогоУчетаДокумента,
	|	ДанныеДокумента.ВидДеятельностиНДС													КАК КорВидДеятельностиНДС,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК ВидДеятельностиНДСДокумента,
	|
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ТипЗаписи
	|			ТОГДА ДанныеДокумента.ТипЗаписи
	// Для товаров в пути от поставщиков при отрицательном количестве тип записи должен быть СписаниеОстаткаБезПартии.
	// См. описание в функции ОписаниеОперацийУчетаСебестоимости документа СписаниеРасхожденийПоступлениеПриобретение
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварВПути)
	|		 И ДанныеДокумента.Количество < 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеОстаткаБезПартии)
	// При неотфактурованной поставке и положительном количестве тип записи должен быть СписаниеОстаткаБезПартии.
	// См. описание в функции ОписаниеОперацийУчетаСебестоимости документа СписаниеРасхожденийПоступлениеПриобретение
	|		КОГДА (ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|			ИЛИ ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПустаяСсылка)
	|			И ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасхожденийПоступлениеПриобретение))
	|		И ДанныеДокумента.Количество > 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеОстаткаБезПартии)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|	КОНЕЦ														  						КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости) 	КАК ОперацияУчетаСебестоимости,
	|	ДанныеДокумента.ДокументИсточник 												  	КАК ДокументИсточник,
	|	НЕОПРЕДЕЛЕНО																		КАК ДокументДвижения,
	|	ДанныеДокумента.ИдентификаторСтроки 						  						КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  						КАК ИдентификаторФинЗаписи,
	|	ДанныеДокумента.НастройкаХозяйственнойОперации 				  						КАК НастройкаХозяйственнойОперации,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров							КАК МетодОценкиСтоимостиТоваров,
	|	ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента) 			КАК СпособОпределенияСебестоимости
	|ПОМЕСТИТЬ ВТОперация_ВыбытиеПоФиксированнойСтоимости
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости)
	|";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТОперация_ВыбытиеПоФиксированнойСтоимости", ТекстЗапросаОтражения);
	
КонецПроцедуры

Процедура ОтразитьОперациюСебестоимостиПеремещение(ПараметрыОтражения)
	
	// Сформируем шаблон текста запроса для отражения операции.
	ТекстЗапросаОтражения =
	"
	// РАСХОД - списание у отправителя
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) 	КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 														КАК Организация,
	|	ВЫБОР КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И НЕ ДанныеДокумента.ХозяйственнаяОперация В
	|	  	    (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет))
	|		ТОГДА ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыКомитента, НЕОПРЕДЕЛЕНО)
	|		ИНАЧЕ ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО)
	|	КОНЕЦ 																				КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И НЕ ДанныеДокумента.ХозяйственнаяОперация В
	|	  	    (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет))
	|		ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		 И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ 																				КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета И ДанныеДокумента.РазделУчета <> НЕОПРЕДЕЛЕНО
	|		 И ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.РазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_РазделУчета <> НЕОПРЕДЕЛЕНО И НЕ
	//	Переопределяем раздел учета только тогда, когда у нас не переопределяется аналитика учета и вид запасов. Для комиссионного товара
	//	она переопределяется, а потому раздел учета, определенный по общим принципам, уже не подходит.
	|			(ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|				И ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|				И НЕ ДанныеДокумента.ХозяйственнаяОперация В (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет)))
	|			ТОГДА ДанныеДокумента.Расчетное_РазделУчета
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНедостачЗаСчетКомитента))
	|			ТОГДА 
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|				КОНЕЦ
	//++ Устарело_Переработка24
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	//-- Устарело_Переработка24
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуПодразделениями),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуФилиалами))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаВСтранахЕАЭСПоступлениеИзТоваровВПути),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаПоИмпортуПоступлениеИзТоваровВПути),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщикаПоступлениеИзТоваровВПути))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|				(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтХранителя),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУХранителя),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровУХранителя),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНедостачЗаСчетПоклажедателя))
	|			ТОГДА
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|				(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтПереработчика2_5),
	//++ Устарело_Переработка24
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтПереработчика),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика),
	//-- Устарело_Переработка24
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеОтПереработчика2_5),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУПереработчика),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровУПереработчика),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровУПереработчика))
	|			ТОГДА
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтКомиссионера),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровЧерезКомиссионера))
	|		И ДанныеДокумента.ВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В
	|			(ТИП(Документ.ПередачаТоваровМеждуОрганизациями),
	|			 ТИП(Документ.ВозвратТоваровОтКлиента),
	|			 ТИП(Документ.ВозвратТоваровМеждуОрганизациями))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|				ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																				КАК РазделУчета,
	|
	// Корреспондирующие поля
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|			ТОГДА ДанныеДокумента.КорРазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_КорРазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_КорРазделУчета
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	// Товар на хранении с правом продажи
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|		 И ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваров),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровСПереоценкой),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваров),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваров),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровСПереоценкой),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНедостачЗаСчетПоклажедателя),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеИзлишковТоваровВПользуПоклажедателя),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровУПереработчика))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиКОформлениюСписания)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|				(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаХранениеСПравомПродажи),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУХранителя),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровУХранителя))
	|			ТОГДА
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|				(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПереработчику2_5),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУПереработчика),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровУПереработчика))
	|			ТОГДА
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуПодразделениями),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуФилиалами))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	//++ Устарело_Переработка24
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПереработчику))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	//-- Устарело_Переработка24
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаКомиссию),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеИзлишковТоваровВПользуКомитента))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНедостачЗаСчетКомитента))
	|			ТОГДА 
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтРозничногоПокупателя),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтКомиссионера),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровЧерезКомиссионера))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаКомиссиюВДругуюОрганизацию))
	|			ТОГДА 
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтХранителя),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтПереработчика2_5))
	|			ТОГДА 
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|					КОГДА ДанныеДокумента.КорАналитикаУчетаНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|		  			  ИЛИ ДанныеДокумента.КорАналитикаУчетаНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет))
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ДанныеДокумента.КорАналитикаУчетаНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|		  ИЛИ ДанныеДокумента.КорАналитикаУчетаНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																					КАК КорРазделУчета,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.КорОрганизация = ДанныеДокумента.Организация
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|			ИНАЧЕ ДанныеДокумента.КорОрганизация
	|	КОНЕЦ 																					КАК КорОрганизация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		 И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		   (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваров),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровСПереоценкой),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваров),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваров),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровСПереоценкой))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА ДанныеДокумента.ВидЗапасов
	|		ИНАЧЕ ДанныеДокумента.КорВидЗапасов КОНЕЦ)											КАК КорВидЗапасов,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация 													КАК ХозяйственнаяОперация,
	//++ НЕ УТ
	|	ВЫБОР КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ДвижениеПродукцииИМатериалов))
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ ДанныеДокумента.Подразделение
	|	КОНЕЦ 								  													КАК Подразделение,
	//-- НЕ УТ
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.АктВыполненныхВнутреннихРабот))
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ДвижениеПродукцииИМатериалов)
	|		  И ДанныеДокумента.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеПолуфабрикатов),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеПолуфабрикатовМеждуФилиалами))
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//-- НЕ УТ
	|			ИНАЧЕ ДанныеДокумента.ГруппаПродукции
	|	КОНЕЦ                                            										КАК ГруппаПродукции,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ЗаказКлиента
	|		ТОГДА ДанныеДокумента.ЗаказКлиента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																					КАК ЗаказКлиента,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПоПартнерам
	|	 И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПоПартнерам
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																					КАК АналитикаУчетаПоПартнерам,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество 																КАК Количество,
	|	ДанныеДокумента.Стоимость 																КАК Стоимость,
	|	ДанныеДокумента.СтоимостьБезНДС 														КАК СтоимостьБезНДС,
	|	ДанныеДокумента.СтоимостьРегл 															КАК СтоимостьРегл,
	|	ВЫБОР КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|	  И &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.СтоимостьУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ 																					КАК СтоимостьУпр,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ПостояннаяРазница
	|		ТОГДА ДанныеДокумента.ПостояннаяРазница
	|		ИНАЧЕ 0
	|	КОНЕЦ 																					КАК ПостояннаяРазница,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ВременнаяРазница
	|		ТОГДА ДанныеДокумента.ВременнаяРазница
	|		ИНАЧЕ 0
	|	КОНЕЦ 																					КАК ВременнаяРазница,
	|
	// Поля партионного учета версии 2.2
	|	НЕОПРЕДЕЛЕНО 																			КАК Партия,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																					КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) = НЕОПРЕДЕЛЕНО ТОГДА
	|					НЕОПРЕДЕЛЕНО
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																					КАК КорАналитикаФинансовогоУчета,
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.АктВыполненныхВнутреннихРабот),
	|		  ТИП(Документ.РаспределениеВозвратныхОтходов))
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	//-- НЕ УТ

	//++ Локализация
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.КорректировкаВидаДеятельностиНДС))
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	//-- Локализация
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК ВидДеятельностиНДС,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	//++ Локализация
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.КорректировкаВидаДеятельностиНДС)
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	//-- Локализация
	|			ИНАЧЕ ДанныеДокумента.ВидДеятельностиНДС
	|	КОНЕЦ 																					КАК КорВидДеятельностиНДС,
	|
	|	ВЫБОР 
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|			ТОГДА ДанныеДокумента.КорПартия
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК КорПартия,
	|	НЕОПРЕДЕЛЕНО 																			КАК АналитикаУчетаПартий,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПартий
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК КорАналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК ВидДеятельностиНДСДокумента,
	|
	|	ВЫБОР
	//++ НЕ УТ

	//++ Локализация
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратИзПроизводства))
	|		  И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВозвратМатериаловИзПроизводства)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПотреблениеПроизводство)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеТоваров))
	|		  И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ПеремещениеМатериаловВПроизводстве)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПотреблениеПроизводство)
	//-- Локализация

	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтРозничногоПокупателя),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровЧерезКомиссионера))
	|		  И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В
	|			(ТИП(Документ.ВозвратТоваровОтКлиента),
	|			 ТИП(Документ.ВозвратТоваровМеждуОрганизациями))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратНаДругойСклад)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|	КОНЕЦ 														  							КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Перемещение) 							КАК ОперацияУчетаСебестоимости,
	|	НЕОПРЕДЕЛЕНО 												  							КАК ДокументИсточник,
	|	ВЫБОР
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.АктВыполненныхВнутреннихРабот),
	|		  ТИП(Документ.РаспределениеВозвратныхОтходов))
	|			ТОГДА ДанныеДокумента.Ссылка
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтКомиссионера))
	|			ТОГДА ДанныеДокумента.Ссылка
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК ДокументДвижения,
	|	ДанныеДокумента.ИдентификаторСтроки 						  							КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  							КАК ИдентификаторФинЗаписи,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		ТОГДА ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.РеализацияКомиссионногоТовара)
	|		ИНАЧЕ ДанныеДокумента.НастройкаХозяйственнойОперации
	|	КОНЕЦ																					КАК НастройкаХозяйственнойОперации,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров								КАК МетодОценкиСтоимостиТоваров,
	|	ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости							КАК СпособОпределенияСебестоимости
	|ПОМЕСТИТЬ ВТОперация_Перемещение
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Перемещение)
	|	И НЕ (НЕ (&Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ))
	|		И ДанныеДокумента.ХозяйственнаяОперация В
	|	  		(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратИзПроизводства))
	//++ НЕ УТ

	//++ Локализация
	|		И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ВозвратМатериаловИзПроизводства)
	//-- Локализация

	//-- НЕ УТ
	|		)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// ПРИХОД - оприходование у получателя
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) 	КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ЕСТЬNULL(ДанныеДокумента.КорОрганизацияСсылка, ДанныеДокумента.Организация) 							КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		 И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		   (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваров),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровСПереоценкой),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваров),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваров),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровСПереоценкой))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА ДанныеДокумента.ВидЗапасов
	|		ИНАЧЕ ДанныеДокумента.КорВидЗапасов КОНЕЦ)											КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|			ТОГДА ДанныеДокумента.КорРазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_КорРазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_КорРазделУчета
	|		КОГДА ДанныеДокумента.СпрКорНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				ИЛИ ДанныеДокумента.СпрКорНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	// Товар на хранении с правом продажи
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|		 И ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваров),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровСПереоценкой),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваров),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваров),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровСПереоценкой),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНедостачЗаСчетПоклажедателя),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеИзлишковТоваровВПользуПоклажедателя),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровУПереработчика))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиКОформлениюСписания)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|				(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаХранениеСПравомПродажи),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУХранителя),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровУХранителя))
	|			ТОГДА
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|				(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПереработчику2_5),
	//++ Устарело_Переработка24
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПереработчику),
	//-- Устарело_Переработка24
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПересортицаТоваровУПереработчика),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПорчаТоваровУПереработчика))
	|			ТОГДА
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуПодразделениями),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуФилиалами))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаКомиссию),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеИзлишковТоваровВПользуКомитента))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНедостачЗаСчетКомитента))
	|			ТОГДА 
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности))
	|		  И ДанныеДокумента.КорВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности))
	|		  И ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|		  И ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|		  И ДанныеДокумента.КорВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиента),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтРозничногоПокупателя),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтКомиссионера),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровЧерезКомиссионера))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаКомиссиюВДругуюОрганизацию))
	|			ТОГДА 
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтХранителя),
	|		  ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтПереработчика2_5))
	|			ТОГДА 
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|					КОГДА ДанныеДокумента.КорАналитикаУчетаНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|		  			  ИЛИ ДанныеДокумента.КорАналитикаУчетаНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ДанныеДокумента.КорАналитикаУчетаНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|		  ИЛИ ДанныеДокумента.КорАналитикаУчетаНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																					КАК РазделУчета,
	|
	// Корреспондирующие поля
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК КорРазделУчета,
	|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
	|
	// Прочие поля
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуФилиалами))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВнутреннееПоступлениеРабот)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеТоваровМеждуФилиалами),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеПолуфабрикатовМеждуФилиалами))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВнутреннееПоступлениеТоваров)
	|		ИНАЧЕ ДанныеДокумента.ХозяйственнаяОперация
	|	КОНЕЦ 							КАК ХозяйственнаяОперация,
	//++ НЕ УТ
	|	ВЫБОР КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ДвижениеПродукцииИМатериалов))
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ ДанныеДокумента.Подразделение
	|	КОНЕЦ 							КАК Подразделение,
	//-- НЕ УТ
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	|
	//++ Локализация
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ПередачаМатериаловВПроизводство)
	|			ТОГДА ДанныеДокумента.ГруппаПродукции
	//-- Локализация
	|
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ПоступлениеОтПереработчика)
	|			ТОГДА ДанныеДокумента.ГруппаПродукции
	//-- Устарело_Переработка24
	|
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|
	|	КОНЕЦ							КАК ГруппаПродукции,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ЗаказКлиента
	|		ТОГДА ДанныеДокумента.ЗаказКлиента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ							КАК ЗаказКлиента,
	|	НЕОПРЕДЕЛЕНО					КАК АналитикаУчетаПоПартнерам,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество 																КАК Количество,
	|	ДанныеДокумента.Стоимость 																КАК Стоимость,
	|	ДанныеДокумента.СтоимостьБезНДС 														КАК СтоимостьБезНДС,
	|	ДанныеДокумента.СтоимостьРегл 															КАК СтоимостьРегл,
	|	ВЫБОР КОГДА &Константа_ВестиУправленческийУчетОрганизаций
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаНачалаВеденияУправленческогоУчетаОрганизаций, МЕСЯЦ)
	|	  И &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.СтоимостьУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ 																					КАК СтоимостьУпр,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ПостояннаяРазница
	|		ТОГДА ДанныеДокумента.ПостояннаяРазница
	|		ИНАЧЕ 0
	|	КОНЕЦ 																					КАК ПостояннаяРазница,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ВременнаяРазница
	|		ТОГДА ДанныеДокумента.ВременнаяРазница
	|		ИНАЧЕ 0
	|	КОНЕЦ 																					КАК ВременнаяРазница,
	|
	// Поля партионного учета версии 2.2
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|	      И ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|			ТОГДА ДанныеДокумента.Ссылка
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК Партия,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ															КАК АналитикаФинансовогоУчета,
	|	НЕОПРЕДЕЛЕНО 													КАК КорАналитикаФинансовогоУчета,
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	//++ Локализация
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.КорректировкаВидаДеятельностиНДС)
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	//-- Локализация
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаКомиссию))
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ ДанныеДокумента.ВидДеятельностиНДС
	|	КОНЕЦ 															КАК ВидДеятельностиНДС,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК КорВидДеятельностиНДС,
	|
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	  И НЕ ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|		ТОГДА ДанныеДокумента.КорПартия
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК КорПартия,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПартий
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК АналитикаУчетаПартий,
	|	НЕОПРЕДЕЛЕНО 													КАК КорАналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК ВидДеятельностиНДСДокумента,
	|
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуФилиалами))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеОбособленно)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеУпр)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеТоваровМеждуФилиалами),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеПолуфабрикатовМеждуФилиалами))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеОбособленно)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = 
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности) ТОГДА
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПеремещениеТоварыВПути)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)
	|	КОНЕЦ 															КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Перемещение) 	КАК ОперацияУчетаСебестоимости,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В 
	|		  (ТИП(Документ.ПоступлениеТоваровОтХранителя), ТИП(Документ.ПередачаТоваровХранителю))
	|			ТОГДА ДанныеДокумента.Ссылка
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК ДокументИсточник,
	|	ВЫБОР
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.АктВыполненныхВнутреннихРабот),
	//++ Устарело_Переработка24
	|		  ТИП(Документ.ПоступлениеОтПереработчика),
	//-- Устарело_Переработка24
	|		  ТИП(Документ.РаспределениеВозвратныхОтходов))
	|			ТОГДА ДанныеДокумента.Ссылка
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратОтКомиссионера))
	|			ТОГДА ДанныеДокумента.Ссылка
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК ДокументДвижения,
	|	ДанныеДокумента.ИдентификаторСтроки 						  	КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  	КАК ИдентификаторФинЗаписи,
	|	ДанныеДокумента.НастройкаХозяйственнойОперации				  	КАК НастройкаХозяйственнойОперации,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров		КАК МетодОценкиСтоимостиТоваров,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоКорДвижению)
	|		ИНАЧЕ ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости
	|	КОНЕЦ 															КАК СпособОпределенияСебестоимости
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Перемещение)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// РАСХОД - списание комиссионного товара
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) 	КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 														КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ					 															КАК ВидЗапасов,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию) 	КАК РазделУчета,
	|
	// Корреспондирующие поля
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК КорРазделУчета,
	|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	//++ НЕ УТ
	|	ВЫБОР КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ДвижениеПродукцииИМатериалов))
	|		ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ ДанныеДокумента.Подразделение
	|	КОНЕЦ 								  КАК Подразделение,
	//-- НЕ УТ
	|	НЕОПРЕДЕЛЕНО						  КАК ГруппаПродукции,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ЗаказКлиента
	|		ТОГДА ДанныеДокумента.ЗаказКлиента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ								  КАК ЗаказКлиента,
	|	НЕОПРЕДЕЛЕНО						  КАК АналитикаУчетаПоПартнерам,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество КАК Количество,
	|	0 КАК Стоимость,
	|	0 КАК СтоимостьБезНДС,
	|	0 КАК СтоимостьРегл,
	|	0 КАК СтоимостьУпр,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница,
	|
	// Поля партионного учета версии 2.2
	|	НЕОПРЕДЕЛЕНО 																	КАК Партия,
	|	НЕОПРЕДЕЛЕНО 																	КАК АналитикаФинансовогоУчета,
	|	НЕОПРЕДЕЛЕНО 																	КАК КорАналитикаФинансовогоУчета,
	|	НЕОПРЕДЕЛЕНО 																	КАК ВидДеятельностиНДС,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																			КАК КорВидДеятельностиНДС,
	|
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|			ТОГДА ДанныеДокумента.КорПартия
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																			КАК КорПартия,
	|	НЕОПРЕДЕЛЕНО 																	КАК АналитикаУчетаПартий,
	|	НЕОПРЕДЕЛЕНО 																	КАК КорАналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																			КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																			КАК ВидДеятельностиНДСДокумента,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление) 		  					КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Перемещение) 					КАК ОперацияУчетаСебестоимости,
	|	НЕОПРЕДЕЛЕНО 												  					КАК ДокументИсточник,
	|	НЕОПРЕДЕЛЕНО 																	КАК ДокументДвижения,
	|	ДанныеДокумента.ИдентификаторСтроки 						  					КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  					КАК ИдентификаторФинЗаписи,
	|	ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.СписаниеКомиссионныхТоваров)	КАК НастройкаХозяйственнойОперации,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров						КАК МетодОценкиСтоимостиТоваров,
	|	ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости					КАК СпособОпределенияСебестоимости
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Перемещение)
	|	И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|	И ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|	И НЕ ДанныеДокумента.ХозяйственнаяОперация В
	|	  	(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиентуРеглУчет))
	|";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТОперация_Перемещение", ТекстЗапросаОтражения);
	
КонецПроцедуры

// Описание принципов формирования движений модульной операции "Реализация".
// 
// При продаже типа запасов "Полуфабрикат давальца" если в исходных данных заполнен кор тип запасов "Продукция давальца":
// - балансовая себестоимость номенклатуры списывается на себестоимость продаж, в регистр "Выручка и себестоимость продаж"
// - забалансовая себестоимость переходит в себестоимость продукции давальца (тип запасов "Продукция давальца")   
// 	для этого формируется дополнительное приходное движение по кор виду запасов
//
Процедура ОтразитьОперациюСебестоимостиРеализация(ПараметрыОтражения)
	
	// Сформируем шаблон текста запроса для отражения операции.
	ТекстЗапросаОтражения =
	"ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиентаПрошлыхПериодов),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровЧерезКомиссионераПрошлыхПериодов),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноРеализацииВозвратНаДругойСклад))
	|		ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	//++ НЕ УТКА

	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетДавальцу)
	|		  И ДанныеДокумента.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|		  И (НЕ &Константа_ПартионныйУчетВерсии22
	|		  		ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ))
	|			ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	//-- Устарело_Переработка24

	//-- НЕ УТКА
	|			ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	КОНЕЦ									КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 															КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ																					КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета И ДанныеДокумента.РазделУчета <> НЕОПРЕДЕЛЕНО
	|		 И ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.РазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_РазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_РазделУчета
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	//++ НЕ УТКА

	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетДавальцу)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	//-- Устарело_Переработка24

	//-- НЕ УТКА
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНедостачЗаСчетПоклажедателя))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	//++ НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровУПереработчика))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетКомиссионера),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОприходованиеИзлишковТоваровВПользуКомитента),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНедостачЗаСчетКомитента),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионера))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В(
	|		  ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтгрузкаПринятыхСПравомПродажиТоваровСХранения),
	|		  ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоставкаПодПринципала))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В(
	//++ Устарело_Переработка24
	|		  ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаДавальцу),
	//-- Устарело_Переработка24
	|		  ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыкупТоваровДавальца))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыкупПринятыхНаХранениеТоваров))
	|			ТОГДА 
	|				ВЫБОР КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыкупТоваровХранителем),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыкупТоваровПереработчиком))
	|			ТОГДА 
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|					КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыкупТоваровПереработчиком)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|			И ДанныеДокумента.ВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|			И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности))
	|		  И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперацияДокумента В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровЧерезКомиссионера))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|				ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																					КАК РазделУчета,
	|
	// Корреспондирующие поля
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|			ТОГДА ДанныеДокумента.КорРазделУчета
	// Условия заполнения поля КорРазделУчета из таблицы ВТРазделыУчета должны соответствовать условиям формирования 
	// движения Приход для модульной операции Реализация.
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
	|		 И ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца)
	|		 И ДанныеДокумента.Расчетное_КорРазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_КорРазделУчета
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация =
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию)
	|			ТОГДА ВЫБОР
	|				КОГДА ЕСТЬNULL(ДанныеДокумента.СпрКорНоменклатураТипНоменклатуры, НЕОПРЕДЕЛЕНО)
	|						= ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|				КОГДА ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|					ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация =
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуМеждуОрганизациями)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|	КОНЕЦ																					КАК КорРазделУчета,
	|	ДанныеДокумента.КорОрганизация 															КАК КорОрганизация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.КорВидЗапасов
	|	КОНЕЦ 															КАК КорВидЗапасов,
	|
	// Прочие поля
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		 И ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиенту),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияВРозницу))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКомиссионногоТовара)
	|		ИНАЧЕ ДанныеДокумента.ХозяйственнаяОперация КОНЕЦ) КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.АналитикаУчетаПоПартнерам 	КАК АналитикаУчетаПоПартнерам,
	|	ДанныеДокумента.Подразделение 				КАК Подразделение,
	|	ДанныеДокумента.ЗаказКлиента 				КАК ЗаказКлиента,
	|	ДанныеДокумента.ПериодДокументаИсточника	КАК ПериодПродажи,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество 					КАК Количество,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_Стоимость
	|		ТОГДА ДанныеДокумента.Стоимость
	|		ИНАЧЕ 0
	|	КОНЕЦ										КАК Стоимость,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьБезНДС
	|		ТОГДА ДанныеДокумента.СтоимостьБезНДС
	|		ИНАЧЕ 0
	|	КОНЕЦ										КАК СтоимостьБезНДС,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьРегл
	|		ТОГДА ДанныеДокумента.СтоимостьРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ										КАК СтоимостьРегл,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьУпр
	|		ТОГДА ДанныеДокумента.СтоимостьУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ										КАК СтоимостьУпр,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьЗабалансовая
	|		ТОГДА ДанныеДокумента.СтоимостьЗабалансовая
	|		ИНАЧЕ 0
	|	КОНЕЦ 										КАК СтоимостьЗабалансовая,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьЗабалансоваяРегл
	|		ТОГДА ДанныеДокумента.СтоимостьЗабалансоваяРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ 										КАК СтоимостьЗабалансоваяРегл,
	|
	// Поля партионного учета версии 2.2
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуМеждуОрганизациями))
	|			И ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|			ТОГДА ДанныеДокумента.Ссылка
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 														КАК Партия,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПартий
	|				И ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ														КАК АналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		И ЕСТЬNULL(ДанныеДокумента.КорУчетныеПолитикиФИФОСкользящаяОценка, ИСТИНА) = ИСТИНА
	|		ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 														  КАК КорАналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 														КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			И (ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.РеализацияТоваровУслуг)
	|			И ДанныеДокумента.СпрНоменклатураТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа))
	|		ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 														  КАК КорАналитикаФинансовогоУчета,
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА НЕ ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуМеждуОрганизациями),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиентаПрошлыхПериодов))
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ ДанныеДокумента.ВидДеятельностиНДС
	|	КОНЕЦ 														  КАК ВидДеятельностиНДС,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорВидДеятельностиНДС
	|			ТОГДА ДанныеДокумента.КорВидДеятельностиНДС
	|		ИНАЧЕ ДанныеДокумента.ВидДеятельностиНДС
	|	КОНЕЦ							 							  КАК КорВидДеятельностиНДС,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		И (ЕСТЬNULL(ДанныеДокумента.КорУчетныеПолитикиФИФОСкользящаяОценка, ИСТИНА) = ИСТИНА
	//++ НЕ УТ
	|			ИЛИ ТИПЗНАЧЕНИЯ(ДанныеДокумента.КорПартия) = ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|			)
	|		ТОГДА ДанныеДокумента.КорПартия
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 														  КАК КорПартия,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 														КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 														  КАК ВидДеятельностиНДСДокумента,
	|
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ТипЗаписи
	|			ТОГДА ДанныеДокумента.ТипЗаписи
	//++ НЕ УТКА

	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.ОтчетДавальцу)
	|		  И ДанныеДокумента.ВидДеятельностиНДС = ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|		  И (НЕ &Константа_ПартионныйУчетВерсии22
	|		  		ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПустаяСсылка)
	//-- Устарело_Переработка24

	//-- НЕ УТКА
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5)
	|			И ДанныеДокумента.Количество < 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровОтКлиентаПрошлыхПериодов),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровЧерезКомиссионераПрошлыхПериодов))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетКомиссионера))
	|		  И ДанныеДокумента.Количество < 0
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратБезДокументаИсточника)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноПереданнойТары),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратТоваровЧерезКомиссионера),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноРеализации))
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|			(ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности))
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ПотреблениеТоварыВПути)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|	КОНЕЦ														  КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Реализация)  КАК ОперацияУчетаСебестоимости,
	|	ДанныеДокумента.ДокументИсточник 							  КАК ДокументИсточник,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ДокументДвижения
	|		 И ДанныеДокумента.ЕстьПолеЗапроса_СпособОпределенияСебестоимости
	|		 И ДанныеДокумента.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента)
	|			ТОГДА ДанныеДокумента.ДокументДвижения
	|		КОГДА ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоСреднескользящей)
	|			ТОГДА ДанныеДокумента.Ссылка
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ								  КАК ДокументДвижения,
	|	ДанныеДокумента.ИдентификаторСтроки 						  КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  КАК ИдентификаторФинЗаписи,
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		 И ДанныеДокумента.ХозяйственнаяОперация В (
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиенту),
	|				ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияВРозницу))
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.РеализацияКомиссионногоТовара)
	|		ИНАЧЕ ДанныеДокумента.НастройкаХозяйственнойОперации КОНЕЦ) КАК НастройкаХозяйственнойОперации,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров	  КАК МетодОценкиСтоимостиТоваров,
	// Поле "Способ определения себестоимости" заполняется в документах:
	//	- ОтчетДавальцуМеждуОрганизациями - значение "ИзДокумента", т.к. при выпуске по плановой стоимости в движении
	//		указывается плановая стоимость из документа.
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СпособОпределенияСебестоимости
	|		 И ДанныеДокумента.СпособОпределенияСебестоимости <> ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.СпособОпределенияСебестоимости
	|		КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка ТОГДА
	|			ВЫБОР КОГДА ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоДвижениямДокументаИсточника)
	|				ИНАЧЕ ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости
	|			КОНЕЦ
	|		ИНАЧЕ ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости
	|	КОНЕЦ 															КАК СпособОпределенияСебестоимости
	|
	|ПОМЕСТИТЬ ВТОперация_Реализация
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Реализация)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// ПРИХОД - давальческий товар
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)	КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 															КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.КорВидЗапасов
	|	КОНЕЦ															КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|			ТОГДА ДанныеДокумента.КорРазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_КорРазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_КорРазделУчета
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|	КОНЕЦ 																					КАК РазделУчета,
	|
	// Корреспондирующие поля
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)					КАК КорРазделУчета,
	|	НЕОПРЕДЕЛЕНО																			КАК КорОрганизация,
	|	НЕОПРЕДЕЛЕНО																			КАК КорАналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО																			КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	НЕОПРЕДЕЛЕНО																			КАК КорВидЗапасов,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация		КАК ХозяйственнаяОперация,
	|	НЕОПРЕДЕЛЕНО								КАК АналитикаУчетаПоПартнерам,
	|	ДанныеДокумента.Подразделение 				КАК Подразделение,
	|	НЕОПРЕДЕЛЕНО								КАК ЗаказКлиента,
	|	НЕОПРЕДЕЛЕНО								КАК ПериодПродажи,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество 					КАК Количество,
	|	0											КАК Стоимость,
	|	0											КАК СтоимостьБезНДС,
	|	0											КАК СтоимостьРегл,
	|	0											КАК СтоимостьУпр,
	|	0	 										КАК СтоимостьЗабалансовая,
	|	0											КАК СтоимостьЗабалансоваяРегл,
	|
	// Поля партионного учета версии 2.2
	|	НЕОПРЕДЕЛЕНО													КАК Партия,
	|	НЕОПРЕДЕЛЕНО													КАК АналитикаУчетаПартий,
	|	НЕОПРЕДЕЛЕНО													КАК КорАналитикаУчетаПартий,
	|	НЕОПРЕДЕЛЕНО													КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК КорАналитикаФинансовогоУчета,
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ ДанныеДокумента.ВидДеятельностиНДС
	|	КОНЕЦ 															КАК ВидДеятельностиНДС,
	|	НЕОПРЕДЕЛЕНО							 						КАК КорВидДеятельностиНДС,
	|	НЕОПРЕДЕЛЕНО 													КАК КорПартия,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК ВидДеятельностиНДСДокумента,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)			КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Реализация)	КАК ОперацияУчетаСебестоимости,
	|	ДанныеДокумента.Ссылка 											КАК ДокументИсточник,
	|	НЕОПРЕДЕЛЕНО												  	КАК ДокументДвижения,
	|	ДанныеДокумента.ИдентификаторСтроки 							КАК ИдентификаторСтроки,
	// Для прихода давальческой продукции идентификатор фин записи не заполняем, т.к. у давальческой продукции нет балансовой стоимости.
	|	&ИдентификаторНеиспользуемойФинЗаписи 							КАК ИдентификаторФинЗаписи,
	|	ДанныеДокумента.НастройкаХозяйственнойОперации					КАК НастройкаХозяйственнойОперации,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров		КАК МетодОценкиСтоимостиТоваров,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СпособОпределенияСебестоимости
	|		 И ДанныеДокумента.СпособОпределенияСебестоимости <> ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.СпособОпределенияСебестоимости
	|		КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоКорДвижению)
	|		ИНАЧЕ ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости
	|	КОНЕЦ 															КАК СпособОпределенияСебестоимости
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Реализация)
	|	И ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца)
	|	И ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца)
	|";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТОперация_Реализация", ТекстЗапросаОтражения);
	
КонецПроцедуры

Процедура ОтразитьОперациюСебестоимостиСписаниеНаДругиеПартии(ПараметрыОтражения)
	
	// Сформируем шаблон текста запроса для отражения операции.
	ТекстЗапросаОтражения =
	"
	// РАСХОД - списание у отправителя
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) 	КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 														КАК Организация,
	|	ВЫБОР КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		ТОГДА ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыКомитента, НЕОПРЕДЕЛЕНО)
	|		ИНАЧЕ ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО)
	|	КОНЕЦ 																				КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		  И ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		 И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ 																				КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета И ДанныеДокумента.РазделУчета <> НЕОПРЕДЕЛЕНО
	|		 И ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.РазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_РазделУчета <> НЕОПРЕДЕЛЕНО И НЕ
	//	Переопределяем раздел учета только тогда, когда у нас не переопределяется аналитика учета и вид запасов. Для комиссионного товара
	//	она переопределяется, а потому раздел учета, определенный по общим принципам, уже не подходит.
	|			(ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|				И ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар))
	|			ТОГДА ДанныеДокумента.Расчетное_РазделУчета
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		  ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	// Товар на хранении с правом продажи
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА (ВЫБОР
	|				КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиПереданныеПартнерам)
	|				ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи) КОНЕЦ)
	//++ НЕ УТ
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|		 И (ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5)
	|			ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5_ЕАЭС))
	|		 И ДанныеДокумента.СпрНоменклатураТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|								ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
	|								ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровПоТребованию))
	|			И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	//-- НЕ УТ
	|		КОГДА (ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|				ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																				КАК РазделУчета,
	|
	// Корреспондирующие поля
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|			ТОГДА ДанныеДокумента.КорРазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_КорРазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_КорРазделУчета
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуМеждуОрганизациями))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	//++ НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыкупТоваровДавальца)
	|		 И ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|		 И ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	|
	|		КОГДА ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|		 И (ДанныеДокумента.КорАналитикаДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5)
	|			ИЛИ ДанныеДокумента.КорАналитикаДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5_ЕАЭС))
	|		 И ДанныеДокумента.СпрКорНоменклатураТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыкупТоваровДавальца)
	|		 И ДанныеДокумента.ВидЗапасовТипЗапасов В
	|		  (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),
	|		   ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РаспределениеРасходовНаПартииПроизводства)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|		КОГДА ДанныеДокумента.КорАналитикаУчетаНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|		  ИЛИ ДанныеДокумента.КорАналитикаУчетаНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																					КАК КорРазделУчета,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.КорОрганизация = ДанныеДокумента.Организация
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|			ИНАЧЕ ДанныеДокумента.КорОрганизация
	|	КОНЕЦ 																					КАК КорОрганизация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.КорВидЗапасов
	|	КОНЕЦ 															КАК КорВидЗапасов,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация 													КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.Подразделение 															КАК Подразделение,
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	|
	// Для движения по разделу "Незавершенное производство" группа продукции не заполняется.
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ДанныеДокумента.ГруппаПродукции
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																					КАК ГруппаПродукции,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество 																КАК Количество,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_Стоимость
	|		ТОГДА ДанныеДокумента.Стоимость
	|		ИНАЧЕ 0
	|	КОНЕЦ																					КАК Стоимость,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьБезНДС
	|		ТОГДА ДанныеДокумента.СтоимостьБезНДС
	|		ИНАЧЕ 0
	|	КОНЕЦ																					КАК СтоимостьБезНДС,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьРегл
	|		ТОГДА ДанныеДокумента.СтоимостьРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ																					КАК СтоимостьРегл,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьУпр
	|		ТОГДА ДанныеДокумента.СтоимостьУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ																					КАК СтоимостьУпр,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_НДСРегл
	|		ТОГДА ДанныеДокумента.НДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ																					КАК НДСРегл,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_НДСУпр
	|		ТОГДА ДанныеДокумента.НДСУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ																					КАК НДСУпр,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьЗабалансовая
	|		ТОГДА ДанныеДокумента.СтоимостьЗабалансовая
	|		ИНАЧЕ 0
	|	КОНЕЦ																					КАК СтоимостьЗабалансовая,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьЗабалансоваяРегл
	|		ТОГДА ДанныеДокумента.СтоимостьЗабалансоваяРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ																					КАК СтоимостьЗабалансоваяРегл,
	|
	// Поля партионного учета версии 2.2
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_Партия
	|		И &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		И (ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	//++ НЕ УТ
	|			ИЛИ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|			)
	|		ТОГДА ДанныеДокумента.Партия
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																					КАК Партия,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПартий
	|			И (ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	//++ НЕ УТ
	|			ИЛИ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|			)
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																					КАК АналитикаУчетаПартий,
	|	ВЫБОР
	|		КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|
	// В разделе "Незавершенное производство" аналитика финансового учета должна соответствовать группе продукции из
	// партии производства, или иметь значение НЕОПРЕДЕЛЕНО, если группа продукции не заполнена.
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|				 И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					ТОГДА ВЫБОР
	|						КОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|							<> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|							ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|						ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																					КАК АналитикаФинансовогоУчета,
	// Поле "КорАналитикаФинансовогоУчета" заполняется в документах:
	// - ОтчетПереработчика - указывается группа продукции для распределения затрат на выпуск.
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорАналитикаФинансовогоУчета
	|			ТОГДА ДанныеДокумента.КорАналитикаФинансовогоУчета
	|		КОГДА &Константа_ПартионныйУчетВерсии22
	|			И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			И НЕ ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры ЕСТЬ NULL
	|		ТОГДА ВЫБОР
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.КорПартия) = ТИП(Справочник.ПартииПроизводства)
	|				 И ДанныеДокумента.КорПартия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					ТОГДА ВЫБОР
	|						КОГДА ВЫРАЗИТЬ(ДанныеДокумента.КорПартия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|							<> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|							ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.КорПартия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|						ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК КорАналитикаФинансовогоУчета,
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|			ИНАЧЕ ДанныеДокумента.ВидДеятельностиНДС
	|	КОНЕЦ 																					КАК ВидДеятельностиНДС,
	|	ДанныеДокумента.ВидДеятельностиНДС														КАК КорВидДеятельностиНДС,
	|
	|	ВЫБОР 
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|	  	КОГДА НЕ ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	//++ НЕ УТ
	|		  И ТИПЗНАЧЕНИЯ(ДанныеДокумента.КорПартия) <> ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|			ИНАЧЕ ДанныеДокумента.КорПартия
	|	КОНЕЦ 																					КАК КорПартия,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорАналитикаУчетаПартий
	|	  	И (ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	//++ НЕ УТ
	|		  ИЛИ ТИПЗНАЧЕНИЯ(ДанныеДокумента.КорПартия) = ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|		  ИЛИ ЛОЖЬ)
	|		ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК КорАналитикаУчетаПартий,
	// Поле "АналитикаФинансовогоУчетаДокумента" заполняется в документах:
	// - ОтчетПереработчика - указывается группа продукции для распределения затрат на выпуск.
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаФинансовогоУчетаДокумента
	|			ТОГДА ДанныеДокумента.АналитикаФинансовогоУчетаДокумента
	|		КОГДА &Константа_ПартионныйУчетВерсии22
	|		 И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР
	//++ НЕ УТ
	|
	// В разделе "Незавершенное производство" аналитика финансового учета должна соответствовать группе продукции из
	// партии производства, или иметь значение НЕОПРЕДЕЛЕНО, если группа продукции не заполнена.
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|				 И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					ТОГДА ВЫБОР
	|						КОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|							<> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|							ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|						ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Партнер))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК ВидДеятельностиНДСДокумента,
	|
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ТипЗаписи
	|			ТОГДА ДанныеДокумента.ТипЗаписи
	//++ НЕ УТ
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	//-- НЕ УТ
	|		ИНАЧЕ
	|			ВЫБОР КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеНаДругиеПартии)
	|				ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|			КОНЕЦ
	|	КОНЕЦ																					КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии)				КАК ОперацияУчетаСебестоимости,
	|	НЕОПРЕДЕЛЕНО 												  							КАК ДокументИсточник,
	|	ДанныеДокумента.ИдентификаторСтроки 						  							КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  							КАК ИдентификаторФинЗаписи,
	|	ДанныеДокумента.НастройкаХозяйственнойОперации 				  							КАК НастройкаХозяйственнойОперации,
	// Поле "ДокументДвижения" заполняется в документах:
	// - ОтчетПереработчика - значение Неопределено для распределения материалов на выпуск, т.к. стоимость определяется
	//		при закрытии месяца.
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ДокументДвижения 
	|			ТОГДА ДанныеДокумента.ДокументДвижения
	|		КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|			ТОГДА ДанныеДокумента.Ссылка
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																					КАК ДокументДвижения,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров								КАК МетодОценкиСтоимостиТоваров,
	// Поле "Способ определения себестоимости" заполняется в документах:
	// - ОтчетДавальцуМеждуОрганизациями - значение "ИзДокумента", т.к. стоимость прихода в НЗП у давальца определяется
	//	суммой в документе.
	// - ОтчетПереработчика - значение "ИзДокумента", т.к. стоимость расходы из НЗП рассчитывается при закрытии месяца
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СпособОпределенияСебестоимости
	|		 И ДанныеДокумента.СпособОпределенияСебестоимости <> ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.СпособОпределенияСебестоимости
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаПродукцииИзПроизводстваФиксированнаяСтоимость)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента)
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета
	|		 И ДанныеДокумента.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ВыпускПродукции)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента)
	|		ИНАЧЕ ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости
	|	КОНЕЦ 															КАК СпособОпределенияСебестоимости
	|
	|ПОМЕСТИТЬ ВТОперация_СписаниеНаДругиеПартии
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// ПРИХОД - оприходование у получателя
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) 	КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ЕСТЬNULL(ДанныеДокумента.КорОрганизацияСсылка, ДанныеДокумента.Организация) 							КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.КорВидЗапасов
	|	КОНЕЦ 																					КАК ВидЗапасов,
	|	(ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|			ТОГДА ДанныеДокумента.КорРазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_КорРазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_КорРазделУчета
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство) КОНЕЦ) КАК РазделУчета,
	|
	// Корреспондирующие поля
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК КорРазделУчета,
	|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.Подразделение	КАК Подразделение,
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ДанныеДокумента.ГруппаПродукции
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ							КАК ГруппаПродукции,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество									КАК Количество,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_Стоимость
	|		ТОГДА ДанныеДокумента.Стоимость
	|		ИНАЧЕ 0
	|	КОНЕЦ														КАК Стоимость,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьБезНДС
	|		ТОГДА ДанныеДокумента.СтоимостьБезНДС
	|		ИНАЧЕ 0
	|	КОНЕЦ														КАК СтоимостьБезНДС,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьРегл
	|		ТОГДА ДанныеДокумента.СтоимостьРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ														КАК СтоимостьРегл,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьУпр
	|		ТОГДА ДанныеДокумента.СтоимостьУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ														КАК СтоимостьУпр,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_НДСРегл
	|		ТОГДА ДанныеДокумента.НДСРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ														КАК НДСРегл,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_НДСУпр
	|		ТОГДА ДанныеДокумента.НДСУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ														КАК НДСУпр,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьЗабалансовая
	|		ТОГДА ДанныеДокумента.СтоимостьЗабалансовая
	|		ИНАЧЕ 0
	|	КОНЕЦ														КАК СтоимостьЗабалансовая,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьЗабалансоваяРегл
	|		ТОГДА ДанныеДокумента.СтоимостьЗабалансоваяРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ														КАК СтоимостьЗабалансоваяРегл,
	|
	// Поля партионного учета версии 2.2
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ ДанныеДокумента.КорПартия
	|	КОНЕЦ 															КАК Партия,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПартий
	//++ НЕ УТ
	|			И НЕ ТИПЗНАЧЕНИЯ(ДанныеДокумента.КорПартия) = ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|				ТОГДА ДанныеДокумента.АналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ															КАК АналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА ВЫБОР
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.КорПартия) = ТИП(Справочник.ПартииПроизводства)
	|				 И ДанныеДокумента.КорПартия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					ТОГДА ВЫБОР
	|						КОГДА ВЫРАЗИТЬ(ДанныеДокумента.КорПартия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|							<> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|							ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.КорПартия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|						ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК АналитикаФинансовогоУчета,
	|	НЕОПРЕДЕЛЕНО 													КАК КорАналитикаФинансовогоУчета,
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ ДанныеДокумента.ВидДеятельностиНДС
	|	КОНЕЦ 															КАК ВидДеятельностиНДС,
	|	НЕОПРЕДЕЛЕНО													КАК КорВидДеятельностиНДС,
	|
	|	НЕОПРЕДЕЛЕНО													КАК КорПартия,
	|	НЕОПРЕДЕЛЕНО													КАК КорАналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.КорПартия) = ТИП(Справочник.ПартииПроизводства)
	|				 И ДанныеДокумента.КорПартия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					ТОГДА ВЫБОР
	|						КОГДА ВЫРАЗИТЬ(ДанныеДокумента.КорПартия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|							<> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|							ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.КорПартия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|						ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКорКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_КорАналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК ВидДеятельностиНДСДокумента,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)				КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии) 	КАК ОперацияУчетаСебестоимости,
	|	НЕОПРЕДЕЛЕНО 												  	КАК ДокументИсточник,
	|	ДанныеДокумента.ИдентификаторСтроки 						  	КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  	КАК ИдентификаторФинЗаписи,
	|	ДанныеДокумента.НастройкаХозяйственнойОперации					КАК НастройкаХозяйственнойОперации,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		ТОГДА ДанныеДокумента.Ссылка
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 															КАК ДокументДвижения,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров		КАК МетодОценкиСтоимостиТоваров,
	// Поле "Способ определения себестоимости" заполняется в документах:
	// - ОтчетДавальцуМеждуОрганизациями - значение "ИзДокумента", т.к. стоимость прихода в НЗП у давальца определяется
	//	суммой в документе.
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СпособОпределенияСебестоимости
	|		 И ДанныеДокумента.СпособОпределенияСебестоимости <> ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.СпособОпределенияСебестоимости
	|		КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоКорДвижению)
	|		ИНАЧЕ ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости
	|	КОНЕЦ 															КАК СпособОпределенияСебестоимости
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии)
	|	И ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// РАСХОД - списание комиссионного товара
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) 	КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 														КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ																				КАК ВидЗапасов,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию) 	КАК РазделУчета,
	|
	// Корреспондирующие поля
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка) КАК КорРазделУчета,
	|	НЕОПРЕДЕЛЕНО КАК КорОрганизация,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	НЕОПРЕДЕЛЕНО КАК КорВидЗапасов,
	|
	// Прочие поля
	|	ВЫБОР КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.СборкаТоваров)
	|		ТОГДА ДанныеДокумента.ХозяйственнаяОперация
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеКомиссионныхТоваров)
	|	КОНЕЦ								  КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.Подразделение		  КАК Подразделение,
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	
	//++ Устарело_Переработка24
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.ОтчетПереработчика))
	|			ТОГДА ДанныеДокумента.ГруппаПродукции
	//-- Устарело_Переработка24
	
	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ								  КАК ГруппаПродукции,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество КАК Количество,
	|	0 КАК Стоимость,
	|	0 КАК СтоимостьБезНДС,
	|	0 КАК СтоимостьРегл,
	|	0 КАК СтоимостьУпр,
	|	0 КАК НДСРегл,
	|	0 КАК НДСУпр,
	|	0 КАК СтоимостьЗабалансовая,
	|	0 КАК СтоимостьЗабалансоваяРегл,
	|
	// Поля партионного учета версии 2.2
	|	НЕОПРЕДЕЛЕНО 																	КАК Партия,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПартий
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																			КАК АналитикаУчетаПартий,
	|	НЕОПРЕДЕЛЕНО 																	КАК АналитикаФинансовогоУчета,
	|	НЕОПРЕДЕЛЕНО 																	КАК КорАналитикаФинансовогоУчета,
	|	НЕОПРЕДЕЛЕНО 																	КАК ВидДеятельностиНДС,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияЧерезКомиссионераБезПереходаПраваСобственности))
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																			КАК КорВидДеятельностиНДС,
	|
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	|			ТОГДА ДанныеДокумента.КорПартия
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																			КАК КорПартия,
	|	НЕОПРЕДЕЛЕНО																	КАК КорАналитикаУчетаПартий,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|				 И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					ТОГДА ВЫБОР
	|						КОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|							<> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|							ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	|						ИНАЧЕ НЕОПРЕДЕЛЕНО КОНЕЦ
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																			КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																			КАК ВидДеятельностиНДСДокумента,
	|
	|	ВЫБОР КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.СборкаТоваров)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.СписаниеНаДругиеПартии)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|	КОНЕЦ 		  																	КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии)		КАК ОперацияУчетаСебестоимости,
	|	НЕОПРЕДЕЛЕНО 												  					КАК ДокументИсточник,
	|	НЕОПРЕДЕЛЕНО 						  											КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  					КАК ИдентификаторФинЗаписи,
	|	ВЫБОР КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) = ТИП(Документ.СборкаТоваров)
	|		ТОГДА ДанныеДокумента.НастройкаХозяйственнойОперации
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.СписаниеКомиссионныхТоваров)
	|	КОНЕЦ 		  																	КАК НастройкаХозяйственнойОперации,
	|	НЕОПРЕДЕЛЕНО																	КАК ДокументДвижения,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров						КАК МетодОценкиСтоимостиТоваров,
	|	ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости					КАК СпособОпределенияСебестоимости
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии)
	|	И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|	И ЕСТЬNULL(ДанныеДокумента.КорВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТОперация_СписаниеНаДругиеПартии", ТекстЗапросаОтражения);
	
КонецПроцедуры

Процедура ОтразитьОперациюСебестоимостиСписаниеНаРасходыАктивы(ПараметрыОтражения)
	
	// Сформируем шаблон текста запроса для отражения операции.
	ТекстЗапросаОтражения =
	"
	// РАСХОД - списание на расходы
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы))
	|			ТОГДА ВЫБОР
	|				КОГДА НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|					ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				КОНЕЦ
	|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	КОНЕЦ									КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 															КАК Организация,
	|	ВЫБОР КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		ТОГДА ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыКомитента, НЕОПРЕДЕЛЕНО)
	|		ИНАЧЕ ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО)
	|	КОНЕЦ 																					КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		 И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ 																					КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета И ДанныеДокумента.РазделУчета <> НЕОПРЕДЕЛЕНО
	|		 И ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|			ТОГДА ДанныеДокумента.РазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_РазделУчета <> НЕОПРЕДЕЛЕНО И НЕ
	//	Переопределяем раздел учета только тогда, когда у нас не переопределяется аналитика учета и вид запасов. Для комиссионного товара
	//	она переопределяется, а потому раздел учета, определенный по общим принципам, уже не подходит.
	|			ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ДанныеДокумента.Расчетное_РазделУчета
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		  ИЛИ ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|		 И ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеПринятыхТоваровЗаСчетПоклажедателя),
	|		   ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеПринятыхТоваровНаРасходы))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажиКОформлениюСписания)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ТоварНаХраненииСПравомПродажи)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаХраненииСПравомПродажи)
	//++ НЕ УТ
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|		 И (ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5)
	|			ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5_ЕАЭС))
	|		 И ДанныеДокумента.СпрНоменклатураТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеПереработчику)
	//-- НЕ УТ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетКомиссионераОСписании),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНедостачЗаСчетКомитента))
	|			ТОГДА 
	|				ВЫБОР
	|					КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|						ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|						ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|				КОНЕЦ
	|
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СХранителем)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНедостачЗаСчетПоклажедателя))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.СобственныеТоварыПереданныеПартнерам)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровУКомиссионера))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|		КОГДА ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая
	|		  ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПроизводственныеЗатраты)
	|			ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыНаСкладах)
	|	КОНЕЦ 																					КАК РазделУчета,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|			ТОГДА ДанныеДокумента.КорРазделУчета
	//		При списании на расходы выполняется изменение раздела учета - приход в ...КОформлениюСписания
	//		Особенность документа ОтчетДавальцу2_5:
	//		для него выполняется только изменение типа запасов с ПолуфабрикатДавальца на ПродукцияДавальца (кор. раздел определяется ниже, как для всех давальческих товаров)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),
	|														ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца),
	|														ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|			И НЕ ДанныеДокумента.ХозяйственнаяОперация В (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5),
	|															ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуСписаниеНаРасходы),
	|															ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаЗаСчетДавальца),
	|															ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаНаРасходы))
	|			ТОГДА ВЫБОР КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуКОформлениюСписания)
	|				ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранениеКОформлениюСписания)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.Расчетное_КорРазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_КорРазделУчета
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|	КОНЕЦ 																					КАК КорРазделУчета,
	|
	// Корреспондирующие поля
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.КорОрганизация = ДанныеДокумента.Организация
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|			ИНАЧЕ ДанныеДокумента.КорОрганизация
	|	КОНЕЦ 																					КАК КорОрганизация,
	// Условия для КорАналитикаУчетаНоменклатуры должны синхронизироваться с условием формирования приходных движений по давальческим товарам в этой операции
	|	ВЫБОР КОГДА ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5)
	|	  И ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуСписаниеНаРасходы)
	|	  И ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаЗаСчетДавальца)
	|	  И ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаНаРасходы)
	|	  И ДанныеДокумента.ВидЗапасовТипЗапасов В
	|		(ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),
	|		 ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца),
	|		 ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|			ТОГДА ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО)
	|			ИНАЧЕ ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО)
	|	КОНЕЦ 																					КАК КорАналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК КорАналитикаУчетаНоменклатурыИсходная,
	// Условия для КорВидЗапасов должны синхронизироваться с условием формирования приходных движений по давальческим товарам в этой операции
	|	ВЫБОР КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|	 И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|		ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|	КОГДА ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5)
	|	  И ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуСписаниеНаРасходы)
	|	  И ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаЗаСчетДавальца)
	|	  И ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаНаРасходы)
	|	  И ДанныеДокумента.ВидЗапасовТипЗапасов В
	|		(ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),
	|		 ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца),
	|		 ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|			ТОГДА ДанныеДокумента.ВидЗапасов
	|			ИНАЧЕ ДанныеДокумента.КорВидЗапасов
	|	КОНЕЦ 																					КАК КорВидЗапасов,
	|	ДанныеДокумента.КорНаправлениеДеятельности			    								КАК КорНаправлениеДеятельности,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорПартия
	|		ТОГДА ДанныеДокумента.КорПартия
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК КорПартия,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорАналитикаУчетаПартий
	|		ТОГДА ДанныеДокумента.КорАналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК КорАналитикаУчетаПартий,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация 													КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.Подразделение 															КАК Подразделение,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.СтатьяРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК СтатьяРасходовСписания,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.АналитикаРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаРасходов,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ДанныеДокумента.СтатьяРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК СтатьяАктивовПассивов,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ДанныеДокумента.АналитикаРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаАктивовПассивов,
	|	ДанныеДокумента.ПериодДокументаИсточника												КАК ПериодПродажи,
	|	ВЫБОР
	|		КОГДА ЛОЖЬ
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	
	//++ Локализация
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВыпускПродукции))
	|			ТОГДА ДанныеДокумента.ГруппаПродукции
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	//-- Локализация

	//-- НЕ УТ
	|	КОНЕЦ                                            										КАК ГруппаПродукции,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПоПартнерам
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПоПартнерам
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК АналитикаУчетаПоПартнерам,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_НастройкаСчетовУчета
	|			ТОГДА ДанныеДокумента.НастройкаСчетовУчета
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																					КАК НастройкаСчетовУчета,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ЗаказКлиента
	|		ТОГДА ДанныеДокумента.ЗаказКлиента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																					КАК ЗаказКлиента,
	|
	// Количественные и суммовые показатели
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы))
	|			ТОГДА ВЫБОР
	|				КОГДА НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|					ТОГДА ДанныеДокумента.Количество
	|					ИНАЧЕ -ДанныеДокумента.Количество
	|				КОНЕЦ
	|		ИНАЧЕ ДанныеДокумента.Количество
	|	КОНЕЦ																		КАК Количество,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_Стоимость
	|		ТОГДА ДанныеДокумента.Стоимость
	|		ИНАЧЕ 0
	|	КОНЕЦ 																		КАК Стоимость,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьБезНДС
	|		ТОГДА ДанныеДокумента.СтоимостьБезНДС
	|		ИНАЧЕ 0
	|	КОНЕЦ 																		КАК СтоимостьБезНДС,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьРегл
	|		ТОГДА ДанныеДокумента.СтоимостьРегл
	|		ИНАЧЕ 0
	|	КОНЕЦ 																		КАК СтоимостьРегл,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_СтоимостьУпр
	|		ТОГДА ДанныеДокумента.СтоимостьУпр
	|		ИНАЧЕ 0
	|	КОНЕЦ 																		КАК СтоимостьУпр,
	|
	// Поля партионного учета версии 2.2
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|	ТОГДА
	|		(ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		)
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																		КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																		КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|			ИНАЧЕ ДанныеДокумента.ВидДеятельностиНДС
	|	КОНЕЦ 																		КАК ВидДеятельностиНДС,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																		КАК ВидДеятельностиНДСДокумента,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|				ТИП(Документ.ВнутреннееПотребление),
	|				ТИП(Документ.СписаниеНедостачТоваров),
	|				ТИП(Документ.ПередачаТоваровМеждуОрганизациями),
	|				ТИП(Документ.ОтчетКомиссионераОСписании),
	//++ НЕ УТКА
	|				ТИП(Документ.ОтчетДавальцуМеждуОрганизациями),
	//-- НЕ УТКА
	|				ТИП(Документ.ОтчетПоКомиссииМеждуОрганизациямиОСписании))
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	//++ НЕ УТ

	//++ Локализация
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВыпускПродукции))
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	//-- Локализация

	//-- НЕ УТ
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																		КАК КорВидДеятельностиНДС,
	|	ВЫБОР
	|	  КОГДА ЛОЖЬ
	|		ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ
	
	//++ Локализация
	|	  КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВыпускПродукции))
	|		ТОГДА ВЫБОР 
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	//-- Локализация

	//-- НЕ УТ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																		КАК КорАналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_Партия
	|		И &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		И (ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	//++ НЕ УТ
	|			ИЛИ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|			)
	|		ТОГДА ДанныеДокумента.Партия
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																		КАК Партия,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПартий
	|			И (ДанныеДокумента.УчетныеПолитикиФИФОСкользящаяОценка
	//++ НЕ УТ
	|			ИЛИ ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|			)
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПартий
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																		КАК АналитикаУчетаПартий,
	|
	|	ВЫБОР
	// Тип записи определяется в процедуре ОписаниеОперацийУчетаСебестоимости у следующих документов:
	//	- ОтчетПереработчика
	//	- ОтчетПереработчика2_5
	//	- КорректировкаРеализации
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ТипЗаписи
	|			ТОГДА ДанныеДокумента.ТипЗаписи
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы))
	|			ТОГДА ВЫБОР
	|				КОГДА НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНаРасходыФиксированнаяСтоимость))
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Дополнение)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|	КОНЕЦ																		КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы) 	КАК ОперацияУчетаСебестоимости,
	|	ДанныеДокумента.ДокументИсточник							  				КАК ДокументИсточник,
	|	ДанныеДокумента.ИдентификаторСтроки 						  				КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  				КАК ИдентификаторФинЗаписи,
	|	ДанныеДокумента.НастройкаХозяйственнойОперации 				  				КАК НастройкаХозяйственнойОперации,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ДокументДвижения 
	|		ТОГДА ДанныеДокумента.ДокументДвижения
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																		КАК ДокументДвижения,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров					КАК МетодОценкиСтоимостиТоваров,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета
	|		 И ДанныеДокумента.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ВыпускПродукции)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента) 
	|		КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|			ТОГДА ВЫБОР
	|				КОГДА ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеНаРасходыФиксированнаяСтоимость)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента)
	|				КОГДА ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоДвижениямДокументаИсточника)
	|				ИНАЧЕ ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости
	|			КОНЕЦ
	|		ИНАЧЕ ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости
	|	КОНЕЦ 															КАК СпособОпределенияСебестоимости
	|ПОМЕСТИТЬ ВТОперация_СписаниеНаРасходыАктивы
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы)
	// Для передачи товаров между организациями со списанием на расходы это движение делать не надо, т.к. в отличии от переработки, тут не будет дополнительного приходного движения 
	|	И НЕ (ЕСТЬNULL(ДанныеДокумента.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		И ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияТоваровВДругуюОрганизацию))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// РАСХОД - списание комиссионного товара
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы))
	|			ТОГДА ВЫБОР
	|				КОГДА НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|					ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|					ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|				КОНЕЦ
	|		ИНАЧЕ ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	КОНЕЦ									КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 														КАК Организация,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ																				КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_РазделУчета И ДанныеДокумента.РазделУчета <> НЕОПРЕДЕЛЕНО
	|		 И ДанныеДокумента.РазделУчета <> ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|		ТОГДА ДанныеДокумента.РазделУчета
	|		КОГДА ДанныеДокумента.Расчетное_РазделУчета <> НЕОПРЕДЕЛЕНО
	|		ТОГДА ДанныеДокумента.Расчетное_РазделУчета
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|	КОНЕЦ КАК РазделУчета,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)				КАК КорРазделУчета,
	|
	// Корреспондирующие поля
	|	НЕОПРЕДЕЛЕНО 																		КАК КорОрганизация,
	|	НЕОПРЕДЕЛЕНО 																		КАК КорАналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО 																		КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|				И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		ИНАЧЕ ДанныеДокумента.КорВидЗапасов
	|	КОНЕЦ																				КАК КорВидЗапасов,
	|	НЕОПРЕДЕЛЕНО			    														КАК КорНаправлениеДеятельности,
	|	НЕОПРЕДЕЛЕНО 																		КАК КорПартия,
	|	НЕОПРЕДЕЛЕНО 																		КАК КорАналитикаУчетаПартий,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация 												КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.Подразделение 														КАК Подразделение,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.СтатьяРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК СтатьяРасходовСписания,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.АналитикаРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаРасходов,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ДанныеДокумента.СтатьяРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК СтатьяАктивовПассивов,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ДанныеДокумента.АналитикаРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаАктивовПассивов,
	|	ДанныеДокумента.ПериодДокументаИсточника											КАК ПериодПродажи,
	|	НЕОПРЕДЕЛЕНО																		КАК ГруппаПродукции,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПоПартнерам
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПоПартнерам
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаУчетаПоПартнерам,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_НастройкаСчетовУчета
	|			ТОГДА ДанныеДокумента.НастройкаСчетовУчета
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК НастройкаСчетовУчета,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ЗаказКлиента
	|		ТОГДА ДанныеДокумента.ЗаказКлиента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																				КАК ЗаказКлиента,
	|
	// Количественные и суммовые показатели
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы))
	|			ТОГДА ВЫБОР
	|				КОГДА НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|					ТОГДА ДанныеДокумента.Количество
	|					ИНАЧЕ -ДанныеДокумента.Количество
	|				КОНЕЦ
	|		ИНАЧЕ ДанныеДокумента.Количество
	|	КОНЕЦ																				КАК Количество,
	|	0 																					КАК Стоимость,
	|	0 																					КАК СтоимостьБезНДС,
	|	0 																					КАК СтоимостьРегл,
	|	0 																					КАК СтоимостьУпр,
	|
	// Поля партионного учета версии 2.2
	|	НЕОПРЕДЕЛЕНО 																		КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаФинансовогоУчетаДокумента,
	|	НЕОПРЕДЕЛЕНО																		КАК ВидДеятельностиНДС,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК ВидДеятельностиНДСДокумента,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (
	|		  ТИП(Документ.ВнутреннееПотребление),
	//++ НЕ УТ
	
	//++ Локализация
	|		  ТИП(Документ.ВыпускПродукции),
	//-- Локализация

	//-- НЕ УТ
	|	   	  ТИП(Документ.СписаниеНедостачТоваров))
	|			ТОГДА ДанныеДокумента.ВидДеятельностиНДС
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК КорВидДеятельностиНДС,
	|	НЕОПРЕДЕЛЕНО 																		КАК КорАналитикаФинансовогоУчета,
	|	НЕОПРЕДЕЛЕНО																		КАК Партия,
	|	НЕОПРЕДЕЛЕНО																		КАК АналитикаУчетаПартий,
	|
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В
	|		  (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СторноСписанияНаРасходы))
	|			ТОГДА ВЫБОР
	|				КОГДА НАЧАЛОПЕРИОДА(ДанныеДокумента.ПериодДокументаИсточника, МЕСЯЦ) < НАЧАЛОПЕРИОДА(ДанныеДокумента.Период, МЕСЯЦ)
	|					ТОГДА ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.ВозвратПрошлыхПериодов)
	|					ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Сторно)
	|				КОНЕЦ
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Потребление)
	|	КОНЕЦ																				КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы) 			КАК ОперацияУчетаСебестоимости,
	|	ДанныеДокумента.ДокументИсточник							  						КАК ДокументИсточник,
	|	ДанныеДокумента.ИдентификаторСтроки 						  						КАК ИдентификаторСтроки,
	|	ДанныеДокумента.ИдентификаторФинЗаписи 						  						КАК ИдентификаторФинЗаписи,
	|	ВЫБОР КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Ссылка) В (ТИП(Документ.ВнутреннееПотребление))
	|		ТОГДА ДанныеДокумента.НастройкаХозяйственнойОперации
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.СписаниеКомиссионныхТоваров)
	|	КОНЕЦ 																				КАК НастройкаХозяйственнойОперации,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ДокументДвижения 
	|		ТОГДА ДанныеДокумента.ДокументДвижения
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																				КАК ДокументДвижения,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров							КАК МетодОценкиСтоимостиТоваров,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		ТОГДА
	|			ВЫБОР КОГДА ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоДвижениямДокументаИсточника)
	|				ИНАЧЕ ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости
	|			КОНЕЦ
	|		ИНАЧЕ ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости
	|	КОНЕЦ 															КАК СпособОпределенияСебестоимости
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы)
	|	И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// ПРИХОД - давальческий товар
	|ВЫБРАТЬ
	|	ДанныеДокумента.НомерОперации КАК НомерОперации,
	// Описание документа
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)	КАК ВидДвижения,
	|	ДанныеДокумента.Период 					КАК Период,
	|
	// Поля учета номенклатуры
	|	ДанныеДокумента.Организация 															КАК Организация,
	|	ВЫБОР КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуСписаниеНаРасходы))
	|		ТОГДА ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры
	|		ИНАЧЕ ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры
	|	КОНЕЦ																					КАК АналитикаУчетаНоменклатуры,
	|	ВЫБОР КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуСписаниеНаРасходы))
	|		ТОГДА ДанныеДокумента.ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная
	|		ИНАЧЕ ДанныеДокумента.ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная
	|	КОНЕЦ																					КАК АналитикаУчетаНоменклатурыИсходная,
	|	ВЫБОР КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|		 И НЕ ДанныеДокумента.СпрНоменклатураПрослеживаемыйТовар
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	|		КОГДА ДанныеДокумента.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуСписаниеНаРасходы))
	|		ТОГДА ДанныеДокумента.КорВидЗапасов
	|		ИНАЧЕ ДанныеДокумента.ВидЗапасов
	|	КОНЕЦ																					КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_КорРазделУчета
	|			ТОГДА ДанныеДокумента.КорРазделУчета
	//		При списании на расходы выполняется изменение раздела учета - приход в ...КОформлениюСписания
	//		Особенность документа ОтчетДавальцу2_5:
	//		для него выполняется только изменение типа запасов с ПолуфабрикатДавальца на ПродукцияДавальца (кор. раздел определяется ниже, как для всех давальческих товаров)
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),
	|														ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца),
	|														ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|			И НЕ ДанныеДокумента.ХозяйственнаяОперация В (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5),
	|															ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуСписаниеНаРасходы),
	|															ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаЗаСчетДавальца),
	|															ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаНаРасходы))
	|			ТОГДА ВЫБОР КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуКОформлениюСписания)
	|				ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранениеКОформлениюСписания)
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.Расчетное_КорРазделУчета <> НЕОПРЕДЕЛЕНО
	|			ТОГДА ДанныеДокумента.Расчетное_КорРазделУчета
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|	КОНЕЦ 																					КАК РазделУчета,
	|	ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)					КАК КорРазделУчета,
	|
	// Корреспондирующие поля
	|	НЕОПРЕДЕЛЕНО 																		КАК КорОрганизация,
	|	НЕОПРЕДЕЛЕНО 																		КАК КорАналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО 																		КАК КорАналитикаУчетаНоменклатурыИсходная,
	|	НЕОПРЕДЕЛЕНО																		КАК КорВидЗапасов,
	|	НЕОПРЕДЕЛЕНО			    														КАК КорНаправлениеДеятельности,
	|	НЕОПРЕДЕЛЕНО 																		КАК КорПартия,
	|	НЕОПРЕДЕЛЕНО 																		КАК КорАналитикаУчетаПартий,
	|
	// Прочие поля
	|	ДанныеДокумента.ХозяйственнаяОперация 												КАК ХозяйственнаяОперация,
	|	ДанныеДокумента.Подразделение 														КАК Подразделение,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.СтатьяРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК СтатьяРасходовСписания,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|			ТОГДА ДанныеДокумента.АналитикаРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаРасходов,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ДанныеДокумента.СтатьяРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК СтатьяАктивовПассивов,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.СтатьяРасходовАктивов) = ТИП(ПланВидовХарактеристик.СтатьиАктивовПассивов)
	|			ТОГДА ДанныеДокумента.АналитикаРасходовАктивов
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаАктивовПассивов,
	|	ДанныеДокумента.ПериодДокументаИсточника											КАК ПериодПродажи,
	|	НЕОПРЕДЕЛЕНО																		КАК ГруппаПродукции,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_АналитикаУчетаПоПартнерам
	|		ТОГДА ДанныеДокумента.АналитикаУчетаПоПартнерам
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаУчетаПоПартнерам,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_НастройкаСчетовУчета
	|			ТОГДА ДанныеДокумента.НастройкаСчетовУчета
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК НастройкаСчетовУчета,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ЗаказКлиента
	|		ТОГДА ДанныеДокумента.ЗаказКлиента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																				КАК ЗаказКлиента,
	|
	// Количественные и суммовые показатели
	|	ДанныеДокумента.Количество															КАК Количество,
	|	0 																					КАК Стоимость,
	|	0 																					КАК СтоимостьБезНДС,
	|	0 																					КАК СтоимостьРегл,
	|	0 																					КАК СтоимостьУпр,
	|
	// Поля партионного учета версии 2.2
	|	НЕОПРЕДЕЛЕНО 																		КАК АналитикаФинансовогоУчета,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|		И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ВЫБОР 
	//++ НЕ УТ
	|				КОГДА ТИПЗНАЧЕНИЯ(ДанныеДокумента.Партия) = ТИП(Справочник.ПартииПроизводства)
	|					И ДанныеДокумента.Партия <> ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
	|					И ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции <> ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|				ТОГДА ВЫРАЗИТЬ(ДанныеДокумента.Партия КАК Справочник.ПартииПроизводства).ГруппаПродукции
	//-- НЕ УТ
	|				КОГДА (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) = ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				КОГДА НЕ (ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая, ЛОЖЬ)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение))
	|					И ТИПЗНАЧЕНИЯ(ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета) <> ТИП(Справочник.ГруппыАналитическогоУчетаНоменклатуры)
	|				ТОГДА ДанныеДокумента.Расчетное_АналитикаФинансовогоУчета
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|			КОНЕЦ
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК АналитикаФинансовогоУчетаДокумента,
	|	ВЫБОР
	|		КОГДА НЕ &Константа_ПартионныйУчетВерсии22
	|		  ИЛИ ДанныеДокумента.Период < НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ ДанныеДокумента.ВидДеятельностиНДС
	|	КОНЕЦ 																				КАК ВидДеятельностиНДС,
	|	ВЫБОР КОГДА &Константа_ПартионныйУчетВерсии22
	|	  И ДанныеДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаПереходаНаПартионныйУчетВерсии22, МЕСЯЦ)
	|		ТОГДА ДанныеДокумента.ВидДеятельностиНДСДокумента
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ 																				КАК ВидДеятельностиНДСДокумента,
	|	НЕОПРЕДЕЛЕНО																		КАК КорВидДеятельностиНДС,
	|	НЕОПРЕДЕЛЕНО 																		КАК КорАналитикаФинансовогоУчета,
	|	НЕОПРЕДЕЛЕНО																		КАК Партия,
	|	НЕОПРЕДЕЛЕНО																		КАК АналитикаУчетаПартий,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ТипыЗаписейПартий.Перемещение)								КАК ТипЗаписи,
	|	ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы) 			КАК ОперацияУчетаСебестоимости,
	|	ДанныеДокумента.ДокументИсточник							  						КАК ДокументИсточник,
	|	ДанныеДокумента.ИдентификаторСтроки 						  						КАК ИдентификаторСтроки,
	// Для прихода давальческой продукции идентификатор фин записи не заполняем, т.к. у давальческой продукции нет балансовой стоимости.
	|	&ИдентификаторНеиспользуемойФинЗаписи 						  						КАК ИдентификаторФинЗаписи,
	|	ДанныеДокумента.НастройкаХозяйственнойОперации 										КАК НастройкаХозяйственнойОперации,
	|	ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ДокументДвижения 
	|		ТОГДА ДанныеДокумента.ДокументДвижения
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ																				КАК ДокументДвижения,
	|	ДанныеДокумента.УчетныеПолитикиМетодОценкиСтоимостиТоваров							КАК МетодОценкиСтоимостиТоваров,
	|	ВЫБОР КОГДА ДанныеДокумента.УчетныеПолитикиОрганизацийСреднескользящаяОценка
	|		ТОГДА
	|			ВЫБОР КОГДА ДанныеДокумента.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоДвижениямДокументаИсточника)
	|				ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоКорДвижению)
	|			КОНЕЦ
	|		ИНАЧЕ ДанныеДокумента.УчетныеПолитикиСпособОпределенияСебестоимости
	|	КОНЕЦ 															КАК СпособОпределенияСебестоимости
	|ИЗ
	|	ВТДанныеДокумента КАК ДанныеДокумента
	|ГДЕ
	|	ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы)
	// Условие формирования приходных движений по давальческим товарам должны совпадать с условиями для КорАналитикаУчетаНоменклатуры и КорВидЗапасов в расходном движении в этой операции
	|	И ((ДанныеДокумента.ХозяйственнаяОперация В (
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуСписаниеНаРасходы))
	|		И ДанныеДокумента.СпрНоменклатураТипНоменклатуры <> ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа))
	|		ИЛИ 
	|		(ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцу2_5)
	|			И ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтчетДавальцуСписаниеНаРасходы)
	|			И ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаЗаСчетДавальца)
	|			И ДанныеДокумента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаНаРасходы)
	|			И ДанныеДокумента.ВидЗапасовТипЗапасов В
	|				(ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),
	|				 ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца),
	|				 ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))))
	|";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТОперация_СписаниеНаРасходыАктивы", ТекстЗапросаОтражения);
	
КонецПроцедуры

#КонецОбласти

#Область ТекстыВспомогательныхВременныхТаблиц

Процедура ДобавитьТекстЗапросаТаблицыДанные(ПараметрыОтражения)
	
	ИмяРегистра = ПараметрыОтражения.ИмяРегистра;
	ОписаниеРегистра = ПараметрыОтражения.РегистрыДляОтражения[ИмяРегистра];
	ЗаполнитьТекстыПолейПоРегистру(ОписаниеРегистра, ПараметрыОтражения);
	
	// Сформируем таблицу ВТДанныеДокументаПредварительная со всеми дополнительныим полями, необходимыми для формирования последующих временных таблиц.
	// В таблице все поля типизированы. Если в последующем необходимо к каким-либо полям обращаться через точку, необходимо это обращение сделать здесь.
	ТекстЗапросаВТДанныеДокументаПредварительная = ТекстЗапросаВТДанныеДокументаПредварительная(ИмяРегистра, ОписаниеРегистра);
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТДанныеДокументаПредварительная", ТекстЗапросаВТДанныеДокументаПредварительная);
	
	// Сторнирование
	Если ПараметрыОтражения.ИспользуетсяСреднескользящая
	 И НЕ ПараметрыОтражения.ЕстьСторнирование Тогда

			ТекстЗапроса =
			"ВЫБРАТЬ ПЕРВЫЕ 0
			|	Т.Период КАК ПериодПервичныхДвижений,
			|	*
			|ПОМЕСТИТЬ ВТДанныеСторнированияСебестоимость
			|ИЗ
			|	РегистрНакопления.СебестоимостьТоваров КАК Т";
			
			ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТДанныеСторнированияСебестоимость", ТекстЗапроса);
			
	КонецЕсли;
	
	// Сформируем вспомогательные временные таблицы
	ДобавитьТекстЗапросаФормированияАналитикНоменклатуры(ПараметрыОтражения);
	ДобавитьТекстЗапросаФормированияАналитикиФинансовогоУчета(ПараметрыОтражения);
	ДобавитьТекстЗапросаУчетныеПолитики(ПараметрыОтражения);
	ДобавитьТекстЗапросаРазделУчета(ПараметрыОтражения);
	ДобавитьТекстЗапросаНастроекПризнанияНДД(ПараметрыОтражения);

	// Сторнирование
	Если ПараметрыОтражения.ИспользуетсяСреднескользящая Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	0 КАК НомерОперации,
		|	УчетныеПолитикиОрганизаций.МетодОценкиСтоимостиТоваров КАК МетодОценкиСтоимостиТоваров,
		|	Т.Период,
		|	Т.Период КАК ПериодДокументаИсточника,
		|	Т.ВидДвижения,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатурыИсходная,
		|	Т.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатурыИсходная,
		|	&ПоляВыборки
		|ПОМЕСТИТЬ ВТДвиженияСторнирования
		|ИЗ
		|	ВТДанныеСторнированияСебестоимость КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТУчетныеПолитикиОрганизаций КАК УчетныеПолитикиОрганизаций
		|		ПО Т.Организация = УчетныеПолитикиОрганизаций.Организация
		|		И Т.Период = УчетныеПолитикиОрганизаций.Период
		|		И УчетныеПолитикиОрганизаций.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТУчетныеПолитикиОрганизаций КАК УчетныеПолитикиОрганизацийПервичногоДокумента
		|		ПО Т.Организация = УчетныеПолитикиОрганизацийПервичногоДокумента.Организация
		|		И Т.ПериодПервичныхДвижений = УчетныеПолитикиОрганизацийПервичногоДокумента.Период
		|		И УчетныеПолитикиОрганизацийПервичногоДокумента.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
		|ГДЕ
		|	Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|" + "
		|ИНДЕКСИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры
		|";
		
		ТекстПоляВыборки = "";
		
		Для Каждого ТекПоле Из Метаданные.РегистрыНакопления.СебестоимостьТоваров.Измерения Цикл
			ТекстПоляВыборки = ТекстПоляВыборки + ?(ТекстПоляВыборки = "", "", "," + Символы.ПС + "	") + "Т." + ТекПоле.Имя + " КАК " + ТекПоле.Имя;
		КонецЦикла;
		
		Для Каждого ТекПоле Из Метаданные.РегистрыНакопления.СебестоимостьТоваров.Реквизиты Цикл
			Если ТекПоле.Тип.СодержитТип(Тип("Число")) Тогда
				ТекстПоляВыборки = ТекстПоляВыборки + ?(ТекстПоляВыборки = "", "", "," + Символы.ПС + "	") + "-Т." + ТекПоле.Имя + " КАК " + ТекПоле.Имя;
			ИначеЕсли ТекПоле.Имя = Метаданные.РегистрыНакопления.СебестоимостьТоваров.Реквизиты.СпособОпределенияСебестоимости.Имя Тогда
				ТекстПоляВыборки = ТекстПоляВыборки + ?(ТекстПоляВыборки = "", "", "," + Символы.ПС + "	")
					+ "ВЫБОР КОГДА УчетныеПолитикиОрганизацийПервичногоДокумента.Организация ЕСТЬ NULL
						| И Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПустаяСсылка)
						|	ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента)
						|	ИНАЧЕ Т." + ТекПоле.Имя + "
						|КОНЕЦ КАК " + ТекПоле.Имя;
			Иначе
				ТекстПоляВыборки = ТекстПоляВыборки + ?(ТекстПоляВыборки = "", "", "," + Символы.ПС + "	") + "Т." + ТекПоле.Имя + " КАК " + ТекПоле.Имя;
			КонецЕсли;
		КонецЦикла;
		
		Для Каждого ТекПоле Из Метаданные.РегистрыНакопления.СебестоимостьТоваров.Ресурсы Цикл
			ТекстПоляВыборки = ТекстПоляВыборки + ?(ТекстПоляВыборки = "", "", "," + Символы.ПС + "	") + "-Т." + ТекПоле.Имя + " КАК " + ТекПоле.Имя;
		КонецЦикла;
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляВыборки", ТекстПоляВыборки);
		
		ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТДвиженияСторнирования", ТекстЗапроса);
		
	КонецЕсли;
	
	// Сформируем таблицу ВТДанныеДокумента со всеми дополнительныим полями, необходимыми для формирования временных таблиц ВТОперация_<имя операции себестоимости>
	// Важно! В таблицах ВТОперация_<имя операции себестоимости> не следует
	// - обращаться к полям реквизитов "через две точки"
	// - добавлять соединения с другими временными таблицами.
	// Все необходимые поля и соединения следует добавлять в таблицу ВТДанныеДокумента. Часть дополнительных полей получается в таблице ВТДанныеДокументаПредварительная,
	// в этой таблице идет соединение с дополнительными временными таблицами и получаются доп. поля, которые идут из временных таблиц.
	ТекстЗапросаВТДанныеДокумента = ТекстЗапросаВТДанныеДокумента(ОписаниеРегистра);
	
	ТекстЗапросаДанные = ТекстЗапросаДанные(ОписаниеРегистра);
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТДанныеДокумента", ТекстЗапросаВТДанныеДокумента);
	ПараметрыОтражения.ТекстыЗапросовДанныхДокумента.Вставить("ДанныеДокумента", ТекстЗапросаДанные);
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаФормированияАналитикНоменклатуры(ПараметрыОтражения)
	
	ТекстЗапросаВременнаяТаблица =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДанныеДокумента.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	ДанныеДокумента.ВидЗапасов КАК ВидЗапасов,
	|	ДанныеДокумента.ВидЗапасов КАК ВидЗапасовИсходный,
	|	ДанныеДокумента.ВидЗапасовТипЗапасов КАК ТипЗапасов,
	|	ДанныеДокумента.ВидЗапасовВладелецТовара КАК ВладелецТовара,
	|	ДанныеДокумента.Период КАК Период
	|ПОМЕСТИТЬ ВТАналитикиУчетаНоменклатурыДокумента
	|ИЗ
	|	ВТДанныеДокументаПредварительная КАК ДанныеДокумента
	|";
	
	Если ЕстьПолеТаблицыДанные(ПараметрыОтражения, "КорАналитикаУчетаНоменклатуры") Тогда
		
		ТекстЗапросаВременнаяТаблица = ТекстЗапросаВременнаяТаблица + "
		|ОБЪЕДИНИТЬ
		|" + "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДанныеДокумента.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	ДанныеДокумента.КорВидЗапасов КАК ВидЗапасов,
		|	ДанныеДокумента.КорВидЗапасов КАК ВидЗапасовИсходный,
		|	ДанныеДокумента.КорВидЗапасовТипЗапасов КАК ТипЗапасов,
		|	ДанныеДокумента.КорВидЗапасовВладелецТовара КАК ВладелецТовара,
		|	ДанныеДокумента.Период КАК Период
		|ИЗ
		|	ВТДанныеДокументаПредварительная КАК ДанныеДокумента
		|";
		
	КонецЕсли;

	ТекстЗапросаВременнаяТаблица = ТекстЗапросаВременнаяТаблица + "
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТАналитикиУчетаНоменклатурыДокумента", ТекстЗапросаВременнаяТаблица);
	
	ТекстЗапросаВременнаяТаблица =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	АналитикиДокумента.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатурыИсходная,
	|	Аналитика.Назначение.ТипНазначения КАК ТипНазначения,
	|	ВЫБОР КОГДА &Константа_УчитыватьСебестоимостьТоваровПоНазначениям
	|	  И АналитикиДокумента.Период >= НАЧАЛОПЕРИОДА(&Константа_ДатаВключенияОбособленногоУчетаСебестоимостиПоНазначениям, МЕСЯЦ)
	|		ТОГДА АналитикиДокумента.АналитикаУчетаНоменклатуры
	|		ИНАЧЕ АналитикаБезНазначения.КлючАналитики
	|	КОНЕЦ КАК АналитикаУчетаНоменклатуры,
	|	ЕСТЬNULL(АналитикаКомитента.КлючАналитики, НЕОПРЕДЕЛЕНО) КАК АналитикаУчетаНоменклатурыКомитента,
	|	АналитикиДокумента.ВидЗапасовИсходный КАК ВидЗапасов
	|ПОМЕСТИТЬ ВТЗаменаАналитикУчетаНоменклатуры
	|ИЗ
	|	ВТАналитикиУчетаНоменклатурыДокумента КАК АналитикиДокумента
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК Аналитика
	|		ПО АналитикиДокумента.АналитикаУчетаНоменклатуры = Аналитика.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаБезНазначения
	|		ПО Аналитика.Номенклатура = АналитикаБезНазначения.Номенклатура
	|		И Аналитика.Характеристика = АналитикаБезНазначения.Характеристика
	|		И Аналитика.Серия = АналитикаБезНазначения.Серия
	|		И Аналитика.МестоХранения = АналитикаБезНазначения.МестоХранения
	|		И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаБезНазначения.Назначение
	//++ НЕ УТ
	|		И Аналитика.СтатьяКалькуляции = АналитикаБезНазначения.СтатьяКалькуляции
	//-- НЕ УТ
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаКомитента
	|	ПО	Аналитика.Номенклатура = АналитикаКомитента.Номенклатура
	|		И Аналитика.Характеристика = АналитикаКомитента.Характеристика
	|		И ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) = АналитикаКомитента.Назначение
	|		И ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) = АналитикаКомитента.Серия
	|		И АналитикиДокумента.ВладелецТовара = АналитикаКомитента.МестоХранения
	//++ НЕ УТ
	|		И ЗНАЧЕНИЕ(Справочник.СтатьиКалькуляции.ПустаяСсылка) = АналитикаКомитента.СтатьяКалькуляции
	//-- НЕ УТ
	|		И АналитикиДокумента.ТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатурыИсходная
	|";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТЗаменаАналитикУчетаНоменклатуры", ТекстЗапросаВременнаяТаблица);
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаФормированияАналитикиФинансовогоУчета(ПараметрыОтражения)
	
	ТекстЗапросаВременнаяТаблица =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДанныеДокумента.Сделка 			КАК Сделка,
	|	ДанныеДокумента.Менеджер 		КАК Менеджер,
	|	ДанныеДокумента.Подразделение 	КАК Подразделение,
	|	ДанныеДокумента.СпрНоменклатураТипНоменклатуры	КАК ТипНоменклатуры,
	|	ВЫБОР
	|		КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ГруппаПродукции
	|			ТОГДА ДанныеДокумента.ГруппаПродукции
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ГруппыАналитическогоУчетаНоменклатуры.ПустаяСсылка)
	|	КОНЕЦ КАК ГруппаПродукции,
	|	ВЫБОР
	//++ НЕ УТ
	|		КОГДА &Константа_АналитическийУчетПоГруппамПродукции
	|		  И НЕ ГруппыАналитическогоУчетаНоменклатуры.Ссылка ЕСТЬ NULL
	|			ТОГДА ГруппыАналитическогоУчетаНоменклатуры.Ссылка
	//-- НЕ УТ
	
	// Для работ и услуг подразделение, менеджер или сделка не учитываются в аналитике финансового учета.
	// Менеджер, подразделение и сделка учитываются только для товаров. 
	|		КОГДА ДанныеДокумента.СпрНоменклатураТипНоменклатуры В (
	|				ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Услуга))
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА &Константа_ФормироватьВидыЗапасовПоСделкам
	|			И ЕСТЬNULL(Сделки.Ссылка.ОбособленныйУчетТоваровПоСделке, ЛОЖЬ)
	|			ТОГДА ЕСТЬNULL(Сделки.Ссылка, НЕОПРЕДЕЛЕНО)
	|		КОГДА &Константа_ФормироватьВидыЗапасовПоПодразделениямМенеджерам
	|		 И ЕСТЬNULL(Подразделения.ВариантОбособленногоУчетаТоваров, ЗНАЧЕНИЕ(Перечисление.ВариантыОбособленногоУчетаТоваров.ПустаяСсылка))
	|			= ЗНАЧЕНИЕ(Перечисление.ВариантыОбособленногоУчетаТоваров.ПоМенеджерамПодразделения)
	|			ТОГДА ЕСТЬNULL(Пользователи.Ссылка, НЕОПРЕДЕЛЕНО)
	|		КОГДА &Константа_ФормироватьВидыЗапасовПоПодразделениямМенеджерам
	|		 И ЕСТЬNULL(Подразделения.ВариантОбособленногоУчетаТоваров, ЗНАЧЕНИЕ(Перечисление.ВариантыОбособленногоУчетаТоваров.ПустаяСсылка))
	|			= ЗНАЧЕНИЕ(Перечисление.ВариантыОбособленногоУчетаТоваров.ПоПодразделению)
	|			ТОГДА ЕСТЬNULL(Подразделения.Ссылка, НЕОПРЕДЕЛЕНО)
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК АналитикаФинансовогоУчета
	|ПОМЕСТИТЬ ВТАналитикиФинансовогоУчета
	|ИЗ
	|	ВТДанныеДокументаПредварительная КАК ДанныеДокумента
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СтруктураПредприятия КАК Подразделения
	|		ПО ДанныеДокумента.Подразделение = Подразделения.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СделкиСКлиентами КАК Сделки
	|		ПО ДанныеДокумента.Сделка = Сделки.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
	|		ПО ДанныеДокумента.Менеджер = Пользователи.Ссылка
	//++ НЕ УТ
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ГруппыАналитическогоУчетаНоменклатуры КАК ГруппыАналитическогоУчетаНоменклатуры
	|		ПО ВЫБОР КОГДА ДанныеДокумента.ЕстьПолеЗапроса_ГруппаПродукции
	|			ТОГДА ДанныеДокумента.ГруппаПродукции
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|		  КОНЕЦ = ГруппыАналитическогоУчетаНоменклатуры.Ссылка
	//-- НЕ УТ
	|";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТАналитикиФинансовогоУчета", ТекстЗапросаВременнаяТаблица);
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаУчетныеПолитики(ПараметрыОтражения)
	
	ТекстЗапросаВременнаяТаблица =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ДанныеДокумента.Организация КАК Организация,
	|	ВЫБОР КОГДА ДанныеДокумента.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|		ТОГДА ДанныеДокумента.Организация
	|		ИНАЧЕ ДанныеДокумента.Организация.ГоловнаяОрганизация
	|	КОНЕЦ КАК ГоловнаяОрганизация,
	|	ДанныеДокумента.Период КАК Период
	|ПОМЕСТИТЬ ВТОрганизацииДокумента
	|ИЗ
	|	ВТДанныеДокументаПредварительная КАК ДанныеДокумента
	|";
	
	Если ПараметрыОтражения.ИспользуетсяСреднескользящая И ПараметрыОтражения.ЕстьСторнирование Тогда

		ТекстЗапросаВременнаяТаблица = ТекстЗапросаВременнаяТаблица + "
		|ОБЪЕДИНИТЬ
		|" + "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДанныеДокумента.Организация КАК Организация,
		|	ВЫБОР КОГДА ДанныеДокумента.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|		ТОГДА ДанныеДокумента.Организация
		|		ИНАЧЕ ДанныеДокумента.Организация.ГоловнаяОрганизация
		|	КОНЕЦ КАК ГоловнаяОрганизация,
		|	ДанныеДокумента.Период КАК Период
		|ИЗ
		|	ВТДанныеСторнированияСебестоимость КАК ДанныеДокумента
		|
		|ОБЪЕДИНИТЬ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДанныеДокумента.Организация КАК Организация,
		|	ВЫБОР КОГДА ДанныеДокумента.Организация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|		ТОГДА ДанныеДокумента.Организация
		|		ИНАЧЕ ДанныеДокумента.Организация.ГоловнаяОрганизация
		|	КОНЕЦ КАК ГоловнаяОрганизация,
		|	ДанныеДокумента.ПериодПервичныхДвижений КАК Период
		|ИЗ
		|	ВТДанныеСторнированияСебестоимость КАК ДанныеДокумента
		|";
		
	КонецЕсли;
	
	Если ЕстьПолеТаблицыДанные(ПараметрыОтражения, "КорОрганизация") Тогда
		
		ТекстЗапросаВременнаяТаблица = ТекстЗапросаВременнаяТаблица + "
		|ОБЪЕДИНИТЬ
		|" + "
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДанныеДокумента.КорОрганизация КАК Организация,
		|	ВЫБОР КОГДА ДанныеДокумента.КорОрганизация.ГоловнаяОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
		|		ТОГДА ДанныеДокумента.КорОрганизация
		|		ИНАЧЕ ДанныеДокумента.КорОрганизация.ГоловнаяОрганизация
		|	КОНЕЦ КАК ГоловнаяОрганизация,
		|	ДанныеДокумента.Период КАК Период
		|ИЗ
		|	ВТДанныеДокументаПредварительная КАК ДанныеДокумента
		|";
		
	КонецЕсли;

	ТекстЗапросаВременнаяТаблица = ТекстЗапросаВременнаяТаблица + "
	|ИНДЕКСИРОВАТЬ ПО
	|	ГоловнаяОрганизация";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТОрганизацииДокумента", ТекстЗапросаВременнаяТаблица);
	
	ТекстЗапросаВременнаяТаблица =
	"ВЫБРАТЬ
	|	АналитикиДокумента.Организация КАК Организация,
	|	АналитикиДокумента.ГоловнаяОрганизация КАК ГоловнаяОрганизация,
	|	АналитикиДокумента.Период КАК Период,
	|	МАКСИМУМ(УчетныеПолитики.Период) КАК ПериодПолитики,
	|	МАКСИМУМ(НастройкиСистемыНалогообложения.Период) КАК ПериодНастройки
	|ПОМЕСТИТЬ ВТПериодыУчетныхПолитикОрганизаций
	|ИЗ
	|	ВТОрганизацииДокумента КАК АналитикиДокумента
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаФинансовогоУчета КАК УчетныеПолитики
	|			ПО АналитикиДокумента.ГоловнаяОрганизация = УчетныеПолитики.Организация
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.НастройкиСистемыНалогообложения КАК НастройкиСистемыНалогообложения
	|			ПО АналитикиДокумента.ГоловнаяОрганизация = НастройкиСистемыНалогообложения.Организация
	|ГДЕ
	|	УчетныеПолитики.Период <= КОНЕЦПЕРИОДА(АналитикиДокумента.Период, МЕСЯЦ)
	|
	|СГРУППИРОВАТЬ ПО
	|	АналитикиДокумента.Организация,
	|	АналитикиДокумента.ГоловнаяОрганизация,
	|	АналитикиДокумента.Период
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ПериодПолитики,
	|	ГоловнаяОрганизация
	|";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТПериодыУчетныхПолитикОрганизаций", ТекстЗапросаВременнаяТаблица);
	
	ТекстЗапросаВременнаяТаблица =
	"ВЫБРАТЬ
	|	Т.Организация КАК Организация,
	|	Т.Период КАК Период,
	|	ЕСТЬNULL(УчетныеПолитики.МетодОценкиСтоимостиТоваров, НЕОПРЕДЕЛЕНО) КАК МетодОценкиСтоимостиТоваров,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(УчетныеПолитики.МетодОценкиСтоимостиТоваров, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.ФИФОСкользящаяОценка)
	|			ТОГДА ИСТИНА
	|			ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ФИФОСкользящаяОценка,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(УчетныеПолитики.МетодОценкиСтоимостиТоваров, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|			ТОГДА ИСТИНА
	|			ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СреднескользящаяОценка,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(УчетныеПолитики.МетодОценкиСтоимостиТоваров, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.ФИФОСкользящаяОценка)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоФИФО)
	|		КОГДА ЕСТЬNULL(УчетныеПолитики.МетодОценкиСтоимостиТоваров, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.СредняяЗаМесяц)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоСреднейЗаМесяц)
	|		КОГДА ЕСТЬNULL(УчетныеПолитики.МетодОценкиСтоимостиТоваров, НЕОПРЕДЕЛЕНО) = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоСреднескользящей)
	|			ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК СпособОпределенияСебестоимости,
	|	ЕСТЬNULL(УчетныеПолитики.ДетализироватьОтклоненияПоНаправлениямДеятельности, ЛОЖЬ) КАК ДетализироватьОтклоненияПоНаправлениямДеятельности,
	|	ЕСТЬNULL(УчетныеПолитики.ДетализироватьОтклоненияПоПодразделениям, ЛОЖЬ) КАК ДетализироватьОтклоненияПоПодразделениям,
	|	ЕСТЬNULL(УчетныеПолитики.ДетализироватьОтклоненияПоСкладам, ЛОЖЬ) КАК ДетализироватьОтклоненияПоСкладам,
	|	ЕСТЬNULL(НастройкиСистемыНалогообложения.ПлательщикНДД, ЛОЖЬ) КАК ПлательщикНДД
	|ПОМЕСТИТЬ ВТУчетныеПолитикиОрганизаций
	|ИЗ
	|	ВТПериодыУчетныхПолитикОрганизаций КАК Т
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.УчетнаяПолитикаФинансовогоУчета КАК УчетныеПолитики
	|			ПО Т.ГоловнаяОрганизация = УчетныеПолитики.Организация
	|			И Т.ПериодПолитики = УчетныеПолитики.Период
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.НастройкиСистемыНалогообложения КАК НастройкиСистемыНалогообложения
	|			ПО Т.ГоловнаяОрганизация = НастройкиСистемыНалогообложения.Организация
	|			И Т.ПериодНастройки = НастройкиСистемыНалогообложения.Период
	|ИНДЕКСИРОВАТЬ ПО
	|	Организация";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТУчетныеПолитикиОрганизаций", ТекстЗапросаВременнаяТаблица);
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаРазделУчета(ПараметрыОтражения)
	
	ТекстЗапросаВременнаяТаблица =
	"ВЫБРАТЬ
	|	ДанныеДокумента.НомерЗаписи КАК НомерЗаписи,
	// Раздел учета
	|	ВЫБОР
	|		КОГДА НЕ ДанныеДокумента.ЕстьПолеЗапроса_ВидЗапасов
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ

	// Новый учет товаров, полученных от давальца
	|		КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца),
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|			ТОГДА 
	|				ВЫБОР
	//					Особенность документа ОтчетОСписанииТоваровСХранения - делает списание с раздела учета ...КОформлениюСписания
	|					КОГДА ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы)
	|					  И ДанныеДокумента.ХозяйственнаяОперация В(
	|							ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаЗаСчетДавальца),
	|							ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеТоваровДавальцаНаРасходы))
	|						ТОГДА
	|							ВЫБОР
	|								КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|									ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуКОформлениюСписания)
	|									ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранениеКОформлениюСписания)
	|							КОНЕЦ
	//					На складе или в подразделении
	|					КОГДА ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Склад)
	|						ИЛИ ДанныеДокумента.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|						ТОГДА
	|							ВЫБОР КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|								ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	|								ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
	|							КОНЕЦ
	//					Передача давальческих товаров переработчику 2.5 (субпереработка)
	|					КОГДА ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора, Неопределено) = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5)
	|						ТОГДА
	|							ВЫБОР КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|								ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуПереданныеПартнерам)
	|								ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранениеПереданныеПартнерам)
	|							КОНЕЦ
	|				КОНЕЦ
	//-- НЕ УТ
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора, Неопределено) В (ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПокупателем),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.РеализацияЧерезКомиссионера))
	|			И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора, Неопределено) = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.РеализацияЧерезКомиссионера)
	|			И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
	//		Реализация без перехода права собственности имеет тип договора - реализация, но в аналитике указан договор
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора, Неопределено) = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПокупателем)
	|			И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора, Неопределено) = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СКомиссионером)
	|			И ДанныеДокумента.ВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.СпрКлючиНоменклатурыДоговорТипДоговора, Неопределено) = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СКомиссионером)
	|			И ДанныеДокумента.ВидЗапасов <> ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	//		Как правило это ТипЗапасов = КомиссионныйТовар
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК Расчетное_РазделУчета,
	|
	// Кор. раздел учета
	|	ВЫБОР
	|		КОГДА НЕ ДанныеДокумента.ЕстьПолеЗапроса_КорВидЗапасов
	|			ТОГДА НЕОПРЕДЕЛЕНО
	//++ НЕ УТ

	// Новый учет товаров, полученных от давальца
	//		Особенность документа ВыкупПринятыхНаХранениеТоваров:
	//		- расходное движения делается операцией списания на другие партии
	//		- приходное - внешним поступлением
	//		- для ПолуфабрикатДавальца может быть балансовая стоимость, которая должна отнестись на приходное движение,
	//		  поэтому нужен кор. раздел учета в расходе (определяется по тем же правилам, что и раздел учета в приходе - уже по собственным товарам)
	//		- для других давальческих товаров связывать расходное и приходное движение не нужно
	|		КОГДА ДанныеДокумента.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии)
	|			И ДанныеДокумента.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыкупТоваровДавальца)
	|			ТОГДА ВЫБОР
	|				КОГДА ДанныеДокумента.ВидЗапасовТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),
	|					ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяСсылка)
	|				ИНАЧЕ НЕОПРЕДЕЛЕНО
	|				КОНЕЦ
	|		КОГДА ДанныеДокумента.КорВидЗапасовТипЗапасов В (ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца),
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПолуфабрикатДавальца),
	|			ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПродукцияДавальца))
	|		ТОГДА ВЫБОР
	//			На складе или в подразделении
	|			КОГДА ДанныеДокумента.КорАналитикаУчетаНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Склад)
	|				ИЛИ ДанныеДокумента.КорАналитикаУчетаНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА ВЫБОР
	|				КОГДА ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработку)
	|				ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранение)
	|				КОНЕЦ
	//			Передача давальческих товаров переработчику 2.5 (субпереработка)
	|			КОГДА ЕСТЬNULL(ДанныеДокумента.КорАналитикаДоговорТипДоговора, Неопределено) = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПереработчиком2_5)
	|			ТОГДА ВЫБОР
	|				КОГДА ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.МатериалДавальца)
	|				ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.МатериалыПринятыеВПереработкуПереданныеПартнерам)
	|				ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаОтветхранениеПереданныеПартнерам)
	|				КОНЕЦ
	|			КОНЕЦ
	//-- НЕ УТ
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.КорАналитикаДоговорТипДоговора, Неопределено) В (ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПокупателем),
	|				ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.РеализацияЧерезКомиссионера))
	|			И ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.КомиссионныйТовар)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссиюВПути)
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.КорАналитикаДоговорТипДоговора, Неопределено) = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.РеализацияЧерезКомиссионера)
	|			И ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссиюВПути)
	//		Реализация без перехода права собственности имеет тип договора - реализация, но в аналитике указан договор
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.КорАналитикаДоговорТипДоговора, Неопределено) = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СПокупателем)
	|			И ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыВПути)
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.КорАналитикаДоговорТипДоговора, Неопределено) = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СКомиссионером)
	|			И ДанныеДокумента.КорВидЗапасовТипЗапасов = ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.Товар)
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПереданныеНаКомиссию)
	|		КОГДА ЕСТЬNULL(ДанныеДокумента.КорАналитикаДоговорТипДоговора, Неопределено) = ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.СКомиссионером)
	|			И ДанныеДокумента.КорВидЗапасов <> ЗНАЧЕНИЕ(Справочник.ВидыЗапасов.ПустаяСсылка)
	//		Как правило это ТипЗапасов = КомиссионныйТовар
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ТоварыПринятыеНаКомиссию)
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК Расчетное_КорРазделУчета
	|ПОМЕСТИТЬ ВТРазделыУчета
	|ИЗ
	|	ВТДанныеДокументаПредварительная КАК ДанныеДокумента
	|";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТРазделыУчета", ТекстЗапросаВременнаяТаблица);
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаНастроекПризнанияНДД(ПараметрыОтражения)
	
	ТекстЗапросаВременнаяТаблица = РасчетСебестоимостиЛокализация.ТекстЗапросаНастроекНДД(
			"ВТДанныеДокументаПредварительная", 
			"РасчетСебестоимостиПроведениеДокументов_ДобавитьТекстЗапросаНастроекПризнанияНДД");
	
	Запрос = ПараметрыОтражения.Запрос; //Запрос
	
	Если НЕ Запрос.Параметры.Свойство("Организация") Тогда
		
		ТекстЗапросаВременнаяТаблица = СтрЗаменить(ТекстЗапросаВременнаяТаблица,
			"&Организация",
			"ВЫБРАТЬ ВТОрганизацииДокумента.Организация ИЗ ВТОрганизацииДокумента КАК ВТОрганизацииДокумента");
		
	КонецЕсли;
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("НастройкиПризнанияРасходовНДД", ТекстЗапросаВременнаяТаблица);
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаФормированияДвижений(ПараметрыОтражения)
	
	ИмяРегистра = ПараметрыОтражения.ИмяРегистра;
	ВидыОперацийДокумента = ПараметрыОтражения.РегистрыДляОтражения[ИмяРегистра].ВидыОперацийДокумента;
	ОписаниеРегистра = РасчетСебестоимостиПовтИсп.СформироватьОписаниеРегистра("РегистрНакопления." + ИмяРегистра);
	СуммовыеПоля = Новый Структура(СтрЗаменить(ОписаниеРегистра.ПоляОтбораНепустыхДвижений, "%1", ""));
	
	КолонкиЗапроса = Новый Структура;
	МассивКолонокЗапроса = Новый Массив;
	КолонкиОпераций = Новый Соответствие;
	
	// Заполним перечень всех колонок всех операций себестоимости
	Для Каждого ТекущаяОперацияДокумента Из ВидыОперацийДокумента Цикл
		
		КолонкиТекущейОперации = Новый Структура;
		
		ИмяВременнойТаблицы = "ВТОперация_" + ОбщегоНазначения.ИмяЗначенияПеречисления(ТекущаяОперацияДокумента.Ключ);
		ТекстЗапроса = ПараметрыОтражения.ТекстыШаблоновВТ[ИмяВременнойТаблицы];
		
		Колонки = РасчетСебестоимостиПовтИсп.КолонкиЗапроса(ТекстЗапроса);
		
		Для Каждого ТекущаяКолонка Из Колонки Цикл
			
			КолонкиТекущейОперации.Вставить(ТекущаяКолонка);
			
			Если НЕ КолонкиЗапроса.Свойство(ТекущаяКолонка) Тогда
				КолонкиЗапроса.Вставить(ТекущаяКолонка);
				МассивКолонокЗапроса.Добавить(ТекущаяКолонка);
			КонецЕсли;
			
		КонецЦикла;
		
		КолонкиОпераций.Вставить(ТекущаяОперацияДокумента.Ключ, КолонкиТекущейОперации);
		
	КонецЦикла;
	
	ОтсутствующиеСуммовыеПоля = Новый Структура;
	
	Если ПараметрыОтражения.ИспользуетсяСреднескользящая Тогда
	
		ВозможныеСуммовыеПоля = Новый Структура(СуммовыеПоляСреднескользящей());
		Для Каждого КлючИЗначение Из ВозможныеСуммовыеПоля Цикл
			Если НЕ КолонкиЗапроса.Свойство(КлючИЗначение.Ключ) Тогда
				ОтсутствующиеСуммовыеПоля.Вставить(КлючИЗначение.Ключ);
			КонецЕсли;
		КонецЦикла;
		
	КонецЕсли;
	
	ТекстЗапроса = "";
	
	Для Каждого ТекущаяОперацияДокумента Из ВидыОперацийДокумента Цикл
		
		ТекстПоля = "";
		КолонкиТекущейОперации = КолонкиОпераций[ТекущаяОперацияДокумента.Ключ];
		
		Для Каждого ТекущаяКолонка Из МассивКолонокЗапроса Цикл
			
			Если КолонкиТекущейОперации.Свойство(ТекущаяКолонка) Тогда
				
				ТекстПоля = ТекстПоля + ?(ТекстПоля = "", "", ",") + "
					|	Т." + ТекущаяКолонка + " КАК " + ТекущаяКолонка;
				
			Иначе
				
				Если СуммовыеПоля.Свойство(ТекущаяКолонка) Тогда
					ТекстПоля = ТекстПоля + ?(ТекстПоля = "", "", ",") + "
						|	0 КАК " + ТекущаяКолонка;
				Иначе
					ТекстПоля = ТекстПоля + ?(ТекстПоля = "", "", ",") + "
						|	НЕОПРЕДЕЛЕНО КАК " + ТекущаяКолонка;
				КонецЕсли;
				
			КонецЕсли;
			
		КонецЦикла;

		Если ПараметрыОтражения.ИспользуетсяСреднескользящая Тогда
			
			Для Каждого КлючИЗначение Из ОтсутствующиеСуммовыеПоля Цикл
				ТекстПоля = ТекстПоля + ?(ТекстПоля = "", "", ",") + "
					|	0 КАК " + КлючИЗначение.Ключ;
			КонецЦикла;

			ТекстПоля = ТекстПоля + ?(ТекстПоля = "", "", ",") + "
				|	&ТекущаяДатаСеанса КАК ДатаОпределенияСебестоимости";
			
		КонецЕсли;
		
		Если ПараметрыОтражения.ИспользуетсяСреднескользящая И ТекстЗапроса = "" Тогда
			ШаблонТекстаЗапроса = 
			"ВЫБРАТЬ
			|	&ПоляЗапроса
			|ПОМЕСТИТЬ ВТОперацииДокумента 
			|ИЗ
			|	#ИмяВременнойТаблицы КАК Т";
		Иначе
			
			ШаблонТекстаЗапроса = 
			"ВЫБРАТЬ
			|	&ПоляЗапроса
			|ИЗ
			|	#ИмяВременнойТаблицы КАК Т";
			
		КонецЕсли;
		
		ИмяВременнойТаблицы = "ВТОперация_" + ОбщегоНазначения.ИмяЗначенияПеречисления(ТекущаяОперацияДокумента.Ключ);
		
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "#ИмяВременнойТаблицы", ИмяВременнойТаблицы);
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&ПоляЗапроса", СокрЛП(ТекстПоля));
			
		ТекстЗапроса = ТекстЗапроса
			+ ?(ТекстЗапроса = "", "", "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|")
			+ ШаблонТекстаЗапроса;
		
	КонецЦикла;
	
	Если ПараметрыОтражения.ИспользуетсяСреднескользящая Тогда
		
		Для Каждого КлючИЗначение Из ОтсутствующиеСуммовыеПоля Цикл
			МассивКолонокЗапроса.Добавить(КлючИЗначение.Ключ);
			КолонкиЗапроса.Вставить(КлючИЗначение.Ключ);
		КонецЦикла;
		
		МассивКолонокЗапроса.Добавить("ДатаОпределенияСебестоимости");
		КолонкиЗапроса.Вставить("ДатаОпределенияСебестоимости");
		
		ПараметрыОтражения.Вставить("МассивКолонокЗапроса", МассивКолонокЗапроса); // все колонки запроса выборки данных и ВТОперацииДокумента
		ПараметрыОтражения.Вставить("КолонкиЗапроса", КолонкиЗапроса); // аналогично, но в виде структуры
		
		ТекстЗапроса = ТекстЗапроса + "
		|ИНДЕКСИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры";
		
		ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТОперацииДокумента", ТекстЗапроса);
		
	Иначе
		ПараметрыОтражения.ТекстыШаблоновОтражения.Вставить(ИмяРегистра, ТекстЗапроса);
	КонецЕсли;
	
КонецПроцедуры

Процедура УстановитьДополнительныеПараметрыЗапроса(ПараметрыОтражения)
	
	ПустаяДата = Дата(1,1,1);
	
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "ПартионныйУчетВерсии22", Истина);
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "ДатаПереходаНаПартионныйУчетВерсии22", ПустаяДата);
	
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "ВестиУправленческийУчетОрганизаций", Истина);
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "ДатаНачалаВеденияУправленческогоУчетаОрганизаций", ПустаяДата);
	
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "УчитыватьСебестоимостьТоваровПоНазначениям", Ложь);
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "ДатаВключенияОбособленногоУчетаСебестоимостиПоНазначениям", ПустаяДата);
	
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "ФормироватьВидыЗапасовПоГруппамФинансовогоУчета", Ложь);
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "ФормироватьВидыЗапасовПоСделкам", Ложь);
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "ФормироватьВидыЗапасовПоПодразделениямМенеджерам", Ложь);
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "АналитическийУчетПоГруппамПродукции", Ложь);
	
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "ИспользоватьУчетНДС", Ложь);
	
	//++ НЕ УТКА
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "ИспользоватьУчетПоНДД", Ложь);
	УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, "ДатаНачалаУчетаПоНДД", ПустаяДата);
	//-- НЕ УТКА
	
	// Установим значения прочих параметров
	ПараметрыОтражения.Запрос.УстановитьПараметр("ТекущаяДатаСеанса", ТекущаяДатаСеанса());
	ПараметрыОтражения.Запрос.УстановитьПараметр("НеКонтролироватьПоследовательность",
		РасчетСебестоимостиПовтИсп.ЗначенияТехнологическихПараметров().НеКонтролироватьПоследовательностьПриСреднескользящей);
	
КонецПроцедуры

Процедура УстановитьКонстантуПараметраЗапроса(ПараметрыОтражения, ИмяКонстанты, ЗначениеПоУмолчанию)
	
	ИмяПараметра = "Константа_" + ИмяКонстанты;
	
	Если Метаданные.Константы.Найти(ИмяКонстанты) = Неопределено Тогда
		ЗначениеКонстанты = ЗначениеПоУмолчанию;
	Иначе
		ЗначениеКонстанты = Константы[ИмяКонстанты].Получить();
	КонецЕсли;
	
	ПараметрыОтражения.Запрос.УстановитьПараметр(ИмяПараметра, ЗначениеКонстанты);
	
КонецПроцедуры
	
// Формирует текст запроса выбора кодов строк для аналитики учета партий.
// 
// Параметры:
//  ИмяДокумента - Строка - Имя документа
//  ИменаТабличныхЧастей - Строка - Имена табличных частей документа
//  ИмяРеквизитаАналитики - Строка - Имя реквизита аналитики учета номенклатуры
// 
// Возвращаемое значение:
//  Строка - Текст запроса
// 
Функция ТекстЗапросаКодыСтрокДляАналитикиУчетаПартий(ИмяДокумента, ИменаТабличныхЧастей, ИмяРеквизитаАналитики = "АналитикаУчетаНоменклатуры") Экспорт
	
	ШаблонЗапросаВыборки =
	"ВЫБРАТЬ
	|	&ИмяТабличнойЧасти КАК ИмяТабличнойЧасти,
	|	Т.ИмяРеквизитаАналитики.Номенклатура КАК Номенклатура,
	|	Т.ИмяРеквизитаАналитики.Характеристика КАК Характеристика,
	|	Т.ИмяРеквизитаАналитики.Серия КАК Серия,
	|	(ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА Т.ИмяРеквизитаАналитики.Назначение
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) КОНЕЦ) КАК Назначение,
	|	Т.ИмяРеквизитаАналитики.МестоХранения КАК МестоХранения,
	|	МАКСИМУМ(Т.НомерСтроки) КАК НомерСтроки, // Номер строки для однотипной аналитики
	|	СУММА(1) КАК КоличествоСтрок
	|ПОМЕСТИТЬ ВТНоменклатураДокумента
	|ИЗ
	|	ИмяТаблицыДокумента КАК Т
	|ГДЕ
	|	Т.Ссылка = &Ссылка
	|СГРУППИРОВАТЬ ПО
	|	Т.ИмяРеквизитаАналитики.Номенклатура,
	|	Т.ИмяРеквизитаАналитики.Характеристика,
	|	Т.ИмяРеквизитаАналитики.Серия,
	|	(ВЫБОР
	|		КОГДА &УчитыватьСебестоимостьТоваровПоНазначениям
	|			ТОГДА Т.ИмяРеквизитаАналитики.Назначение
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка) КОНЕЦ),
	|	Т.ИмяРеквизитаАналитики.МестоХранения
	|";
	
	ШаблонЗапросаВыборки = СтрЗаменить(ШаблонЗапросаВыборки, "ИмяРеквизитаАналитики", ИмяРеквизитаАналитики);
	
	ТекстЗапросаВыборкиСводно = "
	|ВЫБРАТЬ
	|	Т.ИмяТабличнойЧасти КАК ИмяТабличнойЧасти,
	|	Т.Номенклатура КАК Номенклатура,
	|	Т.Характеристика КАК Характеристика,
	|	СУММА(Т.КоличествоСтрок) КАК КоличествоСтрок
	|ПОМЕСТИТЬ ВТНоменклатураДокументаСводно
	|ИЗ
	|	ВТНоменклатураДокумента КАК Т
	|СГРУППИРОВАТЬ ПО
	|	Т.ИмяТабличнойЧасти,
	|	Т.Номенклатура,
	|	Т.Характеристика
	|";
	
	// Поле КодСтроки заполняется, если в документе более одной строки с одинаковой номенклатурой и характеристикой,
	// но разными сериями, назначениями или местами хранения.
	// Для всех строк с одинаковой номенклатурой, характеристикой, серией, складом и назначением заполняется один
	// общий код строки для формирования одной общей партии для всех таких строк.
	// Проверка заполнения кода строки в аналитики учета партий выполняется в процедуре ИсправитьПроблемыВДвиженияхИДокументах()
	// общего модуля РасчетСебестоимостиПодготовкаДанных.
	// Это используется для формирования отдельный партий через ключи аналитики учета номенклатуры.
	// Выделение отдельных партий необходимо для получения корректных данных из регистра "Детализация себестоимости партий товаров". 
	ШаблонЗапросаРезультата = "
	|ВЫБРАТЬ
	|	&ИмяТабличнойЧасти КАК ИмяТабличнойЧасти,
	|	Т.НомерСтроки КАК НомерСтроки,
	|	ВЫБОР КОГДА Итоги.КоличествоСтрок > 1
	|	 И Итоги.КоличествоСтрок <> ИтогиДетально.КоличествоСтрок
	|		ТОГДА ИтогиДетально.НомерСтроки
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК КодСтроки
	|ПОМЕСТИТЬ ВТКодыСтрокДляАналитикиУчетаПартий
	|ИЗ
	|	ИмяТаблицыДокумента КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТНоменклатураДокументаСводно КАК Итоги
	|		ПО Т.ИмяРеквизитаАналитики.Номенклатура = Итоги.Номенклатура
	|		И Т.ИмяРеквизитаАналитики.Характеристика = Итоги.Характеристика
	|		И Итоги.ИмяТабличнойЧасти = &ИмяТабличнойЧасти
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТНоменклатураДокумента КАК ИтогиДетально
	|		ПО Т.ИмяРеквизитаАналитики.Номенклатура = ИтогиДетально.Номенклатура
	|		И Т.ИмяРеквизитаАналитики.Характеристика = ИтогиДетально.Характеристика
	|		И Т.ИмяРеквизитаАналитики.Серия = ИтогиДетально.Серия
	|		И (Т.ИмяРеквизитаАналитики.Назначение = ИтогиДетально.Назначение
	|			ИЛИ НЕ &УчитыватьСебестоимостьТоваровПоНазначениям)
	|		И Т.ИмяРеквизитаАналитики.МестоХранения = ИтогиДетально.МестоХранения
	|		И ИтогиДетально.ИмяТабличнойЧасти = &ИмяТабличнойЧасти
	|ГДЕ
	|	Т.Ссылка = &Ссылка
	|";
	
	ШаблонЗапросаРезультата = СтрЗаменить(ШаблонЗапросаРезультата, "ИмяРеквизитаАналитики", ИмяРеквизитаАналитики);
	
	СтруктураТабличныеЧасти = Новый Структура(ИменаТабличныхЧастей);
	ТекстЗапросаВыборки = "";
	ТекстЗапросаРезультата = "";
	
	Для Каждого КлючИЗначение Из СтруктураТабличныеЧасти Цикл
		
		ИмяТаблицы = КлючИЗначение.Ключ;
		ПолноеИмяТаблицы = Метаданные.Документы[ИмяДокумента].ПолноеИмя() + "." + ИмяТаблицы;
		
		ТекстПодзапроса = СтрЗаменить(ШаблонЗапросаВыборки, "&ИмяТабличнойЧасти", """" + ИмяТаблицы + """");
		ТекстПодзапроса = СтрЗаменить(ТекстПодзапроса, "ИмяТаблицыДокумента", ПолноеИмяТаблицы);
		
		Если ЗначениеЗаполнено(ТекстЗапросаВыборки) Тогда
			ТекстПодзапроса = СтрЗаменить(ТекстПодзапроса, "ПОМЕСТИТЬ ВТНоменклатураДокумента", "");
			ТекстЗапросаВыборки = ТекстЗапросаВыборки + "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|";
		КонецЕсли;
		
		ТекстЗапросаВыборки = ТекстЗапросаВыборки + ТекстПодзапроса;
		
		ТекстПодзапроса = СтрЗаменить(ШаблонЗапросаРезультата, "&ИмяТабличнойЧасти", """" + ИмяТаблицы + """");
		ТекстПодзапроса = СтрЗаменить(ТекстПодзапроса, "ИмяТаблицыДокумента", ПолноеИмяТаблицы);
		
		Если ЗначениеЗаполнено(ТекстЗапросаРезультата) Тогда
			ТекстПодзапроса = СтрЗаменить(ТекстПодзапроса, "ПОМЕСТИТЬ ВТКодыСтрокДляАналитикиУчетаПартий", "");
			ТекстЗапросаРезультата = ТекстЗапросаРезультата + "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|";
		КонецЕсли;
		
		ТекстЗапросаРезультата = ТекстЗапросаРезультата + ТекстПодзапроса;
		
	КонецЦикла;
	
	ТекстЗапроса = ТекстЗапросаВыборки + "
		|;
		|" + ТекстЗапросаВыборкиСводно + "
		|;
		|" + ТекстЗапросаРезультата + "
		|;
		|
		|";
	
	Возврат ТекстЗапроса;
	
КонецФункции

Процедура ЗаполнитьТекстыПолейПоРегистру(ОписаниеРегистра, ПараметрыОтражения)
	
	НесуммируемыеПоля = Новый Массив;
	НесуммируемыеПоля.Добавить("КодСтроки");
	
	МассивПолейИнициализацииЗапроса = Новый Массив;
	МассивПолейВыборкиЧисловые = Новый Массив;
	МассивПолейВыборкиНеЧисловые = Новый Массив;
	МассивТипизированныхПолей = Новый Массив;
	
	МассивПолейВыборкиНеЧисловые.Добавить("Т.НомерОперации КАК НомерОперации");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.ОперацияУчетаСебестоимости КАК ОперацияУчетаСебестоимости");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.ХозяйственнаяОперацияДокумента КАК ХозяйственнаяОперацияДокумента");
	// Поля из таблицы ДанныеДокумента
	МассивПолейВыборкиНеЧисловые.Добавить("Т.ВидЗапасовТипЗапасов КАК ВидЗапасовТипЗапасов");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.ВидЗапасовВладелецТовара КАК ВидЗапасовВладелецТовара");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.КорАналитикаДоговорТипДоговора КАК КорАналитикаДоговорТипДоговора");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.КорАналитикаУчетаНоменклатурыСкладскаяТерриторияЦеховаяКладовая КАК КорАналитикаУчетаНоменклатурыСкладскаяТерриторияЦеховаяКладовая");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.КорАналитикаУчетаНоменклатурыТипМестаХранения КАК КорАналитикаУчетаНоменклатурыТипМестаХранения");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.КорВидЗапасовТипЗапасов КАК КорВидЗапасовТипЗапасов");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.КорВидЗапасовВладелецТовара КАК КорВидЗапасовВладелецТовара");
	// Поля из аналитики номенклатуры
	МассивПолейВыборкиНеЧисловые.Добавить("Т.АналитикаУчетаНоменклатурыНазначениеНаправлениеДеятельности КАК АналитикаУчетаНоменклатурыНазначениеНаправлениеДеятельности");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.СпрКлючиНоменклатурыДоговорТипДоговора КАК СпрКлючиНоменклатурыДоговорТипДоговора");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая КАК СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.СпрКлючиНоменклатурыТипМестаХранения КАК СпрКлючиНоменклатурыТипМестаХранения");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.СпрНоменклатураТипНоменклатуры КАК СпрНоменклатураТипНоменклатуры");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.АналитикаУчетаНоменклатурыНоменклатура КАК АналитикаУчетаНоменклатурыНоменклатура");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.АналитикаУчетаНоменклатурыХарактеристика КАК АналитикаУчетаНоменклатурыХарактеристика");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.АналитикаУчетаНоменклатурыМестоХранения КАК АналитикаУчетаНоменклатурыМестоХранения");
	МассивПолейВыборкиНеЧисловые.Добавить("Т.СпрНоменклатураПрослеживаемыйТовар КАК СпрНоменклатураПрослеживаемыйТовар");
	
	МассивТипизированныхПолей.Добавить("Т.НомерОперации КАК НомерОперации");
	МассивТипизированныхПолей.Добавить("Т.ОперацияУчетаСебестоимости КАК ОперацияУчетаСебестоимости");
	
	Для Каждого ОписаниеПоля Из ОписаниеРегистра.ТаблицаПолей Цикл
		
		ТекстПоля = "Т." + ОписаниеПоля.Имя + " КАК " + ОписаниеПоля.Имя;
		Если ОписаниеРегистра.ПоляРегистра.Свойство(ОписаниеПоля.Имя) Тогда
			МассивПолейИнициализацииЗапроса.Добавить(ТекстПоля);
		Иначе
			МассивПолейИнициализацииЗапроса.Добавить("НЕОПРЕДЕЛЕНО" + " КАК " + ОписаниеПоля.Имя);
		КонецЕсли;
		
		МассивПолейИнициализацииЗапроса.Добавить("ЛОЖЬ КАК ЕстьПолеЗапроса_" + ОписаниеПоля.Имя);
		
		Если ОписаниеПоля.Тип.Типы().Количество() = 1 И ОписаниеПоля.Тип.Типы()[0] = Тип("Число") И НесуммируемыеПоля.Найти(ОписаниеПоля.Имя) = Неопределено Тогда
			МассивПолейВыборкиЧисловые.Добавить(ТекстПоля);
		Иначе
			МассивПолейВыборкиНеЧисловые.Добавить(ТекстПоля);
		КонецЕсли;
		
		ТекстТипизированногоПоля = ТекстТипизированногоПоля(ОписаниеПоля.Имя, ОписаниеПоля.Тип);
		ТекстТипизированногоПоля = ?(ТекстТипизированногоПоля = Неопределено, ТекстПоля, ТекстТипизированногоПоля);
		МассивТипизированныхПолей.Добавить(ТекстТипизированногоПоля);
		
		МассивТипизированныхПолей.Добавить("Т.ЕстьПолеЗапроса_" + ОписаниеПоля.Имя + " КАК ЕстьПолеЗапроса_" + ОписаниеПоля.Имя);
		МассивПолейВыборкиНеЧисловые.Добавить("Т.ЕстьПолеЗапроса_" + ОписаниеПоля.Имя + " КАК ЕстьПолеЗапроса_" + ОписаниеПоля.Имя);
		
	КонецЦикла;
	
	МассивПолейИнициализацииЗапроса.Добавить("0 КАК НомерОперации");
	МассивПолейИнициализацииЗапроса.Добавить("ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ПустаяСсылка) КАК ОперацияУчетаСебестоимости");
	
	// Дополнительные поля
	Если ПараметрыОтражения.МетаданныеДокумента.Реквизиты.Найти("ХозяйственнаяОперация") <> Неопределено Тогда
		МассивТипизированныхПолей.Добавить("ВЫРАЗИТЬ(Т.Ссылка КАК Документ." + ПараметрыОтражения.МетаданныеДокумента.Имя + ").ХозяйственнаяОперация КАК ХозяйственнаяОперацияДокумента");
	Иначе
		МассивТипизированныхПолей.Добавить("Т.ХозяйственнаяОперация КАК ХозяйственнаяОперацияДокумента");
	КонецЕсли;
	
	ОписаниеРегистра.Вставить("ТекстПолейИнициализацииЗапроса", СтрСоединить(МассивПолейИнициализацииЗапроса, "," + Символы.ПС + Символы.Таб));
	ОписаниеРегистра.Вставить("ТекстПоляТипизированные", СтрСоединить(МассивТипизированныхПолей, "," + Символы.ПС + Символы.Таб));
	ОписаниеРегистра.Вставить("ТекстПоляОсновнойВыборки", СтрСоединить(МассивПолейВыборкиНеЧисловые, "," + Символы.ПС + Символы.Таб));
	ОписаниеРегистра.Вставить("ТекстПоляВыборкиЧисловые", СтрСоединить(МассивПолейВыборкиЧисловые, "," + Символы.ПС + Символы.Таб));
	
КонецПроцедуры

Функция ТекстЗапросаВТДанныеДокументаПредварительная(ИмяРегистра, ОписаниеРегистра)
	
	ТекстЗапроса = "";
	
	// Соберем схему запроса объединения выборки данных.
	СхемаЗапроса = Новый СхемаЗапроса;
	
	ТекстЗапроса = 
	"ВЫБРАТЬ ПЕРВЫЕ 0
	|	&ПоляЗапроса
	|ИЗ
	|	#ИмяРегистра КАК Т";
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "#ИмяРегистра", "РегистрНакопления" + "." + ИмяРегистра);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляЗапроса", ОписаниеРегистра.ТекстПолейИнициализацииЗапроса);
	
	СхемаЗапроса.УстановитьТекстЗапроса(ТекстЗапроса);
	
	ТекущийЗапросПакета = СхемаЗапроса.ПакетЗапросов.Получить(0); //ЗапросВыбораСхемыЗапроса
	ОператорыЗапроса  = ТекущийЗапросПакета.Операторы;
	КолонкиЗапроса    = ТекущийЗапросПакета.Колонки;
	КоличествоКолонок = ТекущийЗапросПакета.Колонки.Количество();
	
	НомерЗапроса = 0;
	
	Для Каждого ОписаниеСхемы Из ОписаниеРегистра.СхемыЗапросовДокумента Цикл
		
		НомерЗапроса = НомерЗапроса + 1;
		
		ПакетЗапросов = ОписаниеСхемы.СхемаЗапроса.ПакетЗапросов; // ПакетЗапросовСхемыЗапроса
		ТекущийЗапросПакета = ПакетЗапросов.Получить(0); //ЗапросВыбораСхемыЗапроса
		ОператорПодзапроса = ТекущийЗапросПакета.Операторы[0];
		КолонкиПодзапроса  = ТекущийЗапросПакета.Колонки;
		
		ТекущийОператор = ОператорыЗапроса.Добавить(ОператорПодзапроса);
		ТекущийОператор.ВыбираемыеПоля.Очистить();
		
		НомерКолонки = 0;
		
		Для Каждого ОписаниеПоля Из ОписаниеРегистра.ТаблицаПолей Цикл
			
			КолонкаПодзапроса = КолонкиПодзапроса.Найти(ОписаниеПоля.Имя);
			
			// Значение текущего поля
			Если КолонкаПодзапроса <> Неопределено Тогда
				КолонкиЗапроса.Получить(НомерКолонки).Поля.Установить(НомерЗапроса, КолонкаПодзапроса.Поля[0]);
			Иначе
				ТекущийОператор.ВыбираемыеПоля.Добавить("НЕОПРЕДЕЛЕНО", НомерКолонки);
			КонецЕсли;
			
			НомерКолонки = НомерКолонки + 1;
			// Значение поля "ЕстьПолеЗапроса_<текущее поле>"
			ТекущийОператор.ВыбираемыеПоля.Добавить(?(КолонкаПодзапроса = Неопределено, "ЛОЖЬ", "ИСТИНА"), НомерКолонки);
			НомерКолонки = НомерКолонки + 1;
			
		КонецЦикла;
		
		ТекущийОператор.ВыбираемыеПоля.Добавить(СокрЛП(НомерЗапроса), НомерКолонки);
		
		НомерКолонки = НомерКолонки + 1;
		ТекущийОператор.ВыбираемыеПоля.Добавить("ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости." + ОбщегоНазначения.ИмяЗначенияПеречисления(ОписаниеСхемы.ВидОперации) + ")", НомерКолонки);
		
	КонецЦикла;
	
	Пока КолонкиЗапроса.Количество() > КоличествоКолонок Цикл
		КолонкиЗапроса.Удалить(КолонкиЗапроса.Количество() - 1);
	КонецЦикла;
	
	ТекстЗапроса = СхемаЗапроса.ПолучитьТекстЗапроса();
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "NULL,", "НЕОПРЕДЕЛЕНО,");
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "null,", "НЕОПРЕДЕЛЕНО,");
	
	ТекстЗапросаВременнаяТаблица =
		"ВЫБРАТЬ
		|	АВТОНОМЕРЗАПИСИ() КАК НомерЗаписи,
		// Поля из таблицы ДанныеДокумента
		|	ЕСТЬNULL(СпрВидыЗапасов.ТипЗапасов, ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПустаяСсылка)) КАК ВидЗапасовТипЗапасов,
		|	ЕСТЬNULL(СпрВидыЗапасов.ВладелецТовара, НЕОПРЕДЕЛЕНО) КАК ВидЗапасовВладелецТовара,
		|	ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.Договор.ТипДоговора, ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.ПустаяСсылка)) КАК КорАналитикаДоговорТипДоговора,
		|	ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.СкладскаяТерритория.ЦеховаяКладовая, ЛОЖЬ) КАК КорАналитикаУчетаНоменклатурыСкладскаяТерриторияЦеховаяКладовая,
		|	ЕСТЬNULL(Т.КорАналитикаУчетаНоменклатуры.ТипМестаХранения, ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ПустаяСсылка)) КАК КорАналитикаУчетаНоменклатурыТипМестаХранения,
		|	ЕСТЬNULL(КорСпрВидыЗапасов.ТипЗапасов, ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.ПустаяСсылка)) КАК КорВидЗапасовТипЗапасов,
		|	ЕСТЬNULL(КорСпрВидыЗапасов.ВладелецТовара, НЕОПРЕДЕЛЕНО) КАК КорВидЗапасовВладелецТовара,
		// Поля из аналитики номенклатуры
		|	ЕСТЬNULL(СпрКлючиНоменклатуры.Назначение.НаправлениеДеятельности, ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)) КАК АналитикаУчетаНоменклатурыНазначениеНаправлениеДеятельности,
		|	ЕСТЬNULL(СпрКлючиНоменклатуры.Договор.ТипДоговора, ЗНАЧЕНИЕ(Перечисление.ТипыДоговоров.ПустаяСсылка)) КАК СпрКлючиНоменклатурыДоговорТипДоговора,
		|	ЕСТЬNULL(СпрКлючиНоменклатуры.СкладскаяТерритория.ЦеховаяКладовая, ЛОЖЬ) КАК СпрКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая,
		|	ЕСТЬNULL(СпрКлючиНоменклатуры.ТипМестаХранения, ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ПустаяСсылка)) КАК СпрКлючиНоменклатурыТипМестаХранения,
		|	ЕСТЬNULL(СпрКлючиНоменклатуры.Номенклатура, ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка)) КАК АналитикаУчетаНоменклатурыНоменклатура,
		|	ЕСТЬNULL(СпрКлючиНоменклатуры.Характеристика, ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)) КАК АналитикаУчетаНоменклатурыХарактеристика,
		|	ЕСТЬNULL(СпрКлючиНоменклатуры.МестоХранения, Неопределено) КАК АналитикаУчетаНоменклатурыМестоХранения,
		|	ЕСТЬNULL(СпрНоменклатура.ТипНоменклатуры, ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.ПустаяСсылка)) КАК СпрНоменклатураТипНоменклатуры,
		|	ЕСТЬNULL(СпрНоменклатура.ПрослеживаемыйТовар, ЛОЖЬ) КАК СпрНоменклатураПрослеживаемыйТовар,
		|	&ТекстПоляТипизированные
		|ПОМЕСТИТЬ ВТДанныеДокументаПредварительная
		|ИЗ
		|	#ТекстЗапроса КАК Т
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК СпрКлючиНоменклатуры
		|		ПО СпрКлючиНоменклатуры.Ссылка = Т.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
		|		ПО СпрНоменклатура.Ссылка = СпрКлючиНоменклатуры.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК СпрВидыЗапасов
		|		ПО СпрВидыЗапасов.Ссылка = Т.ВидЗапасов
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК КорСпрВидыЗапасов
		|		ПО КорСпрВидыЗапасов.Ссылка = Т.КорВидЗапасов";
	
	ТекстЗапросаВременнаяТаблица = СтрЗаменить(ТекстЗапросаВременнаяТаблица, "&ТекстПоляТипизированные", СокрЛП(ОписаниеРегистра.ТекстПоляТипизированные));
	ТекстЗапросаВременнаяТаблица = СтрЗаменить(ТекстЗапросаВременнаяТаблица, "#ТекстЗапроса", "(" + ТекстЗапроса + ")");
	ТекстЗапросаВременнаяТаблица = ТекстЗапросаВременнаяТаблица + "
		|ИНДЕКСИРОВАТЬ ПО
		|	АналитикаУчетаНоменклатуры
		|";
	
	Возврат ТекстЗапросаВременнаяТаблица;
	
КонецФункции

Функция ТекстЗапросаВТДанныеДокумента(ОписаниеРегистра)
	
	ТекстЗапроса =
		"ВЫБРАТЬ
		|	&ТекстПоляВыборкиНеЧисловые,
		|
		// Поля из таблицы ВТЗаменаАналитикУчетаНоменклатуры
		|	ВТАналитикиНоменклатуры.АналитикаУчетаНоменклатуры КАК ВТАналитикиНоменклатурыАналитикаУчетаНоменклатуры,
		|	ВТАналитикиНоменклатуры.АналитикаУчетаНоменклатурыКомитента КАК ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыКомитента,
		|	ВТАналитикиНоменклатуры.АналитикаУчетаНоменклатурыИсходная КАК ВТАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная,
		|	ВТКорАналитикиНоменклатуры.АналитикаУчетаНоменклатуры КАК ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатуры,
		|	ВТКорАналитикиНоменклатуры.АналитикаУчетаНоменклатурыКомитента КАК ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыКомитента,
		|	ВТКорАналитикиНоменклатуры.АналитикаУчетаНоменклатурыИсходная КАК ВТКорАналитикиНоменклатурыАналитикаУчетаНоменклатурыИсходная,
		|	ВТАналитикиНоменклатуры.ТипНазначения КАК АналитикаУчетаНоменклатурыИсходнаяНазначениеТипНазначения,
		// Поля из кор. аналитики номенклатуры
		|	СпрКорКлючиНоменклатуры.СкладскаяТерритория.ЦеховаяКладовая КАК СпрКорКлючиНоменклатурыСкладскаяТерриторияЦеховаяКладовая,
		|	СпрКорКлючиНоменклатуры.ТипМестаХранения КАК СпрКорКлючиНоменклатурыТипМестаХранения,
		|	СпрКорНоменклатура.ТипНоменклатуры КАК СпрКорНоменклатураТипНоменклатуры,
		// Поля из организаций и учетных политик
		|	КорОрганизации.Ссылка  КАК КорОрганизацияСсылка,
		|	УчетныеПолитикиОрганизаций.МетодОценкиСтоимостиТоваров КАК УчетныеПолитикиМетодОценкиСтоимостиТоваров,
		|	УчетныеПолитикиОрганизаций.ФИФОСкользящаяОценка КАК УчетныеПолитикиФИФОСкользящаяОценка,
		|	УчетныеПолитикиОрганизаций.СреднескользящаяОценка КАК УчетныеПолитикиОрганизацийСреднескользящаяОценка,
		|	УчетныеПолитикиОрганизаций.СпособОпределенияСебестоимости КАК УчетныеПолитикиСпособОпределенияСебестоимости,
		|	УчетныеПолитикиОрганизаций.ПлательщикНДД КАК УчетныеПолитикиПлательщикНДД,
		|	УчетныеПолитикиОрганизаций.ДетализироватьОтклоненияПоНаправлениямДеятельности КАК УчетныеПолитикиДетализироватьОтклоненияПоНаправлениямДеятельности,
		|	УчетныеПолитикиОрганизаций.ДетализироватьОтклоненияПоПодразделениям КАК УчетныеПолитикиДетализироватьОтклоненияПоПодразделениям,
		|	УчетныеПолитикиОрганизаций.ДетализироватьОтклоненияПоСкладам КАК УчетныеПолитикиДетализироватьОтклоненияПоСкладам,
		|	КорУчетныеПолитикиОрганизаций.МетодОценкиСтоимостиТоваров КАК КорУчетныеПолитикиМетодОценкиСтоимостиТоваров,
		|	КорУчетныеПолитикиОрганизаций.ФИФОСкользящаяОценка КАК КорУчетныеПолитикиФИФОСкользящаяОценка,
		|	КорУчетныеПолитикиОрганизаций.СреднескользящаяОценка КАК КорУчетныеПолитикиОрганизацийСреднескользящаяОценка,
		|	КорУчетныеПолитикиОрганизаций.ПлательщикНДД КАК КорУчетныеПолитикиПлательщикНДД,
		// Разделы учета
		|	РазделыУчета.Расчетное_РазделУчета КАК Расчетное_РазделУчета,
		|	РазделыУчета.Расчетное_КорРазделУчета КАК Расчетное_КорРазделУчета,
		// Аналитики финансового учета
		|	ВТАналитикиФинансовогоУчета.АналитикаФинансовогоУчета КАК Расчетное_АналитикаФинансовогоУчета,
		|	ВТКорАналитикиФинансовогоУчета.АналитикаФинансовогоУчета КАК Расчетное_КорАналитикаФинансовогоУчета,
		|
		|	&ТекстПоляВыборкиЧисловые
		|ПОМЕСТИТЬ ВТДанныеДокумента
		|ИЗ
		|	#ДанныеДокумента КАК ДанныеДокумента
		// Аналитика номенклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТЗаменаАналитикУчетаНоменклатуры КАК ВТАналитикиНоменклатуры
		|		ПО ДанныеДокумента.АналитикаУчетаНоменклатуры = ВТАналитикиНоменклатуры.АналитикаУчетаНоменклатурыИсходная
		|		И ДанныеДокумента.ВидЗапасов = ВТАналитикиНоменклатуры.ВидЗапасов
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТАналитикиФинансовогоУчета КАК ВТАналитикиФинансовогоУчета
		|		ПО ДанныеДокумента.Сделка = ВТАналитикиФинансовогоУчета.Сделка
		|		И ДанныеДокумента.Менеджер = ВТАналитикиФинансовогоУчета.Менеджер
		|		И ДанныеДокумента.Подразделение = ВТАналитикиФинансовогоУчета.Подразделение
		|		И ДанныеДокумента.ГруппаПродукции = ВТАналитикиФинансовогоУчета.ГруппаПродукции
		|		И ДанныеДокумента.СпрНоменклатураТипНоменклатуры = ВТАналитикиФинансовогоУчета.ТипНоменклатуры
		// Кор. аналитика номенклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТЗаменаАналитикУчетаНоменклатуры КАК ВТКорАналитикиНоменклатуры
		|		ПО ДанныеДокумента.КорАналитикаУчетаНоменклатуры = ВТКорАналитикиНоменклатуры.АналитикаУчетаНоменклатурыИсходная
		|		И ДанныеДокумента.КорВидЗапасов = ВТКорАналитикиНоменклатуры.ВидЗапасов
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК СпрКорКлючиНоменклатуры
		|		ПО СпрКорКлючиНоменклатуры.Ссылка = ВТКорАналитикиНоменклатуры.АналитикаУчетаНоменклатуры
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрКорНоменклатура
		|		ПО СпрКорНоменклатура.Ссылка = СпрКорКлючиНоменклатуры.Номенклатура
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТАналитикиФинансовогоУчета КАК ВТКорАналитикиФинансовогоУчета
		|		ПО ДанныеДокумента.Сделка = ВТКорАналитикиФинансовогоУчета.Сделка
		|		И ДанныеДокумента.Менеджер = ВТКорАналитикиФинансовогоУчета.Менеджер
		|		И ДанныеДокумента.Подразделение = ВТКорАналитикиФинансовогоУчета.Подразделение
		|		И ДанныеДокумента.ГруппаПродукции = ВТКорАналитикиФинансовогоУчета.ГруппаПродукции
		|		И СпрКорНоменклатура.ТипНоменклатуры = ВТКорАналитикиФинансовогоУчета.ТипНоменклатуры
		// Организации и учетные политики
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации КАК КорОрганизации
		|		ПО ДанныеДокумента.КорОрганизация = КорОрганизации.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТУчетныеПолитикиОрганизаций КАК КорУчетныеПолитикиОрганизаций
		|		ПО ДанныеДокумента.КорОрганизация = КорУчетныеПолитикиОрганизаций.Организация
		|		И ДанныеДокумента.Период = КорУчетныеПолитикиОрганизаций.Период
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТУчетныеПолитикиОрганизаций КАК УчетныеПолитикиОрганизаций
		|		ПО ДанныеДокумента.Организация = УчетныеПолитикиОрганизаций.Организация
		|		И ДанныеДокумента.Период = УчетныеПолитикиОрганизаций.Период
		// Разделы учета
		|	ЛЕВОЕ СОЕДИНЕНИЕ ВТРазделыУчета КАК РазделыУчета
		|		ПО &УсловиеСоединениеСРазделамиУчета
		|";
	
	ТекстЗапроса = ТекстЗапроса + "
		|ИНДЕКСИРОВАТЬ ПО
		|	ОперацияУчетаСебестоимости,
		|	ХозяйственнаяОперация
		|";
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ТекстПоляВыборкиНеЧисловые", СокрЛП(ОписаниеРегистра.ТекстПоляОсновнойВыборки));
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ТекстПоляВыборкиЧисловые", СокрЛП(ОписаниеРегистра.ТекстПоляВыборкиЧисловые));
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "Т.", "ДанныеДокумента.");
	// При преобразовании таблицы #ДанныеДокумента механизмом проведения псевдоним таблицы ДанныеДокумента меняется на Т, но не в секции соединений
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеСоединениеСРазделамиУчета", "Т.НомерЗаписи = РазделыУчета.НомерЗаписи");
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаДанные(ОписаниеРегистра)
	
	ТекстЗапроса = "ВЫБРАТЬ
		|	&ТекстПоляОсновнойВыборки,
		|	&ТекстПоляВыборкиЧисловые
		|ИЗ
		|	ВТДанныеДокументаПредварительная КАК Т
		|";
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ТекстПоляОсновнойВыборки", СокрЛП(ОписаниеРегистра.ТекстПоляОсновнойВыборки));
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ТекстПоляВыборкиЧисловые", СокрЛП(ОписаниеРегистра.ТекстПоляВыборкиЧисловые));
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстТипизированногоПоля(ИмяПоля, ОписаниеТипаПоля)
	
	Текст = Неопределено;
	
	Если ОписаниеТипаПоля.Типы().Количество() <> 1 Тогда
		Возврат Текст;
	КонецЕсли;
	
	ПримитивныеТипы = Новый ОписаниеТипов("Булево, Дата, Число, Строка, УникальныйИдентификатор");
	ТипПоля = ОписаниеТипаПоля.Типы()[0];
	
	Если НЕ ПримитивныеТипы.СодержитТип(ТипПоля) Тогда
		
		МетаданныеДляТипа = Метаданные.НайтиПоТипу(ТипПоля);
		
		Если МетаданныеДляТипа <> Неопределено Тогда
			Текст = "ВЫБОР
				|		КОГДА ТИПЗНАЧЕНИЯ(Т." + ИмяПоля + ") = ТИП(" + МетаданныеДляТипа.ПолноеИмя() + ")
				|		ТОГДА Т." + ИмяПоля + "
				|		ИНАЧЕ ЗНАЧЕНИЕ(" + МетаданныеДляТипа.ПолноеИмя() + ".ПустаяСсылка)
				|	КОНЕЦ КАК " + ИмяПоля;
		КонецЕсли;
		
	Иначе
		
		Если ТипПоля = Тип("Дата") Тогда
			Текст = "ВЫРАЗИТЬ(ВЫБОР
				|		КОГДА ТИПЗНАЧЕНИЯ(Т." + ИмяПоля + ") = ТИП(ДАТА)
				|		ТОГДА Т." + ИмяПоля + "
				|		ИНАЧЕ ДАТАВРЕМЯ(1,1,1)
				|	КОНЕЦ КАК ДАТА) КАК " + ИмяПоля;
		ИначеЕсли ТипПоля = Тип("Число") Тогда
			
			Если ОписаниеТипаПоля.КвалификаторыЧисла.Разрядность = 0 Тогда
				ФорматЧисла = "31,3";
			Иначе
				ФорматЧисла = Формат(ОписаниеТипаПоля.КвалификаторыЧисла.Разрядность, "ЧН=0; ЧГ=") + ","
					+ Формат(ОписаниеТипаПоля.КвалификаторыЧисла.РазрядностьДробнойЧасти, "ЧН=0; ЧГ=");
			КонецЕсли;
			
			Текст = "ВЫРАЗИТЬ(ВЫБОР
				|		КОГДА ТИПЗНАЧЕНИЯ(Т." + ИмяПоля + ") = ТИП(ЧИСЛО)
				|		ТОГДА Т." + ИмяПоля + "
				|		ИНАЧЕ 0
				|	КОНЕЦ КАК ЧИСЛО (" + ФорматЧисла + ")) КАК " + ИмяПоля;
			
		ИначеЕсли ТипПоля = Тип("Булево") Тогда
			Текст = "ВЫБОР
				|		КОГДА ТИПЗНАЧЕНИЯ(Т." + ИмяПоля + ") = ТИП(БУЛЕВО)
				|		ТОГДА Т." + ИмяПоля + "
				|		ИНАЧЕ ЛОЖЬ
				|	КОНЕЦ КАК " + ИмяПоля;
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат Текст;
	
КонецФункции

#КонецОбласти

#Область ТекстыУчетПоСреднескользящей

Процедура ДобавитьТекстЗапросаРасчетСреднескользящаяСтоимость(ПараметрыОтражения)
	
	// Состав суммовых полей
	ВозможныеСуммовыеПоля = Новый Структура(СуммовыеПоляСреднескользящей());
	СуммовыеПоляСреднескользящей = Новый Структура;
	
	Для Каждого КлючИЗначение Из ВозможныеСуммовыеПоля Цикл
		Если ПараметрыОтражения.КолонкиЗапроса.Свойство(КлючИЗначение.Ключ) Тогда
			СуммовыеПоляСреднескользящей.Вставить(КлючИЗначение.Ключ);
		КонецЕсли;
	КонецЦикла;
	
	// Признаки, влияющие на состав пакета запросов
	ЕстьДокументИсточник = ПараметрыОтражения.КолонкиЗапроса.Свойство("ДокументИсточник");
	ЕстьКорНаправлениеДеятельности = ПараметрыОтражения.КолонкиЗапроса.Свойство("КорНаправлениеДеятельности");
	ЕстьНастройкаСчетовУчета = ПараметрыОтражения.КолонкиЗапроса.Свойство("НастройкаСчетовУчета");
	ЕстьСтатьяРасходовСписания = ПараметрыОтражения.КолонкиЗапроса.Свойство("СтатьяРасходовСписания");
	ЕстьСтатьяДоходов = ПараметрыОтражения.КолонкиЗапроса.Свойство("СтатьяДоходов");
	ЕстьСтатьяАктивовПассивов = ПараметрыОтражения.КолонкиЗапроса.Свойство("СтатьяАктивовПассивов");
	ЕстьАналитикаУчетаПоПартнерам = ПараметрыОтражения.КолонкиЗапроса.Свойство("АналитикаУчетаПоПартнерам");
	ЕстьЗаказКлиента = ПараметрыОтражения.КолонкиЗапроса.Свойство("ЗаказКлиента");
	ЕстьПодразделение = ПараметрыОтражения.КолонкиЗапроса.Свойство("Подразделение");
	ЕстьКорОрганизация = ПараметрыОтражения.КолонкиЗапроса.Свойство("КорОрганизация");
	
	ПараметрыОтражения.Вставить("ЕстьДокументИсточник", ЕстьДокументИсточник);
	ПараметрыОтражения.Вставить("ЕстьКорНаправлениеДеятельности", ЕстьКорНаправлениеДеятельности);
	ПараметрыОтражения.Вставить("ЕстьНастройкаСчетовУчета", ЕстьНастройкаСчетовУчета);
	ПараметрыОтражения.Вставить("ЕстьСтатьяРасходовСписания", ЕстьСтатьяРасходовСписания);
	ПараметрыОтражения.Вставить("ЕстьСтатьяДоходов", ЕстьСтатьяДоходов);
	ПараметрыОтражения.Вставить("ЕстьСтатьяАктивовПассивов", ЕстьСтатьяАктивовПассивов);
	ПараметрыОтражения.Вставить("ЕстьАналитикаУчетаПоПартнерам", ЕстьАналитикаУчетаПоПартнерам);
	ПараметрыОтражения.Вставить("ЕстьЗаказКлиента", ЕстьЗаказКлиента);
	ПараметрыОтражения.Вставить("ЕстьПодразделение", ЕстьПодразделение);
	ПараметрыОтражения.Вставить("ЕстьКорОрганизация", ЕстьКорОрганизация);
	
	ВидыОперацийДокумента = ПараметрыОтражения.РегистрыДляОтражения[ПараметрыОтражения.ИмяРегистра].ВидыОперацийДокумента; // Соответствие
	ЕстьВыбытияПоФиксированнойСтоимости =
		(ВидыОперацийДокумента.Получить(Перечисления.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости) <> Неопределено);
	ЕстьПеремещение =
		(ВидыОперацийДокумента.Получить(Перечисления.ОперацииУчетаСебестоимости.Перемещение) <> Неопределено);
	ЕстьСписаниеНаДругиеПартии =
		(ВидыОперацийДокумента.Получить(Перечисления.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии) <> Неопределено);
		
	ПараметрыОтражения.Вставить("ЕстьВыбытияПоФиксированнойСтоимости", ЕстьВыбытияПоФиксированнойСтоимости);
	ПараметрыОтражения.Вставить("ЕстьПеремещение", ЕстьПеремещение);
	ПараметрыОтражения.Вставить("ЕстьСписаниеНаДругиеПартии", ЕстьСписаниеНаДругиеПартии);
	
	#Область ШаблоныДляТекстовЗапросов
	
	// для &ПоляЗапросаПоСреднескользящейПоИсточнику
	// Поле &Знак принимает значения 1 для расчета среднескользящей стоимости выбытия, и -1 при расчете стоимости Сторно движений.
	ШаблонПоляСуммыПоСреднескользящейПоИсточнику = "
		|	ВЫРАЗИТЬ(
		|		&Знак * (ВЫБОР
		|			КОГДА ЕСТЬNULL(Источник.Количество, 0) = 0
		|				ТОГДА 0
		|			КОГДА Т.Количество = Источник.Количество
		|				ТОГДА Источник.ИмяПоляСуммы
		|			ИНАЧЕ ВЫРАЗИТЬ(Т.Количество * (Источник.ИмяПоляСуммы / Источник.Количество) КАК ЧИСЛО (31,2)) КОНЕЦ
		|		- (ВЫБОР КОГДА Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости)
		|			И ЕСТЬNULL(Источник.Количество, 0) <> 0
		// При объединении таблиц разных операций может получиться, что числовое поле будет иметь тип Неопределено (если такого поля нет в одной из операций)
		|			И ТИПЗНАЧЕНИЯ(Т.ИмяПоляСуммы) = ТИП(ЧИСЛО)
		|				ТОГДА ВЫРАЗИТЬ(Т.ИмяПоляСуммы КАК ЧИСЛО (31,2))
		|				ИНАЧЕ 0 КОНЕЦ)) КАК ЧИСЛО (31,2)) КАК ИмяПоляСуммы";
	
	ШаблонПоляСуммыВыборкаПоСреднескользящей = "
	// Для способа "По кор. движению" стоимость всегда определяется из таблицы Сумма. Сумма расходного движения один к одному 
	// переходит в приходное движение.
	// Для других способов, если в исходной таблице стоимость определена (например, по среднескользящей), то сохраняется стоимость из исходной таблицы.
	// Если стоимость не определена, то она определяется из расчета по данным таблицы Суммы.    
		|	ВЫРАЗИТЬ(ВЫБОР
		|		КОГДА Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоКорДвижению)
		|			ТОГДА Суммы.ИмяПоляСуммы
		|		КОГДА Т.ИмяПоляСуммы <> 0 ТОГДА Т.ИмяПоляСуммы
		|		КОГДА Т.Количество = Суммы.Количество ИЛИ Суммы.Количество = 0
		|			ТОГДА Суммы.ИмяПоляСуммы
		|			ИНАЧЕ ВЫРАЗИТЬ(Т.Количество * (Суммы.ИмяПоляСуммы / Суммы.Количество) КАК ЧИСЛО (31,2))
		|	  	КОНЕЦ КАК ЧИСЛО (31,2)) КАК ИмяПоляСуммы";
	
	ТекстПоляЗапросаСГруппировкой = ""; // для &ПоляЗапросаСГруппировкой
	ТекстПоляЗапросаГруппировка = ""; // для &ПоляЗапросаГруппировка
	СтруктураРазличающиесяПоля = Новый Структура("КорАналитикаУчетаНоменклатуры, КорАналитикаУчетаНоменклатурыИсходная, ДокументДвижения, ДатаОпределенияСебестоимости");
	
	ТекстПоляПоСреднескользящейПоИсточнику = "";  // для &ПоляЗапросаПоСреднескользящейПоИсточнику
	ТекстПоляОсновныеПоСреднескользящей = ""; // для &ПоляЗапросаОсновные
	ТекстПоляВыборкаПоСреднескользящей = ""; // для &ПоляЗапросаВыборкаПоСреднескользящей
	
	НеиспользуемыеИзмеренияПоСреднескользящей = Новый Структура;
	// Поля "Партия" и "Аналитика учета партий" в разделе "Неотфактурованные поставки" заполняются всегда.
	// Для товаров раздел учета определяется по типу запасов, для работ и услуг - по разделу учета, определяемому в документе. 
	НеиспользуемыеИзмеренияПоСреднескользящей.Вставить("Партия", "
	|	ВЫБОР
	|		КОГДА Т.РазделУчета В (
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки),
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство))
	//++ НЕ УТ
	|		 ИЛИ ТИПЗНАЧЕНИЯ(Т.Партия) = ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|			ТОГДА Т.Партия
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ");
	НеиспользуемыеИзмеренияПоСреднескользящей.Вставить("АналитикаУчетаПартий", "
	|	ВЫБОР
	|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НеотфактурованныеПоставки)
	|			ТОГДА Т.АналитикаУчетаПартий
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПартий.ПустаяСсылка)
	|	КОНЕЦ");
	НеиспользуемыеИзмеренияПоСреднескользящей.Вставить("АналитикаФинансовогоУчета", "
	|	ВЫБОР
	|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	//++ НЕ УТ
	|		 ИЛИ ТИПЗНАЧЕНИЯ(Т.Партия) = ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|			ТОГДА Т.АналитикаФинансовогоУчета
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ");
	НеиспользуемыеИзмеренияПоСреднескользящей.Вставить("ВидДеятельностиНДС", "
	|	ВЫБОР
	|		КОГДА Т.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
	//++ НЕ УТ
	|		 ИЛИ ТИПЗНАЧЕНИЯ(Т.Партия) = ТИП(Справочник.ПартииПроизводства)
	//-- НЕ УТ
	|			ТОГДА Т.ВидДеятельностиНДС
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|	КОНЕЦ");
	НеиспользуемыеИзмеренияПоСреднескользящей.Вставить("КорВидДеятельностиНДС", "
	|	ВЫБОР
	|		КОГДА Т.КорРазделУчета В (
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяССылка),
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство))
	|			ТОГДА Т.КорВидДеятельностиНДС
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ТипыНалогообложенияНДС.ПустаяСсылка)
	|	КОНЕЦ");
	НеиспользуемыеИзмеренияПоСреднескользящей.Вставить("КорАналитикаФинансовогоУчета", "
	|	ВЫБОР
	|		КОГДА Т.КорРазделУчета В (
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ПустаяССылка),
	|				ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство))
	|			ТОГДА Т.КорАналитикаФинансовогоУчета
	|		ИНАЧЕ НЕОПРЕДЕЛЕНО
	|	КОНЕЦ");
	
	Для Каждого ТекущаяКолонка Из ПараметрыОтражения.МассивКолонокЗапроса Цикл
		
		Если СуммовыеПоляСреднескользящей.Свойство(ТекущаяКолонка) ИЛИ ТекущаяКолонка = "Количество" Тогда

			ТекстПоляЗапросаСГруппировкой = ТекстПоляЗапросаСГруппировкой + ?(ТекстПоляЗапросаСГруппировкой = "", "", ",") + "
				|	СУММА(Т." + ТекущаяКолонка + ") КАК " + ТекущаяКолонка;
			
		ИначеЕсли СтруктураРазличающиесяПоля.Свойство(ТекущаяКолонка) Тогда

			ТекстПоляЗапросаСГруппировкой = ТекстПоляЗапросаСГруппировкой + ?(ТекстПоляЗапросаСГруппировкой = "", "", ",") + "
				|	МАКСИМУМ(Т." + ТекущаяКолонка + ") КАК " + ТекущаяКолонка;
			
		Иначе

			ТекстПоляЗапросаСГруппировкой = ТекстПоляЗапросаСГруппировкой + ?(ТекстПоляЗапросаСГруппировкой = "", "", ",") + "
				|	Т." + ТекущаяКолонка + " КАК " + ТекущаяКолонка;
			ТекстПоляЗапросаГруппировка = ТекстПоляЗапросаГруппировка + ?(ТекстПоляЗапросаГруппировка = "", "", ",") + "
				|	Т." + ТекущаяКолонка;
			
		КонецЕсли;
		
		Если НеиспользуемыеИзмеренияПоСреднескользящей.Свойство(ТекущаяКолонка) Тогда
			
			ТекстПоляОсновныеПоСреднескользящей = ТекстПоляОсновныеПоСреднескользящей + ?(ТекстПоляОсновныеПоСреднескользящей = "", "", ",") + "
				|	ВЫБОР КОГДА Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
				|		ТОГДА " + НеиспользуемыеИзмеренияПоСреднескользящей[ТекущаяКолонка] + "
				|		ИНАЧЕ Т." + ТекущаяКолонка + "
				|	КОНЕЦ КАК " + ТекущаяКолонка;
			
			ТекстПоляВыборкаПоСреднескользящей = ТекстПоляВыборкаПоСреднескользящей + ?(ТекстПоляВыборкаПоСреднескользящей = "", "", ",") + "
				|	ВЫБОР КОГДА Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
				|		ТОГДА " + НеиспользуемыеИзмеренияПоСреднескользящей[ТекущаяКолонка] + "
				|		ИНАЧЕ Т." + ТекущаяКолонка + "
				|	КОНЕЦ КАК " + ТекущаяКолонка;
			
			ТекстПоляПоСреднескользящейПоИсточнику = ТекстПоляПоСреднескользящейПоИсточнику + ?(ТекстПоляПоСреднескользящейПоИсточнику = "", "", ",") + "
				|	Т." + ТекущаяКолонка + " КАК " + ТекущаяКолонка;
			
		ИначеЕсли СуммовыеПоляСреднескользящей.Свойство(ТекущаяКолонка) Тогда
			
			ТекстПоляПоСреднескользящейПоИсточнику = ТекстПоляПоСреднескользящейПоИсточнику + ?(ТекстПоляПоСреднескользящейПоИсточнику = "", "", ",")
				+ СтрЗаменить(ШаблонПоляСуммыПоСреднескользящейПоИсточнику, "ИмяПоляСуммы", ТекущаяКолонка);
			
			ТекстПоляВыборкаПоСреднескользящей = ТекстПоляВыборкаПоСреднескользящей + ?(ТекстПоляВыборкаПоСреднескользящей = "", "", ",")
				+ СтрЗаменить(ШаблонПоляСуммыВыборкаПоСреднескользящей, "ИмяПоляСуммы", ТекущаяКолонка);
				
			ТекстПоляОсновныеПоСреднескользящей = ТекстПоляОсновныеПоСреднескользящей + ?(ТекстПоляОсновныеПоСреднескользящей = "", "", ",") + "
				|	Т." + ТекущаяКолонка + " КАК " + ТекущаяКолонка;
			
		Иначе
			
			ТекстПоляПоСреднескользящейПоИсточнику = ТекстПоляПоСреднескользящейПоИсточнику + ?(ТекстПоляПоСреднескользящейПоИсточнику = "", "", ",") + "
				|	Т." + ТекущаяКолонка + " КАК " + ТекущаяКолонка;
			
			ТекстПоляВыборкаПоСреднескользящей = ТекстПоляВыборкаПоСреднескользящей + ?(ТекстПоляВыборкаПоСреднескользящей = "", "", ",") + "
				|	Т." + ТекущаяКолонка + " КАК " + ТекущаяКолонка;
			
			ТекстПоляОсновныеПоСреднескользящей = ТекстПоляОсновныеПоСреднескользящей + ?(ТекстПоляОсновныеПоСреднескользящей = "", "", ",") + "
				|	Т." + ТекущаяКолонка + " КАК " + ТекущаяКолонка;
			
		КонецЕсли;
		
	КонецЦикла;
	
	#КонецОбласти
	
	#Область ДобавитьТекстЗапросаСреднескользящаяСтоимость
	
	ТекстЗапроса =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета КАК РазделУчета,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация
	|ПОМЕСТИТЬ ВТОтборОстаткиСреднескользящая
	|ИЗ
	|	ВТОперацииДокумента КАК Т
	|ГДЕ
	|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|	И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета КАК РазделУчета,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация
	|ИЗ
	|	ВТДвиженияСторнирования КАК Т
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.Организация,
	|	Т.ИдентификаторФинЗаписи,
	|	Т.Период
	|ПОМЕСТИТЬ ВТОтборИдентификаторы
	|ИЗ
	|	ВТОперацииДокумента КАК Т
	|ГДЕ
	|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|	И Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|	И Т.ИдентификаторФинЗаписи <> НЕОПРЕДЕЛЕНО
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Т.АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета,
	|	Т.ВидЗапасов,
	|	Т.Организация,
	|	Т.ИдентификаторФинЗаписи,
	|	Т.Период,
	|	СУММА(Т.Количество) КАК Количество,
	|	СУММА(Т.Стоимость) КАК Стоимость,
	|	СУММА(Т.СтоимостьБезНДС) КАК СтоимостьБезНДС,
	|	СУММА(Т.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
	|	СУММА(Т.СтоимостьРегл) КАК СтоимостьРегл,
	|	СУММА(Т.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
	|	СУММА(Т.СтоимостьУпр) КАК СтоимостьУпр
	|ПОМЕСТИТЬ ВТСебестоимостьОстаток
	|ИЗ
	|(ВЫБРАТЬ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета КАК РазделУчета,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторФинЗаписи,
	|	НЕОПРЕДЕЛЕНО КАК Период,
	|	Т.КоличествоОстаток КАК Количество,
	|	Т.СтоимостьОстаток КАК Стоимость,
	|	Т.СтоимостьБезНДСОстаток КАК СтоимостьБезНДС,
	|	Т.СтоимостьЗабалансоваяОстаток КАК СтоимостьЗабалансовая,
	|	Т.СтоимостьРеглОстаток КАК СтоимостьРегл,
	|	Т.СтоимостьЗабалансоваяРеглОстаток КАК СтоимостьЗабалансоваяРегл,
	|	Т.СтоимостьУпрОстаток КАК СтоимостьУпр
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров.Остатки(,
	|		(АналитикаУчетаНоменклатуры, РазделУчета, ВидЗапасов, Организация)
	|			В (ВЫБРАТЬ Т.АналитикаУчетаНоменклатуры, Т.РазделУчета, Т.ВидЗапасов, Т.Организация ИЗ ВТОтборОстаткиСреднескользящая КАК Т)
	|		) КАК Т
	|ГДЕ
	|	Т.КоличествоОстаток <> 0
	|	ИЛИ (Т.СтоимостьОстаток <> 0 ИЛИ Т.СтоимостьРеглОстаток <> 0 ИЛИ Т.СтоимостьЗабалансоваяОстаток <> 0 ИЛИ Т.СтоимостьЗабалансоваяРеглОстаток <> 0)
	|	ИЛИ &НеКонтролироватьПоследовательность
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета КАК РазделУчета,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторФинЗаписи,
	|	НЕОПРЕДЕЛЕНО КАК Период,
	|	Т.Количество КАК Количество,
	|	Т.Стоимость КАК Стоимость,
	|	Т.СтоимостьБезНДС КАК СтоимостьБезНДС,
	|	Т.СтоимостьЗабалансовая КАК СтоимостьЗабалансовая,
	|	Т.СтоимостьРегл КАК СтоимостьРегл,
	|	Т.СтоимостьЗабалансоваяРегл КАК СтоимостьЗабалансоваяРегл,
	|	Т.СтоимостьУпр КАК СтоимостьУпр
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборОстаткиСреднескользящая КАК Отбор
	|		ПО Т.АналитикаУчетаНоменклатуры = Отбор.АналитикаУчетаНоменклатуры
	|		И Т.РазделУчета = Отбор.РазделУчета
	|		И Т.ВидЗапасов = Отбор.ВидЗапасов
	|		И Т.Организация = Отбор.Организация
	|ГДЕ
	|	Т.Регистратор = &Ссылка
	|	И (Т.Количество <> 0
	|		ИЛИ Т.Сторно
	|		ИЛИ Т.ХозяйственнаяОперация В(
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтклонениеВСтоимостиТоваровДоходы),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтклонениеВСтоимостиТоваровРасходы)))
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|	И Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоСреднескользящей)
	|	И &НеКонтролироватьПоследовательность
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета КАК РазделУчета,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация,
	|	ВЫБОР
	// Если в движениях не заполнена стоимость из-за ошибки или из-за отсутствия остатков, то не заполняем идентификатор фин записи и
	// период, что бы количество в движениях добавить к остатку для расчета правильной цены при перепроведении документа.
	|		КОГДА Т.Стоимость = 0 И Т.СтоимостьБезНДС = 0 И Т.СтоимостьЗабалансовая = 0
	|		 И Т.СтоимостьРегл = 0 И Т.СтоимостьЗабалансоваяРегл = 0 И Т.СтоимостьУпр = 0
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА Идентификаторы.ИдентификаторФинЗаписи ЕСТЬ NULL
	// В новых движениях документа нет идентификатора фин. записи, который есть в старых движениях.
	// В этом случае старые движения добавляем к "свободным остаткам".
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА Т.ХозяйственнаяОперация В(
	|	  			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтклонениеВСтоимостиТоваровДоходы),
	|	  			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтклонениеВСтоимостиТоваровРасходы))
	|			ТОГДА Т.ИдентификаторСтроки
	|		ИНАЧЕ Т.ИдентификаторФинЗаписи
	|	КОНЕЦ КАК ИдентификаторФинЗаписи,
	|	ВЫБОР
	|		КОГДА Т.Стоимость = 0 И Т.СтоимостьБезНДС = 0 И Т.СтоимостьЗабалансовая = 0
	|		 И Т.СтоимостьРегл = 0 И Т.СтоимостьЗабалансоваяРегл = 0 И Т.СтоимостьУпр = 0
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		КОГДА Идентификаторы.ИдентификаторФинЗаписи ЕСТЬ NULL
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|		ИНАЧЕ Т.Период
	|	КОНЕЦ КАК Период,
	|	ВЫБОР КОГДА НЕ Т.Сторно ТОГДА 1 ИНАЧЕ -1 КОНЕЦ * Т.Количество КАК Количество,
	|	ВЫБОР КОГДА НЕ Т.Сторно ТОГДА 1 ИНАЧЕ -1 КОНЕЦ * Т.Стоимость КАК Стоимость,
	|	ВЫБОР КОГДА НЕ Т.Сторно ТОГДА 1 ИНАЧЕ -1 КОНЕЦ * Т.СтоимостьБезНДС КАК СтоимостьБезНДС,
	|	ВЫБОР КОГДА НЕ Т.Сторно ТОГДА 1 ИНАЧЕ -1 КОНЕЦ * Т.СтоимостьЗабалансовая КАК СтоимостьЗабалансовая,
	|	ВЫБОР КОГДА НЕ Т.Сторно ТОГДА 1 ИНАЧЕ -1 КОНЕЦ * Т.СтоимостьРегл КАК СтоимостьРегл,
	|	ВЫБОР КОГДА НЕ Т.Сторно ТОГДА 1 ИНАЧЕ -1 КОНЕЦ * Т.СтоимостьЗабалансоваяРегл КАК СтоимостьЗабалансоваяРегл,
	|	ВЫБОР КОГДА НЕ Т.Сторно ТОГДА 1 ИНАЧЕ -1 КОНЕЦ * Т.СтоимостьУпр КАК СтоимостьУпр
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборОстаткиСреднескользящая КАК Отбор
	|		ПО Т.АналитикаУчетаНоменклатуры = Отбор.АналитикаУчетаНоменклатуры
	|		И Т.РазделУчета = Отбор.РазделУчета
	|		И Т.ВидЗапасов = Отбор.ВидЗапасов
	|		И Т.Организация = Отбор.Организация
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТОтборИдентификаторы КАК Идентификаторы
	|		ПО Т.ИдентификаторФинЗаписи = Идентификаторы.ИдентификаторФинЗаписи
	|		И Т.Организация = Идентификаторы.Организация
	|		И Т.Период = Идентификаторы.Период
	|ГДЕ
	|	Т.Регистратор = &Ссылка
	|	И (Т.Количество <> 0
	|		ИЛИ Т.Сторно
	|		ИЛИ Т.ХозяйственнаяОперация В(
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтклонениеВСтоимостиТоваровДоходы),
	|			ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтклонениеВСтоимостиТоваровРасходы)))
	|	И НЕ Т.РасчетПартий
	|	И НЕ Т.РасчетСебестоимости
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// Сторно движения Расход формируют остаток стоимости для целей расчета среднескользящей.
	// Сторно движения Приход не учитываем в расчете остатков, т.к. при наличии движений Расход стоимость
	// приходных движений рассчитывается по стоимости расходных движений.
	// Если у документа только Сторно движения Приход, то для таких движений рассчитываются отклонения от текущего остатка,
	// поэтому стоимость сторно движений Приход не включается в стоимость текущего остатка.
	|ВЫБРАТЬ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета КАК РазделУчета,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация,
	|	НЕОПРЕДЕЛЕНО КАК ИдентификаторФинЗаписи,
	|	НЕОПРЕДЕЛЕНО КАК Период,
	|	-Т.Количество КАК Количество,
	|	-Т.Стоимость КАК Стоимость,
	|	-Т.СтоимостьБезНДС КАК СтоимостьБезНДС,
	|	-Т.СтоимостьЗабалансовая КАК СтоимостьЗабалансовая,
	|	-Т.СтоимостьРегл КАК СтоимостьРегл,
	|	-Т.СтоимостьЗабалансоваяРегл КАК СтоимостьЗабалансоваяРегл,
	|	-Т.СтоимостьУпр КАК СтоимостьУпр
	|ИЗ
	|	ВТДанныеСторнированияСебестоимость КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборОстаткиСреднескользящая КАК Отбор
	|		ПО Т.АналитикаУчетаНоменклатуры = Отбор.АналитикаУчетаНоменклатуры
	|		И Т.РазделУчета = Отбор.РазделУчета
	|		И Т.ВидЗапасов = Отбор.ВидЗапасов
	|		И Т.Организация = Отбор.Организация
	|ГДЕ
	|	Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)	
	|
	|) КАК Т
	|СГРУППИРОВАТЬ ПО
	|	Т.АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета,
	|	Т.ВидЗапасов,
	|	Т.Организация,
	|	Т.ИдентификаторФинЗаписи,
	|	Т.Период
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.РазделУчета КАК РазделУчета,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация,
	|	Т.ИдентификаторФинЗаписи КАК ИдентификаторФинЗаписи,
	|	Т.Период КАК Период
	|ПОМЕСТИТЬ ВТИдентификаторыСебестоимости
	|ИЗ
	|	ВТСебестоимостьОстаток КАК Т
	|ГДЕ
	|	Т.ИдентификаторФинЗаписи <> НЕОПРЕДЕЛЕНО
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры
	|";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТСебестоимостьОстаток", ТекстЗапроса);
	
	#КонецОбласти
	
	#Область ДобавитьТекстЗапросаРасчетаСтоимостиПоСреднескользящей
	
	// Для движений по новым строкам документа стоимость определяется по остаткам себестоимости.
	// Для движений по строкам, которые уже были у данного документа, стоимость определяется по его старым движениям.
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	1 КАК КодИсточника,
	|	ЛОЖЬ КАК ЭтоСторно,
	|	&ПоляЗапросаПоСреднескользящейПоИсточнику
	|ПОМЕСТИТЬ ВТДвиженияРасчетПоСреднескользящей
	|ИЗ
	|	ВТОперацииДокумента КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСебестоимостьОстаток КАК Источник
	|		ПО Т.АналитикаУчетаНоменклатуры = Источник.АналитикаУчетаНоменклатуры
	|		И Т.РазделУчета = Источник.РазделУчета
	|		И Т.ВидЗапасов = Источник.ВидЗапасов
	|		И Т.Организация = Источник.Организация
	|		И Источник.ИдентификаторФинЗаписи = НЕОПРЕДЕЛЕНО
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТИдентификаторыСебестоимости КАК Идентификаторы
	|		ПО Т.АналитикаУчетаНоменклатуры = Идентификаторы.АналитикаУчетаНоменклатуры
	|		И Т.РазделУчета = Идентификаторы.РазделУчета
	|		И Т.ВидЗапасов = Идентификаторы.ВидЗапасов
	|		И Т.Организация = Идентификаторы.Организация
	|		И Т.ИдентификаторФинЗаписи = Идентификаторы.ИдентификаторФинЗаписи
	|		И Т.Период = Идентификаторы.Период
	|ГДЕ
	|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|		И (Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоСреднескользящей)
	|			ИЛИ Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости))
	|	И Идентификаторы.ИдентификаторФинЗаписи ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	2 КАК КодИсточника,
	|	ЛОЖЬ КАК ЭтоСторно,
	|	&ПоляЗапросаПоСреднескользящейПоИсточнику
	|ИЗ
	|	ВТОперацииДокумента КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСебестоимостьОстаток КАК Источник
	|		ПО Т.АналитикаУчетаНоменклатуры = Источник.АналитикаУчетаНоменклатуры
	|		И Т.РазделУчета = Источник.РазделУчета
	|		И Т.ВидЗапасов = Источник.ВидЗапасов
	|		И Т.Организация = Источник.Организация
	|		И Т.ИдентификаторФинЗаписи = Источник.ИдентификаторФинЗаписи
	|		И Т.Период = Источник.Период
	|ГДЕ
	|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|		И (Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоСреднескользящей)
	|			ИЛИ Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости))
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	3 КАК КодИсточника,
	|	ИСТИНА КАК ЭтоСторно,
	|	&ТекстПоляПоСреднескользящейСторно
	|ИЗ
	|	ВТДвиженияСторнирования КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСебестоимостьОстаток КАК Источник
	|		ПО Т.АналитикаУчетаНоменклатуры = Источник.АналитикаУчетаНоменклатуры
	|		И Т.РазделУчета = Источник.РазделУчета
	|		И Т.ВидЗапасов = Источник.ВидЗапасов
	|		И Т.Организация = Источник.Организация
	|		И Источник.ИдентификаторФинЗаписи = НЕОПРЕДЕЛЕНО
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТИдентификаторыСебестоимости КАК Идентификаторы
	|		ПО Т.АналитикаУчетаНоменклатуры = Идентификаторы.АналитикаУчетаНоменклатуры
	|		И Т.РазделУчета = Идентификаторы.РазделУчета
	|		И Т.ВидЗапасов = Идентификаторы.ВидЗапасов
	|		И Т.Организация = Идентификаторы.Организация
	|		И Т.ИдентификаторФинЗаписи = Идентификаторы.ИдентификаторФинЗаписи
	|		И Т.Период = Идентификаторы.Период
	|ГДЕ
	|	Идентификаторы.ИдентификаторФинЗаписи ЕСТЬ NULL
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	4 КАК КодИсточника,
	|	ИСТИНА КАК ЭтоСторно,
	|	&ТекстПоляПоСреднескользящейСторно
	|ИЗ
	|	ВТДвиженияСторнирования КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСебестоимостьОстаток КАК Источник
	|		ПО Т.АналитикаУчетаНоменклатуры = Источник.АналитикаУчетаНоменклатуры
	|		И Т.РазделУчета = Источник.РазделУчета
	|		И Т.ВидЗапасов = Источник.ВидЗапасов
	|		И Т.Организация = Источник.Организация
	|		И Т.ИдентификаторФинЗаписи = Источник.ИдентификаторФинЗаписи
	|		И Т.Период = Источник.Период
	|" + "ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры
	|";
	
	ТекстПоляПоСреднескользящейСторно = СтрЗаменить(ТекстПоляПоСреднескользящейПоИсточнику, "Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости)", "ИСТИНА");
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляЗапросаПоСреднескользящейПоИсточнику", СтрЗаменить(СокрЛП(ТекстПоляПоСреднескользящейПоИсточнику), "&Знак", "1"));
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ТекстПоляПоСреднескользящейСторно", СтрЗаменить(СокрЛП(ТекстПоляПоСреднескользящейСторно), "&Знак", "-1"));
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТДвиженияРасчетПоСреднескользящей", ТекстЗапроса);
	
	#КонецОбласти
	
	Если ЕстьДокументИсточник Тогда
		
	#Область ДобавитьТекстЗапросаСтоимостьПоДвижениямДокументаИсточника
	
	ТекстЗапроса =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Т.ДокументИсточник,
	|	Т.КорАналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.КорВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация
	|ПОМЕСТИТЬ ВТОтборДокументыИсточникиСреднескользящая
	|ИЗ
	|	ВТОперацииДокумента КАК Т
	|ГДЕ
	|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|	И Т.ДокументИсточник <> НЕОПРЕДЕЛЕНО
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ДокументИсточник
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Т.Регистратор КАК ДокументИсточник,
	|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	|	Т.ВидЗапасов КАК ВидЗапасов,
	|	Т.Организация КАК Организация,
	|	&Подразделение,
	|	&СтатьяРасходовСписания,
	|	&АналитикаРасходов,
	|	СУММА(Т.Количество) КАК Количество,
	|	СУММА(Т.Стоимость) КАК Стоимость,
	|	СУММА(Т.СтоимостьБезНДС) КАК СтоимостьБезНДС,
	|	СУММА(Т.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
	|	СУММА(Т.СтоимостьРегл) КАК СтоимостьРегл,
	|	СУММА(Т.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл,
	|	СУММА(Т.СтоимостьУпр) КАК СтоимостьУпр
	|ПОМЕСТИТЬ ВТСебестоимостьДокументаИсточника
	|ИЗ
	|	РегистрНакопления.СебестоимостьТоваров КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтборДокументыИсточникиСреднескользящая КАК Отбор
	|		ПО Т.Регистратор = Отбор.ДокументИсточник
	|		И Т.АналитикаУчетаНоменклатуры = Отбор.АналитикаУчетаНоменклатуры
	|		И Т.ВидЗапасов = Отбор.ВидЗапасов
	|		И Т.Организация = Отбор.Организация
	|СГРУППИРОВАТЬ ПО
	|	Т.Регистратор,
	|	Т.АналитикаУчетаНоменклатуры,
	|	Т.ВидЗапасов,
	|	Т.Организация,
	|	&АналитикаУчетаПоПартнерам,
	|	&ЗаказКлиента,
	|	&Подразделение,
	|	&СтатьяРасходовСписания,
	|	&АналитикаРасходов
	|ИМЕЮЩИЕ
	|	СУММА(Т.Количество) <> 0
	|	ИЛИ СУММА(Т.Стоимость) <> 0
	|	ИЛИ СУММА(Т.СтоимостьБезНДС) <> 0
	|	ИЛИ СУММА(Т.СтоимостьЗабалансовая) <> 0
	|	ИЛИ СУММА(Т.СтоимостьРегл) <> 0
	|	ИЛИ СУММА(Т.СтоимостьЗабалансоваяРегл) <> 0
	|	ИЛИ СУММА(Т.СтоимостьУпр) <> 0
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры
	|";
	
	Если ПараметрыОтражения.ЕстьСтатьяРасходовСписания Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&СтатьяРасходовСписания", "Т.СтатьяРасходовСписания");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&АналитикаРасходов", "Т.АналитикаРасходов");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&СтатьяРасходовСписания", "ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&АналитикаРасходов", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьАналитикаУчетаПоПартнерам Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&АналитикаУчетаПоПартнерам", "Т.АналитикаУчетаПоПартнерам");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&АналитикаУчетаПоПартнерам", "ЗНАЧЕНИЕ(Справочник.КлючиАналитикиУчетаПоПартнерам.ПустаяСсылка)");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьЗаказКлиента Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ЗаказКлиента", "Т.ЗаказКлиента");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ЗаказКлиента", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьПодразделение Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Подразделение", "Т.Подразделение");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Подразделение", "ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)");
	КонецЕсли;
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТСебестоимостьДокументаИсточника", ТекстЗапроса);
	
	#КонецОбласти
	
	#Область ДобавитьТекстЗапросаРасчетаСтоимостиПоДокументуИсточнику
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	&ПоляЗапросаПоСреднескользящейПоИсточнику
	|ПОМЕСТИТЬ ВТДвиженияРасчетПоДокументуИсточнику
	|ИЗ
	|	ВТОперацииДокумента КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСебестоимостьДокументаИсточника КАК Источник
	|		ПО Т.ДокументИсточник = Источник.ДокументИсточник
	|		И Т.КорАналитикаУчетаНоменклатуры = Источник.АналитикаУчетаНоменклатуры
	|		И Т.КорВидЗапасов = Источник.ВидЗапасов
	|		И Т.Организация = Источник.Организация
	|		И &СоединениеПоДопПолям
	|ГДЕ
	|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|		И (Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоДвижениямДокументаИсточника)
	|			ИЛИ Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости))
	|";
	
	ТекстСоединение = "";
	
	ПоляДокументаИсточника = Новый Структура;
	ПоляДокументаИсточника.Вставить("Подразделение", 			 "Справочник.СтруктураПредприятия");
	ПоляДокументаИсточника.Вставить("СтатьяРасходовСписания", 	 "ПланВидовХарактеристик.СтатьиРасходов");
	ПоляДокументаИсточника.Вставить("АналитикаРасходов", 		 "НЕОПРЕДЕЛЕНО");
	
	Для Каждого КлючИЗначение Из ПоляДокументаИсточника Цикл
		
		Если ПараметрыОтражения.КолонкиЗапроса.Свойство(КлючИЗначение.Ключ) Тогда
			
			ИмяТипа = КлючИЗначение.Значение;
			
			Если ИмяТипа = "НЕОПРЕДЕЛЕНО" Тогда
				
				ТекстСоединение = ТекстСоединение + ?(ТекстСоединение = "", "", Символы.ПС + "
					|		И ") + "Т." + КлючИЗначение.Ключ + " = Источник."+ КлючИЗначение.Ключ;
				
			Иначе

				ТекстСоединение = ТекстСоединение + ?(ТекстСоединение = "", "", Символы.ПС + "
					|		И ") + "ВЫБОР
					|  			КОГДА ТИПЗНАЧЕНИЯ(Т." + КлючИЗначение.Ключ + ") = ТИП(" + ИмяТипа + ")
					|				ТОГДА Т." + КлючИЗначение.Ключ + "
					|				ИНАЧЕ ЗНАЧЕНИЕ(" + ИмяТипа + ".ПустаяСсылка)
					|		КОНЕЦ = Источник."+ КлючИЗначение.Ключ;
				
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЦикла;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&СоединениеПоДопПолям", ?(ТекстСоединение = "", "ИСТИНА", СокрЛП(ТекстСоединение)));
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляЗапросаПоСреднескользящейПоИсточнику", СтрЗаменить(СокрЛП(ТекстПоляПоСреднескользящейПоИсточнику), "&Знак", "1"));
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТДвиженияРасчетПоДокументуИсточнику", ТекстЗапроса);
	
	#КонецОбласти
	
	КонецЕсли;

	Если ЕстьВыбытияПоФиксированнойСтоимости ИЛИ ПараметрыОтражения.ЕстьСторнирование Тогда
		
	#Область ДобавитьТекстЗапросаРасчетаОтклоненийВСтоимости
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ВЫБОР КОГДА Т.Количество >= 0 ТОГДА 1 ИНАЧЕ -1 КОНЕЦ КАК Знак,
	|	Т.ЭтоСторно,
	|	&ПоляЗапросаСГруппировкой
	|ПОМЕСТИТЬ ВТДвиженияОтклоненияВСтоимостиПредварительная
	|ИЗ
	|	ВТДвиженияРасчетПоСреднескользящей КАК Т
	|ГДЕ
	|	(Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости)
	|		ИЛИ Т.ЭтоСторно)
	// Для разделов учета "Выпуск продукции" и "Незавершенное производство" себестоимость рассчитывается при закрытии месяца,
	// поэтому для этих разделов не нужно рассчитывать отклонения при проведении документов.
	|	И НЕ Т.РазделУчета В (
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.ВыпускПродукции),
	|		ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство))
	|СГРУППИРОВАТЬ ПО
	|	ВЫБОР КОГДА Т.Количество >= 0 ТОГДА 1 ИНАЧЕ -1 КОНЕЦ,
	|	Т.ЭтоСторно,
	|	&ПоляЗапросаГруппировка
	|";

	Если ЕстьДокументИсточник Тогда
		
		ТекстЗапроса = ТекстЗапроса + "
		|ОБЪЕДИНИТЬ ВСЕ
		|";
		
		ТекстЗапроса = ТекстЗапроса + "
		|ВЫБРАТЬ
		|	ВЫБОР КОГДА Т.Количество >= 0 ТОГДА 1 ИНАЧЕ -1 КОНЕЦ КАК Знак,
		|	ЛОЖЬ КАК ЭтоСторно,
		|	&ПоляЗапросаСГруппировкой
		|ИЗ
		|	ВТДвиженияРасчетПоДокументуИсточнику КАК Т
		|ГДЕ
		|	Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости)
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР КОГДА Т.Количество >= 0 ТОГДА 1 ИНАЧЕ -1 КОНЕЦ,
		|	&ПоляЗапросаГруппировка
		|";
		
	КонецЕсли;
	
	ТекстЗапроса = ТекстЗапроса + "
	|ИНДЕКСИРОВАТЬ ПО
	|	АналитикаУчетаНоменклатуры
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|";
	
	ТекстЗапроса = ТекстЗапроса +
	"ВЫБРАТЬ
	// Отклонения в стоимости всегда отражаются движениями Расход для обеспечения двойной записи с 
	// регистрами "Прочие доходы" и "Прочие расходы". 
	|	(ВЫБОР
	|		КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		ИНАЧЕ Т.ВидДвижения КОНЕЦ) КАК ВидДвижения,
	// Отклонения в стоимости являются рассчетными, поэтому признак Сторно не устанавливается.
	|	ЛОЖЬ КАК Сторно,
	|	ЛОЖЬ КАК ЭтоСторно,
	|	ЛОЖЬ КАК ЭтоПрочиеРасходы,
	|	ВЫБОР КОГДА СтатьиДоходов.Ссылка ЕСТЬ NULL
	|		ТОГДА ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ОтклонениеВСтоимостиТоваров)
	|		ИНАЧЕ СтатьиДоходов.Ссылка
	|	КОНЕЦ КАК СтатьяДоходов,
	|	ВЫБОР КОГДА СтатьиДоходов.Ссылка ЕСТЬ NULL
	|		ТОГДА АналитикаНоменклатуры.Номенклатура
	|		ИНАЧЕ &АналитикаДоходов
	|	КОНЕЦ КАК АналитикаДоходов,
	|	НЕОПРЕДЕЛЕНО КАК СтатьяРасходовСписания,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаРасходов,
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтклонениеВСтоимостиТоваровДоходы) КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ОтклонениеВСтоимостиТоваровДоходы) КАК НастройкаХозяйственнойОперации,
	|	ВЫБОР КОГДА Т.ИдентификаторСтроки В ("""", НЕОПРЕДЕЛЕНО)
	|		ТОГДА Т.ИдентификаторФинЗаписи
	|		ИНАЧЕ Т.ИдентификаторСтроки
	|	КОНЕЦ КАК ИдентификаторФинЗаписи,
	|	ВЫБОР КОГДА Т.ИдентификаторФинЗаписи В ("""", НЕОПРЕДЕЛЕНО)
	|		ТОГДА Т.ИдентификаторСтроки
	|		ИНАЧЕ Т.ИдентификаторФинЗаписи
	|	КОНЕЦ КАК ИдентификаторСтроки,
	|	&Ссылка КАК ДокументДвижения,
	|	&ПоляЗапросаДоходы
	|ПОМЕСТИТЬ ВТДвиженияОтклоненияВСтоимости
	|ИЗ
	|	ВТДвиженияОтклоненияВСтоимостиПредварительная КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиДоходов КАК СтатьиДоходов
	|		ПО &СтатьяДоходов = СтатьиДоходов.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
	|		ПО Т.АналитикаУчетаНоменклатуры = АналитикаНоменклатуры.Ссылка
	|ГДЕ
	|	(&УсловияСуммыДоходы)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	// Отклонения в стоимости всегда отражаются движениями Расход для обеспечения двойной записи с 
	// регистрами "Прочие доходы" и "Прочие расходы". 
	|	(ВЫБОР
	|		КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	|		ИНАЧЕ Т.ВидДвижения КОНЕЦ) КАК ВидДвижения,
	// Отклонения в стоимости являются рассчетными, поэтому признак Сторно не устанавливается.
	|	ЛОЖЬ КАК Сторно,
	|	ЛОЖЬ КАК ЭтоСторно,
	|	ИСТИНА КАК ЭтоПрочиеРасходы,
	|	НЕОПРЕДЕЛЕНО КАК СтатьяДоходов,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаДоходов,
	|	ВЫБОР КОГДА СтатьиРасходов.Ссылка ЕСТЬ NULL
	|		ТОГДА ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ОтклонениеВСтоимостиТоваров)
	|		ИНАЧЕ СтатьиРасходов.Ссылка
	|	КОНЕЦ КАК СтатьяРасходовСписания,
	|	ВЫБОР КОГДА СтатьиРасходов.Ссылка ЕСТЬ NULL
	|		ТОГДА АналитикаНоменклатуры.Номенклатура
	|		ИНАЧЕ &АналитикаРасходов
	|	КОНЕЦ КАК АналитикаРасходов,
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОтклонениеВСтоимостиТоваровРасходы) КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ОтклонениеВСтоимостиТоваровРасходы) КАК НастройкаХозяйственнойОперации,
	|	ВЫБОР КОГДА Т.ИдентификаторСтроки В ("""", НЕОПРЕДЕЛЕНО)
	|		ТОГДА Т.ИдентификаторФинЗаписи
	|		ИНАЧЕ Т.ИдентификаторСтроки
	|	КОНЕЦ КАК ИдентификаторФинЗаписи,
	|	ВЫБОР КОГДА Т.ИдентификаторФинЗаписи В ("""", НЕОПРЕДЕЛЕНО)
	|		ТОГДА Т.ИдентификаторСтроки
	|		ИНАЧЕ Т.ИдентификаторФинЗаписи
	|	КОНЕЦ КАК ИдентификаторСтроки,
	|	&Ссылка КАК ДокументДвижения,
	|	&ПоляЗапросаРасходы
	|ИЗ
	|	ВТДвиженияОтклоненияВСтоимостиПредварительная КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
	|		ПО &СтатьяРасходовСписания = СтатьиРасходов.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
	|		ПО Т.АналитикаУчетаНоменклатуры = АналитикаНоменклатуры.Ссылка
	|ГДЕ
	|	(&УсловияСуммыРасходы)
	|";
	
	Если ПараметрыОтражения.ЕстьСтатьяРасходовСписания Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&СтатьяРасходовСписания", "Т.СтатьяРасходовСписания");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&АналитикаРасходов", "Т.АналитикаРасходов");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&СтатьяРасходовСписания", "НЕОПРЕДЕЛЕНО");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&АналитикаРасходов", "АналитикаНоменклатуры.Номенклатура");
	КонецЕсли;
	Если ПараметрыОтражения.ЕстьСтатьяДоходов Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&СтатьяДоходов", "Т.СтатьяДоходов");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&АналитикаДоходов", "Т.АналитикаДоходов");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&СтатьяДоходов", "НЕОПРЕДЕЛЕНО");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&АналитикаДоходов", "АналитикаНоменклатуры.Номенклатура");
	КонецЕсли;
	
	// Перечень полей, используемых в запросе
	ПереопределенныеПоля = Новый Структура("СтатьяДоходов, АналитикаДоходов, СтатьяРасходовСписания, АналитикаРасходов, ДокументДвижения,
		|ХозяйственнаяОперация, НастройкаХозяйственнойОперации, ИдентификаторФинЗаписи, ИдентификаторСтроки,
		|ВидДвижения, Сторно");
	
	ШаблонПоляСуммыДоходы  = "
		|	ВЫБОР
		|		КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|			ТОГДА ВЫБОР
		|				КОГДА Т.ИмяПоляСуммы > 0 ТОГДА -Т.ИмяПоляСуммы
		|				ИНАЧЕ 0 КОНЕЦ
		|		ИНАЧЕ ВЫБОР
		|			КОГДА Т.Знак * Т.ИмяПоляСуммы < 0 ТОГДА Т.ИмяПоляСуммы
		|			ИНАЧЕ 0 КОНЕЦ
		|		КОНЕЦ КАК ИмяПоляСуммы";
	ШаблонПоляСуммыРасходы = "
		|	ВЫБОР
		|		КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|			ТОГДА ВЫБОР
		|				КОГДА Т.ИмяПоляСуммы < 0 ТОГДА -Т.ИмяПоляСуммы
		|				ИНАЧЕ 0 КОНЕЦ
		|		ИНАЧЕ ВЫБОР
		|			КОГДА Т.Знак * Т.ИмяПоляСуммы > 0 ТОГДА Т.ИмяПоляСуммы
		|			ИНАЧЕ 0 КОНЕЦ
		|		КОНЕЦ КАК ИмяПоляСуммы";
	// На прочие доходы относится сумма увеличения себестоимости:
	// - движение Приход со знаком плюс
	// - движение Расход со знаком минус
	// Для движений Сторно условия обратные для того, что бы сторнировать ранее отраженные прочие доходы.
	// Кроме расчета отклонений для Сторно движений Приход, т.к. при оприходовании товара отклонений не бывает и
	// нет необходимости сторнировать прочие доходы. 
	ШаблонУсловияСуммыДоходы  = "
		|	ВЫБОР
		|		КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|			ТОГДА ВЫБОР
		|				КОГДА Т.ИмяПоляСуммы > 0 ТОГДА -Т.ИмяПоляСуммы
		|				ИНАЧЕ 0 КОНЕЦ
		|		ИНАЧЕ ВЫБОР
		|			КОГДА Т.Знак * Т.ИмяПоляСуммы < 0 ТОГДА Т.ИмяПоляСуммы
		|			ИНАЧЕ 0 КОНЕЦ
		|		КОНЕЦ <> 0";
	// На прочие расходы относится сумма уменьшения себестоимости:
	// - движение Приход со знаком минус
	// - движение Расход со знаком плюс
	// Для движений Сторно условия обратные для того, что бы сторнировать ранее отраженные прочие расходы.
	// Кроме расчета отклонений для Сторно движений Приход, т.к. при оприходовании товара отклонений не бывает и
	// нет необходимости сторнировать прочие расходы.
	ШаблонУсловияСуммыРасходы = "
		|	ВЫБОР
		|		КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|			ТОГДА ВЫБОР
		|				КОГДА Т.ИмяПоляСуммы < 0 ТОГДА -Т.ИмяПоляСуммы
		|				ИНАЧЕ 0 КОНЕЦ
		|		ИНАЧЕ ВЫБОР
		|			КОГДА Т.Знак * Т.ИмяПоляСуммы > 0 ТОГДА Т.ИмяПоляСуммы
		|			ИНАЧЕ 0 КОНЕЦ
		|		КОНЕЦ <> 0";
	
	ОписаниеРегистра = РасчетСебестоимостиПовтИсп.СформироватьОписаниеРегистра("РегистрНакопления." + ПараметрыОтражения.ИмяРегистра);
	ЧисловыеПоля = Новый Структура(СтрЗаменить(ОписаниеРегистра.ПоляОтбораНепустыхДвижений, "%1", "")); // все числовые поля регистра
	
	ТекстПоляЗапросаДоходы = ""; // для &ПоляЗапросаДоходы
	ТекстПоляЗапросаРасходы = ""; // для &ПоляЗапросаРасходы
	ТекстУсловияЗапросаДоходы = ""; // для &УсловияСуммыДоходы
	ТекстУсловияЗапросаРасходы = ""; // для &УсловияСуммыРасходы
	
	Для Каждого ТекущаяКолонка Из ПараметрыОтражения.МассивКолонокЗапроса Цикл
		
		Если ПереопределенныеПоля.Свойство(ТекущаяКолонка) Тогда
			Продолжить;
			
		ИначеЕсли СуммовыеПоляСреднескользящей.Свойство(ТекущаяКолонка) Тогда
			
			ТекстПоляЗапросаДоходы = ТекстПоляЗапросаДоходы + ?(ТекстПоляЗапросаДоходы = "", "", ",")
				+ СтрЗаменить(ШаблонПоляСуммыДоходы, "ИмяПоляСуммы", ТекущаяКолонка);
			
			ТекстПоляЗапросаРасходы = ТекстПоляЗапросаРасходы + ?(ТекстПоляЗапросаРасходы = "", "", ",")
				+ СтрЗаменить(ШаблонПоляСуммыРасходы, "ИмяПоляСуммы", ТекущаяКолонка);
			
			ТекстУсловияЗапросаДоходы = ТекстУсловияЗапросаДоходы + ?(ТекстУсловияЗапросаДоходы = "", "", Символы.ПС + "	ИЛИ ")
				+ СтрЗаменить(ШаблонУсловияСуммыДоходы, "ИмяПоляСуммы", ТекущаяКолонка);
			
			ТекстУсловияЗапросаРасходы = ТекстУсловияЗапросаРасходы + ?(ТекстУсловияЗапросаРасходы = "", "", Символы.ПС + "	ИЛИ ")
				+ СтрЗаменить(ШаблонУсловияСуммыРасходы, "ИмяПоляСуммы", ТекущаяКолонка);
			
		ИначеЕсли ЧисловыеПоля.Свойство(ТекущаяКолонка) Тогда
			
			ТекстПоляЗапросаДоходы = ТекстПоляЗапросаДоходы + ?(ТекстПоляЗапросаДоходы = "", "", ",") + "
				|	0 КАК " + ТекущаяКолонка;
			
			ТекстПоляЗапросаРасходы = ТекстПоляЗапросаРасходы + ?(ТекстПоляЗапросаРасходы = "", "", ",") + "
				|	0 КАК " + ТекущаяКолонка;
			
		Иначе
			
			ТекстПоляЗапросаДоходы = ТекстПоляЗапросаДоходы + ?(ТекстПоляЗапросаДоходы = "", "", ",") + "
				|	Т." + ТекущаяКолонка + " КАК " + ТекущаяКолонка;
			
			ТекстПоляЗапросаРасходы = ТекстПоляЗапросаРасходы + ?(ТекстПоляЗапросаРасходы = "", "", ",") + "
				|	Т." + ТекущаяКолонка + " КАК " + ТекущаяКолонка;
			
		КонецЕсли;
		
	КонецЦикла;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляЗапросаСГруппировкой", СокрЛП(ТекстПоляЗапросаСГруппировкой));
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляЗапросаГруппировка",   СокрЛП(ТекстПоляЗапросаГруппировка));
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляЗапросаДоходы",    СокрЛП(ТекстПоляЗапросаДоходы));
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляЗапросаРасходы",   СокрЛП(ТекстПоляЗапросаРасходы));
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловияСуммыДоходы",   СокрЛП(ТекстУсловияЗапросаДоходы));
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловияСуммыРасходы",  СокрЛП(ТекстУсловияЗапросаРасходы));
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТДвиженияОтклоненияВСтоимости", ТекстЗапроса);
	
	#КонецОбласти

	КонецЕсли;

	#Область ДобавитьТекстЗапросаДвиженияСоСтоимостью

	ТекстЗапроса =
	"ВЫБРАТЬ
	|	1 КАК КодИсточника,
	|	ЛОЖЬ КАК Сторно,
	|	&ПоляЗапросаОсновные
	|ПОМЕСТИТЬ ВТИтоговыеДвиженияСебестоимостьТоваров
	|ИЗ
	|	ВТОперацииДокумента КАК Т
	|ГДЕ
	|	Т.МетодОценкиСтоимостиТоваров <> ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|	ИЛИ Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ИзДокумента)
	|	ИЛИ Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.ВыбытиеПоФиксированнойСтоимости)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	2 КАК КодИсточника,
	|	Т.ЭтоСторно КАК Сторно,
	|	&ПоляЗапросаОсновные
	|ИЗ
	|	ВТДвиженияРасчетПоСреднескользящей КАК Т
	|ГДЕ
	|	Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоСреднескользящей)
	|	И Т.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
	|	И НЕ Т.ЭтоСторно
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	3 КАК КодИсточника,
	|	Суммы.ЭтоСторно КАК Сторно,
	|	&ПоляЗапросаВыборкаПоСреднескользящей
	|ИЗ
	|	ВТОперацииДокумента КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТДвиженияРасчетПоСреднескользящей КАК Суммы
	|		ПО Т.Организация = &УсловиеПоОрганизации
	|		И Т.ИдентификаторФинЗаписи = Суммы.ИдентификаторФинЗаписи
	|		И Т.НастройкаХозяйственнойОперации = Суммы.НастройкаХозяйственнойОперации
	|		И Т.Период = Суммы.Период
	|		И НЕ Суммы.ЭтоСторно
	|ГДЕ
	|	Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоКорДвижению)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	4 КАК КодИсточника,
	|	Суммы.ЭтоСторно КАК Сторно,
	|	&ПоляЗапросаВыборкаПоСреднескользящей
	|ИЗ
	|	ВТДвиженияРасчетПоСреднескользящей КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТДвиженияРасчетПоСреднескользящей КАК Суммы
	|		ПО Т.Организация = Т.Организация
	|		И Т.АналитикаУчетаНоменклатуры = Суммы.КорАналитикаУчетаНоменклатуры
	|		И Т.ВидЗапасов = Суммы.КорВидЗапасов
	|		И Т.РазделУчета = Суммы.КорРазделУчета
	|		И НЕ Суммы.ЭтоСторно
	|ГДЕ
	|	Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоСреднескользящей)
	|	И Т.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.СписаниеРасходовНаПартииПроизводства)
	|	И НЕ Т.ЭтоСторно
	|";
	
	Если ПараметрыОтражения.ЕстьКорОрганизация Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеПоОрганизации", 
			"(ВЫБОР КОГДА Суммы.КорОрганизация <> ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
				|	ТОГДА Суммы.КорОрганизация ИНАЧЕ Суммы.Организация КОНЕЦ)");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеПоОрганизации", "Суммы.Организация");
	КонецЕсли;
	
	Если ЕстьДокументИсточник Тогда
		
		ТекстЗапроса = ТекстЗапроса  + "
		|ОБЪЕДИНИТЬ ВСЕ
		|";
		
		ТекстЗапроса = ТекстЗапроса  + "
		|ВЫБРАТЬ
		|	4 КАК КодИсточника,
		|	ЛОЖЬ КАК Сторно,
		|	&ПоляЗапросаОсновные
		|ИЗ
		|	ВТДвиженияРасчетПоДокументуИсточнику КАК Т
		|ГДЕ
		|	Т.СпособОпределенияСебестоимости = ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоДвижениямДокументаИсточника)
		|";
		
	КонецЕсли;
	
	Если ЕстьВыбытияПоФиксированнойСтоимости ИЛИ ПараметрыОтражения.ЕстьСторнирование Тогда
		
		ТекстЗапроса = ТекстЗапроса  + "
		|ОБЪЕДИНИТЬ ВСЕ
		|";
		
		ТекстЗапроса = ТекстЗапроса  + "
		|ВЫБРАТЬ
		|	5 КАК КодИсточника,
		|	Т.ЭтоСторно КАК Сторно,
		|	&ПоляЗапросаОсновные
		|ИЗ
		|	ВТДвиженияОтклоненияВСтоимости КАК Т
		|";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляЗапросаОсновные", СокрЛП(ТекстПоляОсновныеПоСреднескользящей));
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляЗапросаВыборкаПоСреднескользящей", СокрЛП(ТекстПоляВыборкаПоСреднескользящей));
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТИтоговыеДвиженияСебестоимостьТоваров", ТекстЗапроса);
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Т.Сторно,
	|	&ПоляЗапросаОсновные
	|ИЗ
	|	ВТИтоговыеДвиженияСебестоимостьТоваров КАК Т
	|";

	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляЗапросаОсновные", СокрЛП(ТекстПоляОсновныеПоСреднескользящей));
	
	ПараметрыОтражения.ТекстыШаблоновОтражения.Вставить(ПараметрыОтражения.ИмяРегистра, ТекстЗапроса);
		
	#КонецОбласти
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаДвиженияВыручкаИСебестоимостьПродаж(ПараметрыОтражения)
	
	// Проверяем, есть ли у документа текст запроса проведения по регистру выручки
	ИндексЗапроса = -1;
	СтарыйТекстЗапроса = "";
	ИмяРегистра = Метаданные.РегистрыНакопления.ВыручкаИСебестоимостьПродаж.Имя;
	
	Для Каждого ЭлементСписка Из ПараметрыОтражения.ТекстыЗапроса Цикл

		ИндексЗапроса = ИндексЗапроса + 1;
		Если ЭлементСписка.Представление = ИмяРегистра Тогда
			СтарыйТекстЗапроса = ЭлементСписка.Значение;
			Прервать;
		КонецЕсли;
		
	КонецЦикла;
	
	Если ПустаяСтрока(СтарыйТекстЗапроса) Тогда
		Возврат; // нет движений по выручке
	КонецЕсли;
	
	// Замена старого запроса выборка на новый запрос создания временной таблицы ДвиженияВыручкиИСебестоимости
	ОписаниеЗапроса = РасчетСебестоимостиПовтИсп.ЗапросФормированияВТИзЗапросаВыборки(СтарыйТекстЗапроса, "ДвиженияВыручкиИСебестоимости");
	
	НовыйТекстЗапроса = ОписаниеЗапроса.ТекстЗапроса + "
	|ИНДЕКСИРОВАТЬ ПО
	|	ИдентификаторФинЗаписи,
	|	НастройкаХозяйственнойОперации";
	
	ПараметрыОтражения.ТекстыЗапроса[ИндексЗапроса].Значение = НовыйТекстЗапроса;
	ПараметрыОтражения.ТекстыЗапроса[ИндексЗапроса].Представление = "ДвиженияВыручкиИСебестоимости";
	
	// Создание вспомогательной таблицы ВТСтоимостьСреднескользящаяДляВыручки - суммы среднескользящей из себестоимости
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	Т.Организация,
	|   Т.ИдентификаторФинЗаписи,
	|   Т.НастройкаХозяйственнойОперации,
	|   СУММА(ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА -1 ИНАЧЕ 1 КОНЕЦ * Т.Стоимость) КАК Стоимость,
	|   СУММА(ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА -1 ИНАЧЕ 1 КОНЕЦ * Т.СтоимостьБезНДС) КАК СтоимостьБезНДС,
	|   СУММА(ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА -1 ИНАЧЕ 1 КОНЕЦ * Т.СтоимостьРегл) КАК СтоимостьРегл,
	|   СУММА(ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА -1 ИНАЧЕ 1 КОНЕЦ * Т.СтоимостьУпр) КАК СтоимостьУпр,
	|   СУММА(ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА -1 ИНАЧЕ 1 КОНЕЦ * Т.СтоимостьЗабалансовая) КАК СтоимостьЗабалансовая,
	|   СУММА(ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА -1 ИНАЧЕ 1 КОНЕЦ * Т.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл
	|ПОМЕСТИТЬ ВТСтоимостьСреднескользящаяДляВыручки
	|ИЗ
	|	ВТИтоговыеДвиженияСебестоимостьТоваров КАК Т
	|ГДЕ
	|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|	И Т.СпособОпределенияСебестоимости В
	|		(ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоСреднескользящей),
	|		 ЗНАЧЕНИЕ(Перечисление.СпособыОпределенияСебестоимостиТоваров.ПоДвижениямДокументаИсточника))
	|СГРУППИРОВАТЬ ПО
	|	Т.Организация,
	|   Т.ИдентификаторФинЗаписи,
	|   Т.НастройкаХозяйственнойОперации
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ИдентификаторФинЗаписи,
	|	НастройкаХозяйственнойОперации
	|";
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВТСтоимостьСреднескользящаяДляВыручки", ТекстЗапроса);
	
	// Создание итогового запроса выборки данных для регистра выручки
	// Если суммы ресурсов среднескользящей уже заполнены в исходном запросе выборки данных для выручки,
	// то оставим их, иначе возьмем их из таблицы ВТСтоимостьСреднескользящаяДляВыручки
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	&ПоляВыручки
	|ИЗ
	|	ДвиженияВыручкиИСебестоимости КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ ВТСтоимостьСреднескользящаяДляВыручки КАК Суммы
	|		ПО Т.АналитикаУчетаПоПартнерам.Организация = Суммы.Организация
	|		И Т.ИдентификаторФинЗаписи = Суммы.ИдентификаторФинЗаписи
	|		И Т.НастройкаХозяйственнойОперации = Суммы.НастройкаХозяйственнойОперации
	|";
	
	ВозможныеСуммовыеПоля = Новый Структура(СуммовыеПоляСреднескользящей());
	ОтсутствующиеСуммовыеПоля = Новый Структура(СуммовыеПоляСреднескользящей());
	ТекстПоляВыручки = "";
	
	Для Каждого ИмяПоля Из ОписаниеЗапроса.Колонки Цикл
		
		Если ВозможныеСуммовыеПоля.Свойство(ИмяПоля) Тогда
			
			ОтсутствующиеСуммовыеПоля.Удалить(ИмяПоля);
			
			ТекстПоляВыручки = ТекстПоляВыручки + ?(ТекстПоляВыручки = "", "", ",
				|	") + "ВЫБОР КОГДА Т." + ИмяПоля + " <> 0 ТОГДА Т." + ИмяПоля
				+ " ИНАЧЕ ЕСТЬNULL(Суммы." + ИмяПоля + ", 0) КОНЕЦ КАК " + ИмяПоля;
			
		Иначе
			ТекстПоляВыручки = ТекстПоляВыручки + ?(ТекстПоляВыручки = "", "", ",
				|	") + "Т." + ИмяПоля + " КАК " + ИмяПоля;
		КонецЕсли;
		
	КонецЦикла;
	
	Для Каждого КлючИЗначение Из ОтсутствующиеСуммовыеПоля Цикл
		// Добавим ресурсы среднескользящей, которых не было в исходном запросе выборки данных для выручки
		ТекстПоляВыручки = ТекстПоляВыручки + ?(ТекстПоляВыручки = "", "", ",
			|	") + "ЕСТЬNULL(Суммы." + КлючИЗначение.Ключ + ", 0) КАК " + КлючИЗначение.Ключ;
		
	КонецЦикла;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ПоляВыручки", ТекстПоляВыручки);
	
	ПараметрыОтражения.ТекстыШаблоновОтражения.Вставить(ИмяРегистра, ТекстЗапроса);
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаКорДвиженияПрочиеРасходы(ПараметрыОтражения)
	
	Если НЕ (ПараметрыОтражения.ЕстьСтатьяРасходовСписания ИЛИ ПараметрыОтражения.ЕстьСторнирование) Тогда
		Возврат;
	КонецЕсли;
	
	#Область ПроверкаТипаДокумента
	
	ДопустимыеДокументы = Новый Массив;

	ДопустимыеДокументы.Добавить(Метаданные.Документы.ВводОстатковТоваров);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ВнутреннееПотребление);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ВозвратТоваровПоставщику);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ОтчетКомиссионераОСписании);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ОтчетОСписанииТоваровСХранения);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.СписаниеОтгруженныхТоваров);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ОтчетПоКомиссииМеждуОрганизациямиОСписании);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ПередачаТоваровМеждуОрганизациями);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ВозвратТоваровМеждуОрганизациями);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ПрочееОприходованиеТоваров);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.СписаниеНедостачТоваров);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ПересортицаТоваров);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ПересортицаТоваровУХранителя);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ПорчаТоваров);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ПорчаТоваровУХранителя);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.Сторно);
	
	//++ НЕ УТ
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ОтчетПереработчика2_5);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ПроизводствоБезЗаказа);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.РаспределениеПроизводственныхЗатрат);
	
	//++ Локализация

	//++ Устарело_Переработка24
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ОтчетПереработчика);
	//-- Устарело_Переработка24

	//-- Локализация
	
	//-- НЕ УТ
	
	//++ НЕ УТКА
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ОтчетДавальцу2_5);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ОтчетДавальцуМеждуОрганизациями);
	ДопустимыеДокументы.Добавить(Метаданные.Документы.ЭтапПроизводства2_2);
	//-- НЕ УТКА
	
	Если ДопустимыеДокументы.Найти(ПараметрыОтражения.МетаданныеДокумента) = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	#КонецОбласти
	
	#Область ВтИсходныеПрочиеРасходы
	
	ШаблонТекстаЗапроса =
	"ВЫБРАТЬ
	|	Т.Период 										КАК Период,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) 			КАК ВидДвижения,
	|	ЕСТЬNULL(КорОрганизации.Ссылка, Т.Организация) 	КАК Организация,
	|	&Подразделение 									КАК Подразделение,
	|	Т.СтатьяРасходовСписания 						КАК СтатьяРасходов,
	|	Т.АналитикаРасходов 							КАК АналитикаРасходов,
	|	&НаправлениеДеятельности 						КАК НаправлениеДеятельности,
	|	НЕОПРЕДЕЛЕНО 									КАК ВидДеятельностиНДС,
	|	Т.ХозяйственнаяОперация 		 				КАК ХозяйственнаяОперация,
	|	Т.АналитикаУчетаНоменклатуры 	 				КАК АналитикаУчетаНоменклатуры,
	|	Т.ИдентификаторФинЗаписи 		 				КАК ИдентификаторФинЗаписи,
	|	Т.НастройкаХозяйственнойОперации 				КАК НастройкаХозяйственнойОперации,
	|
	|	ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА -1 ИНАЧЕ 1 КОНЕЦ * Т.Стоимость 				КАК СуммаСНДС,
	|	ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА -1 ИНАЧЕ 1 КОНЕЦ * Т.СтоимостьБезНДС 			КАК СуммаБезНДС,
	// При передаче товаров в другую организацию суммы регл. и упр. не заполняются, когда вид движения источника приходный - меняем знак кор. движения (так как в кор движения попадают ресурсы с положительным знаком и видом движения приход).
	|	ВЫБОР
	|		КОГДА НЕ КорОрганизации.Ссылка ЕСТЬ NULL
	|		ТОГДА 0
	|		КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		ТОГДА -1
	|		ИНАЧЕ 1
	|	КОНЕЦ * Т.СтоимостьУпр КАК СуммаБезНДСУпр,
	|	ВЫБОР
	|		КОГДА НЕ КорОрганизации.Ссылка ЕСТЬ NULL
	|		ТОГДА 0
	|		КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		ТОГДА -1
	|		ИНАЧЕ 1
	|	КОНЕЦ * Т.СтоимостьРегл КАК СуммаСНДСРегл,
	|	ВЫБОР
	|		КОГДА НЕ КорОрганизации.Ссылка ЕСТЬ NULL
	|		ТОГДА 0
	|		КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|		ТОГДА -1
	|		ИНАЧЕ 1
	|	КОНЕЦ * Т.СтоимостьРегл КАК СуммаБезНДСРегл,
	|	0 							КАК ПостояннаяРазница,
	|	0 							КАК ВременнаяРазница
	|ПОМЕСТИТЬ ВтИсходныеПрочиеРасходыСреднескользящая
	|ИЗ
	|	ИмяТаблицыДанныхПрочиеРасходы КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
	|		ПО Т.СтатьяРасходовСписания = СтатьиРасходов.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Организации КАК КорОрганизации
	|		ПО &КорОрганизация = КорОрганизации.Ссылка
	|ГДЕ
	|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|	И (Т.Стоимость <> 0
	|		ИЛИ Т.СтоимостьБезНДС <> 0
	|		ИЛИ (КорОрганизации.Ссылка ЕСТЬ NULL
	|			 И (Т.СтоимостьРегл <> 0 ИЛИ Т.СтоимостьУпр <> 0)
	|			 )
	|	  )
	|	И &УсловиеОтбора
	|";
	
	Если ПараметрыОтражения.ЕстьКорНаправлениеДеятельности Тогда
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&НаправлениеДеятельности", "Т.КорНаправлениеДеятельности");
	Иначе
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&НаправлениеДеятельности", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	Если ПараметрыОтражения.ЕстьПодразделение Тогда
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&Подразделение", "Т.Подразделение");
	Иначе
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&Подразделение", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	Если ПараметрыОтражения.ЕстьКорОрганизация Тогда
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&КорОрганизация", "Т.КорОрганизация");
	Иначе
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&КорОрганизация", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	//ВТДвиженияРасчетПоСреднескользящей
	ТекстЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "ИмяТаблицыДанныхПрочиеРасходы", "ВТДвиженияРасчетПоСреднескользящей");
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбора",
		"Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы)");

	//ВТДвиженияРасчетПоДокументуИсточнику
	Если ПараметрыОтражения.ЕстьДокументИсточник Тогда

		ТекстЗапроса = ТекстЗапроса + "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|" + СтрЗаменить(ШаблонТекстаЗапроса, "ПОМЕСТИТЬ ВтИсходныеПрочиеРасходыСреднескользящая", "");
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ИмяТаблицыДанныхПрочиеРасходы", "ВТДвиженияРасчетПоДокументуИсточнику");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбора",
			"Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы)");
		
	КонецЕсли;
	
	//ВТДвиженияОтклоненияВСтоимости
	Если ПараметрыОтражения.ЕстьВыбытияПоФиксированнойСтоимости ИЛИ ПараметрыОтражения.ЕстьСторнирование Тогда

		ТекстЗапроса = ТекстЗапроса + "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|" + СтрЗаменить(ШаблонТекстаЗапроса, "ПОМЕСТИТЬ ВтИсходныеПрочиеРасходыСреднескользящая", "");
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ИмяТаблицыДанныхПрочиеРасходы", "ВТДвиженияОтклоненияВСтоимости");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбора", "ИСТИНА");
		
	КонецЕсли;
	
	// ВтИсходныеПрочиеРасходыСреднескользящая
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВтИсходныеПрочиеРасходыСреднескользящая", ТекстЗапроса);
	
	#КонецОбласти
	
	#Область ФормированиеДвижений
	
	// В запросах, формируемых в модуле менеджера регистра Прочие расходы надо заменить имена используемых временных таблиц.
	// Если это не сделать, то в случае, когда сам документ делает движения по регистру Прочие расходы, возникнет ошибка вида "Таблица уже существует".
	
	// ВтПрочиеРасходы Среднескользящая
	ТекстЗапроса = РегистрыНакопления.ПрочиеРасходы.ТекстЗапросаТаблицаВтПрочиеРасходы(,
		ПараметрыОтражения.ВозможныРазныеПериодыВДвижениях); // использует ВтИсходныеПрочиеРасходы, формирует ВтПрочиеРасходы
	
	ВременныеТаблицы = РасчетСебестоимостиПовтИсп.ВременныеТаблицыЗапроса(ТекстЗапроса);
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВтИсходныеПрочиеРасходы", "ВтИсходныеПрочиеРасходыСреднескользящая");
	
	Для Каждого ЭлементСписка Из ВременныеТаблицы Цикл
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, ЭлементСписка.Представление, ЭлементСписка.Представление + "Среднескользящая");
	КонецЦикла;
	
	ПараметрыОтражения.ТекстыШаблоновВТ.Вставить("ВтПрочиеРасходы" + "Среднескользящая", ТекстЗапроса);

	// Кор. движения по прочим расходам
	ТекстЗапроса = РегистрыНакопления.ПрочиеРасходы.ТекстЗапросаТаблицаПрочиеРасходы(,
		ПараметрыОтражения.ВозможныРазныеПериодыВДвижениях); // использует ВтПрочиеРасходы, формирует выборку движений

	ВременныеТаблицы = РасчетСебестоимостиПовтИсп.ВременныеТаблицыЗапроса(ТекстЗапроса);
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ВтПрочиеРасходы", "ВтПрочиеРасходы" + "Среднескользящая");

	Для Каждого ЭлементСписка Из ВременныеТаблицы Цикл
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, ЭлементСписка.Представление, ЭлементСписка.Представление + "_" + "1");
	КонецЦикла;
	
	ПараметрыОтражения.ТекстыШаблоновОтражения.Вставить(Метаданные.РегистрыНакопления.ПрочиеРасходы.Имя, ТекстЗапроса);
	
	#КонецОбласти
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаКорДвиженияПрочиеДоходы(ПараметрыОтражения)
	
	Если НЕ (ПараметрыОтражения.ЕстьВыбытияПоФиксированнойСтоимости ИЛИ ПараметрыОтражения.ЕстьСторнирование) Тогда
		Возврат;
	КонецЕсли;
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Т.Период 								КАК Период,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) 	КАК ВидДвижения,
	|	Т.Организация 							КАК Организация,
	|	&Подразделение 							КАК Подразделение,
	|	Т.СтатьяДоходов 						КАК СтатьяДоходов,
	|	Т.АналитикаДоходов 						КАК АналитикаДоходов,
	|	&НаправлениеДеятельности 				КАК НаправлениеДеятельности,
	|	Т.ХозяйственнаяОперация 		 		КАК ХозяйственнаяОперация,
	|	Т.ИдентификаторФинЗаписи 		 		КАК ИдентификаторФинЗаписи,
	|	Т.НастройкаХозяйственнойОперации 		КАК НастройкаХозяйственнойОперации,
	|
	|	ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА 1 ИНАЧЕ -1 КОНЕЦ * Т.Стоимость 							КАК Сумма,
	|	ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА 1 ИНАЧЕ -1 КОНЕЦ * Т.СтоимостьРегл 						КАК СуммаРегл,
	|	ВЫБОР КОГДА Т.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) ТОГДА 1 ИНАЧЕ -1 КОНЕЦ * Т.СтоимостьУпр 							КАК СуммаУпр
	|ИЗ
	|	ВТДвиженияОтклоненияВСтоимости КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиДоходов КАК СтатьиДоходов
	|		ПО Т.СтатьяДоходов = СтатьиДоходов.Ссылка
	|ГДЕ
	|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|	И (Т.Стоимость <> 0 ИЛИ Т.СтоимостьРегл <> 0 ИЛИ Т.СтоимостьУпр <> 0)
	|";
	
	Если ПараметрыОтражения.ЕстьКорНаправлениеДеятельности Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&НаправлениеДеятельности", "Т.КорНаправлениеДеятельности");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&НаправлениеДеятельности", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьПодразделение Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Подразделение", "Т.Подразделение");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Подразделение", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	ПараметрыОтражения.ТекстыШаблоновОтражения.Вставить(Метаданные.РегистрыНакопления.ПрочиеДоходы.Имя, ТекстЗапроса);
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаКорДвиженияПрочиеАктивыПассивы(ПараметрыОтражения)
	
	Если НЕ ПараметрыОтражения.ЕстьСтатьяАктивовПассивов Тогда
		Возврат;
	КонецЕсли;
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Т.Период 								КАК Период,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) 	КАК ВидДвижения,
	|	Т.Организация 							КАК Организация,
	|	&Подразделение 							КАК Подразделение,
	|	Т.СтатьяАктивовПассивов 				КАК Статья,
	|	Т.АналитикаАктивовПассивов 				КАК Аналитика,
	|	&НаправлениеДеятельности 				КАК НаправлениеДеятельности,
	|	Т.Стоимость 							КАК Сумма
	|ИЗ
	|	ВТДвиженияРасчетПоСреднескользящей КАК Т
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиАктивовПассивов КАК СтатьиАктивовПассивов
	|		ПО Т.СтатьяАктивовПассивов = СтатьиАктивовПассивов.Ссылка
	|ГДЕ
	|	Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы)
	|	И Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|	И Т.Стоимость <> 0
	|";
	
	Если ПараметрыОтражения.ЕстьДокументИсточник Тогда
		
		ТекстЗапроса = ТекстЗапроса + "
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|" + СтрЗаменить(ТекстЗапроса, "ВТДвиженияРасчетПоСреднескользящей", "ВТДвиженияРасчетПоДокументуИсточнику");
		
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьКорНаправлениеДеятельности Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&НаправлениеДеятельности", "Т.КорНаправлениеДеятельности");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&НаправлениеДеятельности", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьПодразделение Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Подразделение", "Т.Подразделение");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Подразделение", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	ПараметрыОтражения.ТекстыШаблоновОтражения.Вставить(Метаданные.РегистрыНакопления.ПрочиеАктивыПассивы.Имя, ТекстЗапроса);
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаКорДвиженияПоПрочимАктивамПассивам(ПараметрыОтражения)
	
	Если НЕ ПараметрыОтражения.ЕстьСтатьяАктивовПассивов И НЕ ПараметрыОтражения.ЕстьКорОрганизация Тогда
		Возврат;
	КонецЕсли;
	
	ТекстЗапроса = "";
	
	Если ПараметрыОтражения.ЕстьСтатьяАктивовПассивов Тогда
		
		ТекстЗапроса =
		"ВЫБРАТЬ
		|	Т.Период 								КАК Период,
		|	Т.Организация 							КАК Организация,
		|	&Подразделение 							КАК Подразделение,
		|	Т.СтатьяАктивовПассивов 				КАК Статья,
		|	Т.АналитикаАктивовПассивов 				КАК Аналитика,
		|	&НаправлениеДеятельности 				КАК НаправлениеДеятельности,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет) КАК ДебетКредит,
		|	&НастройкаСчетовУчета 					КАК НастройкаСчетовУчета,
		|	Т.ИдентификаторФинЗаписи 		 		КАК ИдентификаторФинЗаписи,
		|	Т.НастройкаХозяйственнойОперации 		КАК НастройкаХозяйственнойОперации,
		|
		|	Т.Стоимость 							КАК СуммаСНДС,
		|	Т.СтоимостьБезНДС 						КАК СуммаБезНДС,
		|	Т.СтоимостьРегл 						КАК СуммаРегл,
		|	Т.СтоимостьУпр 							КАК СуммаУпр
		|ИЗ
		|	ВТДвиженияРасчетПоСреднескользящей КАК Т
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиАктивовПассивов КАК СтатьиАктивовПассивов
		|		ПО Т.СтатьяАктивовПассивов = СтатьиАктивовПассивов.Ссылка
		|ГДЕ
		|	Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы)
		|	И Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
		|	И (Т.Стоимость <> 0 ИЛИ Т.СтоимостьБезНДС <> 0 ИЛИ Т.СтоимостьРегл <> 0 ИЛИ Т.СтоимостьУпр <> 0)
		|";
		
		Если ПараметрыОтражения.ЕстьДокументИсточник Тогда
			
			ТекстЗапроса = ТекстЗапроса + "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|" + СтрЗаменить(ТекстЗапроса, "ВТДвиженияРасчетПоСреднескользящей", "ВТДвиженияРасчетПоДокументуИсточнику");
			
		КонецЕсли;
		
	КонецЕсли;

	Если ПараметрыОтражения.ЕстьКорОрганизация Тогда
		
		// При методе оценки отличном от среднескользящая движения формируются при расчете себестоимости
		// в методе РасчетСебестоимостиКорректировкаСтоимости.СформироватьДвиженияПоПрочимАктивамПассивамЗапросом()
		ТекстЗапроса = ТекстЗапроса + ?(ТекстЗапроса = "", "", "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|") + "
			// Передача в филиал (на стороне отправителя)
			|ВЫБРАТЬ
			|	Т.Период 								КАК Период,
			|	Т.Организация 							КАК Организация,
			|	&Подразделение 							КАК Подразделение,
			|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.РасчетыСФилиалами) КАК Статья,
			|	Т.КорОрганизация 						КАК Аналитика,
			|	&НаправлениеДеятельности 				КАК НаправлениеДеятельности,
			|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Дебет) КАК ДебетКредит,
			|	&НастройкаСчетовУчета 					КАК НастройкаСчетовУчета,
			|	Т.ИдентификаторФинЗаписи 		 		КАК ИдентификаторФинЗаписи,
			|	Т.НастройкаХозяйственнойОперации 		КАК НастройкаХозяйственнойОперации,
			|
			|	Т.Стоимость 							КАК СуммаСНДС,
			|	Т.СтоимостьБезНДС 						КАК СуммаБезНДС,
			|	Т.СтоимостьРегл 						КАК СуммаРегл,
			|	Т.СтоимостьУпр 							КАК СуммаУпр
			|ИЗ
			|	ВТДвиженияРасчетПоСреднескользящей КАК Т
			|ГДЕ
			|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
			|	И Т.ХозяйственнаяОперация В (
			|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеТоваровМеждуФилиалами),
			|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеПолуфабрикатовМеждуФилиалами),
			|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуФилиалами))
			|	И (Т.Стоимость <> 0 ИЛИ Т.СтоимостьБезНДС <> 0 ИЛИ Т.СтоимостьРегл <> 0 ИЛИ Т.СтоимостьУпр <> 0)
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			// Передача в филиал (на стороне получателя)
			|ВЫБРАТЬ
			|	Т.Период 								КАК Период,
			|	Т.КорОрганизация						КАК Организация,
			|	&Подразделение 							КАК Подразделение,
			|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.РасчетыСФилиалами) КАК Статья,
			|	Т.Организация	 						КАК Аналитика,
			|	&НаправлениеДеятельности 				КАК НаправлениеДеятельности,
			|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПрочихАктивовПассивов.Кредит) КАК ДебетКредит,
			|	&НастройкаСчетовУчета 					КАК НастройкаСчетовУчета,
			|	Т.ИдентификаторФинЗаписи 		 		КАК ИдентификаторФинЗаписи,
			|	Т.НастройкаХозяйственнойОперации 		КАК НастройкаХозяйственнойОперации,
			|
			|	Т.Стоимость 							КАК СуммаСНДС,
			|	Т.СтоимостьБезНДС 						КАК СуммаБезНДС,
			|	Т.СтоимостьРегл 						КАК СуммаРегл,
			|	Т.СтоимостьУпр 							КАК СуммаУпр
			|ИЗ
			|	ВТДвиженияРасчетПоСреднескользящей КАК Т
			|ГДЕ
			|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
			|	И Т.ХозяйственнаяОперация В (
			|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеТоваровМеждуФилиалами),
			|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеремещениеПолуфабрикатовМеждуФилиалами),
			|		ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемПередачаРаботМеждуФилиалами))
			|	И (Т.Стоимость <> 0 ИЛИ Т.СтоимостьБезНДС <> 0 ИЛИ Т.СтоимостьРегл <> 0 ИЛИ Т.СтоимостьУпр <> 0)
			|";
		
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьКорНаправлениеДеятельности Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&НаправлениеДеятельности", "Т.КорНаправлениеДеятельности");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&НаправлениеДеятельности", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьНастройкаСчетовУчета Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&НастройкаСчетовУчета", "Т.НастройкаСчетовУчета");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&НастройкаСчетовУчета", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьПодразделение Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Подразделение", "Т.Подразделение");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Подразделение", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	ПараметрыОтражения.ТекстыШаблоновОтражения.Вставить(Метаданные.РегистрыНакопления.ДвиженияПоПрочимАктивамПассивам.Имя, СокрЛП(ТекстЗапроса));
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаКорДвиженияНоменклатураДоходыРасходы(ПараметрыОтражения)
	
	ШаблонТекстаЗапроса =
	"ВЫБРАТЬ
	|	Т.Период 										КАК Период,
	|	Т.Организация 									КАК Организация,
	|	&Подразделение 									КАК Подразделение,
	|	Т.ХозяйственнаяОперация 		 				КАК ХозяйственнаяОперация,
	|	Т.АналитикаУчетаНоменклатуры 	 				КАК АналитикаУчетаНоменклатуры,
	|	Т.ВидЗапасов 	 								КАК ВидЗапасов,
	|	ВидыЗапасов.ТипЗапасов 	 						КАК ТипЗапасов,
	|	&НаправлениеДеятельности 						КАК НаправлениеДеятельностиСтатьи,
	|	&АналитикаРасходов 	 							КАК АналитикаРасходов,
	|	&АналитикаДоходов 	 							КАК АналитикаДоходов,
	|	&АналитикаАктивовПассивов 	 					КАК АналитикаАктивовПассивов,
	|
	|	АналитикаНоменклатуры.Назначение.НаправлениеДеятельности КАК НаправлениеДеятельностиНоменклатуры,
	|	ВЫБОР КОГДА АналитикаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|		ТОГДА АналитикаНоменклатуры.Договор.Партнер
	|		ИНАЧЕ АналитикаНоменклатуры.МестоХранения
	|	КОНЕЦ КАК Склад,
	|	ВЫБОР
	|		КОГДА ТИПЗНАЧЕНИЯ(&СтатьяРасходовСписания) = ТИП(ПланВидовХарактеристик.СтатьиРасходов)
	|	  	  И &СтатьяРасходовСписания <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиРасходов.ПустаяСсылка)
	|			ТОГДА &СтатьяРасходовСписания
	|		КОГДА ТИПЗНАЧЕНИЯ(&СтатьяДоходов) = ТИП(ПланВидовХарактеристик.СтатьиДоходов)
	|	  	  И &СтатьяДоходов <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиДоходов.ПустаяСсылка)
	|			ТОГДА &СтатьяДоходов
	|			ИНАЧЕ &СтатьяАктивовПассивов
	|	КОНЕЦ КАК СтатьяДоходовРасходов,
	|	ВЫБОР
	|		КОГДА АналитикаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА АналитикаНоменклатуры.Номенклатура
	|		КОГДА &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета
	|			ТОГДА Т.ВидЗапасов
	|			ИНАЧЕ АналитикаНоменклатуры.Номенклатура
	|	КОНЕЦ КАК ИсточникГФУНоменклатуры,
	|
	|	Т.Стоимость 			КАК Стоимость,
	|	Т.СтоимостьБезНДС 		КАК СтоимостьБезНДС,
	|	Т.СтоимостьРегл 		КАК СтоимостьРегл,
	|	Т.СтоимостьУпр 			КАК СтоимостьУпр
	|ИЗ
	|	ИмяТаблицыДанныхДоходыРасходы КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
	|		ПО Т.АналитикаУчетаНоменклатуры = АналитикаНоменклатуры.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК ВидыЗапасов
	|		ПО Т.ВидЗапасов = ВидыЗапасов.Ссылка
	|ГДЕ
	|	Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|	И (Т.Стоимость <> 0 ИЛИ Т.СтоимостьБезНДС <> 0 ИЛИ Т.СтоимостьРегл <> 0 ИЛИ Т.СтоимостьУпр <> 0)
	|	И &УсловиеОтбора
	|";
	
	Если ПараметрыОтражения.ЕстьКорНаправлениеДеятельности Тогда
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&НаправлениеДеятельности", "Т.КорНаправлениеДеятельности");
	Иначе
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&НаправлениеДеятельности", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьСтатьяРасходовСписания Тогда
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&СтатьяРасходовСписания", "Т.СтатьяРасходовСписания");
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&АналитикаРасходов", "Т.АналитикаРасходов");
	Иначе
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&СтатьяРасходовСписания", "НЕОПРЕДЕЛЕНО");
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&АналитикаРасходов", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьСтатьяДоходов Тогда
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&СтатьяДоходов", "Т.СтатьяДоходов");
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&АналитикаДоходов", "Т.АналитикаДоходов");
	Иначе
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&СтатьяДоходов", "НЕОПРЕДЕЛЕНО");
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&АналитикаДоходов", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьСтатьяАктивовПассивов Тогда
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&СтатьяАктивовПассивов", "Т.СтатьяАктивовПассивов");
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&АналитикаАктивовПассивов", "Т.АналитикаАктивовПассивов");
	Иначе
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&СтатьяАктивовПассивов", "НЕОПРЕДЕЛЕНО");
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&АналитикаАктивовПассивов", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьПодразделение Тогда
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&Подразделение", "Т.Подразделение");
	Иначе
		ШаблонТекстаЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "&Подразделение", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	//ВТДвиженияРасчетПоСреднескользящей
	ТекстЗапроса = СтрЗаменить(ШаблонТекстаЗапроса, "ИмяТаблицыДанныхДоходыРасходы", "ВТДвиженияРасчетПоСреднескользящей");
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбора",
		"Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы)");

	//ВТДвиженияРасчетПоДокументуИсточнику
	Если ПараметрыОтражения.ЕстьДокументИсточник Тогда

		ТекстЗапроса = ТекстЗапроса + "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|" + ШаблонТекстаЗапроса;
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ИмяТаблицыДанныхДоходыРасходы", "ВТДвиженияРасчетПоДокументуИсточнику");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбора",
			"Т.ОперацияУчетаСебестоимости = ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаРасходыАктивы)");
		
	КонецЕсли;
	
	//ВТДвиженияОтклоненияВСтоимости
	Если ПараметрыОтражения.ЕстьВыбытияПоФиксированнойСтоимости ИЛИ ПараметрыОтражения.ЕстьСторнирование Тогда

		ТекстЗапроса = ТекстЗапроса + "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|" + ШаблонТекстаЗапроса;
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ИмяТаблицыДанныхДоходыРасходы", "ВТДвиженияОтклоненияВСтоимости");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&УсловиеОтбора", "ИСТИНА");
		
	КонецЕсли;
	
	ПараметрыОтражения.ТекстыШаблоновОтражения.Вставить(Метаданные.РегистрыНакопления.ДвиженияНоменклатураДоходыРасходы.Имя, ТекстЗапроса);
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаКорДвиженияНоменклатураНоменклатура(ПараметрыОтражения)
	
	Если НЕ ПараметрыОтражения.ЕстьПеремещение И НЕ ПараметрыОтражения.ЕстьСписаниеНаДругиеПартии Тогда
		Возврат;
	КонецЕсли;
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Т.Период 										КАК Период,
	|	Т.Организация 									КАК Организация,
	|	&Подразделение 									КАК Подразделение,
	|	Т.ХозяйственнаяОперация 		 				КАК ХозяйственнаяОперация,
	|	Т.АналитикаУчетаНоменклатуры 	 				КАК АналитикаУчетаНоменклатуры,
	|	Т.ВидЗапасов 	 								КАК ВидЗапасов,
	|	ВидыЗапасов.ТипЗапасов 	 						КАК ТипЗапасов,
	|
	|	АналитикаНоменклатуры.Назначение.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	ВЫБОР КОГДА АналитикаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|		ТОГДА АналитикаНоменклатуры.Договор.Партнер
	|		ИНАЧЕ АналитикаНоменклатуры.МестоХранения
	|	КОНЕЦ КАК Склад,
	|	ВЫБОР
	|		КОГДА АналитикаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА АналитикаНоменклатуры.Номенклатура
	|		КОГДА &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета
	|			ТОГДА Т.ВидЗапасов
	|			ИНАЧЕ АналитикаНоменклатуры.Номенклатура
	|	КОНЕЦ КАК ИсточникГФУНоменклатуры,
	|
	|	Т.КорАналитикаУчетаНоменклатуры 	 			КАК КорАналитикаУчетаНоменклатуры,
	|	Т.КорВидЗапасов 	 							КАК КорВидЗапасов,
	|	КорВидыЗапасов.ТипЗапасов 	 					КАК КорТипЗапасов,
	|	&КорОрганизация 	 							КАК КорОрганизация,
	|
	|	КорАналитикаНоменклатуры.Назначение.НаправлениеДеятельности КАК КорНаправлениеДеятельности,
	|	ВЫБОР КОГДА КорАналитикаНоменклатуры.ТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|		ТОГДА КорАналитикаНоменклатуры.Договор.Партнер
	|		ИНАЧЕ КорАналитикаНоменклатуры.МестоХранения
	|	КОНЕЦ КАК КорСклад,
	|	ВЫБОР
	|		КОГДА КорАналитикаНоменклатуры.Номенклатура.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Работа)
	|			ТОГДА КорАналитикаНоменклатуры.Номенклатура
	|		КОГДА &ФормироватьВидыЗапасовПоГруппамФинансовогоУчета
	|			ТОГДА Т.КорВидЗапасов
	|			ИНАЧЕ КорАналитикаНоменклатуры.Номенклатура
	|	КОНЕЦ КАК КорИсточникГФУНоменклатуры,
	|
	|	Т.Стоимость 			КАК Стоимость,
	|	Т.СтоимостьБезНДС 		КАК СтоимостьБезНДС,
	|	Т.СтоимостьРегл 		КАК СтоимостьРегл,
	|	Т.СтоимостьУпр 			КАК СтоимостьУпр
	|ИЗ
	|	ВТДвиженияРасчетПоСреднескользящей КАК Т
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК АналитикаНоменклатуры
	|		ПО Т.АналитикаУчетаНоменклатуры = АналитикаНоменклатуры.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.КлючиАналитикиУчетаНоменклатуры КАК КорАналитикаНоменклатуры
	|		ПО Т.КорАналитикаУчетаНоменклатуры = КорАналитикаНоменклатуры.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК ВидыЗапасов
	|		ПО Т.ВидЗапасов = ВидыЗапасов.Ссылка
	|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыЗапасов КАК КорВидыЗапасов
	|		ПО Т.ВидЗапасов = КорВидыЗапасов.Ссылка
	|ГДЕ
	|	Т.ОперацияУчетаСебестоимости В
	|		(ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.Перемещение),
	|		 ЗНАЧЕНИЕ(Перечисление.ОперацииУчетаСебестоимости.СписаниеНаДругиеПартии))
	|	И Т.МетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|	И (Т.Стоимость <> 0 ИЛИ Т.СтоимостьБезНДС <> 0 ИЛИ Т.СтоимостьРегл <> 0 ИЛИ Т.СтоимостьУпр <> 0)
	|";
	
	Если ПараметрыОтражения.ЕстьПодразделение Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Подразделение", "Т.Подразделение");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&Подразделение", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	Если ПараметрыОтражения.ЕстьКорОрганизация Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&КорОрганизация", "Т.КорОрганизация");
	Иначе
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&КорОрганизация", "НЕОПРЕДЕЛЕНО");
	КонецЕсли;
	
	ПараметрыОтражения.ТекстыШаблоновОтражения.Вставить(Метаданные.РегистрыНакопления.ДвиженияНоменклатураНоменклатура.Имя, ТекстЗапроса);
	
КонецПроцедуры

Процедура ДобавитьТекстЗапросаОтклоненияВСтоимостиТоваров(ПараметрыОтражения)
	
	МассивТекстовЗапроса = Новый Массив;
	
	// Поля ресурсов, используемые запросе:
	ЧисловыеПоляСтрокой = "ДопРасходы,ДопРасходыБезНДС,ДопРасходыРегл,ДопРасходыУпр,НДСРегл,НДСУпр,ПостояннаяРазница,ВременнаяРазница";
	// Удалим поля, которых нет в таблице документа:
	ЧисловыеПоля = СтрРазделить(ЧисловыеПоляСтрокой, ",");
	ПоляДляУдаления = Новый Массив;
	Для каждого ЧисловоеПоле Из ЧисловыеПоля Цикл
		Если Не ПараметрыОтражения.КолонкиЗапроса.Свойство(ЧисловоеПоле) Тогда
			ПоляДляУдаления.Добавить(ЧисловоеПоле);
		КонецЕсли;
	КонецЦикла;
	ЧисловыеПоля = ОбщегоНазначенияКлиентСервер.РазностьМассивов(ЧисловыеПоля, ПоляДляУдаления);
	
	Если Не ЧисловыеПоля.Количество() Тогда
		Возврат;
	КонецЕсли;
	
	// Условия заполнения полей должны соответствовать тексту запроса в РасчетСебестоимостиПодготовкаДанных.ИсправитьПроблемыВДвиженияхИДокументах, область ОтклоненияВСтоимостиТоваров
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Т.Период 										КАК Период,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) 			КАК ВидДвижения,
	|	Т.Организация 									КАК Организация,
	|	Т.АналитикаУчетаНоменклатурыНоменклатура		КАК Номенклатура,
	|	Т.АналитикаУчетаНоменклатурыХарактеристика		КАК Характеристика,
	|	Т.ВидЗапасов 									КАК ВидЗапасов,
	|	ВЫБОР
	|		КОГДА НЕ Т.УчетныеПолитикиДетализироватьОтклоненияПоНаправлениямДеятельности
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка)
	|			ИНАЧЕ ЕСТЬNULL(Т.АналитикаУчетаНоменклатурыНазначениеНаправлениеДеятельности,
	|				ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка))
	|	КОНЕЦ											КАК НаправлениеДеятельности,
	|	ВЫБОР
	|		КОГДА НЕ Т.УчетныеПолитикиДетализироватьОтклоненияПоПодразделениям
	|			ТОГДА ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|		КОГДА Т.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Подразделение)
	|			ТОГДА Т.АналитикаУчетаНоменклатурыМестоХранения
	|		КОГДА Т.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.Склад)
	|			ТОГДА ВЫРАЗИТЬ(Т.АналитикаУчетаНоменклатурыМестоХранения КАК Справочник.Склады).Подразделение
	|		КОГДА Т.СпрКлючиНоменклатурыТипМестаХранения = ЗНАЧЕНИЕ(Перечисление.ТипыМестХранения.ДоговорКонтрагента)
	|			ТОГДА ВЫРАЗИТЬ(Т.АналитикаУчетаНоменклатурыМестоХранения КАК Справочник.ДоговорыКонтрагентов).Подразделение
	|			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|	КОНЕЦ 											КАК Подразделение,
	|	ВЫБОР
	|		КОГДА НЕ Т.УчетныеПолитикиДетализироватьОтклоненияПоСкладам
	|			ТОГДА НЕОПРЕДЕЛЕНО
	|			ИНАЧЕ Т.АналитикаУчетаНоменклатурыМестоХранения
	|	КОНЕЦ											КАК МестоХранения,
	|	НАЧАЛОПЕРИОДА(ВЫБОР КОГДА Т.ПериодДокументаИсточника = НЕОПРЕДЕЛЕНО
	|	  ИЛИ Т.ПериодДокументаИсточника = ДАТАВРЕМЯ(1,1,1)
	|		ТОГДА Т.Период
	|		ИНАЧЕ Т.ПериодДокументаИсточника
	|	КОНЕЦ, МЕСЯЦ)									КАК ПериодОтклонения,
	|	Т.ХозяйственнаяОперация 		 				КАК ХозяйственнаяОперация,
	|	Т.НастройкаХозяйственнойОперации 		 		КАК НастройкаХозяйственнойОперации,
	|	Т.ИдентификаторФинЗаписи 		 				КАК ИдентификаторФинЗаписи,
	|
	|	&ТекстЧисловыеПоля
	|ИЗ
	|	ВТДанныеДокумента КАК Т
	|ГДЕ
	|	Т.УчетныеПолитикиМетодОценкиСтоимостиТоваров = ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
	|	И ЕСТЬNULL(Т.ВидЗапасовТипЗапасов, НЕОПРЕДЕЛЕНО)  <> ЗНАЧЕНИЕ(Перечисление.ТипыЗапасов.СобственныйТоварПоНеотфактурованнойПоставке)
	|	И (&ТекстУсловия)";
	
	Если НЕ ПараметрыОтражения.КолонкиЗапроса.Свойство("ПериодДокументаИсточника") Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ПериодДокументаИсточника", "Период");
	КонецЕсли;

	// Основной запрос, в нем поля НДС не заполняютя:
	ОбнуляемыеПоля = СтрРазделить("НДСРегл,НДСУпр", ",");
	ТекстОсновногоЗапроса = ПреобразоватьЧисловыеПоляВЗапросе(ТекстЗапроса, ЧисловыеПоля, ОбнуляемыеПоля);
	МассивТекстовЗапроса.Добавить(ТекстОсновногоЗапроса);
	
	// Запрос включения НДС в стоимость, в нем заполняются только поля НДС:
	Если ПараметрыОтражения.КолонкиЗапроса.Свойство("НДСРегл") Тогда
		ОбнуляемыеПоля = ОбщегоНазначенияКлиентСервер.РазностьМассивов(ЧисловыеПоля, ОбнуляемыеПоля);
		ТекстЗапросаВключенияНДС = ПреобразоватьЧисловыеПоляВЗапросе(ТекстЗапроса, ЧисловыеПоля, ОбнуляемыеПоля);
		ТекстЗапросаВключенияНДС = СтрЗаменить(ТекстЗапросаВключенияНДС, "Т.ИдентификаторФинЗаписи", "Т.ИдентификаторСтроки");
		ТекстЗапросаВключенияНДС = СтрЗаменить(ТекстЗапросаВключенияНДС, "Т.НастройкаХозяйственнойОперации", "ЗНАЧЕНИЕ(Справочник.НастройкиХозяйственныхОпераций.ВключениеНДСВСтоимость)");
		ТекстЗапросаВключенияНДС = СтрЗаменить(ТекстЗапросаВключенияНДС, "ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)", "ЗНАЧЕНИЕ(Перечисление.МетодыОценкиСтоимостиТоваров.Среднескользящая)
		|	И Т.ВидДеятельностиНДС В (&ТипыНалогообложенияНДСУчитываетсяВСтоимости)
		|	И &ФормироватьНДСПредъявленныйПриВключенииВСтоимость
		//++ НЕ УТ
		|	И ТИПЗНАЧЕНИЯ(Т.Партия) <> ТИП(Справочник.ПартииПроизводства)
		//-- НЕ УТ
		|");
		Если ПараметрыОтражения.ВозможныРазныеПериодыВДвижениях Тогда
			ТекстЗапросаВключенияНДС = СтрЗаменить(ТекстЗапросаВключенияНДС, "ВТДанныеДокумента КАК Т", "ВТДанныеДокумента КАК Т
			|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПараметрыПартионногоУчетаДляПроведения КАК Параметры
			|	ПО Параметры.Период = НАЧАЛОПЕРИОДА(Т.Период, МЕСЯЦ)
			|		И Параметры.Организация = Т.Организация");
			ТекстЗапросаВключенияНДС = СтрЗаменить(ТекстЗапросаВключенияНДС, "&ФормироватьНДСПредъявленныйПриВключенииВСтоимость", "Параметры.ФормироватьНДСПредъявленныйПриВключенииВСтоимость");
		КонецЕсли;
		МассивТекстовЗапроса.Добавить(ТекстЗапросаВключенияНДС);
	КонецЕсли;
	
	ТекстЗапроса = СтрСоединить(МассивТекстовЗапроса, ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении());

	ПараметрыОтражения.ТекстыШаблоновОтражения.Вставить(Метаданные.РегистрыНакопления.ОтклоненияВСтоимостиТоваров.Имя, ТекстЗапроса);
	
КонецПроцедуры

Функция ПреобразоватьЧисловыеПоляВЗапросе(ИсходныйТекстЗапроса, ЧисловыеПоля, ОбнуляемыеПоля)
	
	ЗаменаПолеВКонечномЗапросе = Новый Соответствие;
	ЗаменаПолеВКонечномЗапросе.Вставить("ДопРасходы",			"ОтклоненияВСтоимостиСНДС");
	ЗаменаПолеВКонечномЗапросе.Вставить("ДопРасходыБезНДС",	"ОтклоненияВСтоимостиБезНДС");
	ЗаменаПолеВКонечномЗапросе.Вставить("ДопРасходыРегл",		"ОтклоненияВСтоимостиРегл");
	ЗаменаПолеВКонечномЗапросе.Вставить("ДопРасходыУпр", 		"ОтклоненияВСтоимостиУпр");
	
	МассивПолей = Новый Массив;
	МассивУсловий = Новый Массив;
	
	Для каждого ЧисловоеПоле Из ЧисловыеПоля Цикл
		
		ПсевдонимПоля = ?(ЗаменаПолеВКонечномЗапросе.Получить(ЧисловоеПоле) = Неопределено, ЧисловоеПоле, ЗаменаПолеВКонечномЗапросе.Получить(ЧисловоеПоле));
		ЗначениеПоля = ?(ОбнуляемыеПоля.Найти(ЧисловоеПоле) = Неопределено, "Т." + ЧисловоеПоле, "0");
		МассивПолей.Добавить(СтрШаблон("%1 КАК %2", ЗначениеПоля, ПсевдонимПоля));
		Если ЗначениеПоля <> "0" Тогда
			МассивУсловий.Добавить(СтрШаблон("%1 <> 0", ЗначениеПоля));
		КонецЕсли;
		
	КонецЦикла;
	
	ТекстЧисловыеПоля = СтрСоединить(МассивПолей, "," + Символы.ПС + Символы.Таб);
	ТекстУсловия = СтрСоединить(МассивУсловий, Символы.ПС + Символы.Таб + Символы.Таб + " " + "ИЛИ" + " ");
	
	ТекстЗапроса = СтрЗаменить(ИсходныйТекстЗапроса, "&ТекстЧисловыеПоля", ТекстЧисловыеПоля);
	Если НЕ ПустаяСтрока(ТекстУсловия) Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ТекстУсловия", ТекстУсловия);
	Иначе
	// Если в запросе нет числовых полей, то выполнять такой запрос не имеет смысла.
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "&ТекстУсловия", "ЛОЖЬ");
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция СуммовыеПоляСреднескользящей() Экспорт
	
	Возврат "Стоимость, СтоимостьБезНДС, СтоимостьРегл, СтоимостьУпр, СтоимостьЗабалансовая, СтоимостьЗабалансоваяРегл";
	
КонецФункции

#КонецОбласти

#Область Прочие

Процедура ПроверитьПоляЗапросаВыборкиДанных(ПараметрыОтражения, ОписаниеОперации, РазборСхемыЗапроса)
	
	Для Каждого Источники Из РазборСхемыЗапроса.ОписаниеЗапроса.Операторы[0].Источники Цикл
		Если НРег(Источники.Источник.Псевдоним) = НРег("ТаблицаДокумента") Тогда
			ИмяДокумента = Источники.Источник.ИмяТаблицы;
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
	ТаблицаДокументаУказанаИСовпадаетСОтражаемымДокументов = ИмяДокумента <> Неопределено
		И НРег(ПараметрыОтражения.МетаданныеДокумента.ПолноеИмя()) <> НРег(ИмяДокумента)
		И НРег("ДанныеДокументаШапка") <> НРег(ИмяДокумента);
	
	СтруктураПоляОперации = Новый Структура;
	СтруктураПоляЗапроса  = Новый Структура;
	
	Для Каждого Описание Из ОписаниеОперации.Поля Цикл
		СтруктураПоляОперации.Вставить(Описание.Имя, Описание.Дополнительное);
	КонецЦикла;
	
	Для Каждого Описание Из РазборСхемыЗапроса.КолонкиЗапроса Цикл
		СтруктураПоляЗапроса.Вставить(Описание.Ключ);
	КонецЦикла;
	
	ТекстПоляОперации = "";
	ТекстПоляЗапроса = "";
	
	Для Каждого Описание Из СтруктураПоляОперации Цикл
		Если НЕ СтруктураПоляЗапроса.Свойство(Описание.Ключ) И НЕ Описание.Значение Тогда
			ТекстПоляОперации = ТекстПоляОперации + ?(ТекстПоляОперации = "", "", ", ") + Описание.Ключ;
		КонецЕсли;
	КонецЦикла;
	
	Для Каждого Описание Из СтруктураПоляЗапроса Цикл
		Если НЕ СтруктураПоляОперации.Свойство(Описание.Ключ) Тогда
			ТекстПоляЗапроса = ТекстПоляЗапроса + ?(ТекстПоляЗапроса = "", "", ", ") + Описание.Ключ;
		КонецЕсли;
	КонецЦикла;
	
	Если ЗначениеЗаполнено(ТекстПоляЗапроса)
	 ИЛИ ЗначениеЗаполнено(ТекстПоляОперации)
	 ИЛИ ТаблицаДокументаУказанаИСовпадаетСОтражаемымДокументов Тогда
		ОбщегоНазначения.СообщитьПользователю(НСтр("ru = 'Ошибка в подготовке данных для операции';
													|en = 'An error occurred upon preparing the transaction data'") + ": " + РазборСхемыЗапроса.ВидОперации);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ТекстПоляЗапроса) Тогда
		ОбщегоНазначения.СообщитьПользователю(
			СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru = 'Лишние поля в запросе выборки данных операции ""%1"" для проведения документа: ""%2""';
					|en = 'Extra fields in the ""%1"" operation dataset query for document posting: ""%2""'"),
				ОписаниеОперации.ВидОперации,
				ТекстПоляЗапроса));
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ТекстПоляОперации) Тогда
		ОбщегоНазначения.СообщитьПользователю(
			СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
				НСтр("ru = 'Не хватает обязательных полей в запросе выборки данных операции ""%1"" для проведения документа: ""%2""';
					|en = 'Required fields are missing in the ""%1"" operation dataset query for document posting: ""%2""'"),
				ОписаниеОперации.ВидОперации,
				ТекстПоляОперации));
	КонецЕсли;
	
	Если ТаблицаДокументаУказанаИСовпадаетСОтражаемымДокументов Тогда
		
		ТекстОшибки = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru = 'Не совпадает имя документа ""%1"" с основной таблицей запроса ""%2""';
				|en = 'The document name ""%1"" does not match the main query table ""%2""'"),
			ПараметрыОтражения.МетаданныеДокумента.Имя,
			ИмяДокумента);
			
		ОбщегоНазначения.СообщитьПользователю(ТекстОшибки);
		
	КонецЕсли;
	
КонецПроцедуры

Функция МенеджерОбъектаПоСсылке(Документ)
	
	МенеджерДокумента = ОбщегоНазначения.МенеджерОбъектаПоСсылке(Документ);
	
	//++ Локализация
	МетаДокумент = Метаданные.НайтиПоТипу(ТипЗнч(Документ));
	
	Если МетаДокумент = Метаданные.Документы.МаркировкаТоваровГИСМ
	 ИЛИ МетаДокумент = Метаданные.Документы.ПеремаркировкаТоваровГИСМ Тогда
	 
		ИмяМодуля = Метаданные.ОбщиеМодули.МаркировкаТоваровГИСМУТ.Имя;
		МенеджерДокумента = ОбщегоНазначения.ОбщийМодуль(ИмяМодуля);
		
	КонецЕсли;
	//-- Локализация
	
	Возврат МенеджерДокумента;
	
КонецФункции

Функция ВсеПоляРегистра(МетаданныеРегистра)
	
	ПоляРегистра = Новый Структура;
	
	Для Каждого МетаПоле Из МетаданныеРегистра.Измерения Цикл
		ПоляРегистра.Вставить(МетаПоле.Имя);
	КонецЦикла; 
		
	Для Каждого МетаПоле Из МетаданныеРегистра.Ресурсы Цикл
		ПоляРегистра.Вставить(МетаПоле.Имя);
	КонецЦикла; 
	
	Для Каждого МетаПоле Из МетаданныеРегистра.Реквизиты Цикл
		ПоляРегистра.Вставить(МетаПоле.Имя);
	КонецЦикла; 
	
	Для Каждого МетаПоле Из МетаданныеРегистра.СтандартныеРеквизиты Цикл
		ПоляРегистра.Вставить(МетаПоле.Имя);
	КонецЦикла; 
	
	Возврат ПоляРегистра;
	
КонецФункции

#КонецОбласти

#КонецОбласти

// Встраивание в документ:
// Добавить область ПартионныйУчет в конец области Проведение
// Добавить в область процедуры
//	- ОписаниеРегистровУчетаЗатратИСебестоимости
//	- УстановитьДополнительныеПараметрыОперацийУчетаЗатратИСебестоимости
//	- СформироватьДополнительныеТаблицыОперацийУчетаЗатратИСебестоимости
//	- ОписаниеОперацийУчетаСебестоимости
// 	 (примеры заполнения текстов процедур см., например, в документе РеализацияТоваровУслуг)
// Добавить вызов РасчетСебестоимостиПроведениеДокументов. ОтразитьВМеханизмеУчетаЗатратИСебестоимости в процедуру ДанныеДокументаДляПроведения
