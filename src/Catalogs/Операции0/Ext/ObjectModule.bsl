
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ПередЗаписью(Отказ)
	
	Если ОбменДанными.Загрузка 
		ИЛИ ПометкаУдаления Тогда
		Возврат;
	КонецЕсли;
	
	Если КодСуществует() Тогда
		
		ТекстСообщения = СтрШаблон(НСтр("ru = 'Код ""%1"" уже существует.';
										|en = 'Code %1 already exists.'"), Код);
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, Ссылка,, "Объект", Отказ);
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция КодСуществует()
	
	Запрос = Новый Запрос();
	Запрос.УстановитьПараметр("Ссылка", Ссылка);
	Запрос.УстановитьПараметр("Код", Код);
	Запрос.Текст =
	"ВЫБРАТЬ ПЕРВЫЕ 1
	|	1 КАК Поле1
	|ИЗ
	|	Справочник.Операции0 КАК Операции0
	|ГДЕ
	|	Операции0.Код = &Код
	|	И Операции0.Ссылка <> &Ссылка
	|	И НЕ Операции0.ПометкаУдаления";
	
	СтатусВозврата = НЕ Запрос.Выполнить().Пустой();
	
	Возврат СтатусВозврата;
	
КонецФункции

#КонецОбласти

#КонецЕсли
