
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Заголовок   = Параметры.ЗаголовокФормы;
	
	Если Параметры.Картинка.Вид <> ВидКартинки.Пустая Тогда
		Элементы.Картинка.Картинка = Параметры.Картинка;
	Иначе
		Элементы.Картинка.Видимость = Ложь;
	КонецЕсли;
	
	ПоказатьКомментарий = Ложь;
	КонстантыРасхождений = ИнтеграцияСМаркетплейсамиСервер.КонстантыРасхождений();
	
	Для Каждого КлючИЗначение Из Параметры.СведенияОМаркировке Цикл
		СтрокаТаблицыЗначений = СведенияОМаркировке.Добавить();
		ЗаполнитьЗначенияСвойств(СтрокаТаблицыЗначений, КлючИЗначение.Значение);
		
		СтрокаТаблицыЗначений.СтатусКартинка      = БиблиотекаКартинок[КонстантыРасхождений[КлючИЗначение.Значение.Статус]];
		СтрокаТаблицыЗначений.СтатусПредставление = КлючИЗначение.Значение.Статус;
		СтрокаТаблицыЗначений.Количество          = Макс(КлючИЗначение.Значение.Количество, 
			КлючИЗначение.Значение.КоличествоПоДокументу);
		
		СтрокаТаблицыЗначений.Комментарий = "";
		Если СтрокаТаблицыЗначений.Количество > 1 Тогда
			СтрокаТаблицыЗначений.Комментарий = СтрокаТаблицыЗначений.Комментарий
				+ СтрокаТаблицыЗначений.Количество + " " + КлючИЗначение.Значение.Упаковка + " ";
		КонецЕсли;
		Если ЗначениеЗаполнено(КлючИЗначение.Значение.ТекстСообщения) Тогда
			СтрокаТаблицыЗначений.Комментарий = СтрокаТаблицыЗначений.Комментарий
				+ СтрЗаменить(КлючИЗначение.Значение.ТекстСообщения, НСтр("ru = '(в файле нет сведений)';
																			|en = '(there are no information records in the file)'"), "");
		КонецЕсли;
		
		Если ЗначениеЗаполнено(СтрокаТаблицыЗначений.Комментарий) Тогда
			ПоказатьКомментарий = Истина;
		КонецЕсли;
	КонецЦикла;
	
	Элементы.СведенияОМаркировкеКомментарий.Видимость = ПоказатьКомментарий;
	УстановитьУсловноеОформление();
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура УстановитьУсловноеОформление()
	
	УсловноеОформление.Элементы.Очистить();
	
	//
	ЭлементУсловногоОформления = УсловноеОформление.Элементы.Добавить();
	
	ПолеЭлемента = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ПолеЭлемента.Поле = Новый ПолеКомпоновкиДанных(Элементы.СведенияОМаркировкеСтатусПредставление.Имя);
	
	ОтборЭлемента = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ОтборЭлемента.ЛевоеЗначение  = Новый ПолеКомпоновкиДанных("СведенияОМаркировке.СтатусПредставление");
	ОтборЭлемента.ВидСравнения   = ВидСравненияКомпоновкиДанных.Равно;
	ОтборЭлемента.ПравоеЗначение = "КодыМаркировкиСовпадают";
	
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("Текст", НСтр("ru = 'Совпадает';
																					|en = 'Match'"));
	
	//
	ЭлементУсловногоОформления = УсловноеОформление.Элементы.Добавить();
	
	ПолеЭлемента = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ПолеЭлемента.Поле = Новый ПолеКомпоновкиДанных(Элементы.СведенияОМаркировкеСтатусПредставление.Имя);
	
	ОтборЭлемента = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ОтборЭлемента.ЛевоеЗначение  = Новый ПолеКомпоновкиДанных("СведенияОМаркировке.СтатусПредставление");
	ОтборЭлемента.ВидСравнения   = ВидСравненияКомпоновкиДанных.Равно;
	ОтборЭлемента.ПравоеЗначение = "ЛишнийКодМаркировки";
	
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("Текст", НСтр("ru = 'Недостача';
																					|en = 'Shortage'"));
	
	//
	ЭлементУсловногоОформления = УсловноеОформление.Элементы.Добавить();
	
	ПолеЭлемента = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ПолеЭлемента.Поле = Новый ПолеКомпоновкиДанных(Элементы.СведенияОМаркировкеСтатусПредставление.Имя);
	
	ОтборЭлемента = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ОтборЭлемента.ЛевоеЗначение  = Новый ПолеКомпоновкиДанных("СведенияОМаркировке.СтатусПредставление");
	ОтборЭлемента.ВидСравнения   = ВидСравненияКомпоновкиДанных.Равно;
	ОтборЭлемента.ПравоеЗначение = "КодовМаркировкиНетВФайле";
	
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("Текст",      НСтр("ru = 'Нет в файле';
																						|en = 'Not in the file'"));
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ЦветТекста", ЦветаСтиля.ЦветНеАктивнойСтроки);
	
	//
	ЭлементУсловногоОформления = УсловноеОформление.Элементы.Добавить();
	
	ПолеЭлемента = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ПолеЭлемента.Поле = Новый ПолеКомпоновкиДанных(Элементы.СведенияОМаркировкеСтатусПредставление.Имя);
	
	ОтборЭлемента = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ОтборЭлемента.ЛевоеЗначение  = Новый ПолеКомпоновкиДанных("СведенияОМаркировке.СтатусПредставление");
	ОтборЭлемента.ВидСравнения   = ВидСравненияКомпоновкиДанных.Равно;
	ОтборЭлемента.ПравоеЗначение = "ПересортицаКодовМаркировки";
	
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("Текст", НСтр("ru = 'Пересортица';
																					|en = 'Stock reclass'"));
	
	//
	ЭлементУсловногоОформления = УсловноеОформление.Элементы.Добавить();
	
	ПолеЭлемента = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ПолеЭлемента.Поле = Новый ПолеКомпоновкиДанных(Элементы.СведенияОМаркировкеСтатусПредставление.Имя);
	
	ОтборЭлемента = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ОтборЭлемента.ЛевоеЗначение  = Новый ПолеКомпоновкиДанных("СведенияОМаркировке.СтатусПредставление");
	ОтборЭлемента.ВидСравнения   = ВидСравненияКомпоновкиДанных.Равно;
	ОтборЭлемента.ПравоеЗначение = "ИзлишекКодовМаркировки";
	
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("Текст", НСтр("ru = 'Излишек';
																					|en = 'Surplus'"));
	
	//
	ЭлементУсловногоОформления = УсловноеОформление.Элементы.Добавить();
	
	ПолеЭлемента = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ПолеЭлемента.Поле = Новый ПолеКомпоновкиДанных(Элементы.СведенияОМаркировкеСтатусПредставление.Имя);
	
	ОтборЭлемента = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ОтборЭлемента.ЛевоеЗначение  = Новый ПолеКомпоновкиДанных("СведенияОМаркировке.СтатусПредставление");
	ОтборЭлемента.ВидСравнения   = ВидСравненияКомпоновкиДанных.Равно;
	ОтборЭлемента.ПравоеЗначение = "НедостачаКодовМаркировки";
	
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("Текст", НСтр("ru = 'Недостача';
																					|en = 'Shortage'"));
	
	//
	ЭлементУсловногоОформления = УсловноеОформление.Элементы.Добавить();
	
	ПолеЭлемента = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
	ПолеЭлемента.Поле = Новый ПолеКомпоновкиДанных(Элементы.СведенияОМаркировкеСтатусПредставление.Имя);
	
	ОтборЭлемента = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	ОтборЭлемента.ЛевоеЗначение  = Новый ПолеКомпоновкиДанных("СведенияОМаркировке.СтатусПредставление");
	ОтборЭлемента.ВидСравнения   = ВидСравненияКомпоновкиДанных.Равно;
	ОтборЭлемента.ПравоеЗначение = "КодыМаркировкиНеНайдены";
	
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("Текст",      НСтр("ru = 'Не найден';
																						|en = 'Not found'"));
	ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ЦветТекста", ЦветаСтиля.ЦветОсобогоТекста);
	
КонецПроцедуры

#КонецОбласти
