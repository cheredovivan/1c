#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
#Область ОбработчикиСобытий

Процедура ПередЗаписью(Отказ, Замещение)
	
	Для Каждого Запись Из ЭтотОбъект Цикл
		
		КалендарьБылНезаполнен = Ложь;
		
		ПроставитьОбязательностьЭДО(Запись);
		
		// Дата Ответа Рассчитанная
		Если ЗначениеЗаполнено(Запись.ДнейДоОтвета) Тогда
			
			Если Запись.ЭДООбязателен Тогда
				Результат = ТребованияФНС.ДатаПлюсДниПоКалендарю(Запись.ДатаОтправкиТребования, Запись.ДнейДоОтвета);
			ИначеЕсли ЗначениеЗаполнено(Запись.ДатаПодтверждения) Тогда 
				Результат = ТребованияФНС.ДатаПлюсДниПоКалендарю(Запись.ДатаПодтверждения, Запись.ДнейДоОтвета);
			КонецЕсли;
			
			Если Результат <> Неопределено Тогда
				Запись.ОтветитьДо = Результат.Дата;
				
				Если НЕ Результат.КалендарьЗаполнен Тогда
					КалендарьБылНезаполнен = Истина;
				КонецЕсли;
			КонецЕсли;
			
		КонецЕсли;
		
		Если НЕ ЗначениеЗаполнено(Запись.ПодтвердитьДо)
			И ЗначениеЗаполнено(Запись.ДатаОтправкиТребования) Тогда
			
			Результат = ТребованияФНС.ДатаПлюсДниПоКалендарю(Запись.ДатаОтправкиТребования, 6);
			Запись.ПодтвердитьДо = Результат.Дата;
			
			Если НЕ Результат.КалендарьЗаполнен Тогда
				КалендарьБылНезаполнен = Истина;
			КонецЕсли;
			
		КонецЕсли;
		
		Запись.КалендарьБылНезаполнен = КалендарьБылНезаполнен;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура ПроставитьОбязательностьЭДО(Запись)
	
	Если НЕ Запись.ОтветилиНаВопросПроЭДО И ТребованияФНСВызовСервера.ПолученоПозже5февраля2025(Запись.Ссылка) Тогда
		
		ЭДООбязательно = ТребованияФНСВызовСервера.ЭДООбязательноПоОрганизации(Запись.Ссылка.Организация);
		Если ЭДООбязательно = Истина Тогда
			Запись.ЭДООбязателен = Истина;
			Запись.ОтветилиНаВопросПроЭДО = Истина;
		ИначеЕсли ЭДООбязательно = Ложь Тогда
			Запись.ЭДООбязателен = Ложь;
			Запись.ОтветилиНаВопросПроЭДО = Истина;
		КонецЕсли;
		
	КонецЕсли;
		
КонецПроцедуры

#КонецОбласти

#КонецЕсли


