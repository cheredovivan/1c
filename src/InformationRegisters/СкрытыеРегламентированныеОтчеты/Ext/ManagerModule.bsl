#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область СлужебныеПроцедурыИФункции

// Обработчик обновления БРО.
//
// Вызывается при первом заполнении либо в случае необходимости обновления справочника регламентированных отчетов.
//
Процедура СкрытьВосстановитьОтчеты() Экспорт
	
	ОбработкаОбновлениеОтчетов = Обработки.ОбновлениеРегламентированнойОтчетности.Создать();

	ДеревоОтчетов = ОбработкаОбновлениеОтчетов.ПолучитьСписокОтчетов();

	Если ДеревоОтчетов.Строки.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;

	ОбработкаОбновлениеОтчетов.СкрытьВосстановитьОтчеты(ДеревоОтчетов);
	
КонецПроцедуры

// Обработчик обновления БРО 0.0.0.1, 1.0.1.41
//
Процедура ДобавитьСкрытыеОтчетыВРегистрСведений() Экспорт
	
	НачатьТранзакцию();
	
	Запрос = Новый Запрос("ВЫБРАТЬ
						  |	УдалитьРегламентированныеОтчеты.Ссылка КАК Ссылка
						  |ИЗ
						  |	Справочник.УдалитьРегламентированныеОтчеты КАК УдалитьРегламентированныеОтчеты
						  |ГДЕ
						  | УдалитьРегламентированныеОтчеты.ЭтоГруппа = ЛОЖЬ И
						  |	УдалитьРегламентированныеОтчеты.УдалитьНеПоказыватьВСписке = ИСТИНА");
						  
	ТаблицаРезультатов = Запрос.Выполнить().Выгрузить();
	
	Для Каждого СтрТаблЗнач Из ТаблицаРезультатов Цикл
		
		РеглОтчет = Справочники.РегламентированныеОтчеты.НайтиПоРеквизиту("ИсточникОтчета", СтрТаблЗнач.Ссылка.ИсточникОтчета);
		
		Если НЕ РеглОтчет.Пустая() Тогда
			
			СкрытыеРегламентированныеОтчеты = РегистрыСведений.СкрытыеРегламентированныеОтчеты.СоздатьМенеджерЗаписи();
			ЗначенияРеквизитов = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(РеглОтчет, "Ссылка");
			СкрытыеРегламентированныеОтчеты.РегламентированныйОтчет = ЗначенияРеквизитов.Ссылка;
			СкрытыеРегламентированныеОтчеты.УдалитьРегламентированныйОтчет = СтрТаблЗнач.Ссылка;
			СкрытыеРегламентированныеОтчеты.Записать();
			
		КонецЕсли;
		
	КонецЦикла;
						
	ЗафиксироватьТранзакцию();
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли